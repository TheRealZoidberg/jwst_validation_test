
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>JWST Pipeline Validation Notebook: calwebb_image3, NIRCam imaging &#8212; Notebook repository template</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" href="../../../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/main.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script src="../../../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../../_static/sphinx-thebe.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.1/dist/embed-amd.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="JWST Pipeline Validation Notebook: calwebb_image3, NIRCam imaging" href="exec_jwst_image3_nircam_test.html" />
    <link rel="prev" title="JWST Pipeline Validation Notebook: calwebb_detector1, jump unit tests" href="../../jump/exec_jwst_jump_unit_tests.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../../_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Notebook repository template</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../../index.html">
                    <no title>
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../background/jwst_background_miri_test/jwst_background_subtraction_miri_imaging_testing.html">
   JWST Pipeline Validation Notebook: calwebb_image2, background subtraction for MIRI imaging
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../background/jwst_background_miri_test/exec_jwst_background_subtraction_miri_imaging_testing.html">
   JWST Pipeline Validation Notebook: calwebb_image2, background subtraction for MIRI imaging
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../background/jwst_background_miri_test/exec_background_sub-miri-lrs-slit.html">
   JWST Pipeline Validation Testing Notebook: Background_subtract() for MIRI LRS SLIT
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../background/jwst_background_miri_test/background_sub-miri-lrs-slit.html">
   JWST Pipeline Validation Testing Notebook: Background_subtract() for MIRI LRS SLIT
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../pathloss/jwst_pathloss_nirspec_test/exec_jwst_pathloss_nirspec_test.html">
   JWST Pipeline Validation Testing Notebook: spec2, pathloss step
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../pathloss/jwst_pathloss_nirspec_test/jwst_pathloss_nirspec_test.html">
   JWST Pipeline Validation Testing Notebook: spec2, pathloss step
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../msaflagopen/jwst_msa_flagging_nirspec_test.html">
   JWST Pipeline Validation Testing Notebook: spec2, msa_flagging step
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../msaflagopen/exec_jwst_msa_flagging_nirspec_test.html">
   JWST Pipeline Validation Testing Notebook: spec2, msa_flagging step
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../resample/jwst_resample_miri_test/jwst_resample_miri_lrs_slit.html">
   JWST Pipeline Validation Testing Notebook: Calwebb_Image3, Resample step
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../resample/jwst_resample_miri_test/exec_jwst_resample_miri_lrs_slit.html">
   JWST Pipeline Validation Testing Notebook: Calwebb_Image3, Resample step
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../resample/jwst_resample_miri_test/jwst_resample_miri_testing.html">
   JWST Pipeline Validation Testing Notebook: Calwebb_Image3, Resample step with MIRI imaging
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../resample/jwst_resample_miri_test/exec_jwst_resample_miri_testing.html">
   JWST Pipeline Validation Testing Notebook: Calwebb_Image3, Resample step with MIRI imaging
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../example_notebook/example_notebook.html">
   Draft: Notebook title
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../source_catalog/jwst_source_catalog_miri_test/exec_jwst_source_catalog_miri_test.html">
   JWST Pipeline Validation Notebook: calwebb_image3: source_catalog with MIRI
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../source_catalog/jwst_source_catalog_miri_test/jwst_source_catalog_miri_test.html">
   JWST Pipeline Validation Notebook: calwebb_image3: source_catalog with MIRI
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../source_catalog/jwst_source_catalog_nircam_test/jwst_nircam_imaging_source_catalog.html">
   JWST Pipeline Validation Notebook: NIRCam, calwebb_image3, source_catalog
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../source_catalog/jwst_source_catalog_nircam_test/exec_jwst_nircam_imaging_source_catalog.html">
   JWST Pipeline Validation Notebook: NIRCam, calwebb_image3, source_catalog
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../lastframe/exec_jwst_lastframe_unit_tests.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, lastframe unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../lastframe/jwst_lastframe_unit_tests.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, lastframe unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../photom/jwst_photom_miri_test/exec_photom_miri_lrs_slitless.html">
   JWST Pipeline Validation Testing Notebook: MIRI LRS Slitless spectroscopy
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../photom/jwst_photom_miri_test/photom_miri_mrs_test.html">
   JWST Pipeline Validation Testing Notebook: Spec2, photom, MIRI
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../photom/jwst_photom_miri_test/exec_photom_miri_lrs_slit.html">
   JWST Pipeline Validation Testing Notebook: MIRI LRS Slit spectroscopy
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../photom/jwst_photom_miri_test/exec_photom_miri_mrs_test.html">
   JWST Pipeline Validation Testing Notebook: Spec2, photom, MIRI
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../photom/jwst_photom_miri_test/photom_miri_lrs_slit.html">
   JWST Pipeline Validation Testing Notebook: MIRI LRS Slit spectroscopy
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../photom/jwst_photom_miri_test/photom_miri_lrs_slitless.html">
   JWST Pipeline Validation Testing Notebook: MIRI LRS Slitless spectroscopy
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../photom/jwst_photom_miri_test/exec_jwst_photom_miri_test.html">
   JWST Pipeline Validation Notebook: photom with MIRI Imager
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../photom/jwst_photom_miri_test/jwst_photom_miri_test.html">
   JWST Pipeline Validation Notebook: photom with MIRI Imager
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ami3/run_ami_pipeline.html">
   JWST Pipeline Validation Notebook:  AMI3, AMI3 Pipeline
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ami3/exec_ami_analyze_verify.html">
   JWST Pipeline Validation Notebook: AMI3, AmiAnalyze
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ami3/exec_ami_average.html">
   JWST Pipeline Validation Notebook:  calwebb_ami3, ami_average
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ami3/exec_ami_normalize.html">
   JWST Pipeline Validation Notebook: calwebb_ami3, ami_normalize
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ami3/exec_run_ami_pipeline.html">
   JWST Pipeline Validation Notebook:  AMI3, AMI3 Pipeline
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ami3/ami_normalize.html">
   JWST Pipeline Validation Notebook: calwebb_ami3, ami_normalize
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ami3/ami_average.html">
   JWST Pipeline Validation Notebook:  calwebb_ami3, ami_average
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ami3/ami_analyze_verify.html">
   JWST Pipeline Validation Notebook: AMI3, AmiAnalyze
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../assign_wcs/jwst_assign_wcs_nirspec_test/jwst_assign_wcs_nirspec_test.html">
   JWST Pipeline Validation Testing Notebook: NIRSpec, spec2, assign_wcs step
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../assign_wcs/jwst_assign_wcs_nirspec_test/exec_jwst_assign_wcs_nirspec_test.html">
   JWST Pipeline Validation Testing Notebook: NIRSpec, spec2, assign_wcs step
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../assign_wcs/jwst_assign_wcs_niriss_test/jwst_assign_wcs_niriss_image.html">
   JWST Pipeline Validation Notebook: NIRISS, image2, assign_wcs
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../assign_wcs/jwst_assign_wcs_niriss_test/exec_jwst_assign_wcs_niriss_image.html">
   JWST Pipeline Validation Notebook: NIRISS, image2, assign_wcs
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../assign_wcs/jwst_assign_wcs_miri_test/exec_assign_wcs-miri-mrs.html">
   JWST Pipeline Validation Testing Notebook: MIRI MRS Spec2: Assign_wcs()
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../assign_wcs/jwst_assign_wcs_miri_test/exec_assign_wcs-miri-lrs-tso.html">
   JWST Pipeline Validation Testing Notebook: MIRI LRS Time Series Observation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../assign_wcs/jwst_assign_wcs_miri_test/assign_wcs-miri-lrs-slit.html">
   JWST Pipeline Validation Testing Notebook: MIRI LRS Slit
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../assign_wcs/jwst_assign_wcs_miri_test/assign_wcs-miri-mrs.html">
   JWST Pipeline Validation Testing Notebook: MIRI MRS Spec2: Assign_wcs()
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../assign_wcs/jwst_assign_wcs_miri_test/assign_wcs-miri-lrs-tso.html">
   JWST Pipeline Validation Testing Notebook: MIRI LRS Time Series Observation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../assign_wcs/jwst_assign_wcs_miri_test/exec_assign_wcs-miri-lrs-slit.html">
   JWST Pipeline Validation Testing Notebook: MIRI LRS Slit
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../barshadow/jwst_barshadow_nirspec_test/jwst_barshadow_nirspec_test.html">
   JWST Pipeline Validation Testing Notebook: spec2, barshadow step
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../barshadow/jwst_barshadow_nirspec_test/exec_jwst_barshadow_nirspec_test.html">
   JWST Pipeline Validation Testing Notebook: spec2, barshadow step
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../reset/jwst_reset_miri_test/exec_jwst_reset_miri_testing.html">
   JWST Pipeline Validation Testing Notebook: Calwebb_detector1, reset step for MIRI
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../reset/jwst_reset_miri_test/jwst_reset_miri_testing.html">
   JWST Pipeline Validation Testing Notebook: Calwebb_detector1, reset step for MIRI
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../refpix/jwst_refpix_unit_tests.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, refpix unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../refpix/exec_jwst_refpix_unit_tests.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, refpix unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../flat_field/jwst_flat_field_nirspec_test/jwst_flat_field_nirspec_test.html">
   JWST Pipeline Validation Testing Notebook: spec2, flat_field step
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../flat_field/jwst_flat_field_nirspec_test/exec_jwst_flat_field_nirspec_test.html">
   JWST Pipeline Validation Testing Notebook: spec2, flat_field step
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../flat_field/jwst_flat_field_miri_test/exec_flatfield_analysis_slitless.html">
   JWST Pipeline Validation Testing Notebook: MIRI LRS Slitless spectroscopy
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../flat_field/jwst_flat_field_miri_test/exec_jwst_flat_field_miri_test.html">
   JWST Pipeline Validation Testing notebook: flat_field step with MIRI Imaging
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../flat_field/jwst_flat_field_miri_test/exec_flat-miri-lrs-slit.html">
   JWST Pipeline Validation Testing Notebook: MIRI LRS Slit spectroscopy
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../flat_field/jwst_flat_field_miri_test/flatfield_analysis_slitless.html">
   JWST Pipeline Validation Testing Notebook: MIRI LRS Slitless spectroscopy
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../flat_field/jwst_flat_field_miri_test/exec_flat_miri_mrs_test.html">
   JWST Pipeline Validation Testing Notebook: Spec2, flat_field, MIRI
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../flat_field/jwst_flat_field_miri_test/flat-miri-lrs-slit.html">
   JWST Pipeline Validation Testing Notebook: MIRI LRS Slit spectroscopy
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../flat_field/jwst_flat_field_miri_test/jwst_flat_field_miri_test.html">
   JWST Pipeline Validation Testing notebook: flat_field step with MIRI Imaging
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../flat_field/jwst_flat_field_miri_test/flat_miri_mrs_test.html">
   JWST Pipeline Validation Testing Notebook: Spec2, flat_field, MIRI
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../skymatch/jwst_skymatch_miri_test/jwst_skymatch_photom_miri_test.html">
   JWST Pipeline Validation Notebook: skymatch and photometry with MIRI
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../skymatch/jwst_skymatch_miri_test/exec_jwst_skymatch_miri_test.html">
   JWST Pipeline Validation Notebook: skymatch with MIRI
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../skymatch/jwst_skymatch_miri_test/exec_jwst_skymatch_photom_miri_test.html">
   JWST Pipeline Validation Notebook: skymatch and photometry with MIRI
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../skymatch/jwst_skymatch_miri_test/jwst_skymatch_miri_test.html">
   JWST Pipeline Validation Notebook: skymatch with MIRI
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../jump/jwst_jump_miri_test/jwst_jump_miri_testing.html">
   JWST Pipeline Validation Testing Notebook: Calwebb_Detector1, Jump step
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../jump/jwst_jump_miri_test/exec_jwst_jump_miri_testing.html">
   JWST Pipeline Validation Testing Notebook: Calwebb_Detector1, Jump step
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../jump/jwst_jump_unit_tests.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, jump unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../jump/exec_jwst_jump_unit_tests.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, jump unit tests
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   JWST Pipeline Validation Notebook: calwebb_image3, NIRCam imaging
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="exec_jwst_image3_nircam_test.html">
   JWST Pipeline Validation Notebook: calwebb_image3, NIRCam imaging
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../jwst_image3_miri_test/exec_jwst_image3_miri_test.html">
   JWST Pipeline Validation Notebook: calwebb_image3 with MIRI
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../jwst_image3_miri_test/jwst_image3_miri_test.html">
   JWST Pipeline Validation Notebook: calwebb_image3 with MIRI
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../calwebb_detector1/jwst_detector1_nircam_test/jwst_detector1_nircam_test.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, NIRCam imaging
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../calwebb_detector1/jwst_detector1_nircam_test/exec_jwst_detector1_nircam_test.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, NIRCam imaging
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../calwebb_detector1/jwst_detector1_miri_test/exec_jwst_detector1_miri_imtso_testing.html">
   JWST Pipeline Validation Testing Notebook: Calwebb_Detector1 for MIRI TSO imaging
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../calwebb_detector1/jwst_detector1_miri_test/jwst_detector1_miri_imtso_testing.html">
   JWST Pipeline Validation Testing Notebook: Calwebb_Detector1 for MIRI TSO imaging
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../calwebb_detector1/jwst_detector1_miri_test/exec_caldetector1-miri-lrs-tso.html">
   JWST Pipeline Validation Testing Notebook: MIRI LRS Time Series Observation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../calwebb_detector1/jwst_detector1_miri_test/caldetector1-miri-lrs-tso.html">
   JWST Pipeline Validation Testing Notebook: MIRI LRS Time Series Observation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../rscd/jwst_rscd_unit_tests.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, rscd unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../rscd/exec_jwst_rscd_unit_tests.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, rscd unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../rscd/jwst_rscd_miri_test/exec_jwst_miri_rscd_testing.html">
   JWST Pipeline Validation Testing Notebook: Calwebb_Detector1, RSCD step
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../rscd/jwst_rscd_miri_test/jwst_miri_rscd_testing.html">
   JWST Pipeline Validation Testing Notebook: Calwebb_Detector1, RSCD step
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../calwebb_image2/jwst_image2_nircam_test/jwst_image2_nircam_test.html">
   JWST Pipeline Validation Notebook: calwebb_image2, NIRCam imaging
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../calwebb_image2/jwst_image2_nircam_test/exec_jwst_image2_nircam_test.html">
   JWST Pipeline Validation Notebook: calwebb_image2, NIRCam imaging
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ramp_fitting/exec_jwst_ramp_fitting_unit_tests.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, ramp_fitting unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ramp_fitting/jwst_ramp_fitting_unit_tests.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, ramp_fitting unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../firstframe/exec_jwst_firstframe_unit_tests.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, firstframe unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../firstframe/jwst_firstframe_unit_tests.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, firstframe unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../dq_init/exec_jwst_dq_init_unit_tests.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, dq_init unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../dq_init/jwst_dq_init_unit_tests.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, dq_init unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../cube_build/jwst_cube_build_miri_test/test_cube_build_spec3.html">
   JWST Pipeline Validation Testing Notebook: Cube Build with MIRISIM Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../cube_build/jwst_cube_build_miri_test/exec_testing_point_source_flux_conservation_modeshep_all.html">
   JWST Pipeline Validation Testing Notebook: Point Source Flux Conservation Modeshep
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../cube_build/jwst_cube_build_miri_test/testing_point_source_flux_conservation_modeshep_all.html">
   JWST Pipeline Validation Testing Notebook: Point Source Flux Conservation Modeshep
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../cube_build/jwst_cube_build_miri_test/exec_test_cube_build_spec3.html">
   JWST Pipeline Validation Testing Notebook: Cube Build with MIRISIM Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../saturation/exec_jwst_saturation_unit_tests.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, saturation unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../saturation/jwst_saturation_unit_tests.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, saturation unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../extract_2d/jwst_extract_2d_nirspec_test/jwst_extract_2d_nirspec_test.html">
   JWST Pipeline Validation Testing Notebook: spec2, extract_2d step
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../extract_2d/jwst_extract_2d_nirspec_test/exec_jwst_extract_2d_nirspec_test.html">
   JWST Pipeline Validation Testing Notebook: spec2, extract_2d step
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../persistence/exec_jwst_persistence_unit_tests.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, persistence unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../persistence/jwst_persistence_unit_tests.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, persistence unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../extract_1d/jwst_extract_1d_miri_test/exec_extract_1d-spec2-miri-lrs-slit.html">
   JWST Pipeline Validation Testing Notebook: MIRI LRS Slit
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../extract_1d/jwst_extract_1d_miri_test/extract_1d-spec2-miri-lrs-slitless.html">
   JWST Pipeline Validation Testing Notebook: MIRI LRS Slitless
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../extract_1d/jwst_extract_1d_miri_test/extract_1d-spec2-miri-lrs-slit.html">
   JWST Pipeline Validation Testing Notebook: MIRI LRS Slit
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../extract_1d/jwst_extract_1d_miri_test/exec_extract_1d-spec2-miri-lrs-slitless.html">
   JWST Pipeline Validation Testing Notebook: MIRI LRS Slitless
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../dark_current/exec_jwst_dark_current_unit_tests.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, dark_current unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../dark_current/jwst_dark_current_unit_tests.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, dark_current unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../templates/jwst_validation_notebook_template.html">
   JWST Pipeline Validation Notebook:
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../templates/exec_jwst_validation_notebook_template.html">
   JWST Pipeline Validation Notebook:
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../templates/validation_test_template.html">
   JWST Pipeline Validation Testing Notebook: Descriptive Name of Test You Are Performing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../templates/exec_validation_test_template.html">
   JWST Pipeline Validation Testing Notebook: Descriptive Name of Test You Are Performing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ipc/exec_jwst_ipc_unit_tests.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, ipc unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ipc/jwst_ipc_unit_tests.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, ipc unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/background/exec_jwst_background_unit_tests.html">
   JWST calwebb_image2, background unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/background/jwst_background_unit_tests.html">
   JWST calwebb_image2, background unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/jwst_nirspec_regression_tests.html">
   JWST NIRSpec regression tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/flatfield/exec_jwst_flatfield_unit_tests.html">
   JWST calwebb_image2 and calwebb_spec2, flatfield unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/flatfield/jwst_flatfield_unit_tests.html">
   JWST calwebb_image2 and calwebb_spec2, flatfield unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/jwst_nircam_regression_tests.html">
   JWST NIRCam regression tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/resample/exec_jwst_resample_unit_tests.html">
   JWST calwebb_image2 and calwebb_spec2, resample unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/resample/jwst_resample_unit_tests.html">
   JWST calwebb_image2 and calwebb_spec2, resample unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/jwst_niriss_regression_tests.html">
   JWST NIRISS regression tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/source_catalog/jwst_source_catalog_unit_tests.html">
   JWST calwebb_image3, source_catalog unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/source_catalog/exec_jwst_source_catalog_unit_tests.html">
   JWST calwebb_image3, source_catalog unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/exec_jwst_fgs_regression_tests.html">
   JWST FGS regression tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/photom/jwst_photom_unit_tests.html">
   JWST calwebb_image2 and calwebb_spec2, photom unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/photom/exec_jwst_photom_unit_tests.html">
   JWST calwebb_image2 and calwebb_spec2, photom unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/assign_wcs/jwst_assign_wcs_unit_tests.html">
   JWST calwebb_image2 and calwebb_spec2, assign_wcs unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/assign_wcs/exec_jwst_assign_wcs_unit_tests.html">
   JWST calwebb_image2 and calwebb_spec2, assign_wcs unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/skymatch/jwst_skymatch_unit_tests.html">
   JWST calwebb_image3, skymatch unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/skymatch/exec_jwst_skymatch_unit_tests.html">
   JWST calwebb_image3, skymatch unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/exec_jwst_niriss_regression_tests.html">
   JWST NIRISS regression tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/exec_jwst_nirspec_regression_tests.html">
   JWST NIRSpec regression tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/exec_jwst_nircam_regression_tests.html">
   JWST NIRCam regression tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/jwst_fgs_regression_tests.html">
   JWST FGS regression tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/exec_jwst_miri_regression_tests.html">
   JWST MIRI regression tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/jwst_miri_regression_tests.html">
   JWST MIRI regression tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/tweakreg/exec_jwst_tweakreg_unit_tests.html">
   JWST calwebb_image3, tweakreg unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/tweakreg/jwst_tweakreg_unit_tests.html">
   JWST calwebb_image3, tweakreg unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/outlier_detection/jwst_outlier_detection_unit_tests.html">
   JWST calwebb_image3, calwebb_spec3, calwebb_coron3, calwebb_tso3, outlier_detection unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/outlier_detection/exec_jwst_outlier_detection_unit_tests.html">
   JWST calwebb_image3, calwebb_spec3, calwebb_coron3, calwebb_tso3, outlier_detection unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../tweakreg/jwst_tweakreg_miri_test/exec_jwst_tweakreg_miri_test.html">
   JWST Pipeline Validation Testing Notebook: Calwebb_Image3, Tweakreg step with MIRI imaging
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../tweakreg/jwst_tweakreg_miri_test/jwst_tweakreg_miri_test.html">
   JWST Pipeline Validation Testing Notebook: Calwebb_Image3, Tweakreg step with MIRI imaging
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../outlier_detection/jwst_outlier_detection_miri_test/exec_jwst_outlier_detection_miri_test.html">
   JWST Pipeline Validation Notebook: outlier_detection with MIRI
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../outlier_detection/jwst_outlier_detection_miri_test/exec_jwst_outlier_detection_view_miri_test.html">
   JWST Pipeline Validation Notebook: MIRI view outlier_detection
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../outlier_detection/jwst_outlier_detection_miri_test/exec_out_det_test2.html">
   JWST Pipeline Validation Notebook: Outlier Detection for MIRI MRS
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../outlier_detection/jwst_outlier_detection_miri_test/out_det_test2.html">
   JWST Pipeline Validation Notebook: Outlier Detection for MIRI MRS
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../outlier_detection/jwst_outlier_detection_miri_test/jwst_outlier_detection_miri_test.html">
   JWST Pipeline Validation Notebook: outlier_detection with MIRI
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../outlier_detection/jwst_outlier_detection_miri_test/jwst_outlier_detection_view_miri_test.html">
   JWST Pipeline Validation Notebook: MIRI view outlier_detection
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../superbias/exec_jwst_superbias_unit_tests.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, superbias unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../superbias/jwst_superbias_unit_tests.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, superbias unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../calwebb_coron3/exec_MIRI_shared_calcoron3_testing.html">
   JWST Pipeline Validation Testing Notebook: Calwebb_Coron3 for MIRI Coronagraphic Imaging
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../calwebb_coron3/jwst_calcoron3_nircam_test.html">
   JWST Pipeline Validation Notebook: calwebb_coron3 with NIRCam
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../calwebb_coron3/exec_jwst_calcoron3_nircam_test.html">
   JWST Pipeline Validation Notebook: calwebb_coron3 with NIRCam
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../calwebb_coron3/MIRI_shared_calcoron3_testing.html">
   JWST Pipeline Validation Testing Notebook: Calwebb_Coron3 for MIRI Coronagraphic Imaging
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../fringe/JWST_fringe_miri_test/exec_fringe_miri_mrs_test.html">
   JWST Pipeline Validation Testing Notebook: Spec2, fringe, MIRI
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../fringe/JWST_fringe_miri_test/fringe_miri_mrs_test.html">
   JWST Pipeline Validation Testing Notebook: Spec2, fringe, MIRI
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../image3/jwst_image3_miri_test/exec_jwst_image3_miri_test.html">
   JWST Pipeline Validation Notebook: calwebb_image3 with MIRI
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../image3/jwst_image3_miri_test/jwst_image3_miri_test.html">
   JWST Pipeline Validation Notebook: calwebb_image3 with MIRI
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../linearity/jwst_linearity_unit_tests.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, linearity unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../linearity/exec_jwst_linearity_unit_tests.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, linearity unit tests
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/TheRealZoidberg/jwst_validation_test/main?urlpath=tree/notebooks/calwebb_image3/jwst_image3_nircam_test/jwst_image3_nircam_test.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../../../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
      <li>
        <a href="https://colab.research.google.com/github/TheRealZoidberg/jwst_validation_test/blob/main/notebooks/calwebb_image3/jwst_image3_nircam_test/jwst_image3_nircam_test.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Colab"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../../../_static/images/logo_colab.png">
  </span>
<span class="headerbtn__text-container">Colab</span>
</a>

      </li>
      
      <li>
        
<button onclick="initThebeSBT()"
  class="headerbtn headerbtn-launch-thebe"
  data-toggle="tooltip"
data-placement="left"
title="Launch Thebe"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="headerbtn__text-container">Live Code</span>
</button>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/TheRealZoidberg/jwst_validation_test"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/TheRealZoidberg/jwst_validation_test/issues/new?title=Issue%20on%20page%20%2Fnotebooks/calwebb_image3/jwst_image3_nircam_test/jwst_image3_nircam_test.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../../../_sources/notebooks/calwebb_image3/jwst_image3_nircam_test/jwst_image3_nircam_test.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   JWST Pipeline Validation Notebook: calwebb_image3, NIRCam imaging
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#table-of-contents">
     Table of Contents
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#introduction">
   Introduction
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#jwst-calwg-algorithm">
   JWST CalWG Algorithm
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#defining-terms">
   Defining Terms
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#test-description">
   Test Description
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-description">
   Data Description
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#set-up-temporary-directory">
   Set up Temporary Directory
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#imports">
   Imports
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#define-convenience-functions-and-parameters">
   Define convenience functions and parameters
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#loading-the-data">
   Loading the Data
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-calwebb-image3-pipeline-ensemble-processing">
   The calwebb_image3 pipeline: Ensemble processing
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#run-the-entire-calwebb-image3-pipeline">
   Run the entire
   <code class="docutils literal notranslate">
    <span class="pre">
     calwebb_image3
    </span>
   </code>
   pipeline
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#examine-the-outputs">
     Examine the outputs
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#run-the-individual-pipeline-steps">
   Run the individual pipeline steps
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-wcs-refinement-step">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       WCS
      </span>
      <span class="pre">
       refinement
      </span>
     </code>
     step
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#summary">
       Summary
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#documentation">
       Documentation
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#arguments">
       Arguments
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#reference-files-used">
       Reference files used
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#parameter-reference-files">
       Parameter reference files
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#run-the-step">
       Run the step
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-sky-matching-step">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       Sky
      </span>
      <span class="pre">
       matching
      </span>
     </code>
     step
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id1">
       Summary
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id2">
       Documentation
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id3">
       Arguments
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id4">
       Reference files used
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id5">
       Parameter reference files
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id6">
       Run the step
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-outlier-detection-step">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       Outlier
      </span>
      <span class="pre">
       Detection
      </span>
     </code>
     step
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id7">
       Summary
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id8">
       Documentation
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id9">
       Arguments
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id10">
       Reference files used
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id11">
       Run the step
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-resample-step">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       Resample
      </span>
     </code>
     step
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id12">
       Summary
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id13">
       Documentation
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id14">
       Arguments
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id15">
       Reference files used
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id16">
       Run the step
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-source-catalog-step">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       Source
      </span>
      <span class="pre">
       Catalog
      </span>
     </code>
     step
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id17">
       Summary
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id18">
       Documentation
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id19">
       Arguments
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id20">
       Reference files used
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#run-the-step-with-the-run-method">
       Run the step with the run() method
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#examine-the-results">
       Examine the results
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#about-this-notebook">
     About this Notebook
    </a>
   </li>
  </ul>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>JWST Pipeline Validation Notebook: calwebb_image3, NIRCam imaging</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   JWST Pipeline Validation Notebook: calwebb_image3, NIRCam imaging
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#table-of-contents">
     Table of Contents
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#introduction">
   Introduction
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#jwst-calwg-algorithm">
   JWST CalWG Algorithm
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#defining-terms">
   Defining Terms
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#test-description">
   Test Description
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-description">
   Data Description
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#set-up-temporary-directory">
   Set up Temporary Directory
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#imports">
   Imports
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#define-convenience-functions-and-parameters">
   Define convenience functions and parameters
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#loading-the-data">
   Loading the Data
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-calwebb-image3-pipeline-ensemble-processing">
   The calwebb_image3 pipeline: Ensemble processing
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#run-the-entire-calwebb-image3-pipeline">
   Run the entire
   <code class="docutils literal notranslate">
    <span class="pre">
     calwebb_image3
    </span>
   </code>
   pipeline
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#examine-the-outputs">
     Examine the outputs
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#run-the-individual-pipeline-steps">
   Run the individual pipeline steps
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-wcs-refinement-step">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       WCS
      </span>
      <span class="pre">
       refinement
      </span>
     </code>
     step
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#summary">
       Summary
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#documentation">
       Documentation
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#arguments">
       Arguments
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#reference-files-used">
       Reference files used
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#parameter-reference-files">
       Parameter reference files
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#run-the-step">
       Run the step
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-sky-matching-step">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       Sky
      </span>
      <span class="pre">
       matching
      </span>
     </code>
     step
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id1">
       Summary
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id2">
       Documentation
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id3">
       Arguments
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id4">
       Reference files used
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id5">
       Parameter reference files
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id6">
       Run the step
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-outlier-detection-step">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       Outlier
      </span>
      <span class="pre">
       Detection
      </span>
     </code>
     step
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id7">
       Summary
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id8">
       Documentation
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id9">
       Arguments
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id10">
       Reference files used
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id11">
       Run the step
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-resample-step">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       Resample
      </span>
     </code>
     step
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id12">
       Summary
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id13">
       Documentation
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id14">
       Arguments
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id15">
       Reference files used
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id16">
       Run the step
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-source-catalog-step">
     The
     <code class="docutils literal notranslate">
      <span class="pre">
       Source
      </span>
      <span class="pre">
       Catalog
      </span>
     </code>
     step
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id17">
       Summary
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id18">
       Documentation
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id19">
       Arguments
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id20">
       Reference files used
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#run-the-step-with-the-run-method">
       Run the step with the run() method
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#examine-the-results">
       Examine the results
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#about-this-notebook">
     About this Notebook
    </a>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <p><a id="title_ID"></a></p>
<section class="tex2jax_ignore mathjax_ignore" id="jwst-pipeline-validation-notebook-calwebb-image3-nircam-imaging">
<h1>JWST Pipeline Validation Notebook: calwebb_image3, NIRCam imaging<a class="headerlink" href="#jwst-pipeline-validation-notebook-calwebb-image3-nircam-imaging" title="Permalink to this headline">#</a></h1>
<p><span style="color:red"> <strong>Instruments Affected</strong></span>: e.g., NIRCam</p>
<section id="table-of-contents">
<h2>Table of Contents<a class="headerlink" href="#table-of-contents" title="Permalink to this headline">#</a></h2>
<div style="text-align: left"> 
<p><br> <a class="reference external" href="#intro">Introduction*</a>
<br> <a class="reference external" href="#algorithm">JWST CalWG Algorithm*</a>
<br> <a class="reference external" href="#terms">Defining Terms</a>
<br> <a class="reference external" href="#description">Test Description*</a>
<br> <a class="reference external" href="#data_descr">Data Description*</a>
<br> <a class="reference external" href="#imports">Imports*</a>
<br> <a class="reference external" href="#convenience_functions">Convenience Functions</a>
<br> <a class="reference external" href="#data_load">Loading the Data*</a>
<br> <a class="reference external" href="#image3">calwebb_image3 - Ensemble calibrations</a>
<br> <a class="reference external" href="#image3_at_once">Run the entire pipeline</a>
<br> <a class="reference external" href="#image3_step_by_step">Run the individual pipeline steps</a>
<br> <a class="reference external" href="#tweakreg">The <code class="docutils literal notranslate"><span class="pre">WCS</span> <span class="pre">Refinement</span></code> step</a>
<br> <a class="reference external" href="#skymatch">The <code class="docutils literal notranslate"><span class="pre">Sky</span> <span class="pre">Matching</span></code> step</a>
<br> <a class="reference external" href="#outlier_detection">The <code class="docutils literal notranslate"><span class="pre">Outlier</span> <span class="pre">Detection</span></code> step</a>
<br> <a class="reference external" href="#resample">The <code class="docutils literal notranslate"><span class="pre">Resample</span></code> step</a>
<br> <a class="reference external" href="#source_catalog">The <code class="docutils literal notranslate"><span class="pre">Source</span> <span class="pre">Catalog</span></code> step</a>
<br> <a class="reference external" href="#about">About This Notebook*</a>
<br></p>
</div><p><a id='intro'></a></p>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="introduction">
<h1>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">#</a></h1>
<p>This notebook covers part 3 of the imaging mode data calibration module. In this notebook well check Stage 3 of the JWST calibration pipeline for imaging data, also known as <em>calwebb_image3</em>.</p>
<p>The <a class="reference external" href="https://jwst-pipeline.readthedocs.io/en/stable/jwst/pipeline/calwebb_image3.html">Stage 3 pipeline</a> takes one or more calibrated slope images (<code class="docutils literal notranslate"><span class="pre">*_cal.fits</span></code> files) and combines them into a final mosaic image. It then creates a source catalog from this mosaic. Several steps are performed in order to prepare the data for the mosaic creation. These steps largely mirror what is done by <a class="reference external" href="https://www.stsci.edu/scientific-community/software/drizzlepac.html">DrizzlePac</a> software when working with HST data.</p>
<p>First, using common sources found across the input images, the WCS of each image is refined. Background levels are then matched across the inputs. Spurious sources (e.g. cosmic rays that were not flagged in the <code class="docutils literal notranslate"><span class="pre">jump</span></code> step during Stage 1 processing) are removed by comparing each individual input image to a median image. The indivudal images are combined into a single mosaic image. A source catalog is created based on the mosaic image. And finally, the individual exposures are updated using the information from the preceding steps. New versions of the individual calibrated slope images (<code class="docutils literal notranslate"><span class="pre">*_cal.fits</span></code> files) are produced that contain matched backgrounds, flagged spurious sources, and improved WCS objects. Also, updated <a class="reference external" href="https://jwst-pipeline.readthedocs.io/en/stable/jwst/resample/main.html">resampled</a> images (<code class="docutils literal notranslate"><span class="pre">_i2d.fits</span></code> files) are created which all contain the final undistorted sky projection that is present in the mosaic image.</p>
<p>There are three final outputs. The first is updated copies of the input files. These updated files contain a consistent WCS, such that they overlap correctly. The second output is a final mosaic image created by drizzling the input images onto a distortion-free grid. And the final output is a source catalog wth basic photometry, created from the final mosaic image.</p>
<p>To check how the steps of the pipeline change the input data, we will use several NIRCam simulated data files and run them through the pipeline, examining the results at several places along the way.</p>
<p>All JWST imaging mode data, regardless of instrument, are processed through the <em>calwebb_image3</em> pipeline. The steps and the order in which they are performed is the same for all data.</p>
<p>Pipeline description: <a class="reference external" href="https://jwst-pipeline.readthedocs.io/en/latest/jwst/pipeline/calwebb_image3.html">https://jwst-pipeline.readthedocs.io/en/latest/jwst/pipeline/calwebb_image3.html</a></p>
<p>Pipeline code: <a class="reference external" href="https://github.com/spacetelescope/jwst/tree/master/jwst">https://github.com/spacetelescope/jwst/tree/master/jwst</a></p>
<p><a class="reference external" href="#title_ID">Top of Page</a></p>
<p><a id="algorithm"></a></p>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="jwst-calwg-algorithm">
<h1>JWST CalWG Algorithm<a class="headerlink" href="#jwst-calwg-algorithm" title="Permalink to this headline">#</a></h1>
<p>Multiple exposures from the direct imaging modes are combined into a combined image (e.g., mosaic).
The current status of the algorithms for this pipeline stage is summarized in the link below. Links are provided to individual pages where the details of the algorithms are given along with notes on why those algorithms were picked.</p>
<p>The algorithms for each step in each pipeline stage are split into baseline and enhanced versions (formerly known as vanilla and optimal, respectively).  See Baseline and Enhanced Algorithms for more details.
Input/Outputs of this stage refer to the main data products for the pipeline process. The full list of archive products for this (and all stages of the pipeline) is tabulated in Archive Products.</p>
<p><a class="reference external" href="https://outerspace.stsci.edu/display/JWSTCC/CALWEBB_IMAGE3">JWST CalWG algorithms for calwebb_image3</a></p>
<p><a class="reference external" href="#title_ID">Top of Page</a></p>
<p><a id="terms"></a></p>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="defining-terms">
<h1>Defining Terms<a class="headerlink" href="#defining-terms" title="Permalink to this headline">#</a></h1>
<p><strong>JWST</strong>: James Webb Space Telescope</p>
<p><strong>NIR</strong>: Near Infrared</p>
<p><a class="reference external" href="#title_ID">Top of Page</a></p>
<p><a id="description"></a></p>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="test-description">
<h1>Test Description<a class="headerlink" href="#test-description" title="Permalink to this headline">#</a></h1>
<p>This test is performed by running simulated data through the full pipeline and performing a visual inspection of the outputs. Next, the notebook does quick checks after each step in the calwebb_image3 pipeline, based on the algorithms defined.</p>
<p><a class="reference external" href="#title_ID">Top of Page</a></p>
<p><a id="data_descr"></a></p>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="data-description">
<h1>Data Description<a class="headerlink" href="#data-description" title="Permalink to this headline">#</a></h1>
<p>For this module, we will use an association of calibrated NIRCam simulated imaging exposures generated with Mirage.</p>
<p><a class="reference external" href="#title_ID">Top of Page</a></p>
<p><a id="tempdir"></a></p>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="set-up-temporary-directory">
<h1>Set up Temporary Directory<a class="headerlink" href="#set-up-temporary-directory" title="Permalink to this headline">#</a></h1>
<p>The following cell sets up a temporary directory (using pythons <code class="docutils literal notranslate"><span class="pre">tempfile.TemporaryDirectory()</span></code>), and changes the scripts active directory into that directory (using pythons <code class="docutils literal notranslate"><span class="pre">os.chdir()</span></code>). This is so that, when the notebook is run through, it will download files to (and create output files in) the temporary directory rather than in the notebooks directory. This makes cleanup significantly easier (since all output files are deleted when the notebook is shut down), and also means that different notebooks in the same directory wont interfere with each other when run by the automated webpage generation process.</p>
<p>If you want the notebook to generate output in the notebooks directory, simply dont run this cell.</p>
<p>If you have a file (or files) that are kept in the notebooks directory, and that the notebook needs to use while running, you can copy that file into the directory (the code to do so is present below, but commented out).</p>
<p><a class="reference external" href="#title_ID">Top of Page</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#****</span>
<span class="c1">#</span>
<span class="c1"># Set this variable to False to not use the temporary directory</span>
<span class="c1">#</span>
<span class="c1">#****</span>
<span class="n">use_tempdir</span> <span class="o">=</span> <span class="kc">True</span>

<span class="c1"># Create a temporary directory to hold notebook output, and change the working directory to that directory.</span>
<span class="kn">from</span> <span class="nn">tempfile</span> <span class="kn">import</span> <span class="n">TemporaryDirectory</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">shutil</span>

<span class="k">if</span> <span class="n">use_tempdir</span><span class="p">:</span>
    <span class="n">data_dir</span> <span class="o">=</span> <span class="n">TemporaryDirectory</span><span class="p">()</span>

    <span class="c1"># If you have files that are in the notebook&#39;s directory, but that the notebook will need to use while</span>
    <span class="c1"># running, copy them into the temporary directory here.</span>
    <span class="c1">#</span>
    <span class="c1"># files = [&#39;name_of_file&#39;]</span>
    <span class="c1"># for file_name in files:</span>
    <span class="c1">#     shutil.copy(file_name, os.path.join(data_dir.name, file_name))</span>

    <span class="c1"># Save original directory</span>
    <span class="n">orig_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>

    <span class="c1"># Move to new directory</span>
    <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">data_dir</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

<span class="c1"># For info, print out where the script is running</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Running in </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running in /tmp/tmpnwx2_o1i
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="k">if</span> <span class="s1">&#39;CRDS_CACHE_TYPE&#39;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;CRDS_CACHE_TYPE&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;local&#39;</span><span class="p">:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;CRDS_PATH&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;HOME&#39;</span><span class="p">],</span> <span class="s1">&#39;crds&#39;</span><span class="p">,</span> <span class="s1">&#39;cache&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;CRDS_CACHE_TYPE&#39;</span><span class="p">]):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;CRDS_PATH&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;CRDS_CACHE_TYPE&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;CRDS cache location: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;CRDS_PATH&#39;</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">KeyError</span><span class="g g-Whitespace">                                  </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">line</span> <span class="mi">7</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span>     <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;CRDS_CACHE_TYPE&#39;</span><span class="p">]):</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span>         <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;CRDS_PATH&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;CRDS_CACHE_TYPE&#39;</span><span class="p">]</span>
<span class="ne">----&gt; </span><span class="mi">7</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;CRDS cache location: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;CRDS_PATH&#39;</span><span class="p">]))</span>

<span class="nn">File /usr/share/miniconda/lib/python3.9/os.py:679,</span> in <span class="ni">_Environ.__getitem__</span><span class="nt">(self, key)</span>
<span class="g g-Whitespace">    </span><span class="mi">676</span>     <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">encodekey</span><span class="p">(</span><span class="n">key</span><span class="p">)]</span>
<span class="g g-Whitespace">    </span><span class="mi">677</span> <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">678</span>     <span class="c1"># raise KeyError with the original key value</span>
<span class="ne">--&gt; </span><span class="mi">679</span>     <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="kn">from</span> <span class="bp">None</span>
<span class="g g-Whitespace">    </span><span class="mi">680</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">decodevalue</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

<span class="ne">KeyError</span>: &#39;CRDS_PATH&#39;
</pre></div>
</div>
</div>
</div>
<p><a id='Imports_ID'></a></p>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="imports">
<h1>Imports<a class="headerlink" href="#imports" title="Permalink to this headline">#</a></h1>
<p>Import packages necessary for this notebook</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Module with functions to get information about objects:</span>
<span class="kn">from</span> <span class="nn">glob</span> <span class="kn">import</span> <span class="n">glob</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">shutil</span>

<span class="c1"># Numpy library:</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># To read association file</span>
<span class="kn">import</span> <span class="nn">json</span>

<span class="c1"># To download data</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="c1"># To examine parameter reference files</span>
<span class="kn">import</span> <span class="nn">asdf</span>

<span class="c1"># Astropy tools:</span>
<span class="kn">from</span> <span class="nn">astropy.io</span> <span class="kn">import</span> <span class="n">ascii</span><span class="p">,</span> <span class="n">fits</span>
<span class="kn">from</span> <span class="nn">astropy.utils.data</span> <span class="kn">import</span> <span class="n">download_file</span>
<span class="kn">from</span> <span class="nn">astropy.visualization</span> <span class="kn">import</span> <span class="n">ImageNormalize</span><span class="p">,</span> <span class="n">ManualInterval</span><span class="p">,</span> <span class="n">LogStretch</span><span class="p">,</span> <span class="n">LinearStretch</span>
</pre></div>
</div>
</div>
</div>
<p>Set up matplotlib for plotting</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>

<span class="c1"># Use this version for non-interactive plots (easier scrolling of the notebook)</span>
<span class="o">%</span><span class="k">matplotlib</span> inline

<span class="c1"># Use this version (outside of Jupyter Lab) if you want interactive plots</span>
<span class="c1"># %matplotlib notebook</span>

<span class="c1"># These gymnastics are needed to make the sizes of the figures</span>
<span class="c1"># be the same in both the inline and notebook versions</span>
<span class="o">%</span><span class="k">config</span> InlineBackend.print_figure_kwargs = {&#39;bbox_inches&#39;: None}

<span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;savefig.dpi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">80</span>
<span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.dpi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">80</span>
</pre></div>
</div>
</div>
</div>
<p>Import JWST pipeline-related modules</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># The entire calwebb_image3 pipeline</span>
<span class="kn">from</span> <span class="nn">jwst.pipeline</span> <span class="kn">import</span> <span class="n">calwebb_image3</span>

<span class="c1"># Individual steps that make up calwebb_image3</span>
<span class="kn">from</span> <span class="nn">jwst.tweakreg</span> <span class="kn">import</span> <span class="n">TweakRegStep</span>
<span class="kn">from</span> <span class="nn">jwst.skymatch</span> <span class="kn">import</span> <span class="n">SkyMatchStep</span>
<span class="kn">from</span> <span class="nn">jwst.outlier_detection</span> <span class="kn">import</span> <span class="n">OutlierDetectionStep</span>
<span class="kn">from</span> <span class="nn">jwst.resample</span> <span class="kn">import</span> <span class="n">ResampleStep</span>
<span class="kn">from</span> <span class="nn">jwst.source_catalog</span> <span class="kn">import</span> <span class="n">SourceCatalogStep</span>
<span class="kn">from</span> <span class="nn">jwst</span> <span class="kn">import</span> <span class="n">datamodels</span>
<span class="kn">from</span> <span class="nn">jwst.associations</span> <span class="kn">import</span> <span class="n">asn_from_list</span>
<span class="kn">from</span> <span class="nn">jwst.associations.lib.rules_level3_base</span> <span class="kn">import</span> <span class="n">DMS_Level3_Base</span>
</pre></div>
</div>
</div>
</div>
<p>Check which version of the pipeline we are running:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">jwst</span>
<span class="nb">print</span><span class="p">(</span><span class="n">jwst</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><a id='convenience_functions'></a></p>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="define-convenience-functions-and-parameters">
<h1>Define convenience functions and parameters<a class="headerlink" href="#define-convenience-functions-and-parameters" title="Permalink to this headline">#</a></h1>
<p>Here we define some functions that we will use repeatedly throughout the notebook.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Files created in this notebook will be saved</span>
<span class="c1"># in a subdirectory of the base directory called `Stage3`</span>
<span class="n">output_dir</span> <span class="o">=</span> <span class="s1">&#39;./&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">find_bad_pix_types</span><span class="p">(</span><span class="n">dq_value</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Given an integer representation of a series of bad pixel flags,</span>
<span class="sd">    identify which types of bad pixels the flags indicate.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    dq_value : uint16</span>
<span class="sd">        Value associated with a set of bad pixel flags</span>
<span class="sd">        </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    bad_nums : list</span>
<span class="sd">        List of integers representing the bad pixel types</span>
<span class="sd">        </span>
<span class="sd">    bad_types : list</span>
<span class="sd">        List of bad pixel type names corresponding to bad_nums</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Change integer into a byte array</span>
    <span class="n">bitarr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">binary_repr</span><span class="p">(</span><span class="n">dq_value</span><span class="p">)</span>
    
    <span class="c1"># Find the bad pixel type associated with each bit where</span>
    <span class="c1"># the flag is set</span>
    <span class="n">bad_nums</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">bad_types</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">elem</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bitarr</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
        <span class="k">if</span> <span class="n">elem</span> <span class="o">==</span> <span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">badval</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**</span><span class="n">i</span>
            <span class="n">bad_nums</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">badval</span><span class="p">)</span>
            <span class="n">key</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">key</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">datamodels</span><span class="o">.</span><span class="n">dqflags</span><span class="o">.</span><span class="n">pixel</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="n">badval</span><span class="p">)</span>
            <span class="n">bad_types</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">bad_nums</span><span class="p">,</span> <span class="n">bad_types</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">overlay_catalog</span><span class="p">(</span><span class="n">data_2d</span><span class="p">,</span> <span class="n">catalog</span><span class="p">,</span> <span class="n">flux_limit</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                    <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;MJy/str&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function to generate a 2D image of the data, </span>
<span class="sd">    with sources overlaid.</span>
<span class="sd">    </span>
<span class="sd">    data_2d : numpy.ndarray</span>
<span class="sd">        2D image to be displayed</span>
<span class="sd">        </span>
<span class="sd">    catalog : astropy.table.Table</span>
<span class="sd">        Table of sources</span>
<span class="sd">    </span>
<span class="sd">    flux_limit : float</span>
<span class="sd">        Minimum signal threshold to overplot sources from catalog.</span>
<span class="sd">        Sources below this limit will not be shown on the image.</span>
<span class="sd">        </span>
<span class="sd">    vmin : float</span>
<span class="sd">        Minimum signal value to use for scaling</span>
<span class="sd">        </span>
<span class="sd">    vmax : float</span>
<span class="sd">        Maximum signal value to use for scaling</span>
<span class="sd">        </span>
<span class="sd">    title : str</span>
<span class="sd">        String to use for the plot title</span>
<span class="sd">                </span>
<span class="sd">    units : str</span>
<span class="sd">        Units of the data. Used for the annotation in the</span>
<span class="sd">        color bar</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">norm</span> <span class="o">=</span> <span class="n">ImageNormalize</span><span class="p">(</span><span class="n">data_2d</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="n">ManualInterval</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">),</span>
                              <span class="n">stretch</span><span class="o">=</span><span class="n">LogStretch</span><span class="p">())</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">data_2d</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">catalog</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;aper_total_flux&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">&gt;</span> <span class="n">flux_limit</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;xcentroid&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;ycentroid&#39;</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span>
                     <span class="n">markersize</span><span class="o">=</span><span class="s1">&#39;3&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Pixel column&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Pixel row&#39;</span><span class="p">)</span>
    
    <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">units</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">0.15</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">title</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">show_image</span><span class="p">(</span><span class="n">data_2d</span><span class="p">,</span> <span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="p">,</span> <span class="n">xpixel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ypixel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">scale</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;MJy/str&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function to generate a 2D, log-scaled image of the data, </span>
<span class="sd">    with an option to highlight a specific pixel.</span>
<span class="sd">    </span>
<span class="sd">    data_2d : numpy.ndarray</span>
<span class="sd">        2D image to be displayed</span>
<span class="sd">        </span>
<span class="sd">    vmin : float</span>
<span class="sd">        Minimum signal value to use for scaling</span>
<span class="sd">        </span>
<span class="sd">    vmax : float</span>
<span class="sd">        Maximum signal value to use for scaling</span>
<span class="sd">        </span>
<span class="sd">    xpixel : int</span>
<span class="sd">        X-coordinate of pixel to highlight</span>
<span class="sd">        </span>
<span class="sd">    ypixel : int</span>
<span class="sd">        Y-coordinate of pixel to highlight</span>
<span class="sd">        </span>
<span class="sd">    title : str</span>
<span class="sd">        String to use for the plot title</span>
<span class="sd">        </span>
<span class="sd">    scale : str</span>
<span class="sd">        Specify scaling of the image. Can be &#39;log&#39; or &#39;linear&#39;</span>
<span class="sd">        </span>
<span class="sd">    units : str</span>
<span class="sd">        Units of the data. Used for the annotation in the</span>
<span class="sd">        color bar</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">scale</span> <span class="o">==</span> <span class="s1">&#39;log&#39;</span><span class="p">:</span>
        <span class="n">norm</span> <span class="o">=</span> <span class="n">ImageNormalize</span><span class="p">(</span><span class="n">data_2d</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="n">ManualInterval</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">),</span>
                              <span class="n">stretch</span><span class="o">=</span><span class="n">LogStretch</span><span class="p">())</span>
    <span class="k">elif</span> <span class="n">scale</span> <span class="o">==</span> <span class="s1">&#39;linear&#39;</span><span class="p">:</span>
        <span class="n">norm</span> <span class="o">=</span> <span class="n">ImageNormalize</span><span class="p">(</span><span class="n">data_2d</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="n">ManualInterval</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">),</span>
                              <span class="n">stretch</span><span class="o">=</span><span class="n">LinearStretch</span><span class="p">())</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">data_2d</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">xpixel</span> <span class="ow">and</span> <span class="n">ypixel</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xpixel</span><span class="p">,</span> <span class="n">ypixel</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Selected Pixel&#39;</span><span class="p">)</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">units</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Pixel column&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Pixel row&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">title</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><a class="reference external" href="#title_ID">Top of Page</a></p>
<p><a id="data_load"></a></p>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="loading-the-data">
<h1>Loading the Data<a class="headerlink" href="#loading-the-data" title="Permalink to this headline">#</a></h1>
<p>For this module, we will use calbrated rate files from a NIRCam simulated imaging exposure that is stored in Box. Lets download these files, as well as an association file and some parameter reference files.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">astropy.utils.data</span> <span class="kn">import</span> <span class="n">download_file</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">shutil</span> <span class="kn">import</span> <span class="n">move</span>
<span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">splitext</span>

<span class="k">def</span> <span class="nf">get_box_files</span><span class="p">(</span><span class="n">file_list</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">box_url</span><span class="p">,</span><span class="n">file_name</span> <span class="ow">in</span> <span class="n">file_list</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;https&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">box_url</span><span class="p">:</span>
            <span class="n">box_url</span> <span class="o">=</span> <span class="s1">&#39;https://stsci.box.com/shared/static/&#39;</span> <span class="o">+</span> <span class="n">box_url</span>
        <span class="n">downloaded_file</span> <span class="o">=</span> <span class="n">download_file</span><span class="p">(</span><span class="n">box_url</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">Path</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span><span class="o">.</span><span class="n">suffix</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="n">ext</span> <span class="o">=</span> <span class="n">splitext</span><span class="p">(</span><span class="n">box_url</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">file_name</span> <span class="o">+=</span> <span class="n">ext</span>
        <span class="n">move</span><span class="p">(</span><span class="n">downloaded_file</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span>
        
<span class="n">file_urls</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;https://stsci.box.com/shared/static/p2wlvndw25dk7xwk1tasqevmhkg6p55e.fits&#39;</span><span class="p">,</span>
             <span class="s1">&#39;https://stsci.box.com/shared/static/cmhc7kkf5z6373d2vwg7916lrhe5ia7u.fits&#39;</span><span class="p">,</span>
             <span class="s1">&#39;https://stsci.box.com/shared/static/sb18cpfqjbw1i09gvw0cpqkj6ymdn899.fits&#39;</span><span class="p">,</span>
             <span class="s1">&#39;https://stsci.box.com/shared/static/7d00b9isvss7njhcwmd8uiq8c7s4d845.json&#39;</span><span class="p">,</span>
             <span class="s1">&#39;https://stsci.box.com/shared/static/ja0gkd8c0x8p8konhr84wkuhwnpkqf4s.asdf&#39;</span><span class="p">,</span>
             <span class="s1">&#39;https://stsci.box.com/shared/static/yahdw55fotwrh7i6hhcxksj97qkf7j4r.asdf&#39;</span><span class="p">,</span>
              <span class="p">]</span>

<span class="n">file_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;jw98765001001_01101_00001_nrcb5_cal.fits&#39;</span><span class="p">,</span>
              <span class="s1">&#39;jw98765001001_01101_00002_nrcb5_cal.fits&#39;</span><span class="p">,</span>
              <span class="s1">&#39;jw98765001001_01101_00003_nrcb5_cal.fits&#39;</span><span class="p">,</span>
              <span class="s1">&#39;level3_lw_asn.json&#39;</span><span class="p">,</span>
              <span class="s1">&#39;jwst_nircam_pars-tweakregstep_0006.asdf&#39;</span><span class="p">,</span>
              <span class="s1">&#39;nircam_pars-sourcecatalogstep_f444w_clear.asdf&#39;</span>
              <span class="p">]</span>  

<span class="n">box_download_list</span> <span class="o">=</span> <span class="p">[(</span><span class="n">url</span><span class="p">,</span><span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="n">url</span><span class="p">,</span><span class="n">name</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">file_urls</span><span class="p">,</span><span class="n">file_names</span><span class="p">)]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">get_box_files</span><span class="p">(</span><span class="n">box_download_list</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">asn_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="s1">&#39;level3_lw_asn.json&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Open the association file and load into a json object</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">asn_file</span><span class="p">)</span> <span class="k">as</span> <span class="n">f_obj</span><span class="p">:</span>
    <span class="n">asn_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f_obj</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">asn_data</span>
</pre></div>
</div>
</div>
</div>
<p>Here we see that the association file begins with a few lines of data that give high-level information about the association. The most important entry here is the <code class="docutils literal notranslate"><span class="pre">asn_rule</span></code> field. Association files have different formats for the different stages of the pipeline. You should be sure that the <code class="docutils literal notranslate"><span class="pre">asn_rule</span></code> matches the pipeline that you will be running. In this case well be running the Stage 3 pipeline, and we see that the <code class="docutils literal notranslate"><span class="pre">asn_rule</span></code> mentions Level3, which is what we want.</p>
<p>Beneath these lines, we see the <code class="docutils literal notranslate"><span class="pre">products</span></code> field. This field contains a list of dictionaries that specify the files that belong to this association, and the types of those files. When the Stage 3 pipeline is run on this association file, all files listed here will be run through the calibration steps.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tweak_files</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;level3_lw_asn_0_tweakregstep.fits&#39;</span><span class="p">,</span>
               <span class="s1">&#39;level3_lw_asn_1_tweakregstep.fits&#39;</span><span class="p">,</span>
               <span class="s1">&#39;level3_lw_asn_2_tweakregstep.fits&#39;</span><span class="p">]</span>
<span class="n">tweak_product</span> <span class="o">=</span> <span class="s1">&#39;manual_asn_file&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tweakreg_asn</span> <span class="o">=</span> <span class="n">asn_from_list</span><span class="o">.</span><span class="n">asn_from_list</span><span class="p">(</span><span class="n">tweak_files</span><span class="p">,</span> <span class="n">rule</span><span class="o">=</span><span class="n">DMS_Level3_Base</span><span class="p">,</span> <span class="n">product_name</span><span class="o">=</span><span class="n">tweak_product</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Here is our new association, containing the three files created by the <code class="docutils literal notranslate"><span class="pre">tweakreg</span></code> step.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tweakreg_asn</span>
</pre></div>
</div>
</div>
</div>
<p>Now save the new association to a json file.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">output_test</span> <span class="o">=</span> <span class="s1">&#39;manual_tweakreg_asn.json&#39;</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_test</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outfile</span><span class="p">:</span>
    <span class="n">name</span><span class="p">,</span> <span class="n">serialized</span> <span class="o">=</span> <span class="n">tweakreg_asn</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="nb">format</span><span class="o">=</span><span class="s1">&#39;json&#39;</span><span class="p">)</span>
    <span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">serialized</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><a class="reference external" href="#title_ID">Top of Page</a></p>
<hr class="docutils" />
<p><a id='image3'></a></p>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="the-calwebb-image3-pipeline-ensemble-processing">
<h1>The calwebb_image3 pipeline: Ensemble processing<a class="headerlink" href="#the-calwebb-image3-pipeline-ensemble-processing" title="Permalink to this headline">#</a></h1>
<p>In the sections below, we will run the Stage 3 pipeline using an association file containing several NIRCam exposures. We will first call the entire <em>calwebb_image3</em> pipeline itself. The pipeline is a wrapper which will string together all of the appropriate steps in the proper order.</p>
<p>After running the entire pipeline, we will go back to the original calibrated slope images and manually run them through each of the steps that comprise the Stage 3 pipeline. For each step we will check in more detail what is going on and examine how the exposure files have changed.</p>
<p>See <a class="reference external" href="https://jwst-docs.stsci.edu/jwst-data-reduction-pipeline/algorithm-documentation/stages-of-processing/calwebb_image3">Figure 1</a> on the calwebb_image3 algorithm page for a map of the steps are performed on the input data.</p>
<p><a id='image3_at_once'></a></p>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="run-the-entire-calwebb-image3-pipeline">
<h1>Run the entire <code class="docutils literal notranslate"><span class="pre">calwebb_image3</span></code> pipeline<a class="headerlink" href="#run-the-entire-calwebb-image3-pipeline" title="Permalink to this headline">#</a></h1>
<p>In this section we show how to run the entire calwebb_image3 pipeline with a single call.</p>
<p>We set parameter values for some of the individual steps, save some outputs, etc, and then call the pipeline.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create an instance of the pipeline class</span>
<span class="n">image3</span> <span class="o">=</span> <span class="n">calwebb_image3</span><span class="o">.</span><span class="n">Image3Pipeline</span><span class="p">()</span>

<span class="c1"># Set some parameters that pertain to the</span>
<span class="c1"># entire pipeline</span>
<span class="n">image3</span><span class="o">.</span><span class="n">output_dir</span> <span class="o">=</span> <span class="n">output_dir</span>
<span class="n">image3</span><span class="o">.</span><span class="n">save_results</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">image3</span><span class="o">.</span><span class="n">tweakreg</span><span class="o">.</span><span class="n">save_results</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">image3</span><span class="o">.</span><span class="n">skymatch</span><span class="o">.</span><span class="n">save_results</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">image3</span><span class="o">.</span><span class="n">outlier_detection</span><span class="o">.</span><span class="n">save_results</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">image3</span><span class="o">.</span><span class="n">resample</span><span class="o">.</span><span class="n">save_results</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">image3</span><span class="o">.</span><span class="n">source_catalog</span><span class="o">.</span><span class="n">save_results</span> <span class="o">=</span> <span class="kc">True</span>

<span class="c1"># Set some parameters that pertain to some of</span>
<span class="c1"># the individual steps</span>
<span class="n">image3</span><span class="o">.</span><span class="n">tweakreg</span><span class="o">.</span><span class="n">snr_threshold</span> <span class="o">=</span> <span class="mf">10.0</span>  <span class="c1"># 5.0 is the default</span>
<span class="n">image3</span><span class="o">.</span><span class="n">tweakreg</span><span class="o">.</span><span class="n">kernel_fwhm</span> <span class="o">=</span> <span class="mf">2.302</span>  <span class="c1"># 2.5 is the default</span>
<span class="n">image3</span><span class="o">.</span><span class="n">tweakreg</span><span class="o">.</span><span class="n">brightest</span> <span class="o">=</span> <span class="mi">20</span>  <span class="c1"># 100 is the default</span>
<span class="n">image3</span><span class="o">.</span><span class="n">tweakreg</span><span class="o">.</span><span class="n">align_to_gaia</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">image3</span><span class="o">.</span><span class="n">tweakreg</span><span class="o">.</span><span class="n">save_gaia_catalog</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">image3</span><span class="o">.</span><span class="n">source_catalog</span><span class="o">.</span><span class="n">kernel_fwhm</span> <span class="o">=</span> <span class="mf">2.302</span>  <span class="c1"># pixels</span>
<span class="n">image3</span><span class="o">.</span><span class="n">source_catalog</span><span class="o">.</span><span class="n">snr_threshold</span> <span class="o">=</span> <span class="mf">10.</span>

<span class="c1"># Call the run() method</span>
<span class="n">image3</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">asn_file</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="examine-the-outputs">
<h2>Examine the outputs<a class="headerlink" href="#examine-the-outputs" title="Permalink to this headline">#</a></h2>
<p>Get the input filenames from the association file</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">input_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;expname&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">asn_data</span><span class="p">[</span><span class="s1">&#39;products&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;members&#39;</span><span class="p">]]</span>       
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">input_files</span>
</pre></div>
</div>
</div>
</div>
<p>Define the names of the other output files.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mosaic_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="s1">&#39;l3_lw_results_i2d.fits&#39;</span><span class="p">)</span>
<span class="n">source_cat_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="s1">&#39;l3_lw_results_cat.ecsv&#39;</span><span class="p">)</span>
<span class="n">segmentation_map_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="s1">&#39;l3_lw_results_segm.fits&#39;</span><span class="p">)</span>
<span class="n">cr_flagged_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;cal.fits&#39;</span><span class="p">,</span> <span class="s1">&#39;crf.fits&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">input_files</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>Read in the final mosaic image and display</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#with datamodels.open(mosaic_file) as mosaic:</span>
<span class="n">mosaic</span> <span class="o">=</span> <span class="n">datamodels</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">mosaic_file</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">mosaic</span><span class="o">.</span><span class="n">info</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">show_image</span><span class="p">(</span><span class="n">mosaic</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Lets look at the segmentation map that was created by the <code class="docutils literal notranslate"><span class="pre">source_catalog</span></code> step. This shows which pixels are associated with the identified sources.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">seg_map</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="n">segmentation_map_file</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">show_image</span><span class="p">(</span><span class="n">seg_map</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>And now examine the actual source catalog. For each source, the catalog lists the location, along with flux and AB/Vega magnitude values in three different apertures, as well as calculated values for an infinite aperture. Within the documentation, you can see the <a class="reference external" href="https://jwst-pipeline.readthedocs.io/en/stable/jwst/source_catalog/main.html#source-catalog-table">full list of column definitions</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">source_cat</span> <span class="o">=</span> <span class="n">ascii</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">source_cat_file</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">source_cat</span>
</pre></div>
</div>
</div>
</div>
<p>Finally, lets overlay the source catalog on top of the mosaic image. In order to cut down on the number of spurious detections, we only show sources above a minimum flux limit. Another way to cut down on the number of spurious detections would be to change some of the <code class="docutils literal notranslate"><span class="pre">source_catalog</span></code> parameter values when calling the pipeline above.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">overlay_catalog</span><span class="p">(</span><span class="n">mosaic</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">source_cat</span><span class="p">,</span> <span class="n">flux_limit</span><span class="o">=</span><span class="mf">5e-7</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Final mosaic with source catalog&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><a class="reference external" href="#title_ID">Top of Page</a></p>
<p><a id='image3_step_by_step'></a></p>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="run-the-individual-pipeline-steps">
<h1>Run the individual pipeline steps<a class="headerlink" href="#run-the-individual-pipeline-steps" title="Permalink to this headline">#</a></h1>
<p>In the sections below we run the steps contained within calwebb_image3 one at a time, in order to check the outputs for each step.</p>
<p><a id='tweakreg'></a></p>
<section id="the-wcs-refinement-step">
<h2>The <code class="docutils literal notranslate"><span class="pre">WCS</span> <span class="pre">refinement</span></code> step<a class="headerlink" href="#the-wcs-refinement-step" title="Permalink to this headline">#</a></h2>
<section id="summary">
<h3>Summary<a class="headerlink" href="#summary" title="Permalink to this headline">#</a></h3>
<p>This step, called the <code class="docutils literal notranslate"><span class="pre">tweakreg</span></code> step, mimics the behavior of the tweakreg step of Astrodrizzle. Given a series of images, it identifies point sources that are common to two or more images, and uses those sources locations to correct the WCS of the input images. The tweaks are such that when the images are later combined into a final mosiac image, the WCS of the input images will align on the sky.</p>
</section>
<section id="documentation">
<h3>Documentation<a class="headerlink" href="#documentation" title="Permalink to this headline">#</a></h3>
<p><a class="reference external" href="https://jwst-pipeline.readthedocs.io/en/stable/jwst/tweakreg/README.html">Full description</a> of the step.</p>
</section>
<section id="arguments">
<h3>Arguments<a class="headerlink" href="#arguments" title="Permalink to this headline">#</a></h3>
<p>There are many <a class="reference external" href="https://jwst-pipeline.readthedocs.io/en/stable/jwst/tweakreg/README.html#step-arguments">optional input arguments</a>.</p>
</section>
<section id="reference-files-used">
<h3>Reference files used<a class="headerlink" href="#reference-files-used" title="Permalink to this headline">#</a></h3>
<p>This step does not use any reference files.</p>
</section>
<section id="parameter-reference-files">
<h3>Parameter reference files<a class="headerlink" href="#parameter-reference-files" title="Permalink to this headline">#</a></h3>
<p>There are filter-dependent parameter reference files in CRDS for this step.</p>
</section>
<section id="run-the-step">
<h3>Run the step<a class="headerlink" href="#run-the-step" title="Permalink to this headline">#</a></h3>
<p>Since we ran the step above and saved the outputs, well skip this part and just load the outputs.</p>
<p>Lets look at what parameters are available to be set.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">TweakRegStep</span><span class="o">.</span><span class="n">spec</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># # Create instance, set parameters, and run</span>
<span class="c1"># tweakreg = TweakRegStep()</span>
<span class="c1"># tweakreg.kernel_fwhm = 2.302   # Gaussian FWHM in pixels</span>
<span class="c1"># tweakreg.snr_threshold = 10.0  # SNR threshold above background</span>
<span class="c1"># tweakreg.brightest = 100       # Number of brightest objects to keep</span>
<span class="c1"># tweakreg.save_results = True</span>
<span class="c1"># tweak = tweakreg.run(asn_file)</span>
</pre></div>
</div>
</div>
</div>
<p>The step saves the results in new fits files with updated WCS information. Lets look at the difference in the WCS before and after the step by loading the WCS objects, and calculating the RA, Dec at one pixel.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cal_file</span> <span class="o">=</span> <span class="s1">&#39;jw98765001001_01101_00003_nrcb5_cal.fits&#39;</span>
<span class="n">tweak_file</span> <span class="o">=</span> <span class="s1">&#39;jw98765001001_01101_00003_nrcb5_tweakreg.fits&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Open the files using datamodels</span>
<span class="c1">#with datamodels.open(cal_file) as cal_data:</span>
<span class="n">cal_data</span> <span class="o">=</span> <span class="n">datamodels</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">cal_file</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">cal_data</span><span class="p">))</span>
<span class="c1">#with datamodels.open(tweak_file) as tweak_data:</span>
<span class="n">tweak_data</span> <span class="o">=</span> <span class="n">datamodels</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">tweak_file</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">tweak_data</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cal_detector_to_world</span> <span class="o">=</span> <span class="n">cal_data</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">wcs</span><span class="o">.</span><span class="n">get_transform</span><span class="p">(</span><span class="s1">&#39;detector&#39;</span><span class="p">,</span> <span class="s1">&#39;world&#39;</span><span class="p">)</span>
<span class="n">run_detector_to_world</span> <span class="o">=</span> <span class="n">tweak_data</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">wcs</span><span class="o">.</span><span class="n">get_transform</span><span class="p">(</span><span class="s1">&#39;detector&#39;</span><span class="p">,</span> <span class="s1">&#39;world&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Lets look at RA, Dec in the center of the detector.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1024</span><span class="p">,</span> <span class="mi">1024</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">cal_detector_to_world</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">run_detector_to_world</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># What is the shift in the WCS before/after this step?</span>
<span class="n">delta_ra</span> <span class="o">=</span> <span class="n">run_detector_to_world</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">cal_detector_to_world</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">delta_dec</span> <span class="o">=</span> <span class="n">run_detector_to_world</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">cal_detector_to_world</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Shift in RA, Dec is (</span><span class="si">{:.4f}</span><span class="s1">, </span><span class="si">{:.4f}</span><span class="s1">) arcsec&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">delta_ra</span> <span class="o">*</span> <span class="mf">3600.</span><span class="p">,</span> <span class="n">delta_dec</span> <span class="o">*</span> <span class="mf">3600.</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;This is (</span><span class="si">{:.3f}</span><span class="s1">, </span><span class="si">{:.3f}</span><span class="s1">) pixels.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">delta_ra</span> <span class="o">*</span> <span class="mf">3600.</span> <span class="o">/</span> <span class="mf">.062</span><span class="p">,</span> <span class="n">delta_dec</span> <span class="o">*</span> <span class="mf">3600.</span> <span class="o">/</span> <span class="mf">0.062</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>This extremely small shift is expected, since the simulated data used in this exercise has no jitter or offsets added to it.</p>
<p>Just for fun, lets look at the contents of the WCS object in one of the files saved by the tweakreg step.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tweak_data</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">wcs</span>
</pre></div>
</div>
</div>
</div>
<p><a class="reference external" href="#title_ID">Top of Page</a></p>
<p><a id='skymatch'></a></p>
</section>
</section>
<section id="the-sky-matching-step">
<h2>The <code class="docutils literal notranslate"><span class="pre">Sky</span> <span class="pre">matching</span></code> step<a class="headerlink" href="#the-sky-matching-step" title="Permalink to this headline">#</a></h2>
<section id="id1">
<h3>Summary<a class="headerlink" href="#id1" title="Permalink to this headline">#</a></h3>
<p>This step calculates sky values in overlapping regions of the input images. Sky values can be computed for each image separately or in a way that matches the sky levels amongst the collection of images so as to minimize their differences.</p>
</section>
<section id="id2">
<h3>Documentation<a class="headerlink" href="#id2" title="Permalink to this headline">#</a></h3>
<p><a class="reference external" href="https://jwst-pipeline.readthedocs.io/en/stable/jwst/skymatch/README.html">Full description</a> of the step. Note that there are several possible methods for calculating the sky values.</p>
</section>
<section id="id3">
<h3>Arguments<a class="headerlink" href="#id3" title="Permalink to this headline">#</a></h3>
<p>There are <a class="reference external" href="https://jwst-pipeline.readthedocs.io/en/stable/jwst/skymatch/README.html#step-arguments">several optional arguments</a> for this step.</p>
</section>
<section id="id4">
<h3>Reference files used<a class="headerlink" href="#id4" title="Permalink to this headline">#</a></h3>
<p>This step does not use any reference files.</p>
</section>
<section id="id5">
<h3>Parameter reference files<a class="headerlink" href="#id5" title="Permalink to this headline">#</a></h3>
<p>There are currently no parameter reference files for this step</p>
</section>
<section id="id6">
<h3>Run the step<a class="headerlink" href="#id6" title="Permalink to this headline">#</a></h3>
<p>Since we ran the step above and saved the outputs, well skip this part and just load the outputs.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>    The easiest way to call this step is to supply the output object from the tweakreg call above. The other option would be to supply an association file. However, since the tweakreg step saved modified files, we would have to create a new association file that contains these new files, and then supply that association file in the call to skymatch. This pattern is the same for all of the steps in calwebb_image3, since all steps now expect association files for inputs, rather than individual files. 

    To create a new association file, follow the steps outlined in the [Creating your own association files](#diy_association) section above. Keep in mind that you could also simply make a copy of an existing association file and update the member filenames.
</pre></div>
</div>
<p>Lets also see what parameters are available to be set.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">SkyMatchStep</span><span class="o">.</span><span class="n">spec</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># skymatch = SkyMatchStep()</span>
<span class="c1"># skymatch.skymethod = &#39;global+match&#39; # this is the default. Set here as an example</span>
<span class="c1"># skymatch.save_results = True</span>
<span class="c1"># sky = skymatch.run(tweak)</span>
</pre></div>
</div>
</div>
</div>
<p>If you request to save the output from this step, two new header keywords are added to the primary header of the outputs. In each file, the <code class="docutils literal notranslate"><span class="pre">BKGLEVEL</span></code> keyword lists the computed background level, and the <code class="docutils literal notranslate"><span class="pre">BKGSUB</span></code> keyword says whether or not the background has been subtracted from the data.</p>
<p>In this case, we kept the default behavior of not subtracting the background from the data, as shown below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># sky_file = &#39;step_SkyMatchStep_2_skymatchstep.fits&#39;</span>
<span class="n">sky_file</span> <span class="o">=</span> <span class="s1">&#39;l3_lw_results_2_skymatch.fits&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sky_header</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">getheader</span><span class="p">(</span><span class="n">sky_file</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Computed background level: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sky_header</span><span class="p">[</span><span class="s1">&#39;BKGLEVEL&#39;</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Background subtracted: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sky_header</span><span class="p">[</span><span class="s1">&#39;BKGSUB&#39;</span><span class="p">]))</span>
</pre></div>
</div>
</div>
</div>
<p>Here we see that the calculated background value is not subtracted from the input data:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#with datamodels.open(sky_file) as sky_data:</span>
<span class="n">sky_data</span> <span class="o">=</span> <span class="n">datamodels</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">sky_file</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sky_data</span><span class="o">.</span><span class="n">info</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">sky_data</span><span class="o">.</span><span class="n">data</span> <span class="o">-</span> <span class="n">cal_data</span><span class="o">.</span><span class="n">data</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">sky_data</span><span class="o">.</span><span class="n">data</span> <span class="o">-</span> <span class="n">cal_data</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sky_data</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p><a class="reference external" href="#title_ID">Top of Page</a></p>
<p><a id='outlier_detection'></a></p>
</section>
</section>
<section id="the-outlier-detection-step">
<h2>The <code class="docutils literal notranslate"><span class="pre">Outlier</span> <span class="pre">Detection</span></code> step<a class="headerlink" href="#the-outlier-detection-step" title="Permalink to this headline">#</a></h2>
<section id="id7">
<h3>Summary<a class="headerlink" href="#id7" title="Permalink to this headline">#</a></h3>
<p>This step uses the collection of input files to identify and flag any cosmic rays or other transient image artifacts that were not flagged by the jump step in calwebb_detector1. While the jump step looked for large pixel-based deviations in the signal from group-to-group within an integration, the outlier detection step looks for large sky-based exposure-to-exposure devations in the signal. If a given location on the sky shows no signal above the noise in 4 out of 5 exposures, but a bright source in the remaining exposure, the outlier detction step will flag in the DQ map the pixels containing the source in the fifth exposure. These pixels will be ignored when the exposures are later combined into a final mosaic image.</p>
</section>
<section id="id8">
<h3>Documentation<a class="headerlink" href="#id8" title="Permalink to this headline">#</a></h3>
<p><a class="reference external" href="https://jwst-pipeline.readthedocs.io/en/stable/jwst/outlier_detection/main.html">Full description</a> of the step.</p>
</section>
<section id="id9">
<h3>Arguments<a class="headerlink" href="#id9" title="Permalink to this headline">#</a></h3>
<p>There are <a class="reference external" href="https://jwst-pipeline.readthedocs.io/en/stable/jwst/outlier_detection/arguments.html">numerous optional arguments</a> for this step, including several that apply to the resample step, which this step makes use of.</p>
</section>
<section id="id10">
<h3>Reference files used<a class="headerlink" href="#id10" title="Permalink to this headline">#</a></h3>
<p>This step does not use any reference files.</p>
</section>
<section id="id11">
<h3>Run the step<a class="headerlink" href="#id11" title="Permalink to this headline">#</a></h3>
<p>Since we ran the step above and saved the outputs, well skip this part and just load the outputs.</p>
<p>List the available parameters:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">OutlierDetectionStep</span><span class="o">.</span><span class="n">spec</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># # Run the step</span>
<span class="c1"># outlier_detection = OutlierDetectionStep()</span>
<span class="c1"># outlier_detection.save_results = True</span>
<span class="c1"># outlier = outlier_detection.run(sky)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># outlier_file = &#39;step_SkyMatchStep_2_a3001_outlierdetectionstep.fits&#39;</span>
<span class="n">outlier_file</span> <span class="o">=</span> <span class="s1">&#39;l3_lw_results_2_a3001_crf.fits&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Open using datamodels</span>
<span class="c1">#with datamodels.open(outlier_file) as outlier_data:</span>
<span class="n">outlier_data</span> <span class="o">=</span> <span class="n">datamodels</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">outlier_file</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">outlier_data</span><span class="o">.</span><span class="n">info</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get a list of pixels where DQ flags were changed</span>
<span class="n">new_flags</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">cal_data</span><span class="o">.</span><span class="n">dq</span> <span class="o">!=</span> <span class="n">outlier_data</span><span class="o">.</span><span class="n">dq</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Found </span><span class="si">{}</span><span class="s2"> pixels with updated DQ flag values.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">new_flags</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span>
</pre></div>
</div>
</div>
</div>
<p>Lets have a look at the DQ value for one of these pixels before and after the outlier detection step has run, in order to see what has changed.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">index</span> <span class="o">=</span> <span class="mi">12515</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">new_flags</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">index</span><span class="p">]</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">new_flags</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">index</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Pixel x, y = (</span><span class="si">{}</span><span class="s1">, </span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Before: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cal_data</span><span class="o">.</span><span class="n">dq</span><span class="p">[</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;After: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">outlier_data</span><span class="o">.</span><span class="n">dq</span><span class="p">[</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">]))</span>
</pre></div>
</div>
</div>
</div>
<p>Below we see that the OUTLIER and the DO_NOT_USE flags are new.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">find_bad_pix_types</span><span class="p">(</span><span class="n">cal_data</span><span class="o">.</span><span class="n">dq</span><span class="p">[</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">find_bad_pix_types</span><span class="p">(</span><span class="n">outlier_data</span><span class="o">.</span><span class="n">dq</span><span class="p">[</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>The image data itself remains unchanged.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">cal_data</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">],</span> <span class="n">outlier_data</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>When the Resample step is run next in order to create the final mosaic image, all pixels flagged as DO_NOT_USE will be ignored.</p>
<p><a class="reference external" href="#title_ID">Top of Page</a></p>
<p><a id='resample'> </a></p>
</section>
</section>
<section id="the-resample-step">
<h2>The <code class="docutils literal notranslate"><span class="pre">Resample</span></code> step<a class="headerlink" href="#the-resample-step" title="Permalink to this headline">#</a></h2>
<section id="id12">
<h3>Summary<a class="headerlink" href="#id12" title="Permalink to this headline">#</a></h3>
<p>We initially saw this step in calwebb_image2, where it was used to resample individual images onto a distortion-free pixel grid. This time, the Resample step works on the set of input images, which now all have a consistent WCS, thanks to the tweakreg step. The input images are combined into a final mosaic as they are resampled onto a distortion-free grid. The output of this step is the final image output of the Stage 3 pipeline.</p>
</section>
<section id="id13">
<h3>Documentation<a class="headerlink" href="#id13" title="Permalink to this headline">#</a></h3>
<p><a class="reference external" href="https://jwst-pipeline.readthedocs.io/en/stable/jwst/resample/main.html">Full description</a> of the step.</p>
</section>
<section id="id14">
<h3>Arguments<a class="headerlink" href="#id14" title="Permalink to this headline">#</a></h3>
<p>There is a list of <a class="reference external" href="https://jwst-pipeline.readthedocs.io/en/stable/jwst/resample/arguments.html">optional Astrodrizzle-style</a> input parameters that can be used to customize the resampling process.</p>
</section>
<section id="id15">
<h3>Reference files used<a class="headerlink" href="#id15" title="Permalink to this headline">#</a></h3>
<p>This step uses the <a class="reference external" href="https://jwst-pipeline.readthedocs.io/en/stable/jwst/resample/reference_files.html"><code class="docutils literal notranslate"><span class="pre">DRIZPARS</span></code></a> reference file. This file contains Astrodrizzle-style keywords that can be used to control the details of the resampling.</p>
</section>
<section id="id16">
<h3>Run the step<a class="headerlink" href="#id16" title="Permalink to this headline">#</a></h3>
<p>Since we ran the step above and saved the outputs, well skip this part and just load the outputs.</p>
<p>List the available parameters and their default values:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">ResampleStep</span><span class="o">.</span><span class="n">spec</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># # Run the step</span>
<span class="c1"># resample = ResampleStep()</span>
<span class="c1"># resample.save_results = True</span>
<span class="c1"># resamp = resample.run(outlier)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># resamp_file = &#39;step_ResampleStep_resamplestep.fits&#39;</span>
<span class="n">resamp_file</span> <span class="o">=</span> <span class="s1">&#39;l3_lw_results_i2d.fits&#39;</span>

<span class="c1">#with datamodels.open(resamp_file) as resamp:</span>
<span class="n">resamp</span> <span class="o">=</span> <span class="n">datamodels</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">resamp_file</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">resamp</span><span class="o">.</span><span class="n">info</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">show_image</span><span class="p">(</span><span class="n">resamp</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">resamp</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
</div>
<p><a class="reference external" href="#title_ID">Top of Page</a></p>
<p><a id='source_catalog'> </a></p>
</section>
</section>
<section id="the-source-catalog-step">
<h2>The <code class="docutils literal notranslate"><span class="pre">Source</span> <span class="pre">Catalog</span></code> step<a class="headerlink" href="#the-source-catalog-step" title="Permalink to this headline">#</a></h2>
<section id="id17">
<h3>Summary<a class="headerlink" href="#id17" title="Permalink to this headline">#</a></h3>
<p>This step creates a catalog of source photometry and morphology information. Sources are identified using <a class="reference external" href="https://photutils.readthedocs.io/en/latest/segmentation.html">Photutils image segmentation</a> method. The output is an ASCII file containing a table of source locations and aperture photometry results.</p>
</section>
<section id="id18">
<h3>Documentation<a class="headerlink" href="#id18" title="Permalink to this headline">#</a></h3>
<p><a class="reference external" href="https://jwst-pipeline.readthedocs.io/en/stable/jwst/source_catalog/main.html">Full description</a> of the step.</p>
</section>
<section id="id19">
<h3>Arguments<a class="headerlink" href="#id19" title="Permalink to this headline">#</a></h3>
<p>There is a list of <a class="reference external" href="https://jwst-pipeline.readthedocs.io/en/stable/jwst/source_catalog/arguments.html">optional input parameters</a> that can be used to customize the resampling process.</p>
</section>
<section id="id20">
<h3>Reference files used<a class="headerlink" href="#id20" title="Permalink to this headline">#</a></h3>
<p>This step uses the <a class="reference external" href="https://jwst-pipeline.readthedocs.io/en/stable/jwst/source_catalog/reference_files.html"><code class="docutils literal notranslate"><span class="pre">APCORR</span></code> and <code class="docutils literal notranslate"><span class="pre">ABVEGAOFFSET</span></code></a> reference files. The <code class="docutils literal notranslate"><span class="pre">APCORR</span></code> reference file contains the factors necessary to correct aperture photometry results to the equivalent of an infinite aperure. The <code class="docutils literal notranslate"><span class="pre">ABVEGAOFFSET</span></code> reference file contains data necessary for converting from AB to Vega magnitudes.</p>
<p><a id='srccat_run'></a></p>
</section>
<section id="run-the-step-with-the-run-method">
<h3>Run the step with the run() method<a class="headerlink" href="#run-the-step-with-the-run-method" title="Permalink to this headline">#</a></h3>
<p>Since we ran the step above and saved the outputs, well skip this part and just load the outputs.</p>
<p>List the available parameters and their default values:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">SourceCatalogStep</span><span class="o">.</span><span class="n">spec</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Run the step after setting some parameters</span>
<span class="n">srccat</span> <span class="o">=</span> <span class="n">SourceCatalogStep</span><span class="p">()</span>
<span class="n">srccat</span><span class="o">.</span><span class="n">save_results</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">srccat</span><span class="o">.</span><span class="n">kernel_fwhm</span> <span class="o">=</span> <span class="mf">2.302</span>  <span class="c1"># pixels</span>
<span class="n">srccat</span><span class="o">.</span><span class="n">snr_threshold</span> <span class="o">=</span> <span class="mf">10.</span>

<span class="n">source_cat</span> <span class="o">=</span> <span class="n">srccat</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">resamp_file</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="examine-the-results">
<h3>Examine the results<a class="headerlink" href="#examine-the-results" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">source_cat</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">overlay_catalog</span><span class="p">(</span><span class="n">resamp</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">source_cat</span><span class="p">,</span> <span class="n">flux_limit</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Final mosaic with source catalog&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><a class="reference external" href="#title_ID">Top of Page</a></p>
<p><a id="about_ID"></a></p>
</section>
</section>
<section id="about-this-notebook">
<h2>About this Notebook<a class="headerlink" href="#about-this-notebook" title="Permalink to this headline">#</a></h2>
<p><strong>Original Author:</strong> Bryan Hilbert, updated by Alicia Canipe, NIRCam
<br><strong>Updated On:</strong> 07/28/2021</p>
<p><a class="reference external" href="#title_ID">Top of Notebook</a></p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "TheRealZoidberg/jwst_validation_test",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./notebooks/calwebb_image3/jwst_image3_nircam_test"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="../../jump/exec_jwst_jump_unit_tests.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">JWST Pipeline Validation Notebook: calwebb_detector1, jump unit tests</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="exec_jwst_image3_nircam_test.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">JWST Pipeline Validation Notebook: calwebb_image3, NIRCam imaging</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By STScI<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>