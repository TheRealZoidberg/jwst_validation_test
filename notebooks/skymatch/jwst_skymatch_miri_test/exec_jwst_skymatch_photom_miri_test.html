
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>JWST Pipeline Validation Notebook: skymatch and photometry with MIRI &#8212; Notebook repository template</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" href="../../../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/main.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script src="../../../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../../_static/sphinx-thebe.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.1/dist/embed-amd.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="JWST Pipeline Validation Notebook: skymatch with MIRI" href="jwst_skymatch_miri_test.html" />
    <link rel="prev" title="JWST Pipeline Validation Notebook: skymatch with MIRI" href="exec_jwst_skymatch_miri_test.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../../_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Notebook repository template</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../../index.html">
                    <no title>
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../background/jwst_background_miri_test/jwst_background_subtraction_miri_imaging_testing.html">
   JWST Pipeline Validation Notebook: calwebb_image2, background subtraction for MIRI imaging
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../background/jwst_background_miri_test/exec_jwst_background_subtraction_miri_imaging_testing.html">
   JWST Pipeline Validation Notebook: calwebb_image2, background subtraction for MIRI imaging
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../background/jwst_background_miri_test/exec_background_sub-miri-lrs-slit.html">
   JWST Pipeline Validation Testing Notebook: Background_subtract() for MIRI LRS SLIT
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../background/jwst_background_miri_test/background_sub-miri-lrs-slit.html">
   JWST Pipeline Validation Testing Notebook: Background_subtract() for MIRI LRS SLIT
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../pathloss/jwst_pathloss_nirspec_test/exec_jwst_pathloss_nirspec_test.html">
   JWST Pipeline Validation Testing Notebook: spec2, pathloss step
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../pathloss/jwst_pathloss_nirspec_test/jwst_pathloss_nirspec_test.html">
   JWST Pipeline Validation Testing Notebook: spec2, pathloss step
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../msaflagopen/jwst_msa_flagging_nirspec_test.html">
   JWST Pipeline Validation Testing Notebook: spec2, msa_flagging step
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../msaflagopen/exec_jwst_msa_flagging_nirspec_test.html">
   JWST Pipeline Validation Testing Notebook: spec2, msa_flagging step
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../resample/jwst_resample_miri_test/jwst_resample_miri_lrs_slit.html">
   JWST Pipeline Validation Testing Notebook: Calwebb_Image3, Resample step
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../resample/jwst_resample_miri_test/exec_jwst_resample_miri_lrs_slit.html">
   JWST Pipeline Validation Testing Notebook: Calwebb_Image3, Resample step
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../resample/jwst_resample_miri_test/jwst_resample_miri_testing.html">
   JWST Pipeline Validation Testing Notebook: Calwebb_Image3, Resample step with MIRI imaging
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../resample/jwst_resample_miri_test/exec_jwst_resample_miri_testing.html">
   JWST Pipeline Validation Testing Notebook: Calwebb_Image3, Resample step with MIRI imaging
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../example_notebook/example_notebook.html">
   Draft: Notebook title
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../source_catalog/jwst_source_catalog_miri_test/exec_jwst_source_catalog_miri_test.html">
   JWST Pipeline Validation Notebook: calwebb_image3: source_catalog with MIRI
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../source_catalog/jwst_source_catalog_miri_test/jwst_source_catalog_miri_test.html">
   JWST Pipeline Validation Notebook: calwebb_image3: source_catalog with MIRI
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../source_catalog/jwst_source_catalog_nircam_test/jwst_nircam_imaging_source_catalog.html">
   JWST Pipeline Validation Notebook: NIRCam, calwebb_image3, source_catalog
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../source_catalog/jwst_source_catalog_nircam_test/exec_jwst_nircam_imaging_source_catalog.html">
   JWST Pipeline Validation Notebook: NIRCam, calwebb_image3, source_catalog
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../lastframe/exec_jwst_lastframe_unit_tests.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, lastframe unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../lastframe/jwst_lastframe_unit_tests.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, lastframe unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../photom/jwst_photom_miri_test/exec_photom_miri_lrs_slitless.html">
   JWST Pipeline Validation Testing Notebook: MIRI LRS Slitless spectroscopy
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../photom/jwst_photom_miri_test/photom_miri_mrs_test.html">
   JWST Pipeline Validation Testing Notebook: Spec2, photom, MIRI
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../photom/jwst_photom_miri_test/exec_photom_miri_lrs_slit.html">
   JWST Pipeline Validation Testing Notebook: MIRI LRS Slit spectroscopy
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../photom/jwst_photom_miri_test/exec_photom_miri_mrs_test.html">
   JWST Pipeline Validation Testing Notebook: Spec2, photom, MIRI
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../photom/jwst_photom_miri_test/photom_miri_lrs_slit.html">
   JWST Pipeline Validation Testing Notebook: MIRI LRS Slit spectroscopy
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../photom/jwst_photom_miri_test/photom_miri_lrs_slitless.html">
   JWST Pipeline Validation Testing Notebook: MIRI LRS Slitless spectroscopy
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../photom/jwst_photom_miri_test/exec_jwst_photom_miri_test.html">
   JWST Pipeline Validation Notebook: photom with MIRI Imager
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../photom/jwst_photom_miri_test/jwst_photom_miri_test.html">
   JWST Pipeline Validation Notebook: photom with MIRI Imager
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ami3/run_ami_pipeline.html">
   JWST Pipeline Validation Notebook:  AMI3, AMI3 Pipeline
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ami3/exec_ami_analyze_verify.html">
   JWST Pipeline Validation Notebook: AMI3, AmiAnalyze
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ami3/exec_ami_average.html">
   JWST Pipeline Validation Notebook:  calwebb_ami3, ami_average
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ami3/exec_ami_normalize.html">
   JWST Pipeline Validation Notebook: calwebb_ami3, ami_normalize
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ami3/exec_run_ami_pipeline.html">
   JWST Pipeline Validation Notebook:  AMI3, AMI3 Pipeline
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ami3/ami_normalize.html">
   JWST Pipeline Validation Notebook: calwebb_ami3, ami_normalize
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ami3/ami_average.html">
   JWST Pipeline Validation Notebook:  calwebb_ami3, ami_average
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ami3/ami_analyze_verify.html">
   JWST Pipeline Validation Notebook: AMI3, AmiAnalyze
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../assign_wcs/jwst_assign_wcs_nirspec_test/jwst_assign_wcs_nirspec_test.html">
   JWST Pipeline Validation Testing Notebook: NIRSpec, spec2, assign_wcs step
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../assign_wcs/jwst_assign_wcs_nirspec_test/exec_jwst_assign_wcs_nirspec_test.html">
   JWST Pipeline Validation Testing Notebook: NIRSpec, spec2, assign_wcs step
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../assign_wcs/jwst_assign_wcs_niriss_test/jwst_assign_wcs_niriss_image.html">
   JWST Pipeline Validation Notebook: NIRISS, image2, assign_wcs
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../assign_wcs/jwst_assign_wcs_niriss_test/exec_jwst_assign_wcs_niriss_image.html">
   JWST Pipeline Validation Notebook: NIRISS, image2, assign_wcs
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../assign_wcs/jwst_assign_wcs_miri_test/exec_assign_wcs-miri-mrs.html">
   JWST Pipeline Validation Testing Notebook: MIRI MRS Spec2: Assign_wcs()
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../assign_wcs/jwst_assign_wcs_miri_test/exec_assign_wcs-miri-lrs-tso.html">
   JWST Pipeline Validation Testing Notebook: MIRI LRS Time Series Observation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../assign_wcs/jwst_assign_wcs_miri_test/assign_wcs-miri-lrs-slit.html">
   JWST Pipeline Validation Testing Notebook: MIRI LRS Slit
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../assign_wcs/jwst_assign_wcs_miri_test/assign_wcs-miri-mrs.html">
   JWST Pipeline Validation Testing Notebook: MIRI MRS Spec2: Assign_wcs()
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../assign_wcs/jwst_assign_wcs_miri_test/assign_wcs-miri-lrs-tso.html">
   JWST Pipeline Validation Testing Notebook: MIRI LRS Time Series Observation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../assign_wcs/jwst_assign_wcs_miri_test/exec_assign_wcs-miri-lrs-slit.html">
   JWST Pipeline Validation Testing Notebook: MIRI LRS Slit
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../barshadow/jwst_barshadow_nirspec_test/jwst_barshadow_nirspec_test.html">
   JWST Pipeline Validation Testing Notebook: spec2, barshadow step
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../barshadow/jwst_barshadow_nirspec_test/exec_jwst_barshadow_nirspec_test.html">
   JWST Pipeline Validation Testing Notebook: spec2, barshadow step
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../reset/jwst_reset_miri_test/exec_jwst_reset_miri_testing.html">
   JWST Pipeline Validation Testing Notebook: Calwebb_detector1, reset step for MIRI
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../reset/jwst_reset_miri_test/jwst_reset_miri_testing.html">
   JWST Pipeline Validation Testing Notebook: Calwebb_detector1, reset step for MIRI
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../refpix/jwst_refpix_unit_tests.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, refpix unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../refpix/exec_jwst_refpix_unit_tests.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, refpix unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../flat_field/jwst_flat_field_nirspec_test/jwst_flat_field_nirspec_test.html">
   JWST Pipeline Validation Testing Notebook: spec2, flat_field step
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../flat_field/jwst_flat_field_nirspec_test/exec_jwst_flat_field_nirspec_test.html">
   JWST Pipeline Validation Testing Notebook: spec2, flat_field step
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../flat_field/jwst_flat_field_miri_test/exec_flatfield_analysis_slitless.html">
   JWST Pipeline Validation Testing Notebook: MIRI LRS Slitless spectroscopy
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../flat_field/jwst_flat_field_miri_test/exec_jwst_flat_field_miri_test.html">
   JWST Pipeline Validation Testing notebook: flat_field step with MIRI Imaging
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../flat_field/jwst_flat_field_miri_test/exec_flat-miri-lrs-slit.html">
   JWST Pipeline Validation Testing Notebook: MIRI LRS Slit spectroscopy
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../flat_field/jwst_flat_field_miri_test/flatfield_analysis_slitless.html">
   JWST Pipeline Validation Testing Notebook: MIRI LRS Slitless spectroscopy
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../flat_field/jwst_flat_field_miri_test/exec_flat_miri_mrs_test.html">
   JWST Pipeline Validation Testing Notebook: Spec2, flat_field, MIRI
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../flat_field/jwst_flat_field_miri_test/flat-miri-lrs-slit.html">
   JWST Pipeline Validation Testing Notebook: MIRI LRS Slit spectroscopy
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../flat_field/jwst_flat_field_miri_test/jwst_flat_field_miri_test.html">
   JWST Pipeline Validation Testing notebook: flat_field step with MIRI Imaging
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../flat_field/jwst_flat_field_miri_test/flat_miri_mrs_test.html">
   JWST Pipeline Validation Testing Notebook: Spec2, flat_field, MIRI
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="jwst_skymatch_photom_miri_test.html">
   JWST Pipeline Validation Notebook: skymatch and photometry with MIRI
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="exec_jwst_skymatch_miri_test.html">
   JWST Pipeline Validation Notebook: skymatch with MIRI
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   JWST Pipeline Validation Notebook: skymatch and photometry with MIRI
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="jwst_skymatch_miri_test.html">
   JWST Pipeline Validation Notebook: skymatch with MIRI
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../jump/jwst_jump_miri_test/jwst_jump_miri_testing.html">
   JWST Pipeline Validation Testing Notebook: Calwebb_Detector1, Jump step
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../jump/jwst_jump_miri_test/exec_jwst_jump_miri_testing.html">
   JWST Pipeline Validation Testing Notebook: Calwebb_Detector1, Jump step
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../jump/jwst_jump_unit_tests.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, jump unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../jump/exec_jwst_jump_unit_tests.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, jump unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../calwebb_image3/jwst_image3_nircam_test/jwst_image3_nircam_test.html">
   JWST Pipeline Validation Notebook: calwebb_image3, NIRCam imaging
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../calwebb_image3/jwst_image3_nircam_test/exec_jwst_image3_nircam_test.html">
   JWST Pipeline Validation Notebook: calwebb_image3, NIRCam imaging
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../calwebb_image3/jwst_image3_miri_test/exec_jwst_image3_miri_test.html">
   JWST Pipeline Validation Notebook: calwebb_image3 with MIRI
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../calwebb_image3/jwst_image3_miri_test/jwst_image3_miri_test.html">
   JWST Pipeline Validation Notebook: calwebb_image3 with MIRI
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../calwebb_detector1/jwst_detector1_nircam_test/jwst_detector1_nircam_test.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, NIRCam imaging
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../calwebb_detector1/jwst_detector1_nircam_test/exec_jwst_detector1_nircam_test.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, NIRCam imaging
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../calwebb_detector1/jwst_detector1_miri_test/exec_jwst_detector1_miri_imtso_testing.html">
   JWST Pipeline Validation Testing Notebook: Calwebb_Detector1 for MIRI TSO imaging
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../calwebb_detector1/jwst_detector1_miri_test/jwst_detector1_miri_imtso_testing.html">
   JWST Pipeline Validation Testing Notebook: Calwebb_Detector1 for MIRI TSO imaging
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../calwebb_detector1/jwst_detector1_miri_test/exec_caldetector1-miri-lrs-tso.html">
   JWST Pipeline Validation Testing Notebook: MIRI LRS Time Series Observation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../calwebb_detector1/jwst_detector1_miri_test/caldetector1-miri-lrs-tso.html">
   JWST Pipeline Validation Testing Notebook: MIRI LRS Time Series Observation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../rscd/jwst_rscd_unit_tests.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, rscd unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../rscd/exec_jwst_rscd_unit_tests.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, rscd unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../rscd/jwst_rscd_miri_test/exec_jwst_miri_rscd_testing.html">
   JWST Pipeline Validation Testing Notebook: Calwebb_Detector1, RSCD step
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../rscd/jwst_rscd_miri_test/jwst_miri_rscd_testing.html">
   JWST Pipeline Validation Testing Notebook: Calwebb_Detector1, RSCD step
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../calwebb_image2/jwst_image2_nircam_test/jwst_image2_nircam_test.html">
   JWST Pipeline Validation Notebook: calwebb_image2, NIRCam imaging
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../calwebb_image2/jwst_image2_nircam_test/exec_jwst_image2_nircam_test.html">
   JWST Pipeline Validation Notebook: calwebb_image2, NIRCam imaging
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ramp_fitting/exec_jwst_ramp_fitting_unit_tests.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, ramp_fitting unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ramp_fitting/jwst_ramp_fitting_unit_tests.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, ramp_fitting unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../firstframe/exec_jwst_firstframe_unit_tests.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, firstframe unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../firstframe/jwst_firstframe_unit_tests.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, firstframe unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../dq_init/exec_jwst_dq_init_unit_tests.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, dq_init unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../dq_init/jwst_dq_init_unit_tests.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, dq_init unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../cube_build/jwst_cube_build_miri_test/test_cube_build_spec3.html">
   JWST Pipeline Validation Testing Notebook: Cube Build with MIRISIM Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../cube_build/jwst_cube_build_miri_test/exec_testing_point_source_flux_conservation_modeshep_all.html">
   JWST Pipeline Validation Testing Notebook: Point Source Flux Conservation Modeshep
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../cube_build/jwst_cube_build_miri_test/testing_point_source_flux_conservation_modeshep_all.html">
   JWST Pipeline Validation Testing Notebook: Point Source Flux Conservation Modeshep
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../cube_build/jwst_cube_build_miri_test/exec_test_cube_build_spec3.html">
   JWST Pipeline Validation Testing Notebook: Cube Build with MIRISIM Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../saturation/exec_jwst_saturation_unit_tests.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, saturation unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../saturation/jwst_saturation_unit_tests.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, saturation unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../extract_2d/jwst_extract_2d_nirspec_test/jwst_extract_2d_nirspec_test.html">
   JWST Pipeline Validation Testing Notebook: spec2, extract_2d step
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../extract_2d/jwst_extract_2d_nirspec_test/exec_jwst_extract_2d_nirspec_test.html">
   JWST Pipeline Validation Testing Notebook: spec2, extract_2d step
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../persistence/exec_jwst_persistence_unit_tests.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, persistence unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../persistence/jwst_persistence_unit_tests.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, persistence unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../extract_1d/jwst_extract_1d_miri_test/exec_extract_1d-spec2-miri-lrs-slit.html">
   JWST Pipeline Validation Testing Notebook: MIRI LRS Slit
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../extract_1d/jwst_extract_1d_miri_test/extract_1d-spec2-miri-lrs-slitless.html">
   JWST Pipeline Validation Testing Notebook: MIRI LRS Slitless
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../extract_1d/jwst_extract_1d_miri_test/extract_1d-spec2-miri-lrs-slit.html">
   JWST Pipeline Validation Testing Notebook: MIRI LRS Slit
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../extract_1d/jwst_extract_1d_miri_test/exec_extract_1d-spec2-miri-lrs-slitless.html">
   JWST Pipeline Validation Testing Notebook: MIRI LRS Slitless
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../dark_current/exec_jwst_dark_current_unit_tests.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, dark_current unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../dark_current/jwst_dark_current_unit_tests.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, dark_current unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../templates/jwst_validation_notebook_template.html">
   JWST Pipeline Validation Notebook:
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../templates/exec_jwst_validation_notebook_template.html">
   JWST Pipeline Validation Notebook:
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../templates/validation_test_template.html">
   JWST Pipeline Validation Testing Notebook: Descriptive Name of Test You Are Performing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../templates/exec_validation_test_template.html">
   JWST Pipeline Validation Testing Notebook: Descriptive Name of Test You Are Performing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ipc/exec_jwst_ipc_unit_tests.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, ipc unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ipc/jwst_ipc_unit_tests.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, ipc unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/background/exec_jwst_background_unit_tests.html">
   JWST calwebb_image2, background unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/background/jwst_background_unit_tests.html">
   JWST calwebb_image2, background unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/jwst_nirspec_regression_tests.html">
   JWST NIRSpec regression tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/flatfield/exec_jwst_flatfield_unit_tests.html">
   JWST calwebb_image2 and calwebb_spec2, flatfield unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/flatfield/jwst_flatfield_unit_tests.html">
   JWST calwebb_image2 and calwebb_spec2, flatfield unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/jwst_nircam_regression_tests.html">
   JWST NIRCam regression tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/resample/exec_jwst_resample_unit_tests.html">
   JWST calwebb_image2 and calwebb_spec2, resample unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/resample/jwst_resample_unit_tests.html">
   JWST calwebb_image2 and calwebb_spec2, resample unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/jwst_niriss_regression_tests.html">
   JWST NIRISS regression tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/source_catalog/jwst_source_catalog_unit_tests.html">
   JWST calwebb_image3, source_catalog unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/source_catalog/exec_jwst_source_catalog_unit_tests.html">
   JWST calwebb_image3, source_catalog unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/exec_jwst_fgs_regression_tests.html">
   JWST FGS regression tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/photom/jwst_photom_unit_tests.html">
   JWST calwebb_image2 and calwebb_spec2, photom unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/photom/exec_jwst_photom_unit_tests.html">
   JWST calwebb_image2 and calwebb_spec2, photom unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/assign_wcs/jwst_assign_wcs_unit_tests.html">
   JWST calwebb_image2 and calwebb_spec2, assign_wcs unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/assign_wcs/exec_jwst_assign_wcs_unit_tests.html">
   JWST calwebb_image2 and calwebb_spec2, assign_wcs unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/skymatch/jwst_skymatch_unit_tests.html">
   JWST calwebb_image3, skymatch unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/skymatch/exec_jwst_skymatch_unit_tests.html">
   JWST calwebb_image3, skymatch unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/exec_jwst_niriss_regression_tests.html">
   JWST NIRISS regression tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/exec_jwst_nirspec_regression_tests.html">
   JWST NIRSpec regression tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/exec_jwst_nircam_regression_tests.html">
   JWST NIRCam regression tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/jwst_fgs_regression_tests.html">
   JWST FGS regression tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/exec_jwst_miri_regression_tests.html">
   JWST MIRI regression tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/jwst_miri_regression_tests.html">
   JWST MIRI regression tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/tweakreg/exec_jwst_tweakreg_unit_tests.html">
   JWST calwebb_image3, tweakreg unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/tweakreg/jwst_tweakreg_unit_tests.html">
   JWST calwebb_image3, tweakreg unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/outlier_detection/jwst_outlier_detection_unit_tests.html">
   JWST calwebb_image3, calwebb_spec3, calwebb_coron3, calwebb_tso3, outlier_detection unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/outlier_detection/exec_jwst_outlier_detection_unit_tests.html">
   JWST calwebb_image3, calwebb_spec3, calwebb_coron3, calwebb_tso3, outlier_detection unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../tweakreg/jwst_tweakreg_miri_test/exec_jwst_tweakreg_miri_test.html">
   JWST Pipeline Validation Testing Notebook: Calwebb_Image3, Tweakreg step with MIRI imaging
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../tweakreg/jwst_tweakreg_miri_test/jwst_tweakreg_miri_test.html">
   JWST Pipeline Validation Testing Notebook: Calwebb_Image3, Tweakreg step with MIRI imaging
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../outlier_detection/jwst_outlier_detection_miri_test/exec_jwst_outlier_detection_miri_test.html">
   JWST Pipeline Validation Notebook: outlier_detection with MIRI
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../outlier_detection/jwst_outlier_detection_miri_test/exec_jwst_outlier_detection_view_miri_test.html">
   JWST Pipeline Validation Notebook: MIRI view outlier_detection
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../outlier_detection/jwst_outlier_detection_miri_test/exec_out_det_test2.html">
   JWST Pipeline Validation Notebook: Outlier Detection for MIRI MRS
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../outlier_detection/jwst_outlier_detection_miri_test/out_det_test2.html">
   JWST Pipeline Validation Notebook: Outlier Detection for MIRI MRS
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../outlier_detection/jwst_outlier_detection_miri_test/jwst_outlier_detection_miri_test.html">
   JWST Pipeline Validation Notebook: outlier_detection with MIRI
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../outlier_detection/jwst_outlier_detection_miri_test/jwst_outlier_detection_view_miri_test.html">
   JWST Pipeline Validation Notebook: MIRI view outlier_detection
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../superbias/exec_jwst_superbias_unit_tests.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, superbias unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../superbias/jwst_superbias_unit_tests.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, superbias unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../calwebb_coron3/exec_MIRI_shared_calcoron3_testing.html">
   JWST Pipeline Validation Testing Notebook: Calwebb_Coron3 for MIRI Coronagraphic Imaging
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../calwebb_coron3/jwst_calcoron3_nircam_test.html">
   JWST Pipeline Validation Notebook: calwebb_coron3 with NIRCam
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../calwebb_coron3/exec_jwst_calcoron3_nircam_test.html">
   JWST Pipeline Validation Notebook: calwebb_coron3 with NIRCam
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../calwebb_coron3/MIRI_shared_calcoron3_testing.html">
   JWST Pipeline Validation Testing Notebook: Calwebb_Coron3 for MIRI Coronagraphic Imaging
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../fringe/JWST_fringe_miri_test/exec_fringe_miri_mrs_test.html">
   JWST Pipeline Validation Testing Notebook: Spec2, fringe, MIRI
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../fringe/JWST_fringe_miri_test/fringe_miri_mrs_test.html">
   JWST Pipeline Validation Testing Notebook: Spec2, fringe, MIRI
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../image3/jwst_image3_miri_test/exec_jwst_image3_miri_test.html">
   JWST Pipeline Validation Notebook: calwebb_image3 with MIRI
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../image3/jwst_image3_miri_test/jwst_image3_miri_test.html">
   JWST Pipeline Validation Notebook: calwebb_image3 with MIRI
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../linearity/jwst_linearity_unit_tests.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, linearity unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../linearity/exec_jwst_linearity_unit_tests.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, linearity unit tests
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/TheRealZoidberg/jwst_validation_test/main?urlpath=tree/notebooks/skymatch/jwst_skymatch_miri_test/exec_jwst_skymatch_photom_miri_test.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../../../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
      <li>
        <a href="https://colab.research.google.com/github/TheRealZoidberg/jwst_validation_test/blob/main/notebooks/skymatch/jwst_skymatch_miri_test/exec_jwst_skymatch_photom_miri_test.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Colab"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../../../_static/images/logo_colab.png">
  </span>
<span class="headerbtn__text-container">Colab</span>
</a>

      </li>
      
      <li>
        
<button onclick="initThebeSBT()"
  class="headerbtn headerbtn-launch-thebe"
  data-toggle="tooltip"
data-placement="left"
title="Launch Thebe"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="headerbtn__text-container">Live Code</span>
</button>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/TheRealZoidberg/jwst_validation_test"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/TheRealZoidberg/jwst_validation_test/issues/new?title=Issue%20on%20page%20%2Fnotebooks/skymatch/jwst_skymatch_miri_test/exec_jwst_skymatch_photom_miri_test.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../../../_sources/notebooks/skymatch/jwst_skymatch_miri_test/exec_jwst_skymatch_photom_miri_test.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   JWST Pipeline Validation Notebook: skymatch and photometry with MIRI
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#table-of-contents">
     Table of Contents
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#introduction">
     Introduction
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#jwst-calwg-algorithm">
   JWST CalWG Algorithm
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#test-description">
   Test Description
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-description">
   Data Description
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#set-up-temporary-directory-and-crds-options">
     Set up temporary directory and CRDS options
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#set-up-import-statements">
     Set up import statements
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#print-pipeline-version-number">
     Print pipeline version number
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#add-helper-script-for-plotting-scatter-plot-of-magnitudes">
     Add helper script for plotting scatter plot of magnitudes
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#loading-the-data">
   Loading the Data
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#run-rate-files-through-calwebb-image2-to-obtain-calibrated-images-for-further-testing">
     Run rate files through calwebb_image2 to obtain calibrated images for further testing
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#set-parameters-for-tests">
     Set parameters for tests
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#set-up-association-files">
     Set up association files
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#modify-average-background-level-of-input-images">
     Modify average background level of input images
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#run-pipeline-steps-in-calwebb-image3">
     Run Pipeline steps in calwebb_image3
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#run-skymatch-step-on-images-with-skymatch-method-local">
     1. Run skymatch step on images with skymatch method = ‘local’
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#run-skymatch-with-sky-match-method-local-subtract-false-match-down-true">
       1.1 Run skymatch with sky match method = local. Subtract = False, match_down = True.
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h4 nav-item toc-entry">
        <a class="reference internal nav-link" href="#look-at-photometry-out-of-source-catalog-to-compare-across-tests">
         Look at photometry out of source catalog to compare across tests.
        </a>
       </li>
      </ul>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#skymatch-method-local-subtract-true">
       1.2  Skymatch method = ‘Local’, subtract= True.
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#run-skymatch-for-skymethod-global">
     2. Run skymatch for skymethod = ‘global’.
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#notes-global-compute-a-common-sky-value-for-all-input-image-and-groups-of-images-in-this-setting-match-will-compute-sky-values-for-each-input-image-group-find-the-minimum-sky-value-and-then-it-will-set-and-or-subtract-sky-value-of-each-input-image-to-this-minimum-value-this-method-may-be-useful-when-input-images-have-been-already-matched-the-global-method-computes-the-minimum-sky-value-across-all-input-images-and-or-groups-that-sky-value-is-then-considered-to-be-the-background-in-all-input-images">
       Notes: ‘global’: compute a common sky value for all input image and groups of images. In this setting match will compute sky values for each input image/group, find the minimum sky value, and then it will set (and/or subtract) sky value of each input image to this minimum value. This method may be useful when input images have been already matched. The ‘global’ method computes the minimum sky value across all input images and/or groups. That sky value is then considered to be the background in all input images.
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#skymethod-global-with-subtraction-false">
       2.1 skymethod = ‘global’ with subtraction = False
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#skymethod-global-with-subtraction-true">
       2.2 skymethod = ‘global’ with subtraction = True
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#run-tests-on-skymatch-method-match">
     3. Run tests on Skymatch method ‘Match’
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#notes-match-compute-differences-in-sky-values-between-images-and-or-groups-in-pair-wise-common-sky-regions-in-this-case-computed-sky-values-will-be-relative-delta-to-the-sky-computed-in-one-of-the-input-images-whose-sky-value-will-be-set-to-reported-to-be-0-this-case-matches-to-the-lowest-sky-value">
       Notes: ‘match’: compute differences in sky values between images and/or groups in (pair-wise) common sky regions. In this case computed sky values will be relative (delta) to the sky computed in one of the input images whose sky value will be set to (reported to be) 0. This case matches to the lowest sky value.
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#skymethod-match-match-down-true-subtract-true">
       3.1 skymethod = ‘match’, match_down=True, subtract=True
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#check-that-all-output-new-sky-values-are-equal-to-the-lowest-original-sky-value">
       ** Check that all output (new) sky values are equal to the lowest original sky value
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#skymethod-match-match-down-false-subtract-true">
       3.2 skymethod = ‘match’, match_down=False, subtract = True
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#check-that-all-output-new-sky-values-are-equal-to-the-highest-original-sky-value">
       ** Check that all output (new) sky values are equal to the highest original sky value
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#skymethod-match-match-down-true-subtract-false">
       3.3 skymethod = ‘match’, match_down = True, subtract = False
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#test-skymatch-method-global-match">
     4. Test skymatch method ‘global+match’
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#notes-global-match-first-use-match-method-to-equalize-sky-values-between-images-and-then-find-a-minimum-global-sky-value-in-all-input-images">
       Notes: ‘global+match’: first use ‘match’ method to equalize sky values between images and then find a minimum “global” sky value in all input images.
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#skymethod-global-match-subtract-true">
       4.1 skymethod = ‘global+match’, subtract = True
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#skymatch-global-match-subtract-false">
       4.2 skymatch = global+match, subtract = False
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#check-that-all-output-new-sky-values-are-around-zero-within-a-standard-deviation">
       ** Check that all output (new) sky values are around zero (within a standard deviation)
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#compare-photometry-across-the-different-skymatch-methods">
       Compare photometry across the different skymatch methods
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#about-this-notebook">
     About this Notebook
    </a>
   </li>
  </ul>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>JWST Pipeline Validation Notebook: skymatch and photometry with MIRI</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   JWST Pipeline Validation Notebook: skymatch and photometry with MIRI
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#table-of-contents">
     Table of Contents
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#introduction">
     Introduction
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#jwst-calwg-algorithm">
   JWST CalWG Algorithm
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#test-description">
   Test Description
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-description">
   Data Description
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#set-up-temporary-directory-and-crds-options">
     Set up temporary directory and CRDS options
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#set-up-import-statements">
     Set up import statements
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#print-pipeline-version-number">
     Print pipeline version number
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#add-helper-script-for-plotting-scatter-plot-of-magnitudes">
     Add helper script for plotting scatter plot of magnitudes
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#loading-the-data">
   Loading the Data
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#run-rate-files-through-calwebb-image2-to-obtain-calibrated-images-for-further-testing">
     Run rate files through calwebb_image2 to obtain calibrated images for further testing
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#set-parameters-for-tests">
     Set parameters for tests
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#set-up-association-files">
     Set up association files
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#modify-average-background-level-of-input-images">
     Modify average background level of input images
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#run-pipeline-steps-in-calwebb-image3">
     Run Pipeline steps in calwebb_image3
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#run-skymatch-step-on-images-with-skymatch-method-local">
     1. Run skymatch step on images with skymatch method = ‘local’
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#run-skymatch-with-sky-match-method-local-subtract-false-match-down-true">
       1.1 Run skymatch with sky match method = local. Subtract = False, match_down = True.
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h4 nav-item toc-entry">
        <a class="reference internal nav-link" href="#look-at-photometry-out-of-source-catalog-to-compare-across-tests">
         Look at photometry out of source catalog to compare across tests.
        </a>
       </li>
      </ul>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#skymatch-method-local-subtract-true">
       1.2  Skymatch method = ‘Local’, subtract= True.
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#run-skymatch-for-skymethod-global">
     2. Run skymatch for skymethod = ‘global’.
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#notes-global-compute-a-common-sky-value-for-all-input-image-and-groups-of-images-in-this-setting-match-will-compute-sky-values-for-each-input-image-group-find-the-minimum-sky-value-and-then-it-will-set-and-or-subtract-sky-value-of-each-input-image-to-this-minimum-value-this-method-may-be-useful-when-input-images-have-been-already-matched-the-global-method-computes-the-minimum-sky-value-across-all-input-images-and-or-groups-that-sky-value-is-then-considered-to-be-the-background-in-all-input-images">
       Notes: ‘global’: compute a common sky value for all input image and groups of images. In this setting match will compute sky values for each input image/group, find the minimum sky value, and then it will set (and/or subtract) sky value of each input image to this minimum value. This method may be useful when input images have been already matched. The ‘global’ method computes the minimum sky value across all input images and/or groups. That sky value is then considered to be the background in all input images.
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#skymethod-global-with-subtraction-false">
       2.1 skymethod = ‘global’ with subtraction = False
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#skymethod-global-with-subtraction-true">
       2.2 skymethod = ‘global’ with subtraction = True
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#run-tests-on-skymatch-method-match">
     3. Run tests on Skymatch method ‘Match’
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#notes-match-compute-differences-in-sky-values-between-images-and-or-groups-in-pair-wise-common-sky-regions-in-this-case-computed-sky-values-will-be-relative-delta-to-the-sky-computed-in-one-of-the-input-images-whose-sky-value-will-be-set-to-reported-to-be-0-this-case-matches-to-the-lowest-sky-value">
       Notes: ‘match’: compute differences in sky values between images and/or groups in (pair-wise) common sky regions. In this case computed sky values will be relative (delta) to the sky computed in one of the input images whose sky value will be set to (reported to be) 0. This case matches to the lowest sky value.
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#skymethod-match-match-down-true-subtract-true">
       3.1 skymethod = ‘match’, match_down=True, subtract=True
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#check-that-all-output-new-sky-values-are-equal-to-the-lowest-original-sky-value">
       ** Check that all output (new) sky values are equal to the lowest original sky value
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#skymethod-match-match-down-false-subtract-true">
       3.2 skymethod = ‘match’, match_down=False, subtract = True
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#check-that-all-output-new-sky-values-are-equal-to-the-highest-original-sky-value">
       ** Check that all output (new) sky values are equal to the highest original sky value
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#skymethod-match-match-down-true-subtract-false">
       3.3 skymethod = ‘match’, match_down = True, subtract = False
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#test-skymatch-method-global-match">
     4. Test skymatch method ‘global+match’
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#notes-global-match-first-use-match-method-to-equalize-sky-values-between-images-and-then-find-a-minimum-global-sky-value-in-all-input-images">
       Notes: ‘global+match’: first use ‘match’ method to equalize sky values between images and then find a minimum “global” sky value in all input images.
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#skymethod-global-match-subtract-true">
       4.1 skymethod = ‘global+match’, subtract = True
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#skymatch-global-match-subtract-false">
       4.2 skymatch = global+match, subtract = False
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#check-that-all-output-new-sky-values-are-around-zero-within-a-standard-deviation">
       ** Check that all output (new) sky values are around zero (within a standard deviation)
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#compare-photometry-across-the-different-skymatch-methods">
       Compare photometry across the different skymatch methods
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#about-this-notebook">
     About this Notebook
    </a>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <p><a id="title_ID"></a></p>
<section class="tex2jax_ignore mathjax_ignore" id="jwst-pipeline-validation-notebook-skymatch-and-photometry-with-miri">
<h1>JWST Pipeline Validation Notebook: skymatch and photometry with MIRI<a class="headerlink" href="#jwst-pipeline-validation-notebook-skymatch-and-photometry-with-miri" title="Permalink to this headline">#</a></h1>
<p><span style="color:red"> <strong>Instruments Affected</strong></span>: MIRI, NIRCam</p>
<p>Tested on MIRI Simulated data</p>
<section id="table-of-contents">
<h2>Table of Contents<a class="headerlink" href="#table-of-contents" title="Permalink to this headline">#</a></h2>
<div style="text-align: left"> 
<p><br> <a class="reference external" href="#intro_ID">Introduction</a>
<br> <a class="reference external" href="#algorithm">JWST CalWG Algorithm</a>
<br> <a class="reference external" href="#description">Test Description</a>
<br> <a class="reference external" href="#data_descr">Data Description</a>
<br> <a class="reference external" href="#imports_ID">Imports</a>
<br> <a class="reference external" href="#data_load">Loading the Data</a>
<br> <a class="reference external" href="#associations_ID">Set up association files</a>
<br> <a class="reference external" href="#outliers_ID">Insert outliers</a>
<br> <a class="reference external" href="#pipeline_ID">Run Pipeline</a></p>
</div><p><a id="intro_ID"></a></p>
</section>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">#</a></h2>
<p>This notebook is meant to test how the differing methods in the skymatch step affect photometry output in a catalog at the end of the source_catalog step. This is set up to test each of the skymatch methods (local, global, match, and global+match) and see if there are differences in photometry between them. The plot at the end of the notebook compare the total AB mag calculated in the source_catalog step by x position. If there are no differences, the magnitudes for each method should line up. If there are differences between them, it will show in different symbols not lining up.</p>
<p>This notebook runs the following steps only from calwebb_image3: skymatch, resample and source_catalog, checking outputs of each step along the way. The final result is the plot at the bottom of the notebook as described above.</p>
<p>The pipeline documentation can be found here: <a class="reference external" href="https://jwst-pipeline.readthedocs.io/en/latest/jwst/skymatch/README.html">https://jwst-pipeline.readthedocs.io/en/latest/jwst/skymatch/README.html</a></p>
<p>The pipeline code is available on GitHub: <a class="reference external" href="https://github.com/spacetelescope/jwst/tree/master/jwst/skymatch">https://github.com/spacetelescope/jwst/tree/master/jwst/skymatch</a></p>
<p><a id="algorithm"></a></p>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="jwst-calwg-algorithm">
<h1>JWST CalWG Algorithm<a class="headerlink" href="#jwst-calwg-algorithm" title="Permalink to this headline">#</a></h1>
<p>The skymatch step can be used to compute sky values in a collection of input images that contain both sky and source signal. The sky values can be computed for each image separately or in a way that matches the sky levels amongst the collection of images so as to minimize their differences. This operation is typically applied before combining multiple images into a mosaic.</p>
<p>Background Matching algorithm page on the CalWG confluence page</p>
<blockquote>
<div><p><a class="reference external" href="https://outerspace.stsci.edu/display/JWSTCC/Vanilla+Image+Background+Matching">https://outerspace.stsci.edu/display/JWSTCC/Vanilla+Image+Background+Matching</a></p>
</div></blockquote>
<p><a class="reference external" href="#title_ID">Top of Page</a></p>
<p><a id="description"></a></p>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="test-description">
<h1>Test Description<a class="headerlink" href="#test-description" title="Permalink to this headline">#</a></h1>
<p>This notebook processes level 2 images through the calwebb_image3 skymatch and resample steps and examines outputs for different sky method parameters.</p>
<ol class="simple">
<li><p>Set up data path and image list file.</p></li>
<li><p>Set up association files.</p></li>
<li><p>Modify average backgrould level of input images.</p></li>
<li><p>Run skymatch step on images.</p></li>
<li><p>Run skymatch, resample and source_catalog for each skymethod parameter (local, global, match, global+match).</p></li>
<li><p>See if the differing skymatch methods affect the source photometry.</p></li>
<li><p>Testing other parameters (nclip, usigma, lsigma, lower, upper, skystat). (Still TBD.)</p></li>
</ol>
<p>This notebook has been created to test how skymatch, resample and source_catalog work together (with subtract=True indicating that the subtraction is done in the skymatch step and subtract=False indicating that the subtraction is done in the resample step). There are displays of the combined noise image to see how well the backgrounds were subtracted in the full combined image.</p>
<p><a class="reference external" href="#title_ID">Top of Page</a></p>
<p><a id="data_descr"></a></p>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="data-description">
<h1>Data Description<a class="headerlink" href="#data-description" title="Permalink to this headline">#</a></h1>
<p>These steps are set up with simulated MIRI F560W data of a crowded field with a variety of point sources and extended sources. There are four dither positions of the same field that are combined in the resample step. The notebook adds noise backgrounds to the field to help the pipeline testers have a better visualization of what the pipeline is doing with each set of parameters.</p>
<p><a class="reference external" href="#title_ID">Top of Page</a></p>
<section id="set-up-temporary-directory-and-crds-options">
<h2>Set up temporary directory and CRDS options<a class="headerlink" href="#set-up-temporary-directory-and-crds-options" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a temporary directory to hold notebook output, and change the working directory to that directory.</span>
<span class="kn">from</span> <span class="nn">tempfile</span> <span class="kn">import</span> <span class="n">TemporaryDirectory</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="n">data_dir</span> <span class="o">=</span> <span class="n">TemporaryDirectory</span><span class="p">()</span>
<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">data_dir</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">data_dir</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;TemporaryDirectory &#39;/tmp/tmpw_9tx2tw&#39;&gt;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set up CRDS options</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="k">if</span> <span class="s2">&quot;CRDS_CACHE_TYPE&quot;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;CRDS_CACHE_TYPE&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;local&#39;</span><span class="p">:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;CRDS_PATH&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;HOME&#39;</span><span class="p">],</span> <span class="s1">&#39;crds&#39;</span><span class="p">,</span> <span class="s1">&#39;cache&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;CRDS_CACHE_TYPE&#39;</span><span class="p">]):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;CRDS_PATH&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;CRDS_CACHE_TYPE&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p><a id="imports_ID"></a></p>
</section>
<section id="set-up-import-statements">
<h2>Set up import statements<a class="headerlink" href="#set-up-import-statements" title="Permalink to this headline">#</a></h2>
<p>The following packages are needed to run this notebook:</p>
<ul class="simple">
<li><p>jwst to run the pipeline, access datamodels and create associations</p></li>
<li><p>matplotlib to plot</p></li>
<li><p>astropy for a variety of calculations</p></li>
<li><p>glob to find files of a certain type</p></li>
<li><p>imports to retrieve files from Box</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pytest</span>
<span class="kn">from</span> <span class="nn">astropy.io</span> <span class="kn">import</span> <span class="n">fits</span>
<span class="kn">from</span> <span class="nn">astropy.table</span> <span class="kn">import</span> <span class="n">Table</span><span class="p">,</span> <span class="n">vstack</span><span class="p">,</span> <span class="n">unique</span><span class="p">,</span> <span class="n">join</span>
<span class="kn">from</span> <span class="nn">astropy</span> <span class="kn">import</span> <span class="n">table</span>
<span class="kn">from</span> <span class="nn">glob</span> <span class="kn">import</span> <span class="n">glob</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">rcParams</span>
<span class="o">%</span><span class="k">matplotlib</span> inline

<span class="kn">import</span> <span class="nn">jwst</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">from</span> <span class="nn">jwst.skymatch</span> <span class="kn">import</span> <span class="n">skymatch</span>
<span class="kn">from</span> <span class="nn">jwst.resample</span> <span class="kn">import</span> <span class="n">ResampleStep</span>
<span class="kn">from</span> <span class="nn">jwst.pipeline</span> <span class="kn">import</span> <span class="n">Image2Pipeline</span><span class="p">,</span> <span class="n">Image3Pipeline</span>
<span class="kn">from</span> <span class="nn">jwst.skymatch.skyimage</span> <span class="kn">import</span> <span class="n">SkyImage</span>
<span class="kn">from</span> <span class="nn">jwst.associations.lib.rules_level3_base</span> <span class="kn">import</span> <span class="n">DMS_Level3_Base</span>
<span class="kn">from</span> <span class="nn">jwst.associations</span> <span class="kn">import</span> <span class="n">asn_from_list</span>
<span class="kn">from</span> <span class="nn">jwst</span> <span class="kn">import</span> <span class="n">datamodels</span>
<span class="kn">from</span> <span class="nn">jwst.datamodels</span> <span class="kn">import</span> <span class="n">ImageModel</span>

<span class="c1"># Box download imports </span>
<span class="kn">from</span> <span class="nn">astropy.utils.data</span> <span class="kn">import</span> <span class="n">download_file</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">shutil</span> <span class="kn">import</span> <span class="n">move</span>
<span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">splitext</span>

<span class="kn">from</span> <span class="nn">ci_watson.artifactory_helpers</span> <span class="kn">import</span> <span class="n">get_bigdata</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="print-pipeline-version-number">
<h2>Print pipeline version number<a class="headerlink" href="#print-pipeline-version-number" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">jwst</span><span class="o">.</span><span class="n">__version__</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;1.7.2&#39;
</pre></div>
</div>
</div>
</div>
</section>
<section id="add-helper-script-for-plotting-scatter-plot-of-magnitudes">
<h2>Add helper script for plotting scatter plot of magnitudes<a class="headerlink" href="#add-helper-script-for-plotting-scatter-plot-of-magnitudes" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">create_scatterplot</span><span class="p">(</span><span class="n">catalog_colx</span><span class="p">,</span> <span class="n">catalog_coly</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Function to generate a generic scatterplot.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">catalog_colx</span><span class="p">,</span><span class="n">catalog_coly</span><span class="p">)</span> 
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">catalog_colx</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">catalog_coly</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    
    <span class="k">if</span> <span class="n">title</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><a id="data_load"></a></p>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="loading-the-data">
<h1>Loading the Data<a class="headerlink" href="#loading-the-data" title="Permalink to this headline">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Read in new dataset from Box</span>

<span class="k">def</span> <span class="nf">get_box_files</span><span class="p">(</span><span class="n">file_list</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">box_url</span><span class="p">,</span><span class="n">file_name</span> <span class="ow">in</span> <span class="n">file_list</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;https&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">box_url</span><span class="p">:</span>
            <span class="n">box_url</span> <span class="o">=</span> <span class="s1">&#39;https://stsci.box.com/shared/static/&#39;</span> <span class="o">+</span> <span class="n">box_url</span>
        <span class="n">downloaded_file</span> <span class="o">=</span> <span class="n">download_file</span><span class="p">(</span><span class="n">box_url</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">Path</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span><span class="o">.</span><span class="n">suffix</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="n">ext</span> <span class="o">=</span> <span class="n">splitext</span><span class="p">(</span><span class="n">box_url</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">file_name</span> <span class="o">+=</span> <span class="n">ext</span>
        <span class="n">move</span><span class="p">(</span><span class="n">downloaded_file</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span>

<span class="c1"># Use F560W data set</span>
        
<span class="n">file_urls</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;https://stsci.box.com/shared/static/g8ozd2wkdo9klrtkafpe9qegpzhpd66a.fits&#39;</span><span class="p">,</span> 
             <span class="s1">&#39;https://stsci.box.com/shared/static/ym75nbqdi32t9wnbanm6s57itqixniyc.fits&#39;</span><span class="p">,</span> 
             <span class="s1">&#39;https://stsci.box.com/shared/static/0bqh6ijsc6kd7cyv6gtnj9kvly9t885f.fits&#39;</span><span class="p">,</span>
             <span class="s1">&#39;https://stsci.box.com/shared/static/tywadpqcjhp9yxyv0sy91hc79red92xm.fits&#39;</span><span class="p">]</span>


<span class="n">filenames</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;det_image_seq1_MIRIMAGE_F560Wexp1_rate.fits&#39;</span><span class="p">,</span> 
             <span class="s1">&#39;det_image_seq2_MIRIMAGE_F560Wexp1_rate.fits&#39;</span><span class="p">,</span> 
             <span class="s1">&#39;det_image_seq3_MIRIMAGE_F560Wexp1_rate.fits&#39;</span><span class="p">,</span>
             <span class="s1">&#39;det_image_seq4_MIRIMAGE_F560Wexp1_rate.fits&#39;</span><span class="p">]</span>


<span class="c1"># Test with F770W data set</span>

<span class="c1">#file_urls = [&#39;https://stsci.box.com/shared/static/8573htf1p8mhk4e49z9b483dp975y3lz.fits&#39;,</span>
<span class="c1">#             &#39;https://stsci.box.com/shared/static/p69h7uzlmqwlzf6kqqbf4lu9ibz28tc6.fits&#39;,</span>
<span class="c1">#             &#39;https://stsci.box.com/shared/static/js8k6j20rek1oago057wxn08dhuticij.fits&#39;,</span>
<span class="c1">#             &#39;https://stsci.box.com/shared/static/es253mc3m1sptusj9c9ctl1blidr1qdl.fits&#39;,</span>
<span class="c1">#             &#39;https://stsci.box.com/shared/static/lpcgp7jkq6lmjj2lxpk63jz9u05qgk3a.cat&#39;,</span>
<span class="c1">#             &#39;https://stsci.box.com/shared/static/15j6hkjc28zow4rjepob2t75dl887zs3.cat&#39;]</span>


<span class="c1">#file_names = [&#39;det_image_seq1_MIRIMAGE_F770Wexp1_rate.fits&#39;, </span>
<span class="c1">#             &#39;det_image_seq2_MIRIMAGE_F770Wexp1_rate.fits&#39;, </span>
<span class="c1">#             &#39;det_image_seq3_MIRIMAGE_F770Wexp1_rate.fits&#39;,</span>
<span class="c1">#             &#39;det_image_seq4_MIRIMAGE_F770Wexp1_rate.fits&#39;,</span>
<span class="c1">#             &#39;input_sim_stars.cat&#39;,</span>
<span class="c1">#             &#39;input_sim_galaxies.cat&#39;]</span>

<span class="n">box_download_list</span> <span class="o">=</span> <span class="p">[(</span><span class="n">url</span><span class="p">,</span><span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="n">url</span><span class="p">,</span><span class="n">name</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">file_urls</span><span class="p">,</span><span class="n">filenames</span><span class="p">)]</span>


<span class="n">get_box_files</span><span class="p">(</span><span class="n">box_download_list</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="run-rate-files-through-calwebb-image2-to-obtain-calibrated-images-for-further-testing">
<h2>Run rate files through calwebb_image2 to obtain calibrated images for further testing<a class="headerlink" href="#run-rate-files-through-calwebb-image2-to-obtain-calibrated-images-for-further-testing" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Run Calwebb_image2 on output files from detector1</span>
<span class="n">ratefiles</span> <span class="o">=</span> <span class="n">glob</span><span class="p">(</span><span class="s1">&#39;*rate.fits&#39;</span><span class="p">)</span>    
    
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;There are &#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">ratefiles</span><span class="p">),</span> <span class="s1">&#39; images.&#39;</span><span class="p">)</span>
    
<span class="n">callist</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># cycle through files</span>
<span class="k">for</span> <span class="n">im</span> <span class="ow">in</span> <span class="n">ratefiles</span><span class="p">:</span>
    <span class="n">pipe2</span> <span class="o">=</span> <span class="n">Image2Pipeline</span><span class="p">()</span>
    
    <span class="n">rampfile</span> <span class="o">=</span> <span class="n">ImageModel</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="n">rampfile</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">filename</span>
    <span class="c1"># Set pipeline parameters</span>

    <span class="n">pipe2</span><span class="o">.</span><span class="n">save_results</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">pipe2</span><span class="o">.</span><span class="n">output_file</span> <span class="o">=</span> <span class="n">filename</span> <span class="o">+</span><span class="s1">&#39;_cal.fits&#39;</span>
    <span class="n">pipe2</span><span class="o">.</span><span class="n">resample</span><span class="o">.</span><span class="n">save_results</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">pipe2</span><span class="o">.</span><span class="n">suffix</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">calfile</span> <span class="o">=</span> <span class="n">pipe2</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">rampfile</span><span class="p">)</span>

    <span class="n">callist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">calfile</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">callist</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-09-20 17:20:02,150 - stpipe.Image2Pipeline - INFO - Image2Pipeline instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-09-20 17:20:02,152 - stpipe.Image2Pipeline.bkg_subtract - INFO - BackgroundStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-09-20 17:20:02,153 - stpipe.Image2Pipeline.assign_wcs - INFO - AssignWcsStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-09-20 17:20:02,155 - stpipe.Image2Pipeline.flat_field - INFO - FlatFieldStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-09-20 17:20:02,156 - stpipe.Image2Pipeline.photom - INFO - PhotomStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-09-20 17:20:02,158 - stpipe.Image2Pipeline.resample - INFO - ResampleStep instance created.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>There are  4  images.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-09-20 17:20:03,363 - stpipe.Image2Pipeline - INFO - Step Image2Pipeline running with args (&lt;ImageModel(1024, 1032) from det_image_seq4_MIRIMAGE_F560Wexp1_rate.fits&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-09-20 17:20:03,369 - stpipe.Image2Pipeline - INFO - Step Image2Pipeline parameters are: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: &#39;/tmp/tmpw_9tx2tw/det_image_seq4_MIRIMAGE_F560Wexp1_rate.fits_cal.fits&#39;, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: False, &#39;output_use_index&#39;: True, &#39;save_results&#39;: True, &#39;skip&#39;: False, &#39;suffix&#39;: None, &#39;search_output_file&#39;: True, &#39;input_dir&#39;: &#39;&#39;, &#39;save_bsub&#39;: False, &#39;steps&#39;: {&#39;bkg_subtract&#39;: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: None, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: False, &#39;output_use_index&#39;: True, &#39;save_results&#39;: False, &#39;skip&#39;: False, &#39;suffix&#39;: None, &#39;search_output_file&#39;: True, &#39;input_dir&#39;: &#39;&#39;, &#39;save_combined_background&#39;: False, &#39;sigma&#39;: 3.0, &#39;maxiters&#39;: None, &#39;wfss_mmag_extract&#39;: None}, &#39;assign_wcs&#39;: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: None, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: False, &#39;output_use_index&#39;: True, &#39;save_results&#39;: False, &#39;skip&#39;: False, &#39;suffix&#39;: None, &#39;search_output_file&#39;: True, &#39;input_dir&#39;: &#39;&#39;, &#39;sip_approx&#39;: True, &#39;sip_max_pix_error&#39;: 0.25, &#39;sip_degree&#39;: None, &#39;sip_max_inv_pix_error&#39;: 0.25, &#39;sip_inv_degree&#39;: None, &#39;sip_npoints&#39;: 32, &#39;slit_y_low&#39;: -0.55, &#39;slit_y_high&#39;: 0.55}, &#39;flat_field&#39;: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: None, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: False, &#39;output_use_index&#39;: True, &#39;save_results&#39;: False, &#39;skip&#39;: False, &#39;suffix&#39;: None, &#39;search_output_file&#39;: True, &#39;input_dir&#39;: &#39;&#39;, &#39;save_interpolated_flat&#39;: False, &#39;user_supplied_flat&#39;: None, &#39;inverse&#39;: False}, &#39;photom&#39;: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: None, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: False, &#39;output_use_index&#39;: True, &#39;save_results&#39;: False, &#39;skip&#39;: False, &#39;suffix&#39;: None, &#39;search_output_file&#39;: True, &#39;input_dir&#39;: &#39;&#39;, &#39;inverse&#39;: False, &#39;source_type&#39;: None}, &#39;resample&#39;: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: None, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: False, &#39;output_use_index&#39;: True, &#39;save_results&#39;: True, &#39;skip&#39;: False, &#39;suffix&#39;: None, &#39;search_output_file&#39;: True, &#39;input_dir&#39;: &#39;&#39;, &#39;pixfrac&#39;: 1.0, &#39;kernel&#39;: &#39;square&#39;, &#39;fillval&#39;: &#39;INDEF&#39;, &#39;weight_type&#39;: &#39;ivm&#39;, &#39;output_shape&#39;: None, &#39;crpix&#39;: None, &#39;crval&#39;: None, &#39;rotation&#39;: None, &#39;pixel_scale_ratio&#39;: 1.0, &#39;pixel_scale&#39;: None, &#39;single&#39;: False, &#39;blendheaders&#39;: True, &#39;allowed_memory&#39;: None, &#39;in_memory&#39;: True}}}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-09-20 17:20:03,378 - stpipe.Image2Pipeline - INFO - Prefetching reference files for dataset: &#39;det_image_seq4_MIRIMAGE_F560Wexp1_rate.fits&#39; reftypes = [&#39;area&#39;, &#39;camera&#39;, &#39;collimator&#39;, &#39;dflat&#39;, &#39;disperser&#39;, &#39;distortion&#39;, &#39;drizpars&#39;, &#39;fflat&#39;, &#39;filteroffset&#39;, &#39;flat&#39;, &#39;fore&#39;, &#39;fpa&#39;, &#39;ifufore&#39;, &#39;ifupost&#39;, &#39;ifuslicer&#39;, &#39;msa&#39;, &#39;ote&#39;, &#39;photom&#39;, &#39;regions&#39;, &#39;sflat&#39;, &#39;specwcs&#39;, &#39;wavelengthrange&#39;, &#39;wfssbkg&#39;]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-09-20 17:20:03,379 - CRDS - ERROR -  (FATAL) CRDS server connection and cache load FAILED.  Cannot continue.
 See https://hst-crds.stsci.edu/docs/cmdline_bestrefs/ or https://jwst-crds.stsci.edu/docs/cmdline_bestrefs/
 for more information on configuring CRDS,  particularly CRDS_PATH and CRDS_SERVER_URL. : [Errno 2] No such file or directory: &#39;/grp/crds/cache/config/jwst/server_config&#39;
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ServiceError</span><span class="g g-Whitespace">                              </span>Traceback (most recent call last)
<span class="nn">File /usr/share/miniconda/lib/python3.9/site-packages/crds/client/api.py:387,</span> in <span class="ni">_get_server_info</span><span class="nt">()</span>
<span class="g g-Whitespace">    </span><span class="mi">386</span> <span class="n">config_uri</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;JSON RPC service at &#39;</span><span class="si">{</span><span class="n">get_crds_server</span><span class="p">()</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
<span class="ne">--&gt; </span><span class="mi">387</span> <span class="n">info</span> <span class="o">=</span> <span class="n">S</span><span class="o">.</span><span class="n">get_server_info</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">388</span> <span class="n">log</span><span class="o">.</span><span class="n">verbose</span><span class="p">(</span><span class="s2">&quot;Connected to server at&quot;</span><span class="p">,</span> <span class="n">srepr</span><span class="p">(</span><span class="n">get_crds_server</span><span class="p">()))</span>

<span class="nn">File /usr/share/miniconda/lib/python3.9/site-packages/crds/client/proxy.py:157,</span> in <span class="ni">ServiceCallBinding.__call__</span><span class="nt">(self, *args, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">156</span> <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="ne">--&gt; </span><span class="mi">157</span>     <span class="n">jsonrpc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">158</span>     <span class="k">if</span> <span class="n">jsonrpc</span><span class="p">[</span><span class="s2">&quot;error&quot;</span><span class="p">]:</span>

<span class="nn">File /usr/share/miniconda/lib/python3.9/site-packages/crds/client/proxy.py:121,</span> in <span class="ni">ServiceCallBinding._call</span><span class="nt">(self, *args, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">120</span> <span class="k">if</span> <span class="s2">&quot;serverless&quot;</span> <span class="ow">in</span> <span class="n">url</span> <span class="ow">or</span> <span class="s2">&quot;server-less&quot;</span> <span class="ow">in</span> <span class="n">url</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">121</span>     <span class="k">raise</span> <span class="n">exceptions</span><span class="o">.</span><span class="n">ServiceError</span><span class="p">(</span><span class="s2">&quot;Configured for server-less mode.  Skipping JSON RPC &quot;</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__service_name</span><span class="p">))</span>
<span class="g g-Whitespace">    </span><span class="mi">123</span> <span class="k">if</span> <span class="n">log</span><span class="o">.</span><span class="n">get_verbose</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="mi">50</span><span class="p">:</span>

<span class="ne">ServiceError</span>: Configured for server-less mode.  Skipping JSON RPC &#39;get_server_info&#39;

<span class="n">The</span> <span class="n">above</span> <span class="n">exception</span> <span class="n">was</span> <span class="n">the</span> <span class="n">direct</span> <span class="n">cause</span> <span class="n">of</span> <span class="n">the</span> <span class="n">following</span> <span class="n">exception</span><span class="p">:</span>

<span class="ne">CrdsNetworkError</span><span class="g g-Whitespace">                          </span>Traceback (most recent call last)
<span class="nn">File /usr/share/miniconda/lib/python3.9/site-packages/crds/core/heavy_client.py:513,</span> in <span class="ni">get_config_info</span><span class="nt">(observatory)</span>
<span class="g g-Whitespace">    </span><span class="mi">512</span> <span class="k">try</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">513</span>     <span class="n">info</span> <span class="o">=</span> <span class="n">ConfigInfo</span><span class="p">(</span><span class="n">api</span><span class="o">.</span><span class="n">get_server_info</span><span class="p">())</span>
<span class="g g-Whitespace">    </span><span class="mi">514</span>     <span class="k">if</span> <span class="n">info</span><span class="o">.</span><span class="n">effective_mode</span> <span class="o">!=</span> <span class="s2">&quot;remote&quot;</span><span class="p">:</span>

<span class="nn">File /usr/share/miniconda/lib/python3.9/site-packages/crds/core/utils.py:306,</span> in <span class="ni">CachedFunction.__call__</span><span class="nt">(self, *args, **keys)</span>
<span class="g g-Whitespace">    </span><span class="mi">303</span> <span class="sd">&quot;&quot;&quot;Compute or fetch func(*args, **keys).  Add the result to the cache.</span>
<span class="g g-Whitespace">    </span><span class="mi">304</span><span class="sd"> return func(*args, **keys)</span>
<span class="g g-Whitespace">    </span><span class="mi">305</span><span class="sd"> &quot;&quot;&quot;</span>
<span class="ne">--&gt; </span><span class="mi">306</span> <span class="n">key</span><span class="p">,</span> <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_readonly</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">keys</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">307</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span>

<span class="nn">File /usr/share/miniconda/lib/python3.9/site-packages/crds/core/utils.py:293,</span> in <span class="ni">CachedFunction._readonly</span><span class="nt">(self, *args, **keys)</span>
<span class="g g-Whitespace">    </span><span class="mi">292</span> <span class="n">log</span><span class="o">.</span><span class="n">verbose</span><span class="p">(</span><span class="s2">&quot;Uncached call&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">uncached</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">key</span><span class="p">),</span> <span class="n">verbosity</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">293</span> <span class="k">return</span> <span class="n">key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">uncached</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">keys</span><span class="p">)</span>

<span class="nn">File /usr/share/miniconda/lib/python3.9/site-packages/crds/client/api.py:337,</span> in <span class="ni">get_server_info</span><span class="nt">()</span>
<span class="g g-Whitespace">    </span><span class="mi">324</span> <span class="sd">&quot;&quot;&quot;Return a dictionary of critical parameters about the server such as:</span>
<span class="g g-Whitespace">    </span><span class="mi">325</span><span class="sd"> </span>
<span class="g g-Whitespace">    </span><span class="mi">326</span><span class="sd"> operational_context  - the context in use in the operational pipeline</span>
<span class="sd">   (...)</span>
<span class="g g-Whitespace">    </span><span class="mi">335</span><span class="sd"> what context, software, and network mode should be used for processing.</span>
<span class="g g-Whitespace">    </span><span class="mi">336</span><span class="sd"> &quot;&quot;&quot;</span>
<span class="ne">--&gt; </span><span class="mi">337</span> <span class="n">info</span> <span class="o">=</span> <span class="n">_get_server_info</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">338</span> <span class="n">info</span><span class="p">[</span><span class="s2">&quot;server&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_crds_server</span><span class="p">()</span>

<span class="nn">File /usr/share/miniconda/lib/python3.9/site-packages/crds/client/api.py:392,</span> in <span class="ni">_get_server_info</span><span class="nt">()</span>
<span class="g g-Whitespace">    </span><span class="mi">391</span> <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">392</span>     <span class="k">raise</span> <span class="n">CrdsNetworkError</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">393</span>         <span class="sa">f</span><span class="s2">&quot;Failed downloading cache config from: </span><span class="si">{</span><span class="n">config_uri</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">394</span>         <span class="n">srepr</span><span class="p">(</span><span class="n">exc</span><span class="p">))</span> <span class="kn">from</span> <span class="nn">exc</span>
<span class="g g-Whitespace">    </span><span class="mi">395</span> <span class="k">return</span> <span class="n">info</span>

<span class="ne">CrdsNetworkError</span>: Failed downloading cache config from: JSON RPC service at &#39;https://crds-serverless-mode.stsci.edu&#39;: &quot;Configured for server-less mode.  Skipping JSON RPC &#39;get_server_info&#39;&quot;

<span class="n">During</span> <span class="n">handling</span> <span class="n">of</span> <span class="n">the</span> <span class="n">above</span> <span class="n">exception</span><span class="p">,</span> <span class="n">another</span> <span class="n">exception</span> <span class="n">occurred</span><span class="p">:</span>

<span class="ne">FileNotFoundError</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="nn">File /usr/share/miniconda/lib/python3.9/site-packages/crds/core/log.py:366,</span> in <span class="ni">exception_trap_logger.&lt;locals&gt;.func_on_exception</span><span class="nt">(*args, **keys)</span>
<span class="g g-Whitespace">    </span><span class="mi">365</span> <span class="k">try</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">366</span>     <span class="k">yield</span>
<span class="g g-Whitespace">    </span><span class="mi">367</span> <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>

<span class="nn">File /usr/share/miniconda/lib/python3.9/site-packages/crds/core/heavy_client.py:595,</span> in <span class="ni">load_server_info</span><span class="nt">(observatory)</span>
<span class="g g-Whitespace">    </span><span class="mi">594</span>     <span class="n">server_config</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">locate_config</span><span class="p">(</span><span class="s2">&quot;server_config&quot;</span><span class="p">,</span> <span class="n">observatory</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">595</span> <span class="n">config_data</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_uri_content</span><span class="p">(</span><span class="n">server_config</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">596</span> <span class="n">info</span> <span class="o">=</span> <span class="n">ConfigInfo</span><span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">(</span><span class="n">config_data</span><span class="p">))</span>

<span class="nn">File /usr/share/miniconda/lib/python3.9/site-packages/crds/core/utils.py:737,</span> in <span class="ni">get_uri_content</span><span class="nt">(uri, mode)</span>
<span class="g g-Whitespace">    </span><span class="mi">736</span> <span class="n">mode</span> <span class="o">=</span> <span class="s2">&quot;r&quot;</span> <span class="k">if</span> <span class="p">(</span><span class="n">mode</span><span class="o">==</span><span class="s2">&quot;text&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;rb&quot;</span>
<span class="ne">--&gt; </span><span class="mi">737</span> <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">uri</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">738</span>     <span class="k">return</span> <span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

<span class="ne">FileNotFoundError</span>: [Errno 2] No such file or directory: &#39;/grp/crds/cache/config/jwst/server_config&#39;

<span class="n">During</span> <span class="n">handling</span> <span class="n">of</span> <span class="n">the</span> <span class="n">above</span> <span class="n">exception</span><span class="p">,</span> <span class="n">another</span> <span class="n">exception</span> <span class="n">occurred</span><span class="p">:</span>

<span class="ne">SystemExit</span><span class="g g-Whitespace">                                </span>Traceback (most recent call last)
    <span class="p">[</span><span class="o">...</span> <span class="n">skipping</span> <span class="n">hidden</span> <span class="mi">1</span> <span class="n">frame</span><span class="p">]</span>

<span class="n">Cell</span> <span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="n">line</span> <span class="mi">21</span>
<span class="g g-Whitespace">     </span><span class="mi">19</span> <span class="n">pipe2</span><span class="o">.</span><span class="n">suffix</span> <span class="o">=</span> <span class="kc">None</span>
<span class="ne">---&gt; </span><span class="mi">21</span> <span class="n">calfile</span> <span class="o">=</span> <span class="n">pipe2</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">rampfile</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">23</span> <span class="n">callist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">calfile</span><span class="p">)</span>

<span class="nn">File /usr/share/miniconda/lib/python3.9/site-packages/stpipe/step.py:481,</span> in <span class="ni">Step.run</span><span class="nt">(self, *args)</span>
<span class="g g-Whitespace">    </span><span class="mi">480</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prefetch_references</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">481</span>     <span class="bp">self</span><span class="o">.</span><span class="n">prefetch</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">482</span> <span class="k">try</span><span class="p">:</span>

<span class="nn">File /usr/share/miniconda/lib/python3.9/site-packages/stpipe/step.py:598,</span> in <span class="ni">Step.prefetch</span><span class="nt">(self, *args)</span>
<span class="g g-Whitespace">    </span><span class="mi">597</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reference_file_types</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">skip</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">598</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_precache_references</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="nn">File /usr/share/miniconda/lib/python3.9/site-packages/stpipe/pipeline.py:313,</span> in <span class="ni">Pipeline._precache_references</span><span class="nt">(self, input_file)</span>
<span class="g g-Whitespace">    </span><span class="mi">311</span>     <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">open_model</span><span class="p">(</span><span class="n">input_file</span><span class="p">,</span> <span class="n">asn_n_members</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">312</span>                         <span class="n">asn_exptypes</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;science&quot;</span><span class="p">])</span> <span class="k">as</span> <span class="n">model</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">313</span>         <span class="bp">self</span><span class="o">.</span><span class="n">_precache_references_opened</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">314</span> <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">,</span> <span class="ne">IOError</span><span class="p">):</span>

<span class="nn">File /usr/share/miniconda/lib/python3.9/site-packages/stpipe/pipeline.py:336,</span> in <span class="ni">Pipeline._precache_references_opened</span><span class="nt">(self, model_or_container)</span>
<span class="g g-Whitespace">    </span><span class="mi">334</span> <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">335</span>     <span class="c1"># precache a single model object</span>
<span class="ne">--&gt; </span><span class="mi">336</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_precache_references_impl</span><span class="p">(</span><span class="n">model_or_container</span><span class="p">)</span>

<span class="nn">File /usr/share/miniconda/lib/python3.9/site-packages/stpipe/pipeline.py:360,</span> in <span class="ni">Pipeline._precache_references_impl</span><span class="nt">(self, model)</span>
<span class="g g-Whitespace">    </span><span class="mi">358</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Prefetching reference files for dataset: &quot;</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span> <span class="o">+</span>
<span class="g g-Whitespace">    </span><span class="mi">359</span>               <span class="s2">&quot; reftypes = &quot;</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="n">fetch_types</span><span class="p">))</span>
<span class="ne">--&gt; </span><span class="mi">360</span> <span class="n">crds_refs</span> <span class="o">=</span> <span class="n">crds_client</span><span class="o">.</span><span class="n">get_multiple_reference_paths</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">get_crds_parameters</span><span class="p">(),</span> <span class="n">fetch_types</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">crds_observatory</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">362</span> <span class="n">ref_path_map</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">crds_refs</span><span class="o">.</span><span class="n">items</span><span class="p">())</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">ovr_refs</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>

<span class="nn">File /usr/share/miniconda/lib/python3.9/site-packages/stpipe/crds_client.py:55,</span> in <span class="ni">get_multiple_reference_paths</span><span class="nt">(parameters, reference_file_types, observatory)</span>
<span class="g g-Whitespace">     </span><span class="mi">54</span> <span class="n">log</span><span class="o">.</span><span class="n">set_log_time</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="ne">---&gt; </span><span class="mi">55</span> <span class="n">refpaths</span> <span class="o">=</span> <span class="n">_get_refpaths</span><span class="p">(</span><span class="n">parameters</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">reference_file_types</span><span class="p">),</span> <span class="n">observatory</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">56</span> <span class="k">return</span> <span class="n">refpaths</span>

<span class="nn">File /usr/share/miniconda/lib/python3.9/site-packages/stpipe/crds_client.py:68,</span> in <span class="ni">_get_refpaths</span><span class="nt">(data_dict, reference_file_types, observatory)</span>
<span class="g g-Whitespace">     </span><span class="mi">67</span> <span class="k">with</span> <span class="n">crds_cache_locking</span><span class="o">.</span><span class="n">get_cache_lock</span><span class="p">():</span>
<span class="ne">---&gt; </span><span class="mi">68</span>     <span class="n">bestrefs</span> <span class="o">=</span> <span class="n">crds</span><span class="o">.</span><span class="n">getreferences</span><span class="p">(</span>
<span class="g g-Whitespace">     </span><span class="mi">69</span>         <span class="n">data_dict</span><span class="p">,</span> <span class="n">reftypes</span><span class="o">=</span><span class="n">reference_file_types</span><span class="p">,</span> <span class="n">observatory</span><span class="o">=</span><span class="n">observatory</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">70</span> <span class="n">refpaths</span> <span class="o">=</span> <span class="p">{</span><span class="n">filetype</span><span class="p">:</span> <span class="n">filepath</span> <span class="k">if</span> <span class="s2">&quot;N/A&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">filepath</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">else</span> <span class="s2">&quot;N/A&quot;</span>
<span class="g g-Whitespace">     </span><span class="mi">71</span>             <span class="k">for</span> <span class="p">(</span><span class="n">filetype</span><span class="p">,</span> <span class="n">filepath</span><span class="p">)</span> <span class="ow">in</span> <span class="n">bestrefs</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

<span class="nn">File /usr/share/miniconda/lib/python3.9/site-packages/crds/core/heavy_client.py:122,</span> in <span class="ni">getreferences</span><span class="nt">(parameters, reftypes, context, ignore_cache, observatory, fast)</span>
<span class="g g-Whitespace">     </span><span class="mi">83</span> <span class="sd">&quot;&quot;&quot;</span>
<span class="g g-Whitespace">     </span><span class="mi">84</span><span class="sd"> This is the top-level get reference call for all of CRDS.  Based on</span>
<span class="g g-Whitespace">     </span><span class="mi">85</span><span class="sd"> `parameters`, getreferences() will download/cache the corresponding best</span>
<span class="sd">   (...)</span>
<span class="g g-Whitespace">    </span><span class="mi">120</span><span class="sd">   cached reference file.</span>
<span class="g g-Whitespace">    </span><span class="mi">121</span><span class="sd"> &quot;&quot;&quot;</span>
<span class="ne">--&gt; </span><span class="mi">122</span> <span class="n">final_context</span><span class="p">,</span> <span class="n">bestrefs</span> <span class="o">=</span> <span class="n">_initial_recommendations</span><span class="p">(</span><span class="s2">&quot;getreferences&quot;</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">123</span>     <span class="n">parameters</span><span class="p">,</span> <span class="n">reftypes</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">ignore_cache</span><span class="p">,</span> <span class="n">observatory</span><span class="p">,</span> <span class="n">fast</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">125</span> <span class="c1"># Attempt to cache the recommended references,  which unlike dump_mappings</span>
<span class="g g-Whitespace">    </span><span class="mi">126</span> <span class="c1"># should work without network access if files are already cached.</span>

<span class="nn">File /usr/share/miniconda/lib/python3.9/site-packages/crds/core/heavy_client.py:203,</span> in <span class="ni">_initial_recommendations</span><span class="nt">(name, parameters, reftypes, context, ignore_cache, observatory, fast)</span>
<span class="g g-Whitespace">    </span><span class="mi">201</span>     <span class="n">check_context</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">203</span> <span class="n">mode</span><span class="p">,</span> <span class="n">final_context</span> <span class="o">=</span> <span class="n">get_processing_mode</span><span class="p">(</span><span class="n">observatory</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">205</span> <span class="n">log</span><span class="o">.</span><span class="n">verbose</span><span class="p">(</span><span class="s2">&quot;Final effective context is&quot;</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">final_context</span><span class="p">))</span>

<span class="nn">File /usr/share/miniconda/lib/python3.9/site-packages/crds/core/utils.py:306,</span> in <span class="ni">CachedFunction.__call__</span><span class="nt">(self, *args, **keys)</span>
<span class="g g-Whitespace">    </span><span class="mi">303</span> <span class="sd">&quot;&quot;&quot;Compute or fetch func(*args, **keys).  Add the result to the cache.</span>
<span class="g g-Whitespace">    </span><span class="mi">304</span><span class="sd"> return func(*args, **keys)</span>
<span class="g g-Whitespace">    </span><span class="mi">305</span><span class="sd"> &quot;&quot;&quot;</span>
<span class="ne">--&gt; </span><span class="mi">306</span> <span class="n">key</span><span class="p">,</span> <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_readonly</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">keys</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">307</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span>

<span class="nn">File /usr/share/miniconda/lib/python3.9/site-packages/crds/core/utils.py:293,</span> in <span class="ni">CachedFunction._readonly</span><span class="nt">(self, *args, **keys)</span>
<span class="g g-Whitespace">    </span><span class="mi">292</span> <span class="n">log</span><span class="o">.</span><span class="n">verbose</span><span class="p">(</span><span class="s2">&quot;Uncached call&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">uncached</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">key</span><span class="p">),</span> <span class="n">verbosity</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">293</span> <span class="k">return</span> <span class="n">key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">uncached</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">keys</span><span class="p">)</span>

<span class="nn">File /usr/share/miniconda/lib/python3.9/site-packages/crds/core/heavy_client.py:390,</span> in <span class="ni">get_processing_mode</span><span class="nt">(observatory, context)</span>
<span class="g g-Whitespace">    </span><span class="mi">387</span> <span class="sd">&quot;&quot;&quot;Return the processing mode (local, remote) and the .pmap name to be used</span>
<span class="g g-Whitespace">    </span><span class="mi">388</span><span class="sd"> for best references selections.</span>
<span class="g g-Whitespace">    </span><span class="mi">389</span><span class="sd"> &quot;&quot;&quot;</span>
<span class="ne">--&gt; </span><span class="mi">390</span> <span class="n">info</span> <span class="o">=</span> <span class="n">get_config_info</span><span class="p">(</span><span class="n">observatory</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">392</span> <span class="n">final_context</span> <span class="o">=</span> <span class="n">get_final_context</span><span class="p">(</span><span class="n">info</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>

<span class="nn">File /usr/share/miniconda/lib/python3.9/site-packages/crds/core/utils.py:306,</span> in <span class="ni">CachedFunction.__call__</span><span class="nt">(self, *args, **keys)</span>
<span class="g g-Whitespace">    </span><span class="mi">303</span> <span class="sd">&quot;&quot;&quot;Compute or fetch func(*args, **keys).  Add the result to the cache.</span>
<span class="g g-Whitespace">    </span><span class="mi">304</span><span class="sd"> return func(*args, **keys)</span>
<span class="g g-Whitespace">    </span><span class="mi">305</span><span class="sd"> &quot;&quot;&quot;</span>
<span class="ne">--&gt; </span><span class="mi">306</span> <span class="n">key</span><span class="p">,</span> <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_readonly</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">keys</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">307</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span>

<span class="nn">File /usr/share/miniconda/lib/python3.9/site-packages/crds/core/utils.py:293,</span> in <span class="ni">CachedFunction._readonly</span><span class="nt">(self, *args, **keys)</span>
<span class="g g-Whitespace">    </span><span class="mi">292</span> <span class="n">log</span><span class="o">.</span><span class="n">verbose</span><span class="p">(</span><span class="s2">&quot;Uncached call&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">uncached</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">key</span><span class="p">),</span> <span class="n">verbosity</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">293</span> <span class="k">return</span> <span class="n">key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">uncached</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">keys</span><span class="p">)</span>

<span class="nn">File /usr/share/miniconda/lib/python3.9/site-packages/crds/core/heavy_client.py:523,</span> in <span class="ni">get_config_info</span><span class="nt">(observatory)</span>
<span class="g g-Whitespace">    </span><span class="mi">522</span>     <span class="n">log</span><span class="o">.</span><span class="n">verbose_warning</span><span class="p">(</span><span class="s2">&quot;Couldn&#39;t contact CRDS server:&quot;</span><span class="p">,</span> <span class="n">srepr</span><span class="p">(</span><span class="n">api</span><span class="o">.</span><span class="n">get_crds_server</span><span class="p">()),</span> <span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">))</span>
<span class="ne">--&gt; </span><span class="mi">523</span> <span class="n">info</span> <span class="o">=</span> <span class="n">load_server_info</span><span class="p">(</span><span class="n">observatory</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">524</span> <span class="n">info</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;cache&quot;</span>

<span class="nn">File /usr/share/miniconda/lib/python3.9/site-packages/crds/core/heavy_client.py:598,</span> in <span class="ni">load_server_info</span><span class="nt">(observatory)</span>
<span class="g g-Whitespace">    </span><span class="mi">597</span> <span class="n">info</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;cache&quot;</span>
<span class="ne">--&gt; </span><span class="mi">598</span> <span class="k">return</span> <span class="n">info</span>

<span class="nn">File /usr/share/miniconda/lib/python3.9/contextlib.py:137,</span> in <span class="ni">_GeneratorContextManager.__exit__</span><span class="nt">(self, typ, value, traceback)</span>
<span class="g g-Whitespace">    </span><span class="mi">136</span> <span class="k">try</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">137</span>     <span class="bp">self</span><span class="o">.</span><span class="n">gen</span><span class="o">.</span><span class="n">throw</span><span class="p">(</span><span class="n">typ</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">traceback</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">138</span> <span class="k">except</span> <span class="ne">StopIteration</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">139</span>     <span class="c1"># Suppress StopIteration *unless* it&#39;s the same exception that</span>
<span class="g g-Whitespace">    </span><span class="mi">140</span>     <span class="c1"># was passed to throw().  This prevents a StopIteration</span>
<span class="g g-Whitespace">    </span><span class="mi">141</span>     <span class="c1"># raised inside the &quot;with&quot; statement from being suppressed.</span>

<span class="nn">File /usr/share/miniconda/lib/python3.9/site-packages/crds/core/log.py:368,</span> in <span class="ni">exception_trap_logger.&lt;locals&gt;.func_on_exception</span><span class="nt">(*args, **keys)</span>
<span class="g g-Whitespace">    </span><span class="mi">367</span> <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">368</span>     <span class="n">reraise</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span> <span class="o">+</span> <span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">)),</span> <span class="o">**</span><span class="n">keys</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">369</span>     <span class="k">if</span> <span class="ow">not</span> <span class="n">CRDS_EXCEPTION_TRAP</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">370</span>         <span class="c1"># In python-2, distinction between raise and &quot;raise something&quot;.  raise doesn&#39;t</span>
<span class="g g-Whitespace">    </span><span class="mi">371</span>         <span class="c1"># wreck the traceback,  raising a new improved exception does.</span>

<span class="nn">File /usr/share/miniconda/lib/python3.9/site-packages/crds/core/log.py:261,</span> in <span class="ni">CrdsLogger.fatal_error</span><span class="nt">(self, *args, **keys)</span>
<span class="g g-Whitespace">    </span><span class="mi">260</span> <span class="n">error</span><span class="p">(</span><span class="s2">&quot;(FATAL)&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">keys</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">261</span> <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

<span class="ne">SystemExit</span>: -1

<span class="n">During</span> <span class="n">handling</span> <span class="n">of</span> <span class="n">the</span> <span class="n">above</span> <span class="n">exception</span><span class="p">,</span> <span class="n">another</span> <span class="n">exception</span> <span class="n">occurred</span><span class="p">:</span>

<span class="ne">AssertionError</span><span class="g g-Whitespace">                            </span>Traceback (most recent call last)
    <span class="p">[</span><span class="o">...</span> <span class="n">skipping</span> <span class="n">hidden</span> <span class="mi">1</span> <span class="n">frame</span><span class="p">]</span>

<span class="nn">File /usr/share/miniconda/lib/python3.9/site-packages/IPython/core/interactiveshell.py:1987,</span> in <span class="ni">InteractiveShell.showtraceback</span><span class="nt">(self, exc_tuple, filename, tb_offset, exception_only, running_compiled_code)</span>
<span class="g g-Whitespace">   </span><span class="mi">1984</span> <span class="k">if</span> <span class="n">exception_only</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1985</span>     <span class="n">stb</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;An exception has occurred, use %tb to see &#39;</span>
<span class="g g-Whitespace">   </span><span class="mi">1986</span>            <span class="s1">&#39;the full traceback.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">]</span>
<span class="ne">-&gt; </span><span class="mi">1987</span>     <span class="n">stb</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">InteractiveTB</span><span class="o">.</span><span class="n">get_exception_only</span><span class="p">(</span><span class="n">etype</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1988</span>                                                      <span class="n">value</span><span class="p">))</span>
<span class="g g-Whitespace">   </span><span class="mi">1989</span> <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1990</span>     <span class="k">try</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1991</span>         <span class="c1"># Exception classes can customise their traceback - we</span>
<span class="g g-Whitespace">   </span><span class="mi">1992</span>         <span class="c1"># use this in IPython.parallel for exceptions occurring</span>
<span class="g g-Whitespace">   </span><span class="mi">1993</span>         <span class="c1"># in the engines. This should return a list of strings.</span>

<span class="nn">File /usr/share/miniconda/lib/python3.9/site-packages/IPython/core/ultratb.py:579,</span> in <span class="ni">ListTB.get_exception_only</span><span class="nt">(self, etype, value)</span>
<span class="g g-Whitespace">    </span><span class="mi">571</span> <span class="k">def</span> <span class="nf">get_exception_only</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">etype</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">572</span>     <span class="sd">&quot;&quot;&quot;Only print the exception type and message, without a traceback.</span>
<span class="g g-Whitespace">    </span><span class="mi">573</span><span class="sd"> </span>
<span class="g g-Whitespace">    </span><span class="mi">574</span><span class="sd">     Parameters</span>
<span class="sd">   (...)</span>
<span class="g g-Whitespace">    </span><span class="mi">577</span><span class="sd">     value : exception value</span>
<span class="g g-Whitespace">    </span><span class="mi">578</span><span class="sd">     &quot;&quot;&quot;</span>
<span class="ne">--&gt; </span><span class="mi">579</span>     <span class="k">return</span> <span class="n">ListTB</span><span class="o">.</span><span class="n">structured_traceback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">etype</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

<span class="nn">File /usr/share/miniconda/lib/python3.9/site-packages/IPython/core/ultratb.py:446,</span> in <span class="ni">ListTB.structured_traceback</span><span class="nt">(self, etype, evalue, etb, tb_offset, context)</span>
<span class="g g-Whitespace">    </span><span class="mi">443</span>     <span class="n">chained_exc_ids</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="n">exception</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
<span class="g g-Whitespace">    </span><span class="mi">444</span>     <span class="n">chained_exceptions_tb_offset</span> <span class="o">=</span> <span class="mi">0</span>
<span class="g g-Whitespace">    </span><span class="mi">445</span>     <span class="n">out_list</span> <span class="o">=</span> <span class="p">(</span>
<span class="ne">--&gt; </span><span class="mi">446</span>         <span class="bp">self</span><span class="o">.</span><span class="n">structured_traceback</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">447</span>             <span class="n">etype</span><span class="p">,</span> <span class="n">evalue</span><span class="p">,</span> <span class="p">(</span><span class="n">etb</span><span class="p">,</span> <span class="n">chained_exc_ids</span><span class="p">),</span>
<span class="g g-Whitespace">    </span><span class="mi">448</span>             <span class="n">chained_exceptions_tb_offset</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">449</span>         <span class="o">+</span> <span class="n">chained_exception_message</span>
<span class="g g-Whitespace">    </span><span class="mi">450</span>         <span class="o">+</span> <span class="n">out_list</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">452</span> <span class="k">return</span> <span class="n">out_list</span>

<span class="nn">File /usr/share/miniconda/lib/python3.9/site-packages/IPython/core/ultratb.py:1112,</span> in <span class="ni">AutoFormattedTB.structured_traceback</span><span class="nt">(self, etype, value, tb, tb_offset, number_of_lines_of_context)</span>
<span class="g g-Whitespace">   </span><span class="mi">1110</span> <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1111</span>     <span class="bp">self</span><span class="o">.</span><span class="n">tb</span> <span class="o">=</span> <span class="n">tb</span>
<span class="ne">-&gt; </span><span class="mi">1112</span> <span class="k">return</span> <span class="n">FormattedTB</span><span class="o">.</span><span class="n">structured_traceback</span><span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">1113</span>     <span class="bp">self</span><span class="p">,</span> <span class="n">etype</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">tb</span><span class="p">,</span> <span class="n">tb_offset</span><span class="p">,</span> <span class="n">number_of_lines_of_context</span><span class="p">)</span>

<span class="nn">File /usr/share/miniconda/lib/python3.9/site-packages/IPython/core/ultratb.py:1006,</span> in <span class="ni">FormattedTB.structured_traceback</span><span class="nt">(self, etype, value, tb, tb_offset, number_of_lines_of_context)</span>
<span class="g g-Whitespace">   </span><span class="mi">1003</span> <span class="n">mode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span>
<span class="g g-Whitespace">   </span><span class="mi">1004</span> <span class="k">if</span> <span class="n">mode</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose_modes</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1005</span>     <span class="c1"># Verbose modes need a full traceback</span>
<span class="ne">-&gt; </span><span class="mi">1006</span>     <span class="k">return</span> <span class="n">VerboseTB</span><span class="o">.</span><span class="n">structured_traceback</span><span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">1007</span>         <span class="bp">self</span><span class="p">,</span> <span class="n">etype</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">tb</span><span class="p">,</span> <span class="n">tb_offset</span><span class="p">,</span> <span class="n">number_of_lines_of_context</span>
<span class="g g-Whitespace">   </span><span class="mi">1008</span>     <span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1009</span> <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;Minimal&#39;</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1010</span>     <span class="k">return</span> <span class="n">ListTB</span><span class="o">.</span><span class="n">get_exception_only</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">etype</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

<span class="nn">File /usr/share/miniconda/lib/python3.9/site-packages/IPython/core/ultratb.py:859,</span> in <span class="ni">VerboseTB.structured_traceback</span><span class="nt">(self, etype, evalue, etb, tb_offset, number_of_lines_of_context)</span>
<span class="g g-Whitespace">    </span><span class="mi">850</span> <span class="k">def</span> <span class="nf">structured_traceback</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">851</span>     <span class="bp">self</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">852</span>     <span class="n">etype</span><span class="p">:</span> <span class="nb">type</span><span class="p">,</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">856</span>     <span class="n">number_of_lines_of_context</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">857</span> <span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">858</span>     <span class="sd">&quot;&quot;&quot;Return a nice text document describing the traceback.&quot;&quot;&quot;</span>
<span class="ne">--&gt; </span><span class="mi">859</span>     <span class="n">formatted_exception</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">format_exception_as_a_whole</span><span class="p">(</span><span class="n">etype</span><span class="p">,</span> <span class="n">evalue</span><span class="p">,</span> <span class="n">etb</span><span class="p">,</span> <span class="n">number_of_lines_of_context</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">860</span>                                                            <span class="n">tb_offset</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">862</span>     <span class="n">colors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Colors</span>  <span class="c1"># just a shorthand + quicker name lookup</span>
<span class="g g-Whitespace">    </span><span class="mi">863</span>     <span class="n">colorsnormal</span> <span class="o">=</span> <span class="n">colors</span><span class="o">.</span><span class="n">Normal</span>  <span class="c1"># used a lot</span>

<span class="nn">File /usr/share/miniconda/lib/python3.9/site-packages/IPython/core/ultratb.py:793,</span> in <span class="ni">VerboseTB.format_exception_as_a_whole</span><span class="nt">(self, etype, evalue, etb, number_of_lines_of_context, tb_offset)</span>
<span class="g g-Whitespace">    </span><span class="mi">790</span> <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tb_offset</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">791</span> <span class="n">head</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prepare_header</span><span class="p">(</span><span class="n">etype</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">long_header</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">792</span> <span class="n">records</span> <span class="o">=</span> <span class="p">(</span>
<span class="ne">--&gt; </span><span class="mi">793</span>     <span class="bp">self</span><span class="o">.</span><span class="n">get_records</span><span class="p">(</span><span class="n">etb</span><span class="p">,</span> <span class="n">number_of_lines_of_context</span><span class="p">,</span> <span class="n">tb_offset</span><span class="p">)</span> <span class="k">if</span> <span class="n">etb</span> <span class="k">else</span> <span class="p">[]</span>
<span class="g g-Whitespace">    </span><span class="mi">794</span> <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">796</span> <span class="n">frames</span> <span class="o">=</span> <span class="p">[]</span>
<span class="g g-Whitespace">    </span><span class="mi">797</span> <span class="n">skipped</span> <span class="o">=</span> <span class="mi">0</span>

<span class="nn">File /usr/share/miniconda/lib/python3.9/site-packages/IPython/core/ultratb.py:848,</span> in <span class="ni">VerboseTB.get_records</span><span class="nt">(self, etb, number_of_lines_of_context, tb_offset)</span>
<span class="g g-Whitespace">    </span><span class="mi">842</span>     <span class="n">formatter</span> <span class="o">=</span> <span class="kc">None</span>
<span class="g g-Whitespace">    </span><span class="mi">843</span> <span class="n">options</span> <span class="o">=</span> <span class="n">stack_data</span><span class="o">.</span><span class="n">Options</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">844</span>     <span class="n">before</span><span class="o">=</span><span class="n">before</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">845</span>     <span class="n">after</span><span class="o">=</span><span class="n">after</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">846</span>     <span class="n">pygments_formatter</span><span class="o">=</span><span class="n">formatter</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">847</span> <span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">848</span> <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">stack_data</span><span class="o">.</span><span class="n">FrameInfo</span><span class="o">.</span><span class="n">stack_data</span><span class="p">(</span><span class="n">etb</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">))[</span><span class="n">tb_offset</span><span class="p">:]</span>

<span class="nn">File /usr/share/miniconda/lib/python3.9/site-packages/stack_data/core.py:578,</span> in <span class="ni">FrameInfo.stack_data</span><span class="nt">(cls, frame_or_tb, options, collapse_repeated_frames)</span>
<span class="g g-Whitespace">    </span><span class="mi">562</span> <span class="nd">@classmethod</span>
<span class="g g-Whitespace">    </span><span class="mi">563</span> <span class="k">def</span> <span class="nf">stack_data</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">564</span>         <span class="bp">cls</span><span class="p">,</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">568</span>         <span class="n">collapse_repeated_frames</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
<span class="g g-Whitespace">    </span><span class="mi">569</span> <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="s1">&#39;FrameInfo&#39;</span><span class="p">,</span> <span class="n">RepeatedFrames</span><span class="p">]]:</span>
<span class="g g-Whitespace">    </span><span class="mi">570</span>     <span class="sd">&quot;&quot;&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">571</span><span class="sd">     An iterator of FrameInfo and RepeatedFrames objects representing</span>
<span class="g g-Whitespace">    </span><span class="mi">572</span><span class="sd">     a full traceback or stack. Similar consecutive frames are collapsed into RepeatedFrames</span>
<span class="sd">   (...)</span>
<span class="g g-Whitespace">    </span><span class="mi">576</span><span class="sd">     and optionally an Options object to configure.</span>
<span class="g g-Whitespace">    </span><span class="mi">577</span><span class="sd">     &quot;&quot;&quot;</span>
<span class="ne">--&gt; </span><span class="mi">578</span>     <span class="n">stack</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">iter_stack</span><span class="p">(</span><span class="n">frame_or_tb</span><span class="p">))</span>
<span class="g g-Whitespace">    </span><span class="mi">580</span>     <span class="c1"># Reverse the stack from a frame so that it&#39;s in the same order</span>
<span class="g g-Whitespace">    </span><span class="mi">581</span>     <span class="c1"># as the order from a traceback, which is the order of a printed</span>
<span class="g g-Whitespace">    </span><span class="mi">582</span>     <span class="c1"># traceback when read top to bottom (most recent call last)</span>
<span class="g g-Whitespace">    </span><span class="mi">583</span>     <span class="k">if</span> <span class="n">is_frame</span><span class="p">(</span><span class="n">frame_or_tb</span><span class="p">):</span>

<span class="nn">File /usr/share/miniconda/lib/python3.9/site-packages/stack_data/utils.py:98,</span> in <span class="ni">iter_stack</span><span class="nt">(frame_or_tb)</span>
<span class="g g-Whitespace">     </span><span class="mi">96</span> <span class="k">while</span> <span class="n">frame_or_tb</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">97</span>     <span class="k">yield</span> <span class="n">frame_or_tb</span>
<span class="ne">---&gt; </span><span class="mi">98</span>     <span class="k">if</span> <span class="n">is_frame</span><span class="p">(</span><span class="n">frame_or_tb</span><span class="p">):</span>
<span class="g g-Whitespace">     </span><span class="mi">99</span>         <span class="n">frame_or_tb</span> <span class="o">=</span> <span class="n">frame_or_tb</span><span class="o">.</span><span class="n">f_back</span>
<span class="g g-Whitespace">    </span><span class="mi">100</span>     <span class="k">else</span><span class="p">:</span>

<span class="nn">File /usr/share/miniconda/lib/python3.9/site-packages/stack_data/utils.py:91,</span> in <span class="ni">is_frame</span><span class="nt">(frame_or_tb)</span>
<span class="g g-Whitespace">     </span><span class="mi">90</span> <span class="k">def</span> <span class="nf">is_frame</span><span class="p">(</span><span class="n">frame_or_tb</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">FrameType</span><span class="p">,</span> <span class="n">TracebackType</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="ne">---&gt; </span><span class="mi">91</span>     <span class="n">assert_</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">frame_or_tb</span><span class="p">,</span> <span class="p">(</span><span class="n">types</span><span class="o">.</span><span class="n">FrameType</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">TracebackType</span><span class="p">)))</span>
<span class="g g-Whitespace">     </span><span class="mi">92</span>     <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">frame_or_tb</span><span class="p">,</span> <span class="p">(</span><span class="n">types</span><span class="o">.</span><span class="n">FrameType</span><span class="p">,))</span>

<span class="nn">File /usr/share/miniconda/lib/python3.9/site-packages/stack_data/utils.py:172,</span> in <span class="ni">assert_</span><span class="nt">(condition, error)</span>
<span class="g g-Whitespace">    </span><span class="mi">170</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">error</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">171</span>     <span class="n">error</span> <span class="o">=</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">172</span> <span class="k">raise</span> <span class="n">error</span>

<span class="ne">AssertionError</span>: 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#input_files=[]</span>
<span class="c1">#input_files=[input_file1,input_file2,input_file3,input_file4]</span>

<span class="n">imlist1</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;det_image_seq1_MIRIMAGE_F560Wexp1_cal.fits&#39;</span><span class="p">,</span><span class="s1">&#39;det_image_seq2_MIRIMAGE_F560Wexp1_cal.fits&#39;</span><span class="p">,</span><span class="s1">&#39;det_image_seq3_MIRIMAGE_F560Wexp1_cal.fits&#39;</span><span class="p">,</span><span class="s1">&#39;det_image_seq4_MIRIMAGE_F560Wexp1_cal.fits&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Look at one image</span>
<span class="n">im_file</span> <span class="o">=</span> <span class="n">ImageModel</span><span class="p">(</span><span class="s1">&#39;det_image_seq1_MIRIMAGE_F560Wexp1_cal.fits&#39;</span><span class="p">)</span>

<span class="c1"># read in ecsv photom file</span>
<span class="kn">from</span> <span class="nn">astropy.visualization</span> <span class="kn">import</span> <span class="n">LogStretch</span><span class="p">,</span> <span class="n">PercentileInterval</span><span class="p">,</span> <span class="n">ManualInterval</span>

<span class="c1">#viz2 = LogStretch() + ManualInterval(0,10)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>
<span class="c1">#plt.imshow(viz2(im_file.data), origin=&#39;lower&#39;)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">im_file</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;rainbow&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="set-parameters-for-tests">
<h2>Set parameters for tests<a class="headerlink" href="#set-parameters-for-tests" title="Permalink to this headline">#</a></h2>
<p>Set parameters to use both in pipeline runs and for regions to examine for background area stats.</p>
<p>For MIRI, the FWHM values are dependent on filter and should be set using the table below:</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>Filter</p></th>
<th class="head"><p>FWHM</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>F560W</p></td>
<td><p>1.636</p></td>
</tr>
<tr class="row-odd"><td><p>F770W</p></td>
<td><p>2.187</p></td>
</tr>
<tr class="row-even"><td><p>F1000W</p></td>
<td><p>2.888</p></td>
</tr>
<tr class="row-odd"><td><p>F1130W</p></td>
<td><p>3.318</p></td>
</tr>
<tr class="row-even"><td><p>F1280W</p></td>
<td><p>3.713</p></td>
</tr>
<tr class="row-odd"><td><p>F1500W</p></td>
<td><p>4.354</p></td>
</tr>
<tr class="row-even"><td><p>F1800W</p></td>
<td><p>5.224</p></td>
</tr>
<tr class="row-odd"><td><p>F2100W</p></td>
<td><p>5.989</p></td>
</tr>
<tr class="row-even"><td><p>F2550W</p></td>
<td><p>7.312</p></td>
</tr>
<tr class="row-odd"><td><p>F2550WR</p></td>
<td><p>7.312</p></td>
</tr>
</tbody>
</table>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Choose region of image to examine for stats (preferably no bright sources)</span>
<span class="n">xmin</span> <span class="o">=</span> <span class="mi">700</span>
<span class="n">xmax</span> <span class="o">=</span> <span class="mi">750</span>
<span class="n">ymin</span> <span class="o">=</span> <span class="mi">400</span>
<span class="n">ymax</span> <span class="o">=</span> <span class="mi">450</span>

<span class="c1"># parameters for calwebb_image3 runs</span>
<span class="n">snr</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">fwhm</span> <span class="o">=</span> <span class="mf">1.7</span>
</pre></div>
</div>
</div>
</div>
<p><a id="associations_ID"></a></p>
</section>
<section id="set-up-association-files">
<h2>Set up association files<a class="headerlink" href="#set-up-association-files" title="Permalink to this headline">#</a></h2>
<p>The level three pipeline relies on an association file to specify which files are to be combined and provide the output file name.</p>
<p><a class="reference external" href="#title_ID">Top of Page</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># use asn_from_list to create association table</span>
<span class="n">cal_list</span><span class="o">=</span><span class="n">imlist1</span>
<span class="n">asn</span> <span class="o">=</span> <span class="n">asn_from_list</span><span class="o">.</span><span class="n">asn_from_list</span><span class="p">(</span><span class="n">cal_list</span><span class="p">,</span> <span class="n">rule</span><span class="o">=</span><span class="n">DMS_Level3_Base</span><span class="p">,</span> <span class="n">product_name</span><span class="o">=</span><span class="s1">&#39;skymatch_combined.fits&#39;</span><span class="p">)</span>

<span class="c1"># use this if you need to add non&#39;science&#39; exposure types</span>
<span class="c1">#asn[&#39;products&#39;][0][&#39;members&#39;][1][&#39;exptype&#39;] = &#39;background&#39;</span>
<span class="c1">#asn[&#39;products&#39;][0][&#39;members&#39;][2][&#39;exptype&#39;] = &#39;sourcecat&#39;</span>

<span class="c1"># dump association table to a .json file for use in image3</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;skymatch_asnfile.json&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
    <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">asn</span><span class="o">.</span><span class="n">dump</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>

<span class="n">skymatch_json_file</span><span class="o">=</span><span class="s1">&#39;skymatch_asnfile.json&#39;</span>
    
<span class="n">json_file</span> <span class="o">=</span> <span class="n">skymatch_json_file</span>
<span class="n">file_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">file_list2</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">json_file</span><span class="p">)</span> <span class="k">as</span> <span class="n">json_data</span><span class="p">:</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">json_data</span><span class="p">)</span>
    <span class="n">members</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;products&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;members&#39;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">members</span><span class="p">)):</span>
        <span class="n">file_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">members</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="s1">&#39;expname&#39;</span><span class="p">])</span>
        <span class="n">file_list2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">members</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="s1">&#39;expname&#39;</span><span class="p">][:</span><span class="o">-</span><span class="mi">5</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;_skymatch.fits&quot;</span><span class="p">)</span>

    
<span class="n">asn2</span> <span class="o">=</span> <span class="n">asn_from_list</span><span class="o">.</span><span class="n">asn_from_list</span><span class="p">(</span><span class="n">file_list2</span><span class="p">,</span> <span class="n">rule</span><span class="o">=</span><span class="n">DMS_Level3_Base</span><span class="p">,</span> <span class="n">product_name</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;products&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>

<span class="c1"># use this if you need to add non&#39;science&#39; exposure types</span>
<span class="c1">#asn[&#39;products&#39;][0][&#39;members&#39;][1][&#39;exptype&#39;] = &#39;background&#39;</span>
<span class="c1">#asn[&#39;products&#39;][0][&#39;members&#39;][2][&#39;exptype&#39;] = &#39;sourcecat&#39;</span>

<span class="c1"># dump association table to a .json file for use in image3</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;skymatch_asnfile2.json&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
    <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">asn2</span><span class="o">.</span><span class="n">dump</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>
    
<span class="n">skymatch_json_file2</span><span class="o">=</span><span class="s1">&#39;skymatch_asnfile2.json&#39;</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="modify-average-background-level-of-input-images">
<h2>Modify average background level of input images<a class="headerlink" href="#modify-average-background-level-of-input-images" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">infile01_1</span> <span class="o">=</span> <span class="n">imlist1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">infile01_2</span> <span class="o">=</span> <span class="n">imlist1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">infile02_1</span> <span class="o">=</span> <span class="n">imlist1</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="n">infile02_2</span> <span class="o">=</span> <span class="n">imlist1</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">img01_1</span> <span class="o">=</span> <span class="n">datamodels</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">infile01_1</span><span class="p">)</span>
<span class="n">img01_2</span> <span class="o">=</span> <span class="n">datamodels</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">infile01_2</span><span class="p">)</span>
<span class="n">img02_1</span> <span class="o">=</span> <span class="n">datamodels</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">infile02_1</span><span class="p">)</span>
<span class="n">img02_2</span> <span class="o">=</span> <span class="n">datamodels</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">infile02_2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data01_1</span> <span class="o">=</span> <span class="n">img01_1</span><span class="o">.</span><span class="n">data</span>
<span class="n">data01_2</span> <span class="o">=</span> <span class="n">img01_2</span><span class="o">.</span><span class="n">data</span>
<span class="n">data02_1</span> <span class="o">=</span> <span class="n">img02_1</span><span class="o">.</span><span class="n">data</span>
<span class="n">data02_2</span> <span class="o">=</span> <span class="n">img02_2</span><span class="o">.</span><span class="n">data</span>

<span class="c1">#data01_1[data01_1&lt;=0.3]=np.nan</span>
<span class="c1">#data01_2[data01_2&lt;=0.3]=np.nan</span>
<span class="c1">#data02_1[data02_1&lt;=0.3]=np.nan</span>
<span class="c1">#data02_2[data02_2&lt;=0.3]=np.nan</span>

<span class="n">data01_1_orig</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">img01_1</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
<span class="n">data01_2_orig</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">img01_2</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
<span class="n">data02_1_orig</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">img02_1</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
<span class="n">data02_2_orig</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">img02_2</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># check mean values of background </span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">data01_1_orig</span><span class="p">[</span><span class="n">data01_1_orig</span><span class="o">&lt;=</span><span class="mf">4.0</span><span class="p">]),</span><span class="s1">&#39; Standard deviation: &#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">data01_1_orig</span><span class="p">[</span><span class="n">data01_1_orig</span><span class="o">&lt;=</span><span class="mf">4.0</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">data01_2_orig</span><span class="p">[</span><span class="n">data01_2_orig</span><span class="o">&lt;=</span><span class="mf">4.0</span><span class="p">]),</span><span class="s1">&#39; Standard deviation: &#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">data01_2_orig</span><span class="p">[</span><span class="n">data01_2_orig</span><span class="o">&lt;=</span><span class="mf">4.0</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">data02_1_orig</span><span class="p">[</span><span class="n">data02_1_orig</span><span class="o">&lt;=</span><span class="mf">4.0</span><span class="p">]),</span><span class="s1">&#39; Standard deviation: &#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">data02_1_orig</span><span class="p">[</span><span class="n">data02_1_orig</span><span class="o">&lt;=</span><span class="mf">4.0</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">data02_2_orig</span><span class="p">[</span><span class="n">data02_2_orig</span><span class="o">&lt;=</span><span class="mf">4.0</span><span class="p">]),</span><span class="s1">&#39; Standard deviation: &#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">data02_2_orig</span><span class="p">[</span><span class="n">data02_2_orig</span><span class="o">&lt;=</span><span class="mf">4.0</span><span class="p">]))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># creating a background image with specified mean and gaussian noise with sigma = 1.0</span>
<span class="n">bkg_img_noise_neg2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="mf">0.2</span><span class="p">,</span><span class="n">data01_1</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">bkg_img_noise_2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="mf">0.2</span><span class="p">,</span><span class="n">data01_1</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">bkg_img_noise_3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="o">*</span><span class="mf">0.2</span><span class="p">,</span><span class="n">data01_1</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">bkg_img_noise_4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="o">*</span><span class="mf">0.2</span><span class="p">,</span><span class="n">data01_1</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">bkg_img_noise_5</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="o">*</span><span class="mf">0.2</span><span class="p">,</span><span class="n">data01_1</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">bkg_img_noise_7</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">7</span><span class="o">*</span><span class="mf">0.2</span><span class="p">,</span><span class="n">data01_1</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Add offset noise to the background of the images for easier background visualization</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># adding the new background with specified mean and gaussian noise (above) to image </span>
<span class="n">img01_1</span><span class="o">.</span><span class="n">data</span><span class="o">=</span><span class="n">bkg_img_noise_2</span> <span class="o">+</span> <span class="n">img01_1</span><span class="o">.</span><span class="n">data</span>
<span class="n">img01_2</span><span class="o">.</span><span class="n">data</span><span class="o">=</span><span class="n">bkg_img_noise_3</span> <span class="o">+</span> <span class="n">img01_2</span><span class="o">.</span><span class="n">data</span>
<span class="n">img02_1</span><span class="o">.</span><span class="n">data</span><span class="o">=</span><span class="n">bkg_img_noise_5</span> <span class="o">+</span> <span class="n">img02_1</span><span class="o">.</span><span class="n">data</span>
<span class="n">img02_2</span><span class="o">.</span><span class="n">data</span><span class="o">=</span><span class="n">bkg_img_noise_2</span> <span class="o">+</span> <span class="n">img02_2</span><span class="o">.</span><span class="n">data</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># checking the mean and standard deviations of the new background values</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">img01_1</span><span class="o">.</span><span class="n">data</span><span class="p">),</span><span class="s1">&#39; Standard deviation: &#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nanstd</span><span class="p">(</span><span class="n">img01_1</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">img01_2</span><span class="o">.</span><span class="n">data</span><span class="p">),</span><span class="s1">&#39; Standard deviation: &#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nanstd</span><span class="p">(</span><span class="n">img01_2</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">img02_1</span><span class="o">.</span><span class="n">data</span><span class="p">),</span><span class="s1">&#39; Standard deviation: &#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nanstd</span><span class="p">(</span><span class="n">img02_1</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">img02_2</span><span class="o">.</span><span class="n">data</span><span class="p">),</span><span class="s1">&#39; Standard deviation: &#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nanstd</span><span class="p">(</span><span class="n">img02_2</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">img01_1</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">file_list2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">img01_2</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">file_list2</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">img02_1</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">file_list2</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">img02_2</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">file_list2</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Look at one image</span>
<span class="n">im_file</span> <span class="o">=</span> <span class="n">ImageModel</span><span class="p">(</span><span class="n">file_list2</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="c1"># read in ecsv photom file</span>
<span class="kn">from</span> <span class="nn">astropy.visualization</span> <span class="kn">import</span> <span class="n">LogStretch</span><span class="p">,</span> <span class="n">PercentileInterval</span><span class="p">,</span> <span class="n">ManualInterval</span>

<span class="c1">#viz2 = LogStretch() + ManualInterval(0,10)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>
<span class="c1">#plt.imshow(viz2(im_file.data), origin=&#39;lower&#39;)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">im_file</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;rainbow&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p><a id="pipeline_ID"></a></p>
</section>
<section id="run-pipeline-steps-in-calwebb-image3">
<h2>Run Pipeline steps in calwebb_image3<a class="headerlink" href="#run-pipeline-steps-in-calwebb-image3" title="Permalink to this headline">#</a></h2>
<p>Run the pipeline on the data for different sets of parameters</p>
</section>
<section id="run-skymatch-step-on-images-with-skymatch-method-local">
<h2>1. Run skymatch step on images with skymatch method = ‘local’<a class="headerlink" href="#run-skymatch-step-on-images-with-skymatch-method-local" title="Permalink to this headline">#</a></h2>
<p>Notes: ‘local’: compute sky background values of each input image or group of images (members of the same “exposure”). A single sky value is computed for each group of images. This method simply computes the mean/median/mode/etc. value of the “sky” separately in each input image. This will resulted in subtracted background being near zero in the combined image, as each image has it’s individual background subtracted.</p>
<p>match_down specifies whether the sky differences should be subtracted from images with higher sky values (match_down = True) in order to match the image with the lowest sky or sky differences should be added to the images with lower sky values to match the sky of the image with the highest sky value (match_down = False). (Default = True)</p>
<p>‘Subtract’ specifies whether the computed sky background values are to be subtracted from the images in the skymatch step. (Default = False) Currently, if not done in skymatch, the subtraction is performed in resample.</p>
<section id="run-skymatch-with-sky-match-method-local-subtract-false-match-down-true">
<h3>1.1 Run skymatch with sky match method = local. Subtract = False, match_down = True.<a class="headerlink" href="#run-skymatch-with-sky-match-method-local-subtract-false-match-down-true" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># skymatch, local, subtract= False, all 4 images used</span>
<span class="c1">#jwst.skymatch.skymatch_step.SkyMatchStep.call(skymatch_json_file2, skymethod=&#39;local&#39;, subtract=False,output_file=&#39;MIRI&#39;,save_results=True)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Test running just skymatch and resample and skipping other steps.</span>

<span class="c1"># Run Calwebb_image3 on the association table</span>
    
<span class="c1"># set any specific parameters</span>
<span class="n">skymethod</span> <span class="o">=</span> <span class="s1">&#39;local&#39;</span> <span class="c1"># sky computation algorithm to be used. Allowed values: {local, global, match, global+match} (Default = global+match</span>
<span class="n">match_down</span> <span class="o">=</span> <span class="kc">True</span> <span class="c1"># Specifies whether the sky differences should be subtracted from images with higher sky values (match_down = True) in order to match the image with the lowest sky or sky differences should be added to the images with lower sky values to match the sky of the image with the highest sky value (match_down = False). (Default = True</span>
<span class="n">subtract</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1"># Specifies whether the computed sky background values are to be subtracted from the images. (Default = False   </span>
    
<span class="n">pipe3</span><span class="o">=</span><span class="n">Image3Pipeline</span><span class="p">()</span>    
<span class="n">pipe3</span><span class="o">.</span><span class="n">tweakreg</span><span class="o">.</span><span class="n">skip</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">outlier_detection</span><span class="o">.</span><span class="n">skip</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">pipe3</span><span class="o">.</span><span class="n">skymatch</span><span class="o">.</span><span class="n">skymethod</span> <span class="o">=</span> <span class="n">skymethod</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">skymatch</span><span class="o">.</span><span class="n">match_down</span> <span class="o">=</span> <span class="n">match_down</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">skymatch</span><span class="o">.</span><span class="n">subtract</span> <span class="o">=</span> <span class="n">subtract</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">skymatch</span><span class="o">.</span><span class="n">output_file</span> <span class="o">=</span> <span class="s1">&#39;MIRI&#39;</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">skymatch</span><span class="o">.</span><span class="n">save_results</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">pipe3</span><span class="o">.</span><span class="n">resample</span><span class="o">.</span><span class="n">save_results</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">pipe3</span><span class="o">.</span><span class="n">source_catalog</span><span class="o">.</span><span class="n">save_results</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">source_catalog</span><span class="o">.</span><span class="n">snr_threshold</span> <span class="o">=</span> <span class="n">snr</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">source_catalog</span><span class="o">.</span><span class="n">kernel_fwhm</span> <span class="o">=</span> <span class="n">fwhm</span>

<span class="n">pipe3</span><span class="o">.</span><span class="n">save_results</span> <span class="o">=</span> <span class="kc">True</span>

<span class="c1"># run Image3</span>

<span class="n">image</span> <span class="o">=</span> <span class="n">pipe3</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">skymatch_json_file2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Image 3 pipeline finished.&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check values out of skymatch step. With subtract = False, values should be equal.</span>

<span class="n">img01_1_new</span> <span class="o">=</span> <span class="n">datamodels</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;MIRI_0_skymatch.fits&#39;</span><span class="p">)</span>
<span class="n">img01_2_new</span> <span class="o">=</span> <span class="n">datamodels</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;MIRI_1_skymatch.fits&#39;</span><span class="p">)</span>
<span class="n">img02_1_new</span> <span class="o">=</span> <span class="n">datamodels</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;MIRI_2_skymatch.fits&#39;</span><span class="p">)</span>
<span class="n">img02_2_new</span> <span class="o">=</span> <span class="n">datamodels</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;MIRI_3_skymatch.fits&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Original and new levels should be equal. If subtract=False, skymatch should not subtract.&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean: original, new (local)&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">img01_1</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ymin</span><span class="p">:</span><span class="n">ymax</span><span class="p">,</span><span class="n">xmin</span><span class="p">:</span><span class="n">xmax</span><span class="p">]),</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">img01_1_new</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ymin</span><span class="p">:</span><span class="n">ymax</span><span class="p">,</span><span class="n">xmin</span><span class="p">:</span><span class="n">xmax</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">img01_2</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ymin</span><span class="p">:</span><span class="n">ymax</span><span class="p">,</span><span class="n">xmin</span><span class="p">:</span><span class="n">xmax</span><span class="p">]),</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">img01_2_new</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ymin</span><span class="p">:</span><span class="n">ymax</span><span class="p">,</span><span class="n">xmin</span><span class="p">:</span><span class="n">xmax</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">img02_1</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ymin</span><span class="p">:</span><span class="n">ymax</span><span class="p">,</span><span class="n">xmin</span><span class="p">:</span><span class="n">xmax</span><span class="p">]),</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">img02_1_new</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ymin</span><span class="p">:</span><span class="n">ymax</span><span class="p">,</span><span class="n">xmin</span><span class="p">:</span><span class="n">xmax</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">img02_2</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ymin</span><span class="p">:</span><span class="n">ymax</span><span class="p">,</span><span class="n">xmin</span><span class="p">:</span><span class="n">xmax</span><span class="p">]),</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">img02_2_new</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ymin</span><span class="p">:</span><span class="n">ymax</span><span class="p">,</span><span class="n">xmin</span><span class="p">:</span><span class="n">xmax</span><span class="p">]))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Look at combined image</span>
<span class="n">im_file</span> <span class="o">=</span> <span class="n">ImageModel</span><span class="p">(</span><span class="s1">&#39;skymatch_combined_i2d.fits&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The resample step should subtract the individual backgrounds found in the skymatch step.&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Since the local individual background level is subtracted from each image, final expected result is near zero.&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">im_file</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ymin</span><span class="p">:</span><span class="n">ymax</span><span class="p">,</span><span class="n">xmin</span><span class="p">:</span><span class="n">xmax</span><span class="p">]))</span>

<span class="c1"># read in ecsv photom file</span>
<span class="kn">from</span> <span class="nn">astropy.visualization</span> <span class="kn">import</span> <span class="n">LogStretch</span><span class="p">,</span> <span class="n">PercentileInterval</span><span class="p">,</span> <span class="n">ManualInterval</span>

<span class="c1">#viz2 = LogStretch() + ManualInterval(0,10)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>
<span class="c1">#plt.imshow(viz2(im_file.data), origin=&#39;lower&#39;)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">im_file</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;rainbow&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<section id="look-at-photometry-out-of-source-catalog-to-compare-across-tests">
<h4>Look at photometry out of source catalog to compare across tests.<a class="headerlink" href="#look-at-photometry-out-of-source-catalog-to-compare-across-tests" title="Permalink to this headline">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get name of output catalog</span>
<span class="n">catfile</span> <span class="o">=</span> <span class="s1">&#39;skymatch_combined_cat.ecsv&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">catfile</span><span class="p">)</span>

<span class="c1"># Read in catalog</span>
<span class="c1">#catalog = Table.read(catfile)</span>
<span class="n">catalog</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">catfile</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;ascii&#39;</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="s1">&#39;#&#39;</span><span class="p">)</span>
<span class="n">cat_local</span> <span class="o">=</span> <span class="n">catalog</span>

<span class="c1"># Plot AB mag values</span>
<span class="n">create_scatterplot</span><span class="p">(</span><span class="n">catalog</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">],</span> <span class="n">catalog</span><span class="p">[</span><span class="s1">&#39;aper_total_abmag&#39;</span><span class="p">],</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Total AB mag&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="skymatch-method-local-subtract-true">
<h3>1.2  Skymatch method = ‘Local’, subtract= True.<a class="headerlink" href="#skymatch-method-local-subtract-true" title="Permalink to this headline">#</a></h3>
<p>Skymatch step should subtract the background. Resample background level should match the skymatch background level since subtraction has already been done</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># skymatch, local, subtract = True, all 4 images used</span>
<span class="c1">#jwst.skymatch.skymatch_step.SkyMatchStep.call(skymatch_json_file2, skymethod=&#39;local&#39;, subtract=True,output_file=&#39;MIRI&#39;,save_results=True)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Test running just skymatch and resample and skiping other steps.</span>

<span class="c1"># Run Calwebb_image3 on the association table</span>
    
<span class="c1"># set any specific parameters</span>
<span class="n">skymethod</span> <span class="o">=</span> <span class="s1">&#39;local&#39;</span> <span class="c1"># sky computation algorithm to be used. Allowed values: {local, global, match, global+match} (Default = global+match</span>
<span class="c1">#match_down = True # Specifies whether the sky differences should be subtracted from images with higher sky values (match_down = True) in order to match the image with the lowest sky or sky differences should be added to the images with lower sky values to match the sky of the image with the highest sky value (match_down = False). (Default = True</span>
<span class="n">subtract</span> <span class="o">=</span> <span class="kc">True</span> <span class="c1"># Specifies whether the computed sky background values are to be subtracted from the images. (Default = False   </span>
    
<span class="n">pipe3</span><span class="o">=</span><span class="n">Image3Pipeline</span><span class="p">()</span>    
<span class="n">pipe3</span><span class="o">.</span><span class="n">tweakreg</span><span class="o">.</span><span class="n">skip</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">outlier_detection</span><span class="o">.</span><span class="n">skip</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">pipe3</span><span class="o">.</span><span class="n">skymatch</span><span class="o">.</span><span class="n">skymethod</span> <span class="o">=</span> <span class="n">skymethod</span>
<span class="c1">#pipe3.skymatch.match_down = match_down</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">skymatch</span><span class="o">.</span><span class="n">subtract</span> <span class="o">=</span> <span class="n">subtract</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">skymatch</span><span class="o">.</span><span class="n">output_file</span> <span class="o">=</span> <span class="s1">&#39;MIRI&#39;</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">skymatch</span><span class="o">.</span><span class="n">save_results</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">pipe3</span><span class="o">.</span><span class="n">resample</span><span class="o">.</span><span class="n">save_results</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">source_catalog</span><span class="o">.</span><span class="n">save_results</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">source_catalog</span><span class="o">.</span><span class="n">snr_threshold</span> <span class="o">=</span> <span class="n">snr</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">source_catalog</span><span class="o">.</span><span class="n">kernel_fwhm</span> <span class="o">=</span> <span class="n">fwhm</span>

<span class="n">pipe3</span><span class="o">.</span><span class="n">save_results</span> <span class="o">=</span> <span class="kc">True</span>

<span class="c1"># run Image3</span>

<span class="n">image</span> <span class="o">=</span> <span class="n">pipe3</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">skymatch_json_file2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Image 3 pipeline finished.&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">img01_1_new</span> <span class="o">=</span> <span class="n">datamodels</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;MIRI_0_skymatch.fits&#39;</span><span class="p">)</span>
<span class="n">img01_2_new</span> <span class="o">=</span> <span class="n">datamodels</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;MIRI_1_skymatch.fits&#39;</span><span class="p">)</span>
<span class="n">img02_1_new</span> <span class="o">=</span> <span class="n">datamodels</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;MIRI_2_skymatch.fits&#39;</span><span class="p">)</span>
<span class="n">img02_2_new</span> <span class="o">=</span> <span class="n">datamodels</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;MIRI_3_skymatch.fits&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;With subtract=True, the new value should show that the background value was subtracted.&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean: original, new (local)&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">img01_1</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ymin</span><span class="p">:</span><span class="n">ymax</span><span class="p">,</span><span class="n">xmin</span><span class="p">:</span><span class="n">xmax</span><span class="p">]),</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">img01_1_new</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ymin</span><span class="p">:</span><span class="n">ymax</span><span class="p">,</span><span class="n">xmin</span><span class="p">:</span><span class="n">xmax</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">img01_2</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ymin</span><span class="p">:</span><span class="n">ymax</span><span class="p">,</span><span class="n">xmin</span><span class="p">:</span><span class="n">xmax</span><span class="p">]),</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">img01_2_new</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ymin</span><span class="p">:</span><span class="n">ymax</span><span class="p">,</span><span class="n">xmin</span><span class="p">:</span><span class="n">xmax</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">img02_1</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ymin</span><span class="p">:</span><span class="n">ymax</span><span class="p">,</span><span class="n">xmin</span><span class="p">:</span><span class="n">xmax</span><span class="p">]),</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">img02_1_new</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ymin</span><span class="p">:</span><span class="n">ymax</span><span class="p">,</span><span class="n">xmin</span><span class="p">:</span><span class="n">xmax</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">img02_2</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ymin</span><span class="p">:</span><span class="n">ymax</span><span class="p">,</span><span class="n">xmin</span><span class="p">:</span><span class="n">xmax</span><span class="p">]),</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">img02_2_new</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ymin</span><span class="p">:</span><span class="n">ymax</span><span class="p">,</span><span class="n">xmin</span><span class="p">:</span><span class="n">xmax</span><span class="p">]))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Look at combined image</span>
<span class="n">im_file</span> <span class="o">=</span> <span class="n">ImageModel</span><span class="p">(</span><span class="s1">&#39;skymatch_combined_i2d.fits&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The background value was subtracted in the skymatch step, no additional subtraction should be done here.&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;This value should match the values in the new column above.&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">im_file</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ymin</span><span class="p">:</span><span class="n">ymax</span><span class="p">,</span><span class="n">xmin</span><span class="p">:</span><span class="n">xmax</span><span class="p">]))</span>

<span class="c1"># read in ecsv photom file</span>
<span class="kn">from</span> <span class="nn">astropy.visualization</span> <span class="kn">import</span> <span class="n">LogStretch</span><span class="p">,</span> <span class="n">PercentileInterval</span><span class="p">,</span> <span class="n">ManualInterval</span>

<span class="c1">#viz2 = LogStretch() + ManualInterval(0,10)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>
<span class="c1">#plt.imshow(viz2(im_file.data), origin=&#39;lower&#39;)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">im_file</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;rainbow&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get name of output catalog</span>
<span class="n">catfile</span> <span class="o">=</span> <span class="s1">&#39;skymatch_combined_cat.ecsv&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">catfile</span><span class="p">)</span>

<span class="c1"># Read in catalog</span>
<span class="c1">#catalog = Table.read(catfile)</span>
<span class="n">catalog</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">catfile</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;ascii&#39;</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="s1">&#39;#&#39;</span><span class="p">)</span>
<span class="n">catalog</span>

<span class="c1"># Plot AB mag values</span>
<span class="n">create_scatterplot</span><span class="p">(</span><span class="n">catalog</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">],</span> <span class="n">catalog</span><span class="p">[</span><span class="s1">&#39;aper_total_abmag&#39;</span><span class="p">],</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Total AB mag&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Look at the sources found on the image</span>
<span class="n">viz2</span> <span class="o">=</span> <span class="n">LogStretch</span><span class="p">()</span> <span class="o">+</span> <span class="n">ManualInterval</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Sources found with Local method&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">viz2</span><span class="p">(</span><span class="n">im_file</span><span class="o">.</span><span class="n">data</span><span class="p">),</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">catalog</span><span class="p">[</span><span class="s1">&#39;xcentroid&#39;</span><span class="p">],</span> <span class="n">catalog</span><span class="p">[</span><span class="s1">&#39;ycentroid&#39;</span><span class="p">],</span><span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="run-skymatch-for-skymethod-global">
<h2>2. Run skymatch for skymethod = ‘global’.<a class="headerlink" href="#run-skymatch-for-skymethod-global" title="Permalink to this headline">#</a></h2>
<section id="notes-global-compute-a-common-sky-value-for-all-input-image-and-groups-of-images-in-this-setting-match-will-compute-sky-values-for-each-input-image-group-find-the-minimum-sky-value-and-then-it-will-set-and-or-subtract-sky-value-of-each-input-image-to-this-minimum-value-this-method-may-be-useful-when-input-images-have-been-already-matched-the-global-method-computes-the-minimum-sky-value-across-all-input-images-and-or-groups-that-sky-value-is-then-considered-to-be-the-background-in-all-input-images">
<h3>Notes: ‘global’: compute a common sky value for all input image and groups of images. In this setting match will compute sky values for each input image/group, find the minimum sky value, and then it will set (and/or subtract) sky value of each input image to this minimum value. This method may be useful when input images have been already matched. The ‘global’ method computes the minimum sky value across all input images and/or groups. That sky value is then considered to be the background in all input images.<a class="headerlink" href="#notes-global-compute-a-common-sky-value-for-all-input-image-and-groups-of-images-in-this-setting-match-will-compute-sky-values-for-each-input-image-group-find-the-minimum-sky-value-and-then-it-will-set-and-or-subtract-sky-value-of-each-input-image-to-this-minimum-value-this-method-may-be-useful-when-input-images-have-been-already-matched-the-global-method-computes-the-minimum-sky-value-across-all-input-images-and-or-groups-that-sky-value-is-then-considered-to-be-the-background-in-all-input-images" title="Permalink to this headline">#</a></h3>
<p>This calculates an average sky across all images and subtracts that average from all images. There should be a warning for users for this step that makes it clear that this should not be used on images with differences in background levels.</p>
</section>
<section id="skymethod-global-with-subtraction-false">
<h3>2.1 skymethod = ‘global’ with subtraction = False<a class="headerlink" href="#skymethod-global-with-subtraction-false" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># skymatch, local</span>
<span class="c1">#jwst.skymatch.skymatch_step.SkyMatchStep.call(skymatch_json_file2, skymethod=&#39;local&#39;, subtract=False,output_file=&#39;MIRI&#39;,save_results=True)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Test running just skymatch and resample and skiping other steps.</span>

<span class="c1"># Run Calwebb_image3 on the association table</span>
    
<span class="c1"># set any specific parameters</span>
<span class="n">skymethod</span> <span class="o">=</span> <span class="s1">&#39;global&#39;</span> <span class="c1"># sky computation algorithm to be used. Allowed values: {local, global, match, global+match} (Default = global+match</span>
<span class="c1">#match_down = True # Specifies whether the sky differences should be subtracted from images with higher sky values (match_down = True) in order to match the image with the lowest sky or sky differences should be added to the images with lower sky values to match the sky of the image with the highest sky value (match_down = False). (Default = True</span>
<span class="n">subtract</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1"># Specifies whether the computed sky background values are to be subtracted from the images. (Default = False   </span>
    
<span class="n">pipe3</span><span class="o">=</span><span class="n">Image3Pipeline</span><span class="p">()</span>    
<span class="n">pipe3</span><span class="o">.</span><span class="n">tweakreg</span><span class="o">.</span><span class="n">skip</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">outlier_detection</span><span class="o">.</span><span class="n">skip</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">pipe3</span><span class="o">.</span><span class="n">skymatch</span><span class="o">.</span><span class="n">skymethod</span> <span class="o">=</span> <span class="n">skymethod</span>
<span class="c1">#pipe3.skymatch.match_down = match_down</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">skymatch</span><span class="o">.</span><span class="n">subtract</span> <span class="o">=</span> <span class="n">subtract</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">skymatch</span><span class="o">.</span><span class="n">output_file</span> <span class="o">=</span> <span class="s1">&#39;MIRI&#39;</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">skymatch</span><span class="o">.</span><span class="n">save_results</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">pipe3</span><span class="o">.</span><span class="n">resample</span><span class="o">.</span><span class="n">save_results</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">source_catalog</span><span class="o">.</span><span class="n">save_results</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">source_catalog</span><span class="o">.</span><span class="n">snr_threshold</span> <span class="o">=</span> <span class="n">snr</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">source_catalog</span><span class="o">.</span><span class="n">kernel_fwhm</span> <span class="o">=</span> <span class="n">fwhm</span>

<span class="n">pipe3</span><span class="o">.</span><span class="n">save_results</span> <span class="o">=</span> <span class="kc">True</span>

<span class="c1"># run Image3</span>

<span class="n">image</span> <span class="o">=</span> <span class="n">pipe3</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">skymatch_json_file2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Image 3 pipeline finished.&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">img01_1_new</span> <span class="o">=</span> <span class="n">datamodels</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;MIRI_0_skymatch.fits&#39;</span><span class="p">)</span>
<span class="n">img01_2_new</span> <span class="o">=</span> <span class="n">datamodels</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;MIRI_1_skymatch.fits&#39;</span><span class="p">)</span>
<span class="n">img02_1_new</span> <span class="o">=</span> <span class="n">datamodels</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;MIRI_2_skymatch.fits&#39;</span><span class="p">)</span>
<span class="n">img02_2_new</span> <span class="o">=</span> <span class="n">datamodels</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;MIRI_3_skymatch.fits&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;There should be no subtraction at this step, with subtraction = False.&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean: original, new (local)&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">img01_1</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ymin</span><span class="p">:</span><span class="n">ymax</span><span class="p">,</span><span class="n">xmin</span><span class="p">:</span><span class="n">xmax</span><span class="p">]),</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">img01_1_new</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ymin</span><span class="p">:</span><span class="n">ymax</span><span class="p">,</span><span class="n">xmin</span><span class="p">:</span><span class="n">xmax</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">img01_2</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ymin</span><span class="p">:</span><span class="n">ymax</span><span class="p">,</span><span class="n">xmin</span><span class="p">:</span><span class="n">xmax</span><span class="p">]),</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">img01_2_new</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ymin</span><span class="p">:</span><span class="n">ymax</span><span class="p">,</span><span class="n">xmin</span><span class="p">:</span><span class="n">xmax</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">img02_1</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ymin</span><span class="p">:</span><span class="n">ymax</span><span class="p">,</span><span class="n">xmin</span><span class="p">:</span><span class="n">xmax</span><span class="p">]),</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">img02_1_new</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ymin</span><span class="p">:</span><span class="n">ymax</span><span class="p">,</span><span class="n">xmin</span><span class="p">:</span><span class="n">xmax</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">img02_2</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ymin</span><span class="p">:</span><span class="n">ymax</span><span class="p">,</span><span class="n">xmin</span><span class="p">:</span><span class="n">xmax</span><span class="p">]),</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">img02_2_new</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ymin</span><span class="p">:</span><span class="n">ymax</span><span class="p">,</span><span class="n">xmin</span><span class="p">:</span><span class="n">xmax</span><span class="p">]))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Look at combined image</span>
<span class="n">im_file</span> <span class="o">=</span> <span class="n">ImageModel</span><span class="p">(</span><span class="s1">&#39;skymatch_combined_i2d.fits&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Global finds a single value for the background, and subtracts that value from all images.&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The value listed here should be the average of the subtracted sky values across images.&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The combined image will look messy as the same value was subtracted from the image with background = 5&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;and from the images with background = 2. This shows the differing backgrounds strongly.&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">im_file</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ymin</span><span class="p">:</span><span class="n">ymax</span><span class="p">,</span><span class="n">xmin</span><span class="p">:</span><span class="n">xmax</span><span class="p">]))</span>

<span class="c1"># read in ecsv photom file</span>
<span class="kn">from</span> <span class="nn">astropy.visualization</span> <span class="kn">import</span> <span class="n">LogStretch</span><span class="p">,</span> <span class="n">PercentileInterval</span><span class="p">,</span> <span class="n">ManualInterval</span>

<span class="c1">#viz2 = LogStretch() + ManualInterval(0,10)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>
<span class="c1">#plt.imshow(viz2(im_file.data), origin=&#39;lower&#39;)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">im_file</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;rainbow&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get name of output catalog</span>
<span class="n">catfile</span> <span class="o">=</span> <span class="s1">&#39;skymatch_combined_cat.ecsv&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">catfile</span><span class="p">)</span>

<span class="c1"># Read in catalog</span>
<span class="c1">#catalog = Table.read(catfile)</span>
<span class="n">catalog</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">catfile</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;ascii&#39;</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="s1">&#39;#&#39;</span><span class="p">)</span>
<span class="n">cat_global</span> <span class="o">=</span> <span class="n">catalog</span>

<span class="c1"># Plot AB mag values</span>
<span class="n">create_scatterplot</span><span class="p">(</span><span class="n">catalog</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">],</span> <span class="n">catalog</span><span class="p">[</span><span class="s1">&#39;aper_total_abmag&#39;</span><span class="p">],</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Total AB mag&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Look at the sources found on the image</span>
<span class="n">viz2</span> <span class="o">=</span> <span class="n">LogStretch</span><span class="p">()</span> <span class="o">+</span> <span class="n">ManualInterval</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Sources found with Global method&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">viz2</span><span class="p">(</span><span class="n">im_file</span><span class="o">.</span><span class="n">data</span><span class="p">),</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">catalog</span><span class="p">[</span><span class="s1">&#39;xcentroid&#39;</span><span class="p">],</span> <span class="n">catalog</span><span class="p">[</span><span class="s1">&#39;ycentroid&#39;</span><span class="p">],</span><span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="skymethod-global-with-subtraction-true">
<h3>2.2 skymethod = ‘global’ with subtraction = True<a class="headerlink" href="#skymethod-global-with-subtraction-true" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># skymatch, global, subtract = True</span>
<span class="c1">#jwst.skymatch.skymatch_step.SkyMatchStep.call(skymatch_json_file2, skymethod=&#39;global&#39;, subtract=True,output_file=&#39;MIRI&#39;,save_results=True)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Test running just skymatch and resample and skiping other steps.</span>

<span class="c1"># Run Calwebb_image3 on the association table</span>
    
<span class="c1"># set any specific parameters</span>
<span class="n">skymethod</span> <span class="o">=</span> <span class="s1">&#39;global&#39;</span> <span class="c1"># sky computation algorithm to be used. Allowed values: {local, global, match, global+match} (Default = global+match</span>
<span class="c1">#match_down = True # Specifies whether the sky differences should be subtracted from images with higher sky values (match_down = True) in order to match the image with the lowest sky or sky differences should be added to the images with lower sky values to match the sky of the image with the highest sky value (match_down = False). (Default = True</span>
<span class="n">subtract</span> <span class="o">=</span> <span class="kc">True</span> <span class="c1"># Specifies whether the computed sky background values are to be subtracted from the images. (Default = False   </span>
    
<span class="n">pipe3</span><span class="o">=</span><span class="n">Image3Pipeline</span><span class="p">()</span>    
<span class="n">pipe3</span><span class="o">.</span><span class="n">tweakreg</span><span class="o">.</span><span class="n">skip</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">outlier_detection</span><span class="o">.</span><span class="n">skip</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">pipe3</span><span class="o">.</span><span class="n">skymatch</span><span class="o">.</span><span class="n">skymethod</span> <span class="o">=</span> <span class="n">skymethod</span>
<span class="c1">#pipe3.skymatch.match_down = match_down</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">skymatch</span><span class="o">.</span><span class="n">subtract</span> <span class="o">=</span> <span class="n">subtract</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">skymatch</span><span class="o">.</span><span class="n">output_file</span> <span class="o">=</span> <span class="s1">&#39;MIRI&#39;</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">skymatch</span><span class="o">.</span><span class="n">save_results</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">pipe3</span><span class="o">.</span><span class="n">resample</span><span class="o">.</span><span class="n">save_results</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">source_catalog</span><span class="o">.</span><span class="n">save_results</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">source_catalog</span><span class="o">.</span><span class="n">snr_threshold</span> <span class="o">=</span> <span class="n">snr</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">source_catalog</span><span class="o">.</span><span class="n">kernel_fwhm</span> <span class="o">=</span> <span class="n">fwhm</span>

<span class="n">pipe3</span><span class="o">.</span><span class="n">save_results</span> <span class="o">=</span> <span class="kc">True</span>

<span class="c1"># run Image3</span>

<span class="n">image</span> <span class="o">=</span> <span class="n">pipe3</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">skymatch_json_file2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Image 3 pipeline finished.&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">img01_1_new</span> <span class="o">=</span> <span class="n">datamodels</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;MIRI_0_skymatch.fits&#39;</span><span class="p">)</span>
<span class="n">img01_2_new</span> <span class="o">=</span> <span class="n">datamodels</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;MIRI_1_skymatch.fits&#39;</span><span class="p">)</span>
<span class="n">img02_1_new</span> <span class="o">=</span> <span class="n">datamodels</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;MIRI_2_skymatch.fits&#39;</span><span class="p">)</span>
<span class="n">img02_2_new</span> <span class="o">=</span> <span class="n">datamodels</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;MIRI_3_skymatch.fits&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Global finds a single value for the background, and subtracts that value from all images.&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The values listed here should be the average of the subtracted sky values across images subtracted from each image.&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean: original, new (global)&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">img01_1</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ymin</span><span class="p">:</span><span class="n">ymax</span><span class="p">,</span><span class="n">xmin</span><span class="p">:</span><span class="n">xmax</span><span class="p">]),</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">img01_1_new</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ymin</span><span class="p">:</span><span class="n">ymax</span><span class="p">,</span><span class="n">xmin</span><span class="p">:</span><span class="n">xmax</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">img01_2</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ymin</span><span class="p">:</span><span class="n">ymax</span><span class="p">,</span><span class="n">xmin</span><span class="p">:</span><span class="n">xmax</span><span class="p">]),</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">img01_2_new</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ymin</span><span class="p">:</span><span class="n">ymax</span><span class="p">,</span><span class="n">xmin</span><span class="p">:</span><span class="n">xmax</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">img02_1</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ymin</span><span class="p">:</span><span class="n">ymax</span><span class="p">,</span><span class="n">xmin</span><span class="p">:</span><span class="n">xmax</span><span class="p">]),</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">img02_1_new</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ymin</span><span class="p">:</span><span class="n">ymax</span><span class="p">,</span><span class="n">xmin</span><span class="p">:</span><span class="n">xmax</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">img02_2</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ymin</span><span class="p">:</span><span class="n">ymax</span><span class="p">,</span><span class="n">xmin</span><span class="p">:</span><span class="n">xmax</span><span class="p">]),</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">img02_2_new</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ymin</span><span class="p">:</span><span class="n">ymax</span><span class="p">,</span><span class="n">xmin</span><span class="p">:</span><span class="n">xmax</span><span class="p">]))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Look at combined image</span>
<span class="n">im_file</span> <span class="o">=</span> <span class="n">ImageModel</span><span class="p">(</span><span class="s1">&#39;skymatch_combined_i2d.fits&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Global finds a single value for the background, and subtracts that value from all images.&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The value listed here should be the average of the subtracted sky values across images.&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The combined image will look messy as the same value was subtracted from the image with background = 5&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;and from the images with background = 2. This shows the differing backgrounds strongly.&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">im_file</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ymin</span><span class="p">:</span><span class="n">ymax</span><span class="p">,</span><span class="n">xmin</span><span class="p">:</span><span class="n">xmax</span><span class="p">]))</span>

<span class="c1"># read in ecsv photom file</span>
<span class="kn">from</span> <span class="nn">astropy.visualization</span> <span class="kn">import</span> <span class="n">LogStretch</span><span class="p">,</span> <span class="n">PercentileInterval</span><span class="p">,</span> <span class="n">ManualInterval</span>

<span class="c1">#viz2 = LogStretch() + ManualInterval(0,10)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>
<span class="c1">#plt.imshow(viz2(im_file.data), origin=&#39;lower&#39;)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">im_file</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;rainbow&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get name of output catalog</span>
<span class="n">catfile</span> <span class="o">=</span> <span class="s1">&#39;skymatch_combined_cat.ecsv&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">catfile</span><span class="p">)</span>

<span class="c1"># Read in catalog</span>
<span class="c1">#catalog = Table.read(catfile)</span>
<span class="n">catalog</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">catfile</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;ascii&#39;</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="s1">&#39;#&#39;</span><span class="p">)</span>
<span class="n">catalog</span>

<span class="c1"># Plot AB mag values</span>
<span class="n">create_scatterplot</span><span class="p">(</span><span class="n">catalog</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">],</span> <span class="n">catalog</span><span class="p">[</span><span class="s1">&#39;aper_total_abmag&#39;</span><span class="p">],</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Total AB mag&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="run-tests-on-skymatch-method-match">
<h2>3. Run tests on Skymatch method ‘Match’<a class="headerlink" href="#run-tests-on-skymatch-method-match" title="Permalink to this headline">#</a></h2>
<section id="notes-match-compute-differences-in-sky-values-between-images-and-or-groups-in-pair-wise-common-sky-regions-in-this-case-computed-sky-values-will-be-relative-delta-to-the-sky-computed-in-one-of-the-input-images-whose-sky-value-will-be-set-to-reported-to-be-0-this-case-matches-to-the-lowest-sky-value">
<h3>Notes: ‘match’: compute differences in sky values between images and/or groups in (pair-wise) common sky regions. In this case computed sky values will be relative (delta) to the sky computed in one of the input images whose sky value will be set to (reported to be) 0. This case matches to the lowest sky value.<a class="headerlink" href="#notes-match-compute-differences-in-sky-values-between-images-and-or-groups-in-pair-wise-common-sky-regions-in-this-case-computed-sky-values-will-be-relative-delta-to-the-sky-computed-in-one-of-the-input-images-whose-sky-value-will-be-set-to-reported-to-be-0-this-case-matches-to-the-lowest-sky-value" title="Permalink to this headline">#</a></h3>
<p>Based on whether match_down is set to True or False, Match will calculate the difference between the lowest background level or highest level (respectively), and subtract the difference between the calculated level and the ‘matched’ level.</p>
<p>This is the preferred default option as it subtracts the differences between the background levels, normalizing all of the backgrounds to a common level (either lowest or highest background), rather than subtracting off all of the background.</p>
</section>
<section id="skymethod-match-match-down-true-subtract-true">
<h3>3.1 skymethod = ‘match’, match_down=True, subtract=True<a class="headerlink" href="#skymethod-match-match-down-true-subtract-true" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># skymatch, match down, subtract = True</span>
<span class="c1">#jwst.skymatch.skymatch_step.SkyMatchStep.call(skymatch_json_file2, skymethod=&#39;match&#39;, match_down=True,subtract=True,output_file=&#39;MIRI&#39;,save_results=True)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Test running just skymatch and resample and skiping other steps.</span>

<span class="c1"># Run Calwebb_image3 on the association table</span>
    
<span class="c1"># set any specific parameters</span>
<span class="n">skymethod</span> <span class="o">=</span> <span class="s1">&#39;match&#39;</span> <span class="c1"># sky computation algorithm to be used. Allowed values: {local, global, match, global+match} (Default = global+match</span>
<span class="n">match_down</span> <span class="o">=</span> <span class="kc">True</span> <span class="c1"># Specifies whether the sky differences should be subtracted from images with higher sky values (match_down = True) in order to match the image with the lowest sky or sky differences should be added to the images with lower sky values to match the sky of the image with the highest sky value (match_down = False). (Default = True</span>
<span class="n">subtract</span> <span class="o">=</span> <span class="kc">True</span> <span class="c1"># Specifies whether the computed sky background values are to be subtracted from the images. (Default = False   </span>
    
<span class="n">pipe3</span><span class="o">=</span><span class="n">Image3Pipeline</span><span class="p">()</span>    
<span class="n">pipe3</span><span class="o">.</span><span class="n">tweakreg</span><span class="o">.</span><span class="n">skip</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">outlier_detection</span><span class="o">.</span><span class="n">skip</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">pipe3</span><span class="o">.</span><span class="n">skymatch</span><span class="o">.</span><span class="n">skymethod</span> <span class="o">=</span> <span class="n">skymethod</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">skymatch</span><span class="o">.</span><span class="n">match_down</span> <span class="o">=</span> <span class="n">match_down</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">skymatch</span><span class="o">.</span><span class="n">subtract</span> <span class="o">=</span> <span class="n">subtract</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">skymatch</span><span class="o">.</span><span class="n">output_file</span> <span class="o">=</span> <span class="s1">&#39;MIRI&#39;</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">skymatch</span><span class="o">.</span><span class="n">save_results</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">pipe3</span><span class="o">.</span><span class="n">resample</span><span class="o">.</span><span class="n">save_results</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">source_catalog</span><span class="o">.</span><span class="n">save_results</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">source_catalog</span><span class="o">.</span><span class="n">snr_threshold</span> <span class="o">=</span> <span class="n">snr</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">source_catalog</span><span class="o">.</span><span class="n">kernel_fwhm</span> <span class="o">=</span> <span class="n">fwhm</span>

<span class="n">pipe3</span><span class="o">.</span><span class="n">save_results</span> <span class="o">=</span> <span class="kc">True</span>

<span class="c1"># run Image3</span>

<span class="n">image</span> <span class="o">=</span> <span class="n">pipe3</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">skymatch_json_file2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Image 3 pipeline finished.&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">img01_1_new</span> <span class="o">=</span> <span class="n">datamodels</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;MIRI_0_skymatch.fits&#39;</span><span class="p">)</span>
<span class="n">img01_2_new</span> <span class="o">=</span> <span class="n">datamodels</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;MIRI_1_skymatch.fits&#39;</span><span class="p">)</span>
<span class="n">img02_1_new</span> <span class="o">=</span> <span class="n">datamodels</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;MIRI_2_skymatch.fits&#39;</span><span class="p">)</span>
<span class="n">img02_2_new</span> <span class="o">=</span> <span class="n">datamodels</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;MIRI_3_skymatch.fits&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;There should be no subtraction at this step, with subtraction = False.&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean: original, new (match down)&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">img01_1</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ymin</span><span class="p">:</span><span class="n">ymax</span><span class="p">,</span><span class="n">xmin</span><span class="p">:</span><span class="n">xmax</span><span class="p">]),</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">img01_1_new</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ymin</span><span class="p">:</span><span class="n">ymax</span><span class="p">,</span><span class="n">xmin</span><span class="p">:</span><span class="n">xmax</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">img01_2</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ymin</span><span class="p">:</span><span class="n">ymax</span><span class="p">,</span><span class="n">xmin</span><span class="p">:</span><span class="n">xmax</span><span class="p">]),</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">img01_2_new</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ymin</span><span class="p">:</span><span class="n">ymax</span><span class="p">,</span><span class="n">xmin</span><span class="p">:</span><span class="n">xmax</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">img02_1</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ymin</span><span class="p">:</span><span class="n">ymax</span><span class="p">,</span><span class="n">xmin</span><span class="p">:</span><span class="n">xmax</span><span class="p">]),</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">img02_1_new</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ymin</span><span class="p">:</span><span class="n">ymax</span><span class="p">,</span><span class="n">xmin</span><span class="p">:</span><span class="n">xmax</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">img02_2</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ymin</span><span class="p">:</span><span class="n">ymax</span><span class="p">,</span><span class="n">xmin</span><span class="p">:</span><span class="n">xmax</span><span class="p">]),</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">img02_2_new</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ymin</span><span class="p">:</span><span class="n">ymax</span><span class="p">,</span><span class="n">xmin</span><span class="p">:</span><span class="n">xmax</span><span class="p">]))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Look at combined image</span>
<span class="n">im_file</span> <span class="o">=</span> <span class="n">ImageModel</span><span class="p">(</span><span class="s1">&#39;skymatch_combined_i2d.fits&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;For the method match with match_down= True, the value of the background should match the minimum of the individual backgrounds.&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;This value should match the values in the new column above. Subtraction was done in skymatch step.&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">im_file</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ymin</span><span class="p">:</span><span class="n">ymax</span><span class="p">,</span><span class="n">xmin</span><span class="p">:</span><span class="n">xmax</span><span class="p">]))</span>

<span class="c1"># read in ecsv photom file</span>
<span class="kn">from</span> <span class="nn">astropy.visualization</span> <span class="kn">import</span> <span class="n">LogStretch</span><span class="p">,</span> <span class="n">PercentileInterval</span><span class="p">,</span> <span class="n">ManualInterval</span>

<span class="c1">#viz2 = LogStretch() + ManualInterval(0,10)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>
<span class="c1">#plt.imshow(viz2(im_file.data), origin=&#39;lower&#39;)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">im_file</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;rainbow&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get name of output catalog</span>
<span class="n">catfile</span> <span class="o">=</span> <span class="s1">&#39;skymatch_combined_cat.ecsv&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">catfile</span><span class="p">)</span>

<span class="c1"># Read in catalog</span>
<span class="c1">#catalog = Table.read(catfile)</span>
<span class="n">catalog</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">catfile</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;ascii&#39;</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="s1">&#39;#&#39;</span><span class="p">)</span>
<span class="n">catalog</span>

<span class="c1"># Plot AB mag values</span>
<span class="n">create_scatterplot</span><span class="p">(</span><span class="n">catalog</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">],</span> <span class="n">catalog</span><span class="p">[</span><span class="s1">&#39;aper_total_abmag&#39;</span><span class="p">],</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Total AB mag&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="check-that-all-output-new-sky-values-are-equal-to-the-lowest-original-sky-value">
<h3>** Check that all output (new) sky values are equal to the lowest original sky value<a class="headerlink" href="#check-that-all-output-new-sky-values-are-equal-to-the-lowest-original-sky-value" title="Permalink to this headline">#</a></h3>
</section>
<section id="skymethod-match-match-down-false-subtract-true">
<h3>3.2 skymethod = ‘match’, match_down=False, subtract = True<a class="headerlink" href="#skymethod-match-match-down-false-subtract-true" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># skymatch, match up, subtract = True</span>
<span class="c1">#jwst.skymatch.skymatch_step.SkyMatchStep.call(skymatch_json_file2, skymethod=&#39;match&#39;, match_down=False,subtract=True,output_file=&#39;MIRI&#39;,save_results=True)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Test running just skymatch and resample and skiping other steps.</span>

<span class="c1"># Run Calwebb_image3 on the association table</span>
    
<span class="c1"># set any specific parameters</span>
<span class="n">skymethod</span> <span class="o">=</span> <span class="s1">&#39;match&#39;</span> <span class="c1"># sky computation algorithm to be used. Allowed values: {local, global, match, global+match} (Default = global+match</span>
<span class="n">match_down</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1"># Specifies whether the sky differences should be subtracted from images with higher sky values (match_down = True) in order to match the image with the lowest sky or sky differences should be added to the images with lower sky values to match the sky of the image with the highest sky value (match_down = False). (Default = True</span>
<span class="n">subtract</span> <span class="o">=</span> <span class="kc">True</span> <span class="c1"># Specifies whether the computed sky background values are to be subtracted from the images. (Default = False   </span>
    
<span class="n">pipe3</span><span class="o">=</span><span class="n">Image3Pipeline</span><span class="p">()</span>    
<span class="n">pipe3</span><span class="o">.</span><span class="n">tweakreg</span><span class="o">.</span><span class="n">skip</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">outlier_detection</span><span class="o">.</span><span class="n">skip</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">pipe3</span><span class="o">.</span><span class="n">skymatch</span><span class="o">.</span><span class="n">skymethod</span> <span class="o">=</span> <span class="n">skymethod</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">skymatch</span><span class="o">.</span><span class="n">match_down</span> <span class="o">=</span> <span class="n">match_down</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">skymatch</span><span class="o">.</span><span class="n">subtract</span> <span class="o">=</span> <span class="n">subtract</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">skymatch</span><span class="o">.</span><span class="n">output_file</span> <span class="o">=</span> <span class="s1">&#39;MIRI&#39;</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">skymatch</span><span class="o">.</span><span class="n">save_results</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">pipe3</span><span class="o">.</span><span class="n">resample</span><span class="o">.</span><span class="n">save_results</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">source_catalog</span><span class="o">.</span><span class="n">save_results</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">source_catalog</span><span class="o">.</span><span class="n">snr_threshold</span> <span class="o">=</span> <span class="n">snr</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">source_catalog</span><span class="o">.</span><span class="n">kernel_fwhm</span> <span class="o">=</span> <span class="n">fwhm</span>

<span class="n">pipe3</span><span class="o">.</span><span class="n">save_results</span> <span class="o">=</span> <span class="kc">True</span>

<span class="c1"># run Image3</span>

<span class="n">image</span> <span class="o">=</span> <span class="n">pipe3</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">skymatch_json_file2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Image 3 pipeline finished.&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">img01_1_new</span> <span class="o">=</span> <span class="n">datamodels</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;MIRI_0_skymatch.fits&#39;</span><span class="p">)</span>
<span class="n">img01_2_new</span> <span class="o">=</span> <span class="n">datamodels</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;MIRI_1_skymatch.fits&#39;</span><span class="p">)</span>
<span class="n">img02_1_new</span> <span class="o">=</span> <span class="n">datamodels</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;MIRI_2_skymatch.fits&#39;</span><span class="p">)</span>
<span class="n">img02_2_new</span> <span class="o">=</span> <span class="n">datamodels</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;MIRI_3_skymatch.fits&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;With match_down = False, match will match the backgrounds of all to the highest background.&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;With subtract = True, the background matching is done at the skymatch step.&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean: original, new (match up)&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">img01_1</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ymin</span><span class="p">:</span><span class="n">ymax</span><span class="p">,</span><span class="n">xmin</span><span class="p">:</span><span class="n">xmax</span><span class="p">]),</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">img01_1_new</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ymin</span><span class="p">:</span><span class="n">ymax</span><span class="p">,</span><span class="n">xmin</span><span class="p">:</span><span class="n">xmax</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">img01_2</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ymin</span><span class="p">:</span><span class="n">ymax</span><span class="p">,</span><span class="n">xmin</span><span class="p">:</span><span class="n">xmax</span><span class="p">]),</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">img01_2_new</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ymin</span><span class="p">:</span><span class="n">ymax</span><span class="p">,</span><span class="n">xmin</span><span class="p">:</span><span class="n">xmax</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">img02_1</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ymin</span><span class="p">:</span><span class="n">ymax</span><span class="p">,</span><span class="n">xmin</span><span class="p">:</span><span class="n">xmax</span><span class="p">]),</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">img02_1_new</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ymin</span><span class="p">:</span><span class="n">ymax</span><span class="p">,</span><span class="n">xmin</span><span class="p">:</span><span class="n">xmax</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">img02_2</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ymin</span><span class="p">:</span><span class="n">ymax</span><span class="p">,</span><span class="n">xmin</span><span class="p">:</span><span class="n">xmax</span><span class="p">]),</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">img02_2_new</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ymin</span><span class="p">:</span><span class="n">ymax</span><span class="p">,</span><span class="n">xmin</span><span class="p">:</span><span class="n">xmax</span><span class="p">]))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Look at combined image</span>
<span class="n">im_file</span> <span class="o">=</span> <span class="n">ImageModel</span><span class="p">(</span><span class="s1">&#39;skymatch_combined_i2d.fits&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;For the method match with match_down=False, the value of the background should match the maximum of the individual backgrounds&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;This value should match the values in the new column above. Subtraction was done in skymatch step.&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">im_file</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ymin</span><span class="p">:</span><span class="n">ymax</span><span class="p">,</span><span class="n">xmin</span><span class="p">:</span><span class="n">xmax</span><span class="p">]))</span>

<span class="c1"># read in ecsv photom file</span>
<span class="kn">from</span> <span class="nn">astropy.visualization</span> <span class="kn">import</span> <span class="n">LogStretch</span><span class="p">,</span> <span class="n">PercentileInterval</span><span class="p">,</span> <span class="n">ManualInterval</span>

<span class="c1">#viz2 = LogStretch() + ManualInterval(0,10)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>
<span class="c1">#plt.imshow(viz2(im_file.data), origin=&#39;lower&#39;)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">im_file</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;rainbow&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get name of output catalog</span>
<span class="n">catfile</span> <span class="o">=</span> <span class="s1">&#39;skymatch_combined_cat.ecsv&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">catfile</span><span class="p">)</span>

<span class="c1"># Read in catalog</span>
<span class="c1">#catalog = Table.read(catfile)</span>
<span class="n">catalog</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">catfile</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;ascii&#39;</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="s1">&#39;#&#39;</span><span class="p">)</span>
<span class="n">catalog</span>

<span class="c1"># Plot AB mag values</span>
<span class="n">create_scatterplot</span><span class="p">(</span><span class="n">catalog</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">],</span> <span class="n">catalog</span><span class="p">[</span><span class="s1">&#39;aper_total_abmag&#39;</span><span class="p">],</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Total AB mag&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="check-that-all-output-new-sky-values-are-equal-to-the-highest-original-sky-value">
<h3>** Check that all output (new) sky values are equal to the highest original sky value<a class="headerlink" href="#check-that-all-output-new-sky-values-are-equal-to-the-highest-original-sky-value" title="Permalink to this headline">#</a></h3>
</section>
<section id="skymethod-match-match-down-true-subtract-false">
<h3>3.3 skymethod = ‘match’, match_down = True, subtract = False<a class="headerlink" href="#skymethod-match-match-down-true-subtract-false" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Test running just skymatch and resample and skiping other steps.</span>

<span class="c1"># Run Calwebb_image3 on the association table</span>
    
<span class="c1"># set any specific parameters</span>
<span class="n">skymethod</span> <span class="o">=</span> <span class="s1">&#39;match&#39;</span> <span class="c1"># sky computation algorithm to be used. Allowed values: {local, global, match, global+match} (Default = global+match</span>
<span class="n">match_down</span> <span class="o">=</span> <span class="kc">True</span> <span class="c1"># Specifies whether the sky differences should be subtracted from images with higher sky values (match_down = True) in order to match the image with the lowest sky or sky differences should be added to the images with lower sky values to match the sky of the image with the highest sky value (match_down = False). (Default = True</span>
<span class="n">subtract</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1"># Specifies whether the computed sky background values are to be subtracted from the images. (Default = False   </span>
    
<span class="n">pipe3</span><span class="o">=</span><span class="n">Image3Pipeline</span><span class="p">()</span>    
<span class="n">pipe3</span><span class="o">.</span><span class="n">tweakreg</span><span class="o">.</span><span class="n">skip</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">outlier_detection</span><span class="o">.</span><span class="n">skip</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">pipe3</span><span class="o">.</span><span class="n">skymatch</span><span class="o">.</span><span class="n">skymethod</span> <span class="o">=</span> <span class="n">skymethod</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">skymatch</span><span class="o">.</span><span class="n">match_down</span> <span class="o">=</span> <span class="n">match_down</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">skymatch</span><span class="o">.</span><span class="n">subtract</span> <span class="o">=</span> <span class="n">subtract</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">skymatch</span><span class="o">.</span><span class="n">output_file</span> <span class="o">=</span> <span class="s1">&#39;MIRI&#39;</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">skymatch</span><span class="o">.</span><span class="n">save_results</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">pipe3</span><span class="o">.</span><span class="n">resample</span><span class="o">.</span><span class="n">save_results</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">source_catalog</span><span class="o">.</span><span class="n">save_results</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">source_catalog</span><span class="o">.</span><span class="n">snr_threshold</span> <span class="o">=</span> <span class="n">snr</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">source_catalog</span><span class="o">.</span><span class="n">kernel_fwhm</span> <span class="o">=</span> <span class="n">fwhm</span>

<span class="n">pipe3</span><span class="o">.</span><span class="n">save_results</span> <span class="o">=</span> <span class="kc">True</span>

<span class="c1"># run Image3</span>

<span class="n">image</span> <span class="o">=</span> <span class="n">pipe3</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">skymatch_json_file2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Image 3 pipeline finished.&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">img01_1_new</span> <span class="o">=</span> <span class="n">datamodels</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;MIRI_0_skymatch.fits&#39;</span><span class="p">)</span>
<span class="n">img01_2_new</span> <span class="o">=</span> <span class="n">datamodels</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;MIRI_1_skymatch.fits&#39;</span><span class="p">)</span>
<span class="n">img02_1_new</span> <span class="o">=</span> <span class="n">datamodels</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;MIRI_2_skymatch.fits&#39;</span><span class="p">)</span>
<span class="n">img02_2_new</span> <span class="o">=</span> <span class="n">datamodels</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;MIRI_3_skymatch.fits&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;With subtract=False, no subtraction should be done here.&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean: original, new (match down)&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">img01_1</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ymin</span><span class="p">:</span><span class="n">ymax</span><span class="p">,</span><span class="n">xmin</span><span class="p">:</span><span class="n">xmax</span><span class="p">]),</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">img01_1_new</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ymin</span><span class="p">:</span><span class="n">ymax</span><span class="p">,</span><span class="n">xmin</span><span class="p">:</span><span class="n">xmax</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">img01_2</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ymin</span><span class="p">:</span><span class="n">ymax</span><span class="p">,</span><span class="n">xmin</span><span class="p">:</span><span class="n">xmax</span><span class="p">]),</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">img01_2_new</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ymin</span><span class="p">:</span><span class="n">ymax</span><span class="p">,</span><span class="n">xmin</span><span class="p">:</span><span class="n">xmax</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">img02_1</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ymin</span><span class="p">:</span><span class="n">ymax</span><span class="p">,</span><span class="n">xmin</span><span class="p">:</span><span class="n">xmax</span><span class="p">]),</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">img02_1_new</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ymin</span><span class="p">:</span><span class="n">ymax</span><span class="p">,</span><span class="n">xmin</span><span class="p">:</span><span class="n">xmax</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">img02_2</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ymin</span><span class="p">:</span><span class="n">ymax</span><span class="p">,</span><span class="n">xmin</span><span class="p">:</span><span class="n">xmax</span><span class="p">]),</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">img02_2_new</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ymin</span><span class="p">:</span><span class="n">ymax</span><span class="p">,</span><span class="n">xmin</span><span class="p">:</span><span class="n">xmax</span><span class="p">]))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Look at combined image</span>
<span class="n">im_file</span> <span class="o">=</span> <span class="n">ImageModel</span><span class="p">(</span><span class="s1">&#39;skymatch_combined_i2d.fits&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;With the match method, subtract=False and match_down=True, the background value should match to the lowest individual background.&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;This value should match the minimum values in the new column above.&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">im_file</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ymin</span><span class="p">:</span><span class="n">ymax</span><span class="p">,</span><span class="n">xmin</span><span class="p">:</span><span class="n">xmax</span><span class="p">]))</span>

<span class="c1"># read in ecsv photom file</span>
<span class="kn">from</span> <span class="nn">astropy.visualization</span> <span class="kn">import</span> <span class="n">LogStretch</span><span class="p">,</span> <span class="n">PercentileInterval</span><span class="p">,</span> <span class="n">ManualInterval</span>

<span class="c1">#viz2 = LogStretch() + ManualInterval(0,10)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>
<span class="c1">#plt.imshow(viz2(im_file.data), origin=&#39;lower&#39;)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">im_file</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;rainbow&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get name of output catalog</span>
<span class="n">catfile</span> <span class="o">=</span> <span class="s1">&#39;skymatch_combined_cat.ecsv&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">catfile</span><span class="p">)</span>

<span class="c1"># Read in catalog</span>
<span class="c1">#catalog = Table.read(catfile)</span>
<span class="n">catalog</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">catfile</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;ascii&#39;</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="s1">&#39;#&#39;</span><span class="p">)</span>
<span class="n">cat_match</span> <span class="o">=</span> <span class="n">catalog</span>

<span class="c1"># Plot AB mag values</span>
<span class="n">create_scatterplot</span><span class="p">(</span><span class="n">catalog</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">],</span> <span class="n">catalog</span><span class="p">[</span><span class="s1">&#39;aper_total_abmag&#39;</span><span class="p">],</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Total AB mag&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Look at the sources found on the image</span>
<span class="c1">#viz2 = LogStretch() + ManualInterval(0,10)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Sources found with Match method&#39;</span><span class="p">)</span>
<span class="c1">#plt.imshow(viz2(im_file.data), origin=&#39;lower&#39;)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">im_file</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">catalog</span><span class="p">[</span><span class="s1">&#39;xcentroid&#39;</span><span class="p">],</span> <span class="n">catalog</span><span class="p">[</span><span class="s1">&#39;ycentroid&#39;</span><span class="p">],</span><span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="test-skymatch-method-global-match">
<h2>4. Test skymatch method ‘global+match’<a class="headerlink" href="#test-skymatch-method-global-match" title="Permalink to this headline">#</a></h2>
<section id="notes-global-match-first-use-match-method-to-equalize-sky-values-between-images-and-then-find-a-minimum-global-sky-value-in-all-input-images">
<h3>Notes: ‘global+match’: first use ‘match’ method to equalize sky values between images and then find a minimum “global” sky value in all input images.<a class="headerlink" href="#notes-global-match-first-use-match-method-to-equalize-sky-values-between-images-and-then-find-a-minimum-global-sky-value-in-all-input-images" title="Permalink to this headline">#</a></h3>
<p>The behavior of this step is that it subtracts all background. More documentation is needed on how exactly it gets to that point.</p>
</section>
<section id="skymethod-global-match-subtract-true">
<h3>4.1 skymethod = ‘global+match’, subtract = True<a class="headerlink" href="#skymethod-global-match-subtract-true" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># skymatch, global+match, subtract = True</span>
<span class="c1">#jwst.skymatch.skymatch_step.SkyMatchStep.call(skymatch_json_file2, skymethod=&#39;global+match&#39;, match_down=True,subtract=True,output_file=&#39;MIRI&#39;,save_results=True)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Test running just skymatch and resample and skiping other steps.</span>

<span class="c1"># Run Calwebb_image3 on the association table</span>
    
<span class="c1"># set any specific parameters</span>
<span class="n">skymethod</span> <span class="o">=</span> <span class="s1">&#39;global+match&#39;</span> <span class="c1"># sky computation algorithm to be used. Allowed values: {local, global, match, global+match} (Default = global+match</span>
<span class="c1">#match_down = True # Specifies whether the sky differences should be subtracted from images with higher sky values (match_down = True) in order to match the image with the lowest sky or sky differences should be added to the images with lower sky values to match the sky of the image with the highest sky value (match_down = False). (Default = True</span>
<span class="n">subtract</span> <span class="o">=</span> <span class="kc">True</span> <span class="c1"># Specifies whether the computed sky background values are to be subtracted from the images. (Default = False   </span>
    
<span class="n">pipe3</span><span class="o">=</span><span class="n">Image3Pipeline</span><span class="p">()</span>    
<span class="n">pipe3</span><span class="o">.</span><span class="n">tweakreg</span><span class="o">.</span><span class="n">skip</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">outlier_detection</span><span class="o">.</span><span class="n">skip</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">pipe3</span><span class="o">.</span><span class="n">skymatch</span><span class="o">.</span><span class="n">skymethod</span> <span class="o">=</span> <span class="n">skymethod</span>
<span class="c1">#pipe3.skymatch.match_down = match_down</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">skymatch</span><span class="o">.</span><span class="n">subtract</span> <span class="o">=</span> <span class="n">subtract</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">skymatch</span><span class="o">.</span><span class="n">output_file</span> <span class="o">=</span> <span class="s1">&#39;MIRI&#39;</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">skymatch</span><span class="o">.</span><span class="n">save_results</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">pipe3</span><span class="o">.</span><span class="n">resample</span><span class="o">.</span><span class="n">save_results</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">source_catalog</span><span class="o">.</span><span class="n">save_results</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">source_catalog</span><span class="o">.</span><span class="n">snr_threshold</span> <span class="o">=</span> <span class="n">snr</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">source_catalog</span><span class="o">.</span><span class="n">kernel_fwhm</span> <span class="o">=</span> <span class="n">fwhm</span>

<span class="n">pipe3</span><span class="o">.</span><span class="n">save_results</span> <span class="o">=</span> <span class="kc">True</span>

<span class="c1"># run Image3</span>

<span class="n">image</span> <span class="o">=</span> <span class="n">pipe3</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">skymatch_json_file2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Image 3 pipeline finished.&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">img01_1_new</span> <span class="o">=</span> <span class="n">datamodels</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;MIRI_0_skymatch.fits&#39;</span><span class="p">)</span>
<span class="n">img01_2_new</span> <span class="o">=</span> <span class="n">datamodels</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;MIRI_1_skymatch.fits&#39;</span><span class="p">)</span>
<span class="n">img02_1_new</span> <span class="o">=</span> <span class="n">datamodels</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;MIRI_2_skymatch.fits&#39;</span><span class="p">)</span>
<span class="n">img02_2_new</span> <span class="o">=</span> <span class="n">datamodels</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;MIRI_3_skymatch.fits&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean: original, new (global+match)&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">img01_1</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ymin</span><span class="p">:</span><span class="n">ymax</span><span class="p">,</span><span class="n">xmin</span><span class="p">:</span><span class="n">xmax</span><span class="p">]),</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">img01_1_new</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ymin</span><span class="p">:</span><span class="n">ymax</span><span class="p">,</span><span class="n">xmin</span><span class="p">:</span><span class="n">xmax</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">img01_2</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ymin</span><span class="p">:</span><span class="n">ymax</span><span class="p">,</span><span class="n">xmin</span><span class="p">:</span><span class="n">xmax</span><span class="p">]),</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">img01_2_new</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ymin</span><span class="p">:</span><span class="n">ymax</span><span class="p">,</span><span class="n">xmin</span><span class="p">:</span><span class="n">xmax</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">img02_1</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ymin</span><span class="p">:</span><span class="n">ymax</span><span class="p">,</span><span class="n">xmin</span><span class="p">:</span><span class="n">xmax</span><span class="p">]),</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">img02_1_new</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ymin</span><span class="p">:</span><span class="n">ymax</span><span class="p">,</span><span class="n">xmin</span><span class="p">:</span><span class="n">xmax</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">img02_2</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ymin</span><span class="p">:</span><span class="n">ymax</span><span class="p">,</span><span class="n">xmin</span><span class="p">:</span><span class="n">xmax</span><span class="p">]),</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">img02_2_new</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ymin</span><span class="p">:</span><span class="n">ymax</span><span class="p">,</span><span class="n">xmin</span><span class="p">:</span><span class="n">xmax</span><span class="p">]))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Look at combined image</span>
<span class="n">im_file</span> <span class="o">=</span> <span class="n">ImageModel</span><span class="p">(</span><span class="s1">&#39;skymatch_combined_i2d.fits&#39;</span><span class="p">)</span>

<span class="c1">#print(&#39;Did resample subtract a background level, and what was it?&#39;)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;This value should match the values in the new column above. Subtraction was done in skymatch step.&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">im_file</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ymin</span><span class="p">:</span><span class="n">ymax</span><span class="p">,</span><span class="n">xmin</span><span class="p">:</span><span class="n">xmax</span><span class="p">]))</span>

<span class="c1"># read in ecsv photom file</span>
<span class="kn">from</span> <span class="nn">astropy.visualization</span> <span class="kn">import</span> <span class="n">LogStretch</span><span class="p">,</span> <span class="n">PercentileInterval</span><span class="p">,</span> <span class="n">ManualInterval</span>

<span class="c1">#viz2 = LogStretch() + ManualInterval(0,10)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>
<span class="c1">#plt.imshow(viz2(im_file.data), origin=&#39;lower&#39;)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">im_file</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;rainbow&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get name of output catalog</span>
<span class="n">catfile</span> <span class="o">=</span> <span class="s1">&#39;skymatch_combined_cat.ecsv&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">catfile</span><span class="p">)</span>

<span class="c1"># Read in catalog</span>
<span class="c1">#catalog = Table.read(catfile)</span>
<span class="n">catalog</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">catfile</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;ascii&#39;</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="s1">&#39;#&#39;</span><span class="p">)</span>
<span class="n">catalog</span>

<span class="c1"># Plot AB mag values</span>
<span class="n">create_scatterplot</span><span class="p">(</span><span class="n">catalog</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">],</span> <span class="n">catalog</span><span class="p">[</span><span class="s1">&#39;aper_total_abmag&#39;</span><span class="p">],</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Total AB mag&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="skymatch-global-match-subtract-false">
<h3>4.2 skymatch = global+match, subtract = False<a class="headerlink" href="#skymatch-global-match-subtract-false" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Test running just skymatch and resample and skiping other steps.</span>

<span class="c1"># Run Calwebb_image3 on the association table</span>
    
<span class="c1"># set any specific parameters</span>
<span class="n">skymethod</span> <span class="o">=</span> <span class="s1">&#39;global+match&#39;</span> <span class="c1"># sky computation algorithm to be used. Allowed values: {local, global, match, global+match} (Default = global+match</span>
<span class="c1">#match_down = True # Specifies whether the sky differences should be subtracted from images with higher sky values (match_down = True) in order to match the image with the lowest sky or sky differences should be added to the images with lower sky values to match the sky of the image with the highest sky value (match_down = False). (Default = True</span>
<span class="n">subtract</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1"># Specifies whether the computed sky background values are to be subtracted from the images. (Default = False   </span>
    
<span class="n">pipe3</span><span class="o">=</span><span class="n">Image3Pipeline</span><span class="p">()</span>    
<span class="n">pipe3</span><span class="o">.</span><span class="n">tweakreg</span><span class="o">.</span><span class="n">skip</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">outlier_detection</span><span class="o">.</span><span class="n">skip</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">pipe3</span><span class="o">.</span><span class="n">skymatch</span><span class="o">.</span><span class="n">skymethod</span> <span class="o">=</span> <span class="n">skymethod</span>
<span class="c1">#pipe3.skymatch.match_down = match_down</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">skymatch</span><span class="o">.</span><span class="n">subtract</span> <span class="o">=</span> <span class="n">subtract</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">skymatch</span><span class="o">.</span><span class="n">output_file</span> <span class="o">=</span> <span class="s1">&#39;MIRI&#39;</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">skymatch</span><span class="o">.</span><span class="n">save_results</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">pipe3</span><span class="o">.</span><span class="n">resample</span><span class="o">.</span><span class="n">save_results</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">source_catalog</span><span class="o">.</span><span class="n">save_results</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">source_catalog</span><span class="o">.</span><span class="n">snr_threshold</span> <span class="o">=</span> <span class="n">snr</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">source_catalog</span><span class="o">.</span><span class="n">kernel_fwhm</span> <span class="o">=</span> <span class="n">fwhm</span>

<span class="n">pipe3</span><span class="o">.</span><span class="n">save_results</span> <span class="o">=</span> <span class="kc">True</span>

<span class="c1"># run Image3</span>

<span class="n">image</span> <span class="o">=</span> <span class="n">pipe3</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">skymatch_json_file2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Image 3 pipeline finished.&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">img01_1_new</span> <span class="o">=</span> <span class="n">datamodels</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;MIRI_0_skymatch.fits&#39;</span><span class="p">)</span>
<span class="n">img01_2_new</span> <span class="o">=</span> <span class="n">datamodels</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;MIRI_1_skymatch.fits&#39;</span><span class="p">)</span>
<span class="n">img02_1_new</span> <span class="o">=</span> <span class="n">datamodels</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;MIRI_2_skymatch.fits&#39;</span><span class="p">)</span>
<span class="n">img02_2_new</span> <span class="o">=</span> <span class="n">datamodels</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;MIRI_3_skymatch.fits&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean: original, new (global+match)&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">img01_1</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ymin</span><span class="p">:</span><span class="n">ymax</span><span class="p">,</span><span class="n">xmin</span><span class="p">:</span><span class="n">xmax</span><span class="p">]),</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">img01_1_new</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ymin</span><span class="p">:</span><span class="n">ymax</span><span class="p">,</span><span class="n">xmin</span><span class="p">:</span><span class="n">xmax</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">img01_2</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ymin</span><span class="p">:</span><span class="n">ymax</span><span class="p">,</span><span class="n">xmin</span><span class="p">:</span><span class="n">xmax</span><span class="p">]),</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">img01_2_new</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ymin</span><span class="p">:</span><span class="n">ymax</span><span class="p">,</span><span class="n">xmin</span><span class="p">:</span><span class="n">xmax</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">img02_1</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ymin</span><span class="p">:</span><span class="n">ymax</span><span class="p">,</span><span class="n">xmin</span><span class="p">:</span><span class="n">xmax</span><span class="p">]),</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">img02_1_new</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ymin</span><span class="p">:</span><span class="n">ymax</span><span class="p">,</span><span class="n">xmin</span><span class="p">:</span><span class="n">xmax</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">img02_2</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ymin</span><span class="p">:</span><span class="n">ymax</span><span class="p">,</span><span class="n">xmin</span><span class="p">:</span><span class="n">xmax</span><span class="p">]),</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">img02_2_new</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ymin</span><span class="p">:</span><span class="n">ymax</span><span class="p">,</span><span class="n">xmin</span><span class="p">:</span><span class="n">xmax</span><span class="p">]))</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="check-that-all-output-new-sky-values-are-around-zero-within-a-standard-deviation">
<h3>** Check that all output (new) sky values are around zero (within a standard deviation)<a class="headerlink" href="#check-that-all-output-new-sky-values-are-around-zero-within-a-standard-deviation" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Look at combined image</span>
<span class="n">im_file</span> <span class="o">=</span> <span class="n">ImageModel</span><span class="p">(</span><span class="s1">&#39;skymatch_combined_i2d.fits&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Did resample subtract a background level, and what was it?&#39;</span><span class="p">)</span>
<span class="c1">#print(&#39;This value should match the values in the new column above. Subtraction was done in skymatch step.&#39;)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">im_file</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ymin</span><span class="p">:</span><span class="n">ymax</span><span class="p">,</span><span class="n">xmin</span><span class="p">:</span><span class="n">xmax</span><span class="p">]))</span>

<span class="c1"># read in ecsv photom file</span>
<span class="kn">from</span> <span class="nn">astropy.visualization</span> <span class="kn">import</span> <span class="n">LogStretch</span><span class="p">,</span> <span class="n">PercentileInterval</span><span class="p">,</span> <span class="n">ManualInterval</span>

<span class="c1">#viz2 = LogStretch() + ManualInterval(0,10)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>
<span class="c1">#plt.imshow(viz2(im_file.data), origin=&#39;lower&#39;)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">im_file</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;rainbow&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get name of output catalog</span>
<span class="n">catfile</span> <span class="o">=</span> <span class="s1">&#39;skymatch_combined_cat.ecsv&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">catfile</span><span class="p">)</span>

<span class="c1"># Read in catalog</span>
<span class="c1">#catalog = Table.read(catfile)</span>
<span class="n">catalog</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">catfile</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;ascii&#39;</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="s1">&#39;#&#39;</span><span class="p">)</span>
<span class="n">cat_global_match</span> <span class="o">=</span> <span class="n">catalog</span>

<span class="c1"># Plot AB mag values</span>
<span class="n">create_scatterplot</span><span class="p">(</span><span class="n">catalog</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">],</span> <span class="n">catalog</span><span class="p">[</span><span class="s1">&#39;aper_total_abmag&#39;</span><span class="p">],</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Total AB mag&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Look at the sources found on the image</span>
<span class="n">viz2</span> <span class="o">=</span> <span class="n">LogStretch</span><span class="p">()</span> <span class="o">+</span> <span class="n">ManualInterval</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Sources found with Global+Match method&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">viz2</span><span class="p">(</span><span class="n">im_file</span><span class="o">.</span><span class="n">data</span><span class="p">),</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">catalog</span><span class="p">[</span><span class="s1">&#39;xcentroid&#39;</span><span class="p">],</span> <span class="n">catalog</span><span class="p">[</span><span class="s1">&#39;ycentroid&#39;</span><span class="p">],</span><span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="compare-photometry-across-the-different-skymatch-methods">
<h3>Compare photometry across the different skymatch methods<a class="headerlink" href="#compare-photometry-across-the-different-skymatch-methods" title="Permalink to this headline">#</a></h3>
<p>Determine whether the different methods give different photometric results. Ideally, the methods won’t affect the output photometry, and the symbols should fall on top of each other for the sources plotted.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">15</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Photometry across methods&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;x position&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;aper_total_abmag&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">cat_local</span><span class="p">[</span><span class="s1">&#39;xcentroid&#39;</span><span class="p">],</span><span class="n">cat_local</span><span class="p">[</span><span class="s1">&#39;aper_total_abmag&#39;</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Local&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">cat_global</span><span class="p">[</span><span class="s1">&#39;xcentroid&#39;</span><span class="p">],</span> <span class="n">cat_global</span><span class="p">[</span><span class="s1">&#39;aper_total_abmag&#39;</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;v&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Global&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">cat_match</span><span class="p">[</span><span class="s1">&#39;xcentroid&#39;</span><span class="p">],</span> <span class="n">cat_match</span><span class="p">[</span><span class="s1">&#39;aper_total_abmag&#39;</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Match&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">cat_global_match</span><span class="p">[</span><span class="s1">&#39;xcentroid&#39;</span><span class="p">],</span> <span class="n">cat_global_match</span><span class="p">[</span><span class="s1">&#39;aper_total_abmag&#39;</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;magenta&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Global+Match&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p><a id="about_ID"></a></p>
</section>
</section>
<section id="about-this-notebook">
<h2>About this Notebook<a class="headerlink" href="#about-this-notebook" title="Permalink to this headline">#</a></h2>
<p><strong>Author:</strong> T. Temim and M. Cracraft, MIRI team
<br><strong>Updated On:</strong> 01/21/2022</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "TheRealZoidberg/jwst_validation_test",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./notebooks/skymatch/jwst_skymatch_miri_test"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="exec_jwst_skymatch_miri_test.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">JWST Pipeline Validation Notebook: skymatch with MIRI</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="jwst_skymatch_miri_test.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">JWST Pipeline Validation Notebook: skymatch with MIRI</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By STScI<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>