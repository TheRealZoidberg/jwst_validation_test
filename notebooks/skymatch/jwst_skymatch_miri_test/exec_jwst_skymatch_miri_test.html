
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>JWST Pipeline Validation Notebook: skymatch with MIRI &#8212; Notebook repository template</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" href="../../../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/main.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script src="../../../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../../_static/sphinx-thebe.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.1/dist/embed-amd.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="JWST Pipeline Validation Notebook: skymatch and photometry with MIRI" href="exec_jwst_skymatch_photom_miri_test.html" />
    <link rel="prev" title="JWST Pipeline Validation Notebook: skymatch and photometry with MIRI" href="jwst_skymatch_photom_miri_test.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../../_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Notebook repository template</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../../index.html">
                    <no title>
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../background/jwst_background_miri_test/jwst_background_subtraction_miri_imaging_testing.html">
   JWST Pipeline Validation Notebook: calwebb_image2, background subtraction for MIRI imaging
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../background/jwst_background_miri_test/exec_jwst_background_subtraction_miri_imaging_testing.html">
   JWST Pipeline Validation Notebook: calwebb_image2, background subtraction for MIRI imaging
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../background/jwst_background_miri_test/exec_background_sub-miri-lrs-slit.html">
   JWST Pipeline Validation Testing Notebook: Background_subtract() for MIRI LRS SLIT
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../background/jwst_background_miri_test/background_sub-miri-lrs-slit.html">
   JWST Pipeline Validation Testing Notebook: Background_subtract() for MIRI LRS SLIT
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../pathloss/jwst_pathloss_nirspec_test/exec_jwst_pathloss_nirspec_test.html">
   JWST Pipeline Validation Testing Notebook: spec2, pathloss step
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../pathloss/jwst_pathloss_nirspec_test/jwst_pathloss_nirspec_test.html">
   JWST Pipeline Validation Testing Notebook: spec2, pathloss step
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../msaflagopen/jwst_msa_flagging_nirspec_test.html">
   JWST Pipeline Validation Testing Notebook: spec2, msa_flagging step
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../msaflagopen/exec_jwst_msa_flagging_nirspec_test.html">
   JWST Pipeline Validation Testing Notebook: spec2, msa_flagging step
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../resample/jwst_resample_miri_test/jwst_resample_miri_lrs_slit.html">
   JWST Pipeline Validation Testing Notebook: Calwebb_Image3, Resample step
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../resample/jwst_resample_miri_test/exec_jwst_resample_miri_lrs_slit.html">
   JWST Pipeline Validation Testing Notebook: Calwebb_Image3, Resample step
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../resample/jwst_resample_miri_test/jwst_resample_miri_testing.html">
   JWST Pipeline Validation Testing Notebook: Calwebb_Image3, Resample step with MIRI imaging
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../resample/jwst_resample_miri_test/exec_jwst_resample_miri_testing.html">
   JWST Pipeline Validation Testing Notebook: Calwebb_Image3, Resample step with MIRI imaging
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../example_notebook/example_notebook.html">
   Draft: Notebook title
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../source_catalog/jwst_source_catalog_miri_test/exec_jwst_source_catalog_miri_test.html">
   JWST Pipeline Validation Notebook: calwebb_image3: source_catalog with MIRI
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../source_catalog/jwst_source_catalog_miri_test/jwst_source_catalog_miri_test.html">
   JWST Pipeline Validation Notebook: calwebb_image3: source_catalog with MIRI
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../source_catalog/jwst_source_catalog_nircam_test/jwst_nircam_imaging_source_catalog.html">
   JWST Pipeline Validation Notebook: NIRCam, calwebb_image3, source_catalog
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../source_catalog/jwst_source_catalog_nircam_test/exec_jwst_nircam_imaging_source_catalog.html">
   JWST Pipeline Validation Notebook: NIRCam, calwebb_image3, source_catalog
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../lastframe/exec_jwst_lastframe_unit_tests.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, lastframe unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../lastframe/jwst_lastframe_unit_tests.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, lastframe unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../photom/jwst_photom_miri_test/exec_photom_miri_lrs_slitless.html">
   JWST Pipeline Validation Testing Notebook: MIRI LRS Slitless spectroscopy
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../photom/jwst_photom_miri_test/photom_miri_mrs_test.html">
   JWST Pipeline Validation Testing Notebook: Spec2, photom, MIRI
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../photom/jwst_photom_miri_test/exec_photom_miri_lrs_slit.html">
   JWST Pipeline Validation Testing Notebook: MIRI LRS Slit spectroscopy
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../photom/jwst_photom_miri_test/exec_photom_miri_mrs_test.html">
   JWST Pipeline Validation Testing Notebook: Spec2, photom, MIRI
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../photom/jwst_photom_miri_test/photom_miri_lrs_slit.html">
   JWST Pipeline Validation Testing Notebook: MIRI LRS Slit spectroscopy
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../photom/jwst_photom_miri_test/photom_miri_lrs_slitless.html">
   JWST Pipeline Validation Testing Notebook: MIRI LRS Slitless spectroscopy
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../photom/jwst_photom_miri_test/exec_jwst_photom_miri_test.html">
   JWST Pipeline Validation Notebook: photom with MIRI Imager
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../photom/jwst_photom_miri_test/jwst_photom_miri_test.html">
   JWST Pipeline Validation Notebook: photom with MIRI Imager
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ami3/run_ami_pipeline.html">
   JWST Pipeline Validation Notebook:  AMI3, AMI3 Pipeline
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ami3/exec_ami_analyze_verify.html">
   JWST Pipeline Validation Notebook: AMI3, AmiAnalyze
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ami3/exec_ami_average.html">
   JWST Pipeline Validation Notebook:  calwebb_ami3, ami_average
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ami3/exec_ami_normalize.html">
   JWST Pipeline Validation Notebook: calwebb_ami3, ami_normalize
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ami3/exec_run_ami_pipeline.html">
   JWST Pipeline Validation Notebook:  AMI3, AMI3 Pipeline
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ami3/ami_normalize.html">
   JWST Pipeline Validation Notebook: calwebb_ami3, ami_normalize
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ami3/ami_average.html">
   JWST Pipeline Validation Notebook:  calwebb_ami3, ami_average
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ami3/ami_analyze_verify.html">
   JWST Pipeline Validation Notebook: AMI3, AmiAnalyze
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../assign_wcs/jwst_assign_wcs_nirspec_test/jwst_assign_wcs_nirspec_test.html">
   JWST Pipeline Validation Testing Notebook: NIRSpec, spec2, assign_wcs step
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../assign_wcs/jwst_assign_wcs_nirspec_test/exec_jwst_assign_wcs_nirspec_test.html">
   JWST Pipeline Validation Testing Notebook: NIRSpec, spec2, assign_wcs step
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../assign_wcs/jwst_assign_wcs_niriss_test/jwst_assign_wcs_niriss_image.html">
   JWST Pipeline Validation Notebook: NIRISS, image2, assign_wcs
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../assign_wcs/jwst_assign_wcs_niriss_test/exec_jwst_assign_wcs_niriss_image.html">
   JWST Pipeline Validation Notebook: NIRISS, image2, assign_wcs
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../assign_wcs/jwst_assign_wcs_miri_test/exec_assign_wcs-miri-mrs.html">
   JWST Pipeline Validation Testing Notebook: MIRI MRS Spec2: Assign_wcs()
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../assign_wcs/jwst_assign_wcs_miri_test/exec_assign_wcs-miri-lrs-tso.html">
   JWST Pipeline Validation Testing Notebook: MIRI LRS Time Series Observation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../assign_wcs/jwst_assign_wcs_miri_test/assign_wcs-miri-lrs-slit.html">
   JWST Pipeline Validation Testing Notebook: MIRI LRS Slit
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../assign_wcs/jwst_assign_wcs_miri_test/assign_wcs-miri-mrs.html">
   JWST Pipeline Validation Testing Notebook: MIRI MRS Spec2: Assign_wcs()
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../assign_wcs/jwst_assign_wcs_miri_test/assign_wcs-miri-lrs-tso.html">
   JWST Pipeline Validation Testing Notebook: MIRI LRS Time Series Observation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../assign_wcs/jwst_assign_wcs_miri_test/exec_assign_wcs-miri-lrs-slit.html">
   JWST Pipeline Validation Testing Notebook: MIRI LRS Slit
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../barshadow/jwst_barshadow_nirspec_test/jwst_barshadow_nirspec_test.html">
   JWST Pipeline Validation Testing Notebook: spec2, barshadow step
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../barshadow/jwst_barshadow_nirspec_test/exec_jwst_barshadow_nirspec_test.html">
   JWST Pipeline Validation Testing Notebook: spec2, barshadow step
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../reset/jwst_reset_miri_test/exec_jwst_reset_miri_testing.html">
   JWST Pipeline Validation Testing Notebook: Calwebb_detector1, reset step for MIRI
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../reset/jwst_reset_miri_test/jwst_reset_miri_testing.html">
   JWST Pipeline Validation Testing Notebook: Calwebb_detector1, reset step for MIRI
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../refpix/jwst_refpix_unit_tests.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, refpix unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../refpix/exec_jwst_refpix_unit_tests.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, refpix unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../flat_field/jwst_flat_field_nirspec_test/jwst_flat_field_nirspec_test.html">
   JWST Pipeline Validation Testing Notebook: spec2, flat_field step
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../flat_field/jwst_flat_field_nirspec_test/exec_jwst_flat_field_nirspec_test.html">
   JWST Pipeline Validation Testing Notebook: spec2, flat_field step
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../flat_field/jwst_flat_field_miri_test/exec_flatfield_analysis_slitless.html">
   JWST Pipeline Validation Testing Notebook: MIRI LRS Slitless spectroscopy
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../flat_field/jwst_flat_field_miri_test/exec_jwst_flat_field_miri_test.html">
   JWST Pipeline Validation Testing notebook: flat_field step with MIRI Imaging
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../flat_field/jwst_flat_field_miri_test/exec_flat-miri-lrs-slit.html">
   JWST Pipeline Validation Testing Notebook: MIRI LRS Slit spectroscopy
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../flat_field/jwst_flat_field_miri_test/flatfield_analysis_slitless.html">
   JWST Pipeline Validation Testing Notebook: MIRI LRS Slitless spectroscopy
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../flat_field/jwst_flat_field_miri_test/exec_flat_miri_mrs_test.html">
   JWST Pipeline Validation Testing Notebook: Spec2, flat_field, MIRI
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../flat_field/jwst_flat_field_miri_test/flat-miri-lrs-slit.html">
   JWST Pipeline Validation Testing Notebook: MIRI LRS Slit spectroscopy
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../flat_field/jwst_flat_field_miri_test/jwst_flat_field_miri_test.html">
   JWST Pipeline Validation Testing notebook: flat_field step with MIRI Imaging
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../flat_field/jwst_flat_field_miri_test/flat_miri_mrs_test.html">
   JWST Pipeline Validation Testing Notebook: Spec2, flat_field, MIRI
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="jwst_skymatch_photom_miri_test.html">
   JWST Pipeline Validation Notebook: skymatch and photometry with MIRI
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   JWST Pipeline Validation Notebook: skymatch with MIRI
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="exec_jwst_skymatch_photom_miri_test.html">
   JWST Pipeline Validation Notebook: skymatch and photometry with MIRI
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="jwst_skymatch_miri_test.html">
   JWST Pipeline Validation Notebook: skymatch with MIRI
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../jump/jwst_jump_miri_test/jwst_jump_miri_testing.html">
   JWST Pipeline Validation Testing Notebook: Calwebb_Detector1, Jump step
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../jump/jwst_jump_miri_test/exec_jwst_jump_miri_testing.html">
   JWST Pipeline Validation Testing Notebook: Calwebb_Detector1, Jump step
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../jump/jwst_jump_unit_tests.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, jump unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../jump/exec_jwst_jump_unit_tests.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, jump unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../calwebb_image3/jwst_image3_nircam_test/jwst_image3_nircam_test.html">
   JWST Pipeline Validation Notebook: calwebb_image3, NIRCam imaging
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../calwebb_image3/jwst_image3_nircam_test/exec_jwst_image3_nircam_test.html">
   JWST Pipeline Validation Notebook: calwebb_image3, NIRCam imaging
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../calwebb_image3/jwst_image3_miri_test/exec_jwst_image3_miri_test.html">
   JWST Pipeline Validation Notebook: calwebb_image3 with MIRI
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../calwebb_image3/jwst_image3_miri_test/jwst_image3_miri_test.html">
   JWST Pipeline Validation Notebook: calwebb_image3 with MIRI
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../calwebb_detector1/jwst_detector1_nircam_test/jwst_detector1_nircam_test.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, NIRCam imaging
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../calwebb_detector1/jwst_detector1_nircam_test/exec_jwst_detector1_nircam_test.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, NIRCam imaging
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../calwebb_detector1/jwst_detector1_miri_test/exec_jwst_detector1_miri_imtso_testing.html">
   JWST Pipeline Validation Testing Notebook: Calwebb_Detector1 for MIRI TSO imaging
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../calwebb_detector1/jwst_detector1_miri_test/jwst_detector1_miri_imtso_testing.html">
   JWST Pipeline Validation Testing Notebook: Calwebb_Detector1 for MIRI TSO imaging
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../calwebb_detector1/jwst_detector1_miri_test/exec_caldetector1-miri-lrs-tso.html">
   JWST Pipeline Validation Testing Notebook: MIRI LRS Time Series Observation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../calwebb_detector1/jwst_detector1_miri_test/caldetector1-miri-lrs-tso.html">
   JWST Pipeline Validation Testing Notebook: MIRI LRS Time Series Observation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../rscd/jwst_rscd_unit_tests.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, rscd unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../rscd/exec_jwst_rscd_unit_tests.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, rscd unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../rscd/jwst_rscd_miri_test/exec_jwst_miri_rscd_testing.html">
   JWST Pipeline Validation Testing Notebook: Calwebb_Detector1, RSCD step
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../rscd/jwst_rscd_miri_test/jwst_miri_rscd_testing.html">
   JWST Pipeline Validation Testing Notebook: Calwebb_Detector1, RSCD step
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../calwebb_image2/jwst_image2_nircam_test/jwst_image2_nircam_test.html">
   JWST Pipeline Validation Notebook: calwebb_image2, NIRCam imaging
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../calwebb_image2/jwst_image2_nircam_test/exec_jwst_image2_nircam_test.html">
   JWST Pipeline Validation Notebook: calwebb_image2, NIRCam imaging
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ramp_fitting/exec_jwst_ramp_fitting_unit_tests.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, ramp_fitting unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ramp_fitting/jwst_ramp_fitting_unit_tests.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, ramp_fitting unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../firstframe/exec_jwst_firstframe_unit_tests.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, firstframe unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../firstframe/jwst_firstframe_unit_tests.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, firstframe unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../dq_init/exec_jwst_dq_init_unit_tests.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, dq_init unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../dq_init/jwst_dq_init_unit_tests.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, dq_init unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../cube_build/jwst_cube_build_miri_test/test_cube_build_spec3.html">
   JWST Pipeline Validation Testing Notebook: Cube Build with MIRISIM Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../cube_build/jwst_cube_build_miri_test/exec_testing_point_source_flux_conservation_modeshep_all.html">
   JWST Pipeline Validation Testing Notebook: Point Source Flux Conservation Modeshep
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../cube_build/jwst_cube_build_miri_test/testing_point_source_flux_conservation_modeshep_all.html">
   JWST Pipeline Validation Testing Notebook: Point Source Flux Conservation Modeshep
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../cube_build/jwst_cube_build_miri_test/exec_test_cube_build_spec3.html">
   JWST Pipeline Validation Testing Notebook: Cube Build with MIRISIM Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../saturation/exec_jwst_saturation_unit_tests.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, saturation unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../saturation/jwst_saturation_unit_tests.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, saturation unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../extract_2d/jwst_extract_2d_nirspec_test/jwst_extract_2d_nirspec_test.html">
   JWST Pipeline Validation Testing Notebook: spec2, extract_2d step
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../extract_2d/jwst_extract_2d_nirspec_test/exec_jwst_extract_2d_nirspec_test.html">
   JWST Pipeline Validation Testing Notebook: spec2, extract_2d step
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../persistence/exec_jwst_persistence_unit_tests.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, persistence unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../persistence/jwst_persistence_unit_tests.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, persistence unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../extract_1d/jwst_extract_1d_miri_test/exec_extract_1d-spec2-miri-lrs-slit.html">
   JWST Pipeline Validation Testing Notebook: MIRI LRS Slit
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../extract_1d/jwst_extract_1d_miri_test/extract_1d-spec2-miri-lrs-slitless.html">
   JWST Pipeline Validation Testing Notebook: MIRI LRS Slitless
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../extract_1d/jwst_extract_1d_miri_test/extract_1d-spec2-miri-lrs-slit.html">
   JWST Pipeline Validation Testing Notebook: MIRI LRS Slit
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../extract_1d/jwst_extract_1d_miri_test/exec_extract_1d-spec2-miri-lrs-slitless.html">
   JWST Pipeline Validation Testing Notebook: MIRI LRS Slitless
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../dark_current/exec_jwst_dark_current_unit_tests.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, dark_current unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../dark_current/jwst_dark_current_unit_tests.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, dark_current unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../templates/jwst_validation_notebook_template.html">
   JWST Pipeline Validation Notebook:
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../templates/exec_jwst_validation_notebook_template.html">
   JWST Pipeline Validation Notebook:
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../templates/validation_test_template.html">
   JWST Pipeline Validation Testing Notebook: Descriptive Name of Test You Are Performing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../templates/exec_validation_test_template.html">
   JWST Pipeline Validation Testing Notebook: Descriptive Name of Test You Are Performing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ipc/exec_jwst_ipc_unit_tests.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, ipc unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ipc/jwst_ipc_unit_tests.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, ipc unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/background/exec_jwst_background_unit_tests.html">
   JWST calwebb_image2, background unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/background/jwst_background_unit_tests.html">
   JWST calwebb_image2, background unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/jwst_nirspec_regression_tests.html">
   JWST NIRSpec regression tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/flatfield/exec_jwst_flatfield_unit_tests.html">
   JWST calwebb_image2 and calwebb_spec2, flatfield unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/flatfield/jwst_flatfield_unit_tests.html">
   JWST calwebb_image2 and calwebb_spec2, flatfield unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/jwst_nircam_regression_tests.html">
   JWST NIRCam regression tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/resample/exec_jwst_resample_unit_tests.html">
   JWST calwebb_image2 and calwebb_spec2, resample unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/resample/jwst_resample_unit_tests.html">
   JWST calwebb_image2 and calwebb_spec2, resample unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/jwst_niriss_regression_tests.html">
   JWST NIRISS regression tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/source_catalog/jwst_source_catalog_unit_tests.html">
   JWST calwebb_image3, source_catalog unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/source_catalog/exec_jwst_source_catalog_unit_tests.html">
   JWST calwebb_image3, source_catalog unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/exec_jwst_fgs_regression_tests.html">
   JWST FGS regression tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/photom/jwst_photom_unit_tests.html">
   JWST calwebb_image2 and calwebb_spec2, photom unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/photom/exec_jwst_photom_unit_tests.html">
   JWST calwebb_image2 and calwebb_spec2, photom unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/assign_wcs/jwst_assign_wcs_unit_tests.html">
   JWST calwebb_image2 and calwebb_spec2, assign_wcs unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/assign_wcs/exec_jwst_assign_wcs_unit_tests.html">
   JWST calwebb_image2 and calwebb_spec2, assign_wcs unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/skymatch/jwst_skymatch_unit_tests.html">
   JWST calwebb_image3, skymatch unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/skymatch/exec_jwst_skymatch_unit_tests.html">
   JWST calwebb_image3, skymatch unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/exec_jwst_niriss_regression_tests.html">
   JWST NIRISS regression tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/exec_jwst_nirspec_regression_tests.html">
   JWST NIRSpec regression tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/exec_jwst_nircam_regression_tests.html">
   JWST NIRCam regression tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/jwst_fgs_regression_tests.html">
   JWST FGS regression tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/exec_jwst_miri_regression_tests.html">
   JWST MIRI regression tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/jwst_miri_regression_tests.html">
   JWST MIRI regression tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/tweakreg/exec_jwst_tweakreg_unit_tests.html">
   JWST calwebb_image3, tweakreg unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/tweakreg/jwst_tweakreg_unit_tests.html">
   JWST calwebb_image3, tweakreg unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/outlier_detection/jwst_outlier_detection_unit_tests.html">
   JWST calwebb_image3, calwebb_spec3, calwebb_coron3, calwebb_tso3, outlier_detection unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/outlier_detection/exec_jwst_outlier_detection_unit_tests.html">
   JWST calwebb_image3, calwebb_spec3, calwebb_coron3, calwebb_tso3, outlier_detection unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../tweakreg/jwst_tweakreg_miri_test/exec_jwst_tweakreg_miri_test.html">
   JWST Pipeline Validation Testing Notebook: Calwebb_Image3, Tweakreg step with MIRI imaging
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../tweakreg/jwst_tweakreg_miri_test/jwst_tweakreg_miri_test.html">
   JWST Pipeline Validation Testing Notebook: Calwebb_Image3, Tweakreg step with MIRI imaging
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../outlier_detection/jwst_outlier_detection_miri_test/exec_jwst_outlier_detection_miri_test.html">
   JWST Pipeline Validation Notebook: outlier_detection with MIRI
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../outlier_detection/jwst_outlier_detection_miri_test/exec_jwst_outlier_detection_view_miri_test.html">
   JWST Pipeline Validation Notebook: MIRI view outlier_detection
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../outlier_detection/jwst_outlier_detection_miri_test/exec_out_det_test2.html">
   JWST Pipeline Validation Notebook: Outlier Detection for MIRI MRS
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../outlier_detection/jwst_outlier_detection_miri_test/out_det_test2.html">
   JWST Pipeline Validation Notebook: Outlier Detection for MIRI MRS
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../outlier_detection/jwst_outlier_detection_miri_test/jwst_outlier_detection_miri_test.html">
   JWST Pipeline Validation Notebook: outlier_detection with MIRI
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../outlier_detection/jwst_outlier_detection_miri_test/jwst_outlier_detection_view_miri_test.html">
   JWST Pipeline Validation Notebook: MIRI view outlier_detection
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../superbias/exec_jwst_superbias_unit_tests.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, superbias unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../superbias/jwst_superbias_unit_tests.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, superbias unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../calwebb_coron3/exec_MIRI_shared_calcoron3_testing.html">
   JWST Pipeline Validation Testing Notebook: Calwebb_Coron3 for MIRI Coronagraphic Imaging
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../calwebb_coron3/jwst_calcoron3_nircam_test.html">
   JWST Pipeline Validation Notebook: calwebb_coron3 with NIRCam
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../calwebb_coron3/exec_jwst_calcoron3_nircam_test.html">
   JWST Pipeline Validation Notebook: calwebb_coron3 with NIRCam
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../calwebb_coron3/MIRI_shared_calcoron3_testing.html">
   JWST Pipeline Validation Testing Notebook: Calwebb_Coron3 for MIRI Coronagraphic Imaging
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../fringe/JWST_fringe_miri_test/exec_fringe_miri_mrs_test.html">
   JWST Pipeline Validation Testing Notebook: Spec2, fringe, MIRI
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../fringe/JWST_fringe_miri_test/fringe_miri_mrs_test.html">
   JWST Pipeline Validation Testing Notebook: Spec2, fringe, MIRI
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../image3/jwst_image3_miri_test/exec_jwst_image3_miri_test.html">
   JWST Pipeline Validation Notebook: calwebb_image3 with MIRI
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../image3/jwst_image3_miri_test/jwst_image3_miri_test.html">
   JWST Pipeline Validation Notebook: calwebb_image3 with MIRI
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../linearity/jwst_linearity_unit_tests.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, linearity unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../linearity/exec_jwst_linearity_unit_tests.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, linearity unit tests
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/TheRealZoidberg/jwst_validation_test/main?urlpath=tree/notebooks/skymatch/jwst_skymatch_miri_test/exec_jwst_skymatch_miri_test.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../../../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
      <li>
        <a href="https://colab.research.google.com/github/TheRealZoidberg/jwst_validation_test/blob/main/notebooks/skymatch/jwst_skymatch_miri_test/exec_jwst_skymatch_miri_test.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Colab"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../../../_static/images/logo_colab.png">
  </span>
<span class="headerbtn__text-container">Colab</span>
</a>

      </li>
      
      <li>
        
<button onclick="initThebeSBT()"
  class="headerbtn headerbtn-launch-thebe"
  data-toggle="tooltip"
data-placement="left"
title="Launch Thebe"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="headerbtn__text-container">Live Code</span>
</button>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/TheRealZoidberg/jwst_validation_test"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/TheRealZoidberg/jwst_validation_test/issues/new?title=Issue%20on%20page%20%2Fnotebooks/skymatch/jwst_skymatch_miri_test/exec_jwst_skymatch_miri_test.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../../../_sources/notebooks/skymatch/jwst_skymatch_miri_test/exec_jwst_skymatch_miri_test.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#table-of-contents">
   Table of Contents
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#introduction">
   Introduction
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#set-up-temporary-directory-and-crds-options">
     Set up temporary directory and CRDS options
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#set-up-import-statements">
     Set up import statements
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#print-pipeline-version-number">
     Print pipeline version number
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#retrieve-data-from-artifactory">
     Retrieve data from Artifactory
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#set-up-association-files">
     Set up association files
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#modify-average-background-level-of-input-images">
     Modify average background level of input images
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#run-pipeline-steps">
   Run Pipeline steps
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#run-skymatch-step-on-images-with-skymatch-method-local">
   1. Run skymatch step on images with skymatch method = ‘local’
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#run-skymatch-with-sky-match-method-local-subtract-false-match-down-true">
     1.1 Run skymatch with sky match method = local. Subtract = False, match_down = True.
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#skymatch-method-local-subtract-true">
     1.2  Skymatch method = ‘Local’, subtract= True.
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#run-skymatch-for-skymethod-global">
   2. Run skymatch for skymethod = ‘global’.
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#notes-global-compute-a-common-sky-value-for-all-input-image-and-groups-of-images-in-this-setting-match-will-compute-sky-values-for-each-input-image-group-find-the-minimum-sky-value-and-then-it-will-set-and-or-subtract-sky-value-of-each-input-image-to-this-minimum-value-this-method-may-be-useful-when-input-images-have-been-already-matched-the-global-method-computes-the-minimum-sky-value-across-all-input-images-and-or-groups-that-sky-value-is-then-considered-to-be-the-background-in-all-input-images">
     Notes: ‘global’: compute a common sky value for all input image and groups of images. In this setting match will compute sky values for each input image/group, find the minimum sky value, and then it will set (and/or subtract) sky value of each input image to this minimum value. This method may be useful when input images have been already matched. The ‘global’ method computes the minimum sky value across all input images and/or groups. That sky value is then considered to be the background in all input images.
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#skymethod-global-with-subtraction-false">
     2.1 skymethod = ‘global’ with subtraction = False
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#skymethod-global-with-subtraction-true">
     2.2 skymethod = ‘global’ with subtraction = True
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#run-tests-on-skymatch-method-match">
   3. Run tests on Skymatch method ‘Match’
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#notes-match-compute-differences-in-sky-values-between-images-and-or-groups-in-pair-wise-common-sky-regions-in-this-case-computed-sky-values-will-be-relative-delta-to-the-sky-computed-in-one-of-the-input-images-whose-sky-value-will-be-set-to-reported-to-be-0-this-case-matches-to-the-lowest-sky-value">
     Notes: ‘match’: compute differences in sky values between images and/or groups in (pair-wise) common sky regions. In this case computed sky values will be relative (delta) to the sky computed in one of the input images whose sky value will be set to (reported to be) 0. This case matches to the lowest sky value.
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#skymethod-match-match-down-true-subtract-true">
     3.1 skymethod = ‘match’, match_down=True, subtract=True
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#check-that-all-output-new-sky-values-are-equal-to-the-lowest-original-sky-value">
     ** Check that all output (new) sky values are equal to the lowest original sky value
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#skymethod-match-match-down-false-subtract-true">
     3.2 skymethod = ‘match’, match_down=False, subtract = True
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#check-that-all-output-new-sky-values-are-equal-to-the-highest-original-sky-value">
     ** Check that all output (new) sky values are equal to the highest original sky value
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#skymethod-match-match-down-true-subtract-false">
     3.3 skymethod = ‘match’, match_down = True, subtract = False
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#test-skymatch-method-global-match">
   4. Test skymatch method ‘global+match’
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#notes-global-match-first-use-match-method-to-equalize-sky-values-between-images-and-then-find-a-minimum-global-sky-value-in-all-input-images">
     Notes: ‘global+match’: first use ‘match’ method to equalize sky values between images and then find a minimum “global” sky value in all input images.
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#skymethod-global-match-subtract-true">
     4.1 skymethod = ‘global+match’, subtract = True
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#skymatch-global-match-subtract-false">
     4.2 skymatch = global+match, subtract = False
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#check-that-all-output-new-sky-values-are-around-zero-within-a-standard-deviation">
     ** Check that all output (new) sky values are around zero (within a standard deviation)
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id1">
       Notes: ‘global+match’: first use ‘match’ method to equalize sky values between images and then find a minimum “global” sky value in all input images.
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>JWST Pipeline Validation Notebook: skymatch with MIRI</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#table-of-contents">
   Table of Contents
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#introduction">
   Introduction
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#set-up-temporary-directory-and-crds-options">
     Set up temporary directory and CRDS options
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#set-up-import-statements">
     Set up import statements
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#print-pipeline-version-number">
     Print pipeline version number
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#retrieve-data-from-artifactory">
     Retrieve data from Artifactory
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#set-up-association-files">
     Set up association files
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#modify-average-background-level-of-input-images">
     Modify average background level of input images
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#run-pipeline-steps">
   Run Pipeline steps
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#run-skymatch-step-on-images-with-skymatch-method-local">
   1. Run skymatch step on images with skymatch method = ‘local’
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#run-skymatch-with-sky-match-method-local-subtract-false-match-down-true">
     1.1 Run skymatch with sky match method = local. Subtract = False, match_down = True.
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#skymatch-method-local-subtract-true">
     1.2  Skymatch method = ‘Local’, subtract= True.
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#run-skymatch-for-skymethod-global">
   2. Run skymatch for skymethod = ‘global’.
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#notes-global-compute-a-common-sky-value-for-all-input-image-and-groups-of-images-in-this-setting-match-will-compute-sky-values-for-each-input-image-group-find-the-minimum-sky-value-and-then-it-will-set-and-or-subtract-sky-value-of-each-input-image-to-this-minimum-value-this-method-may-be-useful-when-input-images-have-been-already-matched-the-global-method-computes-the-minimum-sky-value-across-all-input-images-and-or-groups-that-sky-value-is-then-considered-to-be-the-background-in-all-input-images">
     Notes: ‘global’: compute a common sky value for all input image and groups of images. In this setting match will compute sky values for each input image/group, find the minimum sky value, and then it will set (and/or subtract) sky value of each input image to this minimum value. This method may be useful when input images have been already matched. The ‘global’ method computes the minimum sky value across all input images and/or groups. That sky value is then considered to be the background in all input images.
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#skymethod-global-with-subtraction-false">
     2.1 skymethod = ‘global’ with subtraction = False
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#skymethod-global-with-subtraction-true">
     2.2 skymethod = ‘global’ with subtraction = True
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#run-tests-on-skymatch-method-match">
   3. Run tests on Skymatch method ‘Match’
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#notes-match-compute-differences-in-sky-values-between-images-and-or-groups-in-pair-wise-common-sky-regions-in-this-case-computed-sky-values-will-be-relative-delta-to-the-sky-computed-in-one-of-the-input-images-whose-sky-value-will-be-set-to-reported-to-be-0-this-case-matches-to-the-lowest-sky-value">
     Notes: ‘match’: compute differences in sky values between images and/or groups in (pair-wise) common sky regions. In this case computed sky values will be relative (delta) to the sky computed in one of the input images whose sky value will be set to (reported to be) 0. This case matches to the lowest sky value.
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#skymethod-match-match-down-true-subtract-true">
     3.1 skymethod = ‘match’, match_down=True, subtract=True
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#check-that-all-output-new-sky-values-are-equal-to-the-lowest-original-sky-value">
     ** Check that all output (new) sky values are equal to the lowest original sky value
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#skymethod-match-match-down-false-subtract-true">
     3.2 skymethod = ‘match’, match_down=False, subtract = True
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#check-that-all-output-new-sky-values-are-equal-to-the-highest-original-sky-value">
     ** Check that all output (new) sky values are equal to the highest original sky value
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#skymethod-match-match-down-true-subtract-false">
     3.3 skymethod = ‘match’, match_down = True, subtract = False
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#test-skymatch-method-global-match">
   4. Test skymatch method ‘global+match’
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#notes-global-match-first-use-match-method-to-equalize-sky-values-between-images-and-then-find-a-minimum-global-sky-value-in-all-input-images">
     Notes: ‘global+match’: first use ‘match’ method to equalize sky values between images and then find a minimum “global” sky value in all input images.
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#skymethod-global-match-subtract-true">
     4.1 skymethod = ‘global+match’, subtract = True
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#skymatch-global-match-subtract-false">
     4.2 skymatch = global+match, subtract = False
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#check-that-all-output-new-sky-values-are-around-zero-within-a-standard-deviation">
     ** Check that all output (new) sky values are around zero (within a standard deviation)
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id1">
       Notes: ‘global+match’: first use ‘match’ method to equalize sky values between images and then find a minimum “global” sky value in all input images.
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <p><a id="title_ID"></a></p>
<section class="tex2jax_ignore mathjax_ignore" id="jwst-pipeline-validation-notebook-skymatch-with-miri">
<h1>JWST Pipeline Validation Notebook: skymatch with MIRI<a class="headerlink" href="#jwst-pipeline-validation-notebook-skymatch-with-miri" title="Permalink to this headline">#</a></h1>
<p><span style="color:red"> <strong>Instruments Affected</strong></span>: MIRI, NIRCam</p>
<p>Tested on MIRI Simulated data</p>
<section id="table-of-contents">
<h2>Table of Contents<a class="headerlink" href="#table-of-contents" title="Permalink to this headline">#</a></h2>
<div style="text-align: left"> 
<p><br>  <a class="reference external" href="#intro_ID">Introduction</a> <br> <a class="reference external" href="#imports_ID">Imports</a> <br> <a class="reference external" href="#associations_ID">Set up association files</a> <br> <a class="reference external" href="#outliers_ID">Insert outliers</a> <br> <a class="reference external" href="#pipeline_ID">Run Pipeline</a></p>
</div><p><a id="intro_ID"></a></p>
</section>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">#</a></h2>
<p>This notebook processes level 2 images through the calwebb_image3 skymatch and resample steps and examines outputs for different sky method parameters.</p>
<ol class="simple">
<li><p>Set up data path and image list file.</p></li>
<li><p>Set up association files.</p></li>
<li><p>Modify average backgrould level of input images.</p></li>
<li><p>Run skymatch step on images.</p></li>
<li><p>Run skymatch and resample for each skymethod parameter (local, global, match, global+match).</p></li>
<li><p>Testing other parameters (nclip, usigma, lsigma, lower, upper, skystat). (Still TBD.)</p></li>
</ol>
<p>These steps are set up with simulated MIRI F560W data of the LMC astrometric field. The notebook removes the astrometric field and replaces the field with noise images to help the pipeline testers have a better visualization of what the pipeline is doing with each set of parameters.</p>
<p>This notebook has also been modified to test how skymatch and resample work together (with subtract=True indicating that the subtraction is done in the skymatch step and subtract=False indicating that the subtraction is done in the resample step). There are displays of the combined noise image to see how well the backgrounds were subtracted in the full combined image.</p>
<p>The pipeline documentation can be found here: <a class="reference external" href="https://jwst-pipeline.readthedocs.io/en/latest/jwst/skymatch/README.html">https://jwst-pipeline.readthedocs.io/en/latest/jwst/skymatch/README.html</a></p>
<p>The pipeline code is available on GitHub: <a class="reference external" href="https://github.com/spacetelescope/jwst/tree/master/jwst/skymatch">https://github.com/spacetelescope/jwst/tree/master/jwst/skymatch</a></p>
<p>Authors: T. Temim and M. Cracraft
Last modified: 01/18/2022</p>
<section id="set-up-temporary-directory-and-crds-options">
<h3>Set up temporary directory and CRDS options<a class="headerlink" href="#set-up-temporary-directory-and-crds-options" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a temporary directory to hold notebook output, and change the working directory to that directory.</span>
<span class="kn">from</span> <span class="nn">tempfile</span> <span class="kn">import</span> <span class="n">TemporaryDirectory</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="n">data_dir</span> <span class="o">=</span> <span class="n">TemporaryDirectory</span><span class="p">()</span>
<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">data_dir</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set up CRDS options</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="k">if</span> <span class="s2">&quot;CRDS_CACHE_TYPE&quot;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;CRDS_CACHE_TYPE&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;local&#39;</span><span class="p">:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;CRDS_PATH&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;HOME&#39;</span><span class="p">],</span> <span class="s1">&#39;crds&#39;</span><span class="p">,</span> <span class="s1">&#39;cache&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;CRDS_CACHE_TYPE&#39;</span><span class="p">]):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;CRDS_PATH&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;CRDS_CACHE_TYPE&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p><a id="imports_ID"></a></p>
</section>
<section id="set-up-import-statements">
<h3>Set up import statements<a class="headerlink" href="#set-up-import-statements" title="Permalink to this headline">#</a></h3>
<p>The following packages are needed to run this notebook:</p>
<ul class="simple">
<li><p>jwst to run the pipeline</p></li>
<li><p>matplotlib to plot</p></li>
<li><p>ci_watson to retrieve data from artifactory</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pytest</span>
<span class="kn">from</span> <span class="nn">astropy.io</span> <span class="kn">import</span> <span class="n">fits</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">jwst</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">from</span> <span class="nn">jwst.skymatch</span> <span class="kn">import</span> <span class="n">skymatch</span>
<span class="kn">from</span> <span class="nn">jwst.resample</span> <span class="kn">import</span> <span class="n">ResampleStep</span>
<span class="kn">from</span> <span class="nn">jwst.pipeline</span> <span class="kn">import</span> <span class="n">Image3Pipeline</span>
<span class="kn">from</span> <span class="nn">jwst.skymatch.skyimage</span> <span class="kn">import</span> <span class="n">SkyImage</span>
<span class="kn">from</span> <span class="nn">jwst.associations.lib.rules_level3_base</span> <span class="kn">import</span> <span class="n">DMS_Level3_Base</span>
<span class="kn">from</span> <span class="nn">jwst.associations</span> <span class="kn">import</span> <span class="n">asn_from_list</span>
<span class="kn">from</span> <span class="nn">jwst</span> <span class="kn">import</span> <span class="n">datamodels</span>
<span class="kn">from</span> <span class="nn">jwst.datamodels</span> <span class="kn">import</span> <span class="n">ImageModel</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">rcParams</span>
<span class="kn">from</span> <span class="nn">ci_watson.artifactory_helpers</span> <span class="kn">import</span> <span class="n">get_bigdata</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="print-pipeline-version-number">
<h3>Print pipeline version number<a class="headerlink" href="#print-pipeline-version-number" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">jwst</span><span class="o">.</span><span class="n">__version__</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;1.7.2&#39;
</pre></div>
</div>
</div>
</div>
</section>
<section id="retrieve-data-from-artifactory">
<h3>Retrieve data from Artifactory<a class="headerlink" href="#retrieve-data-from-artifactory" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">input_file1</span> <span class="o">=</span> <span class="n">get_bigdata</span><span class="p">(</span><span class="s1">&#39;jwst_validation_notebooks&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;validation_data&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;outlier_detection&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;outlier_detection_miri_test&#39;</span><span class="p">,</span> 
                     <span class="s1">&#39;det_image_seq1_MIRIMAGE_F560Wexp1_cal.fits&#39;</span><span class="p">)</span>
<span class="n">input_file2</span> <span class="o">=</span> <span class="n">get_bigdata</span><span class="p">(</span><span class="s1">&#39;jwst_validation_notebooks&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;validation_data&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;outlier_detection&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;outlier_detection_miri_test&#39;</span><span class="p">,</span> 
                     <span class="s1">&#39;det_image_seq2_MIRIMAGE_F560Wexp1_cal.fits&#39;</span><span class="p">)</span>
<span class="n">input_file3</span> <span class="o">=</span> <span class="n">get_bigdata</span><span class="p">(</span><span class="s1">&#39;jwst_validation_notebooks&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;validation_data&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;outlier_detection&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;outlier_detection_miri_test&#39;</span><span class="p">,</span> 
                     <span class="s1">&#39;det_image_seq3_MIRIMAGE_F560Wexp1_cal.fits&#39;</span><span class="p">)</span>
<span class="n">input_file4</span> <span class="o">=</span> <span class="n">get_bigdata</span><span class="p">(</span><span class="s1">&#39;jwst_validation_notebooks&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;validation_data&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;outlier_detection&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;outlier_detection_miri_test&#39;</span><span class="p">,</span> 
                     <span class="s1">&#39;det_image_seq4_MIRIMAGE_F560Wexp1_cal.fits&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">BigdataError</span><span class="g g-Whitespace">                              </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">input_file1</span> <span class="o">=</span> <span class="n">get_bigdata</span><span class="p">(</span><span class="s1">&#39;jwst_validation_notebooks&#39;</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span>                      <span class="s1">&#39;validation_data&#39;</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span>                      <span class="s1">&#39;outlier_detection&#39;</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span>                      <span class="s1">&#39;outlier_detection_miri_test&#39;</span><span class="p">,</span> 
<span class="g g-Whitespace">      </span><span class="mi">5</span>                      <span class="s1">&#39;det_image_seq1_MIRIMAGE_F560Wexp1_cal.fits&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span> <span class="n">input_file2</span> <span class="o">=</span> <span class="n">get_bigdata</span><span class="p">(</span><span class="s1">&#39;jwst_validation_notebooks&#39;</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span>                      <span class="s1">&#39;validation_data&#39;</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">8</span>                      <span class="s1">&#39;outlier_detection&#39;</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">9</span>                      <span class="s1">&#39;outlier_detection_miri_test&#39;</span><span class="p">,</span> 
<span class="g g-Whitespace">     </span><span class="mi">10</span>                      <span class="s1">&#39;det_image_seq2_MIRIMAGE_F560Wexp1_cal.fits&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">11</span> <span class="n">input_file3</span> <span class="o">=</span> <span class="n">get_bigdata</span><span class="p">(</span><span class="s1">&#39;jwst_validation_notebooks&#39;</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">12</span>                      <span class="s1">&#39;validation_data&#39;</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">13</span>                      <span class="s1">&#39;outlier_detection&#39;</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">14</span>                      <span class="s1">&#39;outlier_detection_miri_test&#39;</span><span class="p">,</span> 
<span class="g g-Whitespace">     </span><span class="mi">15</span>                      <span class="s1">&#39;det_image_seq3_MIRIMAGE_F560Wexp1_cal.fits&#39;</span><span class="p">)</span>

<span class="nn">File /usr/share/miniconda/lib/python3.9/site-packages/ci_watson/artifactory_helpers.py:200,</span> in <span class="ni">get_bigdata</span><span class="nt">(docopy, timeout, chunk_size, *args)</span>
<span class="g g-Whitespace">    </span><span class="mi">164</span> <span class="k">def</span> <span class="nf">get_bigdata</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">docopy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">TIMEOUT</span><span class="p">,</span> <span class="n">chunk_size</span><span class="o">=</span><span class="n">CHUNK_SIZE</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">165</span>     <span class="sd">&quot;&quot;&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">166</span><span class="sd">     Acquire requested data from a managed resource</span>
<span class="g g-Whitespace">    </span><span class="mi">167</span><span class="sd">     to the current directory.</span>
<span class="sd">   (...)</span>
<span class="g g-Whitespace">    </span><span class="mi">198</span><span class="sd"> </span>
<span class="g g-Whitespace">    </span><span class="mi">199</span><span class="sd">     &quot;&quot;&quot;</span>
<span class="ne">--&gt; </span><span class="mi">200</span>     <span class="n">src</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">get_bigdata_root</span><span class="p">(),</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">201</span>     <span class="n">src_exists</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">src</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">202</span>     <span class="n">src_is_url</span> <span class="o">=</span> <span class="n">check_url</span><span class="p">(</span><span class="n">src</span><span class="p">)</span>

<span class="nn">File /usr/share/miniconda/lib/python3.9/site-packages/ci_watson/artifactory_helpers.py:153,</span> in <span class="ni">get_bigdata_root</span><span class="nt">(envkey)</span>
<span class="g g-Whitespace">    </span><span class="mi">141</span> <span class="sd">&quot;&quot;&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">142</span><span class="sd"> Find and returns the path to the nearest big datasets.</span>
<span class="g g-Whitespace">    </span><span class="mi">143</span><span class="sd"> </span>
<span class="sd">   (...)</span>
<span class="g g-Whitespace">    </span><span class="mi">150</span><span class="sd"> </span>
<span class="g g-Whitespace">    </span><span class="mi">151</span><span class="sd"> &quot;&quot;&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">152</span> <span class="k">if</span> <span class="n">envkey</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">153</span>     <span class="k">raise</span> <span class="n">BigdataError</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">154</span>         <span class="s1">&#39;Environment variable </span><span class="si">{}</span><span class="s1"> is undefined&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">envkey</span><span class="p">))</span>
<span class="g g-Whitespace">    </span><span class="mi">156</span> <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="n">envkey</span><span class="p">]</span>
<span class="g g-Whitespace">    </span><span class="mi">158</span> <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="ow">or</span> <span class="n">check_url</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>

<span class="ne">BigdataError</span>: Environment variable TEST_BIGDATA is undefined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">input_files</span><span class="o">=</span><span class="p">[]</span>
<span class="n">input_files</span><span class="o">=</span><span class="p">[</span><span class="n">input_file1</span><span class="p">,</span><span class="n">input_file2</span><span class="p">,</span><span class="n">input_file3</span><span class="p">,</span><span class="n">input_file4</span><span class="p">]</span>

<span class="n">imlist1</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;det_image_seq1_MIRIMAGE_F560Wexp1_cal.fits&#39;</span><span class="p">,</span><span class="s1">&#39;det_image_seq2_MIRIMAGE_F560Wexp1_cal.fits&#39;</span><span class="p">,</span><span class="s1">&#39;det_image_seq3_MIRIMAGE_F560Wexp1_cal.fits&#39;</span><span class="p">,</span><span class="s1">&#39;det_image_seq4_MIRIMAGE_F560Wexp1_cal.fits&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Look at one image</span>
<span class="n">im_file</span> <span class="o">=</span> <span class="n">ImageModel</span><span class="p">(</span><span class="s1">&#39;det_image_seq1_MIRIMAGE_F560Wexp1_cal.fits&#39;</span><span class="p">)</span>

<span class="c1"># read in ecsv photom file</span>
<span class="kn">from</span> <span class="nn">astropy.visualization</span> <span class="kn">import</span> <span class="n">LogStretch</span><span class="p">,</span> <span class="n">PercentileInterval</span><span class="p">,</span> <span class="n">ManualInterval</span>

<span class="c1">#viz2 = LogStretch() + ManualInterval(0,10)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>
<span class="c1">#plt.imshow(viz2(im_file.data), origin=&#39;lower&#39;)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">im_file</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;rainbow&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.colorbar.Colorbar at 0x7fed61598bb0&gt;
</pre></div>
</div>
<img alt="../../../_images/exec_jwst_skymatch_miri_test_12_1.png" src="../../../_images/exec_jwst_skymatch_miri_test_12_1.png" />
</div>
</div>
<p><a id="associations_ID"></a></p>
</section>
<section id="set-up-association-files">
<h3>Set up association files<a class="headerlink" href="#set-up-association-files" title="Permalink to this headline">#</a></h3>
<p>The level three pipeline relies on an association file to specify which files are to be combined and provide the output file name.</p>
<p><a class="reference external" href="#title_ID">Top of Page</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># use asn_from_list to create association table</span>
<span class="n">cal_list</span><span class="o">=</span><span class="n">imlist1</span>
<span class="n">asn</span> <span class="o">=</span> <span class="n">asn_from_list</span><span class="o">.</span><span class="n">asn_from_list</span><span class="p">(</span><span class="n">cal_list</span><span class="p">,</span> <span class="n">rule</span><span class="o">=</span><span class="n">DMS_Level3_Base</span><span class="p">,</span> <span class="n">product_name</span><span class="o">=</span><span class="s1">&#39;skymatch_combined.fits&#39;</span><span class="p">)</span>

<span class="c1"># use this if you need to add non&#39;science&#39; exposure types</span>
<span class="c1">#asn[&#39;products&#39;][0][&#39;members&#39;][1][&#39;exptype&#39;] = &#39;background&#39;</span>
<span class="c1">#asn[&#39;products&#39;][0][&#39;members&#39;][2][&#39;exptype&#39;] = &#39;sourcecat&#39;</span>

<span class="c1"># dump association table to a .json file for use in image3</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;skymatch_asnfile.json&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
    <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">asn</span><span class="o">.</span><span class="n">dump</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>

<span class="n">skymatch_json_file</span><span class="o">=</span><span class="s1">&#39;skymatch_asnfile.json&#39;</span>
    
<span class="n">json_file</span> <span class="o">=</span> <span class="n">skymatch_json_file</span>
<span class="n">file_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">file_list2</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">json_file</span><span class="p">)</span> <span class="k">as</span> <span class="n">json_data</span><span class="p">:</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">json_data</span><span class="p">)</span>
    <span class="n">members</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;products&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;members&#39;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">members</span><span class="p">)):</span>
        <span class="n">file_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">members</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="s1">&#39;expname&#39;</span><span class="p">])</span>
        <span class="n">file_list2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">members</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="s1">&#39;expname&#39;</span><span class="p">][:</span><span class="o">-</span><span class="mi">5</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;_skymatch.fits&quot;</span><span class="p">)</span>

    
<span class="n">asn2</span> <span class="o">=</span> <span class="n">asn_from_list</span><span class="o">.</span><span class="n">asn_from_list</span><span class="p">(</span><span class="n">file_list2</span><span class="p">,</span> <span class="n">rule</span><span class="o">=</span><span class="n">DMS_Level3_Base</span><span class="p">,</span> <span class="n">product_name</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;products&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>

<span class="c1"># use this if you need to add non&#39;science&#39; exposure types</span>
<span class="c1">#asn[&#39;products&#39;][0][&#39;members&#39;][1][&#39;exptype&#39;] = &#39;background&#39;</span>
<span class="c1">#asn[&#39;products&#39;][0][&#39;members&#39;][2][&#39;exptype&#39;] = &#39;sourcecat&#39;</span>

<span class="c1"># dump association table to a .json file for use in image3</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;skymatch_asnfile2.json&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
    <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">asn2</span><span class="o">.</span><span class="n">dump</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>
    
<span class="n">skymatch_json_file2</span><span class="o">=</span><span class="s1">&#39;skymatch_asnfile2.json&#39;</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="modify-average-background-level-of-input-images">
<h3>Modify average background level of input images<a class="headerlink" href="#modify-average-background-level-of-input-images" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">infile01_1</span> <span class="o">=</span> <span class="n">input_files</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">infile01_2</span> <span class="o">=</span> <span class="n">input_files</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">infile02_1</span> <span class="o">=</span> <span class="n">input_files</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="n">infile02_2</span> <span class="o">=</span> <span class="n">input_files</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">img01_1</span> <span class="o">=</span> <span class="n">datamodels</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">infile01_1</span><span class="p">)</span>
<span class="n">img01_2</span> <span class="o">=</span> <span class="n">datamodels</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">infile01_2</span><span class="p">)</span>
<span class="n">img02_1</span> <span class="o">=</span> <span class="n">datamodels</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">infile02_1</span><span class="p">)</span>
<span class="n">img02_2</span> <span class="o">=</span> <span class="n">datamodels</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">infile02_2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data01_1</span> <span class="o">=</span> <span class="n">img01_1</span><span class="o">.</span><span class="n">data</span>
<span class="n">data01_2</span> <span class="o">=</span> <span class="n">img01_2</span><span class="o">.</span><span class="n">data</span>
<span class="n">data02_1</span> <span class="o">=</span> <span class="n">img02_1</span><span class="o">.</span><span class="n">data</span>
<span class="n">data02_2</span> <span class="o">=</span> <span class="n">img02_2</span><span class="o">.</span><span class="n">data</span>

<span class="n">data01_1</span><span class="p">[</span><span class="n">data01_1</span><span class="o">&lt;=</span><span class="mf">0.3</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<span class="n">data01_2</span><span class="p">[</span><span class="n">data01_2</span><span class="o">&lt;=</span><span class="mf">0.3</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<span class="n">data02_1</span><span class="p">[</span><span class="n">data02_1</span><span class="o">&lt;=</span><span class="mf">0.3</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<span class="n">data02_2</span><span class="p">[</span><span class="n">data02_2</span><span class="o">&lt;=</span><span class="mf">0.3</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>

<span class="n">data01_1_orig</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">img01_1</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
<span class="n">data01_2_orig</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">img01_2</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
<span class="n">data02_1_orig</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">img02_1</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
<span class="n">data02_2_orig</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">img02_2</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># check mean values of background </span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">data01_1_orig</span><span class="p">[</span><span class="n">data01_1_orig</span><span class="o">&lt;=</span><span class="mf">4.0</span><span class="p">]),</span><span class="s1">&#39; Standard deviation: &#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">data01_1_orig</span><span class="p">[</span><span class="n">data01_1_orig</span><span class="o">&lt;=</span><span class="mf">4.0</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">data01_2_orig</span><span class="p">[</span><span class="n">data01_2_orig</span><span class="o">&lt;=</span><span class="mf">4.0</span><span class="p">]),</span><span class="s1">&#39; Standard deviation: &#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">data01_2_orig</span><span class="p">[</span><span class="n">data01_2_orig</span><span class="o">&lt;=</span><span class="mf">4.0</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">data02_1_orig</span><span class="p">[</span><span class="n">data02_1_orig</span><span class="o">&lt;=</span><span class="mf">4.0</span><span class="p">]),</span><span class="s1">&#39; Standard deviation: &#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">data02_1_orig</span><span class="p">[</span><span class="n">data02_1_orig</span><span class="o">&lt;=</span><span class="mf">4.0</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">data02_2_orig</span><span class="p">[</span><span class="n">data02_2_orig</span><span class="o">&lt;=</span><span class="mf">4.0</span><span class="p">]),</span><span class="s1">&#39; Standard deviation: &#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">data02_2_orig</span><span class="p">[</span><span class="n">data02_2_orig</span><span class="o">&lt;=</span><span class="mf">4.0</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Mean: 0.93090874  Standard deviation:  0.1817127
Mean: 0.9362799  Standard deviation:  0.17500266
Mean: 0.9330347  Standard deviation:  0.17194116
Mean: 0.93216574  Standard deviation:  0.16481434
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># creating a background image with specified mean and gaussian noise with sigma = 1.0</span>
<span class="n">bkg_img_noise_neg2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="mf">0.2</span><span class="p">,</span><span class="n">data01_1</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">bkg_img_noise_2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="mf">0.2</span><span class="p">,</span><span class="n">data01_1</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">bkg_img_noise_3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="o">*</span><span class="mf">0.2</span><span class="p">,</span><span class="n">data01_1</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">bkg_img_noise_4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="o">*</span><span class="mf">0.2</span><span class="p">,</span><span class="n">data01_1</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">bkg_img_noise_5</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="o">*</span><span class="mf">0.2</span><span class="p">,</span><span class="n">data01_1</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">bkg_img_noise_7</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">7</span><span class="o">*</span><span class="mf">0.2</span><span class="p">,</span><span class="n">data01_1</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Replace the images with a noise image for easier background visualization</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># adding the new background with specified mean and gaussian noise (above) to image (This overwrites, not adds.)</span>
<span class="n">img01_1</span><span class="o">.</span><span class="n">data</span><span class="o">=</span><span class="n">bkg_img_noise_2</span>
<span class="n">img01_2</span><span class="o">.</span><span class="n">data</span><span class="o">=</span><span class="n">bkg_img_noise_3</span>
<span class="n">img02_1</span><span class="o">.</span><span class="n">data</span><span class="o">=</span><span class="n">bkg_img_noise_5</span>
<span class="n">img02_2</span><span class="o">.</span><span class="n">data</span><span class="o">=</span><span class="n">bkg_img_noise_2</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># checking the mean and standard deviations of the new background values</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">img01_1</span><span class="o">.</span><span class="n">data</span><span class="p">),</span><span class="s1">&#39; Standard deviation: &#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nanstd</span><span class="p">(</span><span class="n">img01_1</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">img01_2</span><span class="o">.</span><span class="n">data</span><span class="p">),</span><span class="s1">&#39; Standard deviation: &#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nanstd</span><span class="p">(</span><span class="n">img01_2</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">img02_1</span><span class="o">.</span><span class="n">data</span><span class="p">),</span><span class="s1">&#39; Standard deviation: &#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nanstd</span><span class="p">(</span><span class="n">img02_1</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">img02_2</span><span class="o">.</span><span class="n">data</span><span class="p">),</span><span class="s1">&#39; Standard deviation: &#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nanstd</span><span class="p">(</span><span class="n">img02_2</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Mean: 2.0004356  Standard deviation:  0.40004626
Mean: 2.9994354  Standard deviation:  0.60030234
Mean: 4.9994936  Standard deviation:  0.999521
Mean: 2.0004356  Standard deviation:  0.40004626
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">img01_1</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">file_list2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">img01_2</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">file_list2</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">img02_1</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">file_list2</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">img02_2</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">file_list2</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;det_image_seq4_MIRIMAGE_F560Wexp1_cal_skymatch.fits&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Look at one image</span>
<span class="n">im_file</span> <span class="o">=</span> <span class="n">ImageModel</span><span class="p">(</span><span class="n">file_list2</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="c1"># read in ecsv photom file</span>
<span class="kn">from</span> <span class="nn">astropy.visualization</span> <span class="kn">import</span> <span class="n">LogStretch</span><span class="p">,</span> <span class="n">PercentileInterval</span><span class="p">,</span> <span class="n">ManualInterval</span>

<span class="c1">#viz2 = LogStretch() + ManualInterval(0,10)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>
<span class="c1">#plt.imshow(viz2(im_file.data), origin=&#39;lower&#39;)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">im_file</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;rainbow&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.colorbar.Colorbar at 0x7fed5e043ac0&gt;
</pre></div>
</div>
<img alt="../../../_images/exec_jwst_skymatch_miri_test_25_1.png" src="../../../_images/exec_jwst_skymatch_miri_test_25_1.png" />
</div>
</div>
<p><a id="pipeline_ID"></a></p>
</section>
</section>
<section id="run-pipeline-steps">
<h2>Run Pipeline steps<a class="headerlink" href="#run-pipeline-steps" title="Permalink to this headline">#</a></h2>
<p>Run the pipeline on the data for different sets of parameters</p>
</section>
<section id="run-skymatch-step-on-images-with-skymatch-method-local">
<h2>1. Run skymatch step on images with skymatch method = ‘local’<a class="headerlink" href="#run-skymatch-step-on-images-with-skymatch-method-local" title="Permalink to this headline">#</a></h2>
<p>Notes: ‘local’: compute sky background values of each input image or group of images (members of the same “exposure”). A single sky value is computed for each group of images. This method simply computes the mean/median/mode/etc. value of the “sky” separately in each input image. This will resulted in subtracted background being near zero in the combined image, as each image has it’s individual background subtracted.</p>
<p>match_down specifies whether the sky differences should be subtracted from images with higher sky values (match_down = True) in order to match the image with the lowest sky or sky differences should be added to the images with lower sky values to match the sky of the image with the highest sky value (match_down = False). (Default = True)</p>
<p>‘Subtract’ specifies whether the computed sky background values are to be subtracted from the images in the skymatch step. (Default = False) Currently, if not done in skymatch, the subtraction is performed in resample.</p>
<section id="run-skymatch-with-sky-match-method-local-subtract-false-match-down-true">
<h3>1.1 Run skymatch with sky match method = local. Subtract = False, match_down = True.<a class="headerlink" href="#run-skymatch-with-sky-match-method-local-subtract-false-match-down-true" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># skymatch, local, subtract= False, all 4 images used</span>
<span class="c1">#jwst.skymatch.skymatch_step.SkyMatchStep.call(skymatch_json_file2, skymethod=&#39;local&#39;, subtract=False,output_file=&#39;MIRI&#39;,save_results=True)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Test running just skymatch and resample and skiping other steps.</span>

<span class="c1"># Run Calwebb_image3 on the association table</span>
    
<span class="c1"># set any specific parameters</span>
<span class="n">skymethod</span> <span class="o">=</span> <span class="s1">&#39;local&#39;</span> <span class="c1"># sky computation algorithm to be used. Allowed values: {local, global, match, global+match} (Default = global+match</span>
<span class="n">match_down</span> <span class="o">=</span> <span class="kc">True</span> <span class="c1"># Specifies whether the sky differences should be subtracted from images with higher sky values (match_down = True) in order to match the image with the lowest sky or sky differences should be added to the images with lower sky values to match the sky of the image with the highest sky value (match_down = False). (Default = True</span>
<span class="n">subtract</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1"># Specifies whether the computed sky background values are to be subtracted from the images. (Default = False   </span>
    
<span class="n">pipe3</span><span class="o">=</span><span class="n">Image3Pipeline</span><span class="p">()</span>    
<span class="n">pipe3</span><span class="o">.</span><span class="n">tweakreg</span><span class="o">.</span><span class="n">skip</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">outlier_detection</span><span class="o">.</span><span class="n">skip</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">source_catalog</span><span class="o">.</span><span class="n">skip</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">pipe3</span><span class="o">.</span><span class="n">skymatch</span><span class="o">.</span><span class="n">skymethod</span> <span class="o">=</span> <span class="n">skymethod</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">skymatch</span><span class="o">.</span><span class="n">match_down</span> <span class="o">=</span> <span class="n">match_down</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">skymatch</span><span class="o">.</span><span class="n">subtract</span> <span class="o">=</span> <span class="n">subtract</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">skymatch</span><span class="o">.</span><span class="n">output_file</span> <span class="o">=</span> <span class="s1">&#39;MIRI&#39;</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">skymatch</span><span class="o">.</span><span class="n">save_results</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">pipe3</span><span class="o">.</span><span class="n">resample</span><span class="o">.</span><span class="n">save_results</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">pipe3</span><span class="o">.</span><span class="n">save_results</span> <span class="o">=</span> <span class="kc">True</span>

<span class="c1"># run Image3</span>

<span class="n">image</span> <span class="o">=</span> <span class="n">pipe3</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">skymatch_json_file2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Image 3 pipeline finished.&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:03,721 - stpipe.Image3Pipeline - INFO - Image3Pipeline instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:03,723 - stpipe.Image3Pipeline.assign_mtwcs - INFO - AssignMTWcsStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:03,725 - stpipe.Image3Pipeline.tweakreg - INFO - TweakRegStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:03,727 - stpipe.Image3Pipeline.skymatch - INFO - SkyMatchStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:03,730 - stpipe.Image3Pipeline.outlier_detection - INFO - OutlierDetectionStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:03,732 - stpipe.Image3Pipeline.resample - INFO - ResampleStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:03,734 - stpipe.Image3Pipeline.source_catalog - INFO - SourceCatalogStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:03,855 - stpipe.Image3Pipeline - INFO - Step Image3Pipeline running with args (&#39;skymatch_asnfile2.json&#39;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:03,862 - stpipe.Image3Pipeline - INFO - Step Image3Pipeline parameters are: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: None, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: False, &#39;output_use_index&#39;: True, &#39;save_results&#39;: True, &#39;skip&#39;: False, &#39;suffix&#39;: None, &#39;search_output_file&#39;: True, &#39;input_dir&#39;: &#39;&#39;, &#39;steps&#39;: {&#39;assign_mtwcs&#39;: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: None, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: True, &#39;output_use_index&#39;: True, &#39;save_results&#39;: False, &#39;skip&#39;: False, &#39;suffix&#39;: &#39;assign_mtwcs&#39;, &#39;search_output_file&#39;: True, &#39;input_dir&#39;: &#39;&#39;}, &#39;tweakreg&#39;: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: None, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: True, &#39;output_use_index&#39;: True, &#39;save_results&#39;: False, &#39;skip&#39;: True, &#39;suffix&#39;: None, &#39;search_output_file&#39;: True, &#39;input_dir&#39;: &#39;&#39;, &#39;save_catalogs&#39;: False, &#39;catalog_format&#39;: &#39;ecsv&#39;, &#39;kernel_fwhm&#39;: 2.5, &#39;snr_threshold&#39;: 10.0, &#39;brightest&#39;: 200, &#39;peakmax&#39;: None, &#39;enforce_user_order&#39;: False, &#39;expand_refcat&#39;: False, &#39;minobj&#39;: 15, &#39;searchrad&#39;: 2.0, &#39;use2dhist&#39;: True, &#39;separation&#39;: 1.0, &#39;tolerance&#39;: 0.7, &#39;xoffset&#39;: 0.0, &#39;yoffset&#39;: 0.0, &#39;fitgeometry&#39;: &#39;rshift&#39;, &#39;nclip&#39;: 3, &#39;sigma&#39;: 3.0, &#39;align_to_gaia&#39;: False, &#39;gaia_catalog&#39;: &#39;GAIADR2&#39;, &#39;min_gaia&#39;: 5, &#39;save_gaia_catalog&#39;: False}, &#39;skymatch&#39;: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: &#39;/internal/data1/jenkins/workspace/Notebooks/jwst_validation_notebooks_spacetelescope/tmp/tmpt_z84t1b/MIRI&#39;, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: False, &#39;output_use_index&#39;: True, &#39;save_results&#39;: True, &#39;skip&#39;: False, &#39;suffix&#39;: None, &#39;search_output_file&#39;: True, &#39;input_dir&#39;: &#39;&#39;, &#39;skymethod&#39;: &#39;local&#39;, &#39;match_down&#39;: True, &#39;subtract&#39;: False, &#39;stepsize&#39;: None, &#39;skystat&#39;: &#39;mode&#39;, &#39;dqbits&#39;: &#39;~DO_NOT_USE+NON_SCIENCE&#39;, &#39;lower&#39;: None, &#39;upper&#39;: None, &#39;nclip&#39;: 5, &#39;lsigma&#39;: 4.0, &#39;usigma&#39;: 4.0, &#39;binwidth&#39;: 0.1}, &#39;outlier_detection&#39;: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: None, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: False, &#39;output_use_index&#39;: True, &#39;save_results&#39;: False, &#39;skip&#39;: True, &#39;suffix&#39;: None, &#39;search_output_file&#39;: False, &#39;input_dir&#39;: &#39;&#39;, &#39;weight_type&#39;: &#39;ivm&#39;, &#39;pixfrac&#39;: 1.0, &#39;kernel&#39;: &#39;square&#39;, &#39;fillval&#39;: &#39;INDEF&#39;, &#39;nlow&#39;: 0, &#39;nhigh&#39;: 0, &#39;maskpt&#39;: 0.7, &#39;grow&#39;: 1, &#39;snr&#39;: &#39;5.0 4.0&#39;, &#39;scale&#39;: &#39;1.2 0.7&#39;, &#39;backg&#39;: 0.0, &#39;save_intermediate_results&#39;: False, &#39;resample_data&#39;: True, &#39;good_bits&#39;: &#39;~DO_NOT_USE&#39;, &#39;scale_detection&#39;: False, &#39;allowed_memory&#39;: None}, &#39;resample&#39;: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: None, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: False, &#39;output_use_index&#39;: True, &#39;save_results&#39;: True, &#39;skip&#39;: False, &#39;suffix&#39;: None, &#39;search_output_file&#39;: True, &#39;input_dir&#39;: &#39;&#39;, &#39;pixfrac&#39;: 1.0, &#39;kernel&#39;: &#39;square&#39;, &#39;fillval&#39;: &#39;INDEF&#39;, &#39;weight_type&#39;: &#39;ivm&#39;, &#39;output_shape&#39;: None, &#39;crpix&#39;: None, &#39;crval&#39;: None, &#39;rotation&#39;: None, &#39;pixel_scale_ratio&#39;: 1.0, &#39;pixel_scale&#39;: None, &#39;single&#39;: False, &#39;blendheaders&#39;: True, &#39;allowed_memory&#39;: None}, &#39;source_catalog&#39;: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: None, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: False, &#39;output_use_index&#39;: True, &#39;save_results&#39;: False, &#39;skip&#39;: True, &#39;suffix&#39;: &#39;cat&#39;, &#39;search_output_file&#39;: True, &#39;input_dir&#39;: &#39;&#39;, &#39;bkg_boxsize&#39;: 100, &#39;kernel_fwhm&#39;: 2.0, &#39;snr_threshold&#39;: 3.0, &#39;npixels&#39;: 5, &#39;deblend&#39;: False, &#39;aperture_ee1&#39;: 30, &#39;aperture_ee2&#39;: 50, &#39;aperture_ee3&#39;: 70, &#39;ci1_star_threshold&#39;: 2.0, &#39;ci2_star_threshold&#39;: 1.8}}}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:04,018 - stpipe.Image3Pipeline - INFO - Prefetching reference files for dataset: &#39;det_image_seq1_MIRIMAGE_F560Wexp1_cal_skymatch.fits&#39; reftypes = [&#39;drizpars&#39;]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:04,269 - stpipe.Image3Pipeline - INFO - Prefetch for DRIZPARS reference file is &#39;/grp/crds/cache/references/jwst/jwst_miri_drizpars_0001.fits&#39;.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:04,272 - stpipe.Image3Pipeline - INFO - Starting calwebb_image3 ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:04,953 - stpipe.Image3Pipeline.tweakreg - INFO - Step tweakreg running with args (&lt;ModelContainer&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:04,956 - stpipe.Image3Pipeline.tweakreg - INFO - Step tweakreg parameters are: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: None, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: True, &#39;output_use_index&#39;: True, &#39;save_results&#39;: False, &#39;skip&#39;: True, &#39;suffix&#39;: None, &#39;search_output_file&#39;: True, &#39;input_dir&#39;: &#39;&#39;, &#39;save_catalogs&#39;: False, &#39;catalog_format&#39;: &#39;ecsv&#39;, &#39;kernel_fwhm&#39;: 2.5, &#39;snr_threshold&#39;: 10.0, &#39;brightest&#39;: 200, &#39;peakmax&#39;: None, &#39;enforce_user_order&#39;: False, &#39;expand_refcat&#39;: False, &#39;minobj&#39;: 15, &#39;searchrad&#39;: 2.0, &#39;use2dhist&#39;: True, &#39;separation&#39;: 1.0, &#39;tolerance&#39;: 0.7, &#39;xoffset&#39;: 0.0, &#39;yoffset&#39;: 0.0, &#39;fitgeometry&#39;: &#39;rshift&#39;, &#39;nclip&#39;: 3, &#39;sigma&#39;: 3.0, &#39;align_to_gaia&#39;: False, &#39;gaia_catalog&#39;: &#39;GAIADR2&#39;, &#39;min_gaia&#39;: 5, &#39;save_gaia_catalog&#39;: False}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:04,957 - stpipe.Image3Pipeline.tweakreg - INFO - Step skipped.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:04,965 - stpipe.Image3Pipeline.tweakreg - INFO - Step tweakreg done
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:05,103 - stpipe.Image3Pipeline.skymatch - INFO - Step skymatch running with args (&lt;ModelContainer&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:05,107 - stpipe.Image3Pipeline.skymatch - INFO - Step skymatch parameters are: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: &#39;/internal/data1/jenkins/workspace/Notebooks/jwst_validation_notebooks_spacetelescope/tmp/tmpt_z84t1b/MIRI&#39;, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: False, &#39;output_use_index&#39;: True, &#39;save_results&#39;: True, &#39;skip&#39;: False, &#39;suffix&#39;: None, &#39;search_output_file&#39;: True, &#39;input_dir&#39;: &#39;&#39;, &#39;skymethod&#39;: &#39;local&#39;, &#39;match_down&#39;: True, &#39;subtract&#39;: False, &#39;stepsize&#39;: None, &#39;skystat&#39;: &#39;mode&#39;, &#39;dqbits&#39;: &#39;~DO_NOT_USE+NON_SCIENCE&#39;, &#39;lower&#39;: None, &#39;upper&#39;: None, &#39;nclip&#39;: 5, &#39;lsigma&#39;: 4.0, &#39;usigma&#39;: 4.0, &#39;binwidth&#39;: 0.1}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:05,245 - stpipe.Image3Pipeline.skymatch - INFO -  
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:05,246 - stpipe.Image3Pipeline.skymatch - INFO - ***** jwst.skymatch.skymatch.match() started on 2022-07-07 08:10:05.245253
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:05,247 - stpipe.Image3Pipeline.skymatch - INFO -  
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:05,248 - stpipe.Image3Pipeline.skymatch - INFO - Sky computation method: &#39;local&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:05,249 - stpipe.Image3Pipeline.skymatch - INFO - Sky subtraction from image data: OFF
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:05,250 - stpipe.Image3Pipeline.skymatch - INFO -  
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:05,251 - stpipe.Image3Pipeline.skymatch - INFO - ----  Sky values computed per image and/or image groups.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:05,337 - stpipe.Image3Pipeline.skymatch - INFO -    *  Image ID=det_image_seq1_MIRIMAGE_F560Wexp1_cal_skymatch.fits. Sky background: 1.98114
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:05,339 - stpipe.Image3Pipeline.skymatch - INFO -    *  Image ID=det_image_seq2_MIRIMAGE_F560Wexp1_cal_skymatch.fits. Sky background: 2.97636
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:05,340 - stpipe.Image3Pipeline.skymatch - INFO -    *  Image ID=det_image_seq3_MIRIMAGE_F560Wexp1_cal_skymatch.fits. Sky background: 5.01324
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:05,341 - stpipe.Image3Pipeline.skymatch - INFO -    *  Image ID=det_image_seq4_MIRIMAGE_F560Wexp1_cal_skymatch.fits. Sky background: 1.98114
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:05,342 - stpipe.Image3Pipeline.skymatch - INFO -  
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:05,342 - stpipe.Image3Pipeline.skymatch - INFO - ***** jwst.skymatch.skymatch.match() ended on 2022-07-07 08:10:05.342152
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:05,344 - stpipe.Image3Pipeline.skymatch - INFO - ***** jwst.skymatch.skymatch.match() TOTAL RUN TIME: 0:00:00.096899
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:05,344 - stpipe.Image3Pipeline.skymatch - INFO -  
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:05,640 - stpipe.Image3Pipeline.skymatch - INFO - Saved model in MIRI_0_skymatch.fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:05,899 - stpipe.Image3Pipeline.skymatch - INFO - Saved model in MIRI_1_skymatch.fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:06,148 - stpipe.Image3Pipeline.skymatch - INFO - Saved model in MIRI_2_skymatch.fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:06,398 - stpipe.Image3Pipeline.skymatch - INFO - Saved model in MIRI_3_skymatch.fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:06,400 - stpipe.Image3Pipeline.skymatch - INFO - Step skymatch done
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:06,571 - stpipe.Image3Pipeline.outlier_detection - INFO - Step outlier_detection running with args (&lt;ModelContainer&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:06,574 - stpipe.Image3Pipeline.outlier_detection - INFO - Step outlier_detection parameters are: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: None, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: False, &#39;output_use_index&#39;: True, &#39;save_results&#39;: True, &#39;skip&#39;: True, &#39;suffix&#39;: &#39;crf&#39;, &#39;search_output_file&#39;: False, &#39;input_dir&#39;: &#39;&#39;, &#39;weight_type&#39;: &#39;ivm&#39;, &#39;pixfrac&#39;: 1.0, &#39;kernel&#39;: &#39;square&#39;, &#39;fillval&#39;: &#39;INDEF&#39;, &#39;nlow&#39;: 0, &#39;nhigh&#39;: 0, &#39;maskpt&#39;: 0.7, &#39;grow&#39;: 1, &#39;snr&#39;: &#39;5.0 4.0&#39;, &#39;scale&#39;: &#39;1.2 0.7&#39;, &#39;backg&#39;: 0.0, &#39;save_intermediate_results&#39;: False, &#39;resample_data&#39;: True, &#39;good_bits&#39;: &#39;~DO_NOT_USE&#39;, &#39;scale_detection&#39;: False, &#39;allowed_memory&#39;: None}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:06,575 - stpipe.Image3Pipeline.outlier_detection - INFO - Step skipped.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:06,582 - stpipe.Image3Pipeline.outlier_detection - INFO - Step outlier_detection done
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:06,714 - stpipe.Image3Pipeline.resample - INFO - Step resample running with args (&lt;ModelContainer&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:06,716 - stpipe.Image3Pipeline.resample - INFO - Step resample parameters are: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: None, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: False, &#39;output_use_index&#39;: True, &#39;save_results&#39;: True, &#39;skip&#39;: False, &#39;suffix&#39;: &#39;i2d&#39;, &#39;search_output_file&#39;: True, &#39;input_dir&#39;: &#39;&#39;, &#39;pixfrac&#39;: 1.0, &#39;kernel&#39;: &#39;square&#39;, &#39;fillval&#39;: &#39;INDEF&#39;, &#39;weight_type&#39;: &#39;ivm&#39;, &#39;output_shape&#39;: None, &#39;crpix&#39;: None, &#39;crval&#39;: None, &#39;rotation&#39;: None, &#39;pixel_scale_ratio&#39;: 1.0, &#39;pixel_scale&#39;: None, &#39;single&#39;: False, &#39;blendheaders&#39;: True, &#39;allowed_memory&#39;: None}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:06,735 - stpipe.Image3Pipeline.resample - INFO - Drizpars reference file: /grp/crds/cache/references/jwst/jwst_miri_drizpars_0001.fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:06,881 - stpipe.Image3Pipeline.resample - INFO - Blending metadata for skymatch_combined.fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:07,511 - stpipe.Image3Pipeline.resample - INFO - Resampling science data
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:08,117 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:09,070 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:10,017 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:11,143 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:11,522 - stpipe.Image3Pipeline.resample - INFO - Resampling var_rnoise
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:12,114 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:13,262 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:14,349 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:15,431 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:15,805 - stpipe.Image3Pipeline.resample - INFO - Resampling var_poisson
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:16,623 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:17,701 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:18,753 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:19,913 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:20,281 - stpipe.Image3Pipeline.resample - INFO - Resampling var_flat
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:21,064 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:22,224 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:23,319 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:24,428 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:24,823 - stpipe.Image3Pipeline.resample - INFO - Update S_REGION to POLYGON ICRS  0.020232898 -0.018692220 0.023327823 0.016575172 359.989011943 0.019586596 359.985917018 -0.015680796
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:25,313 - stpipe.Image3Pipeline.resample - INFO - Saved model in skymatch_combined_i2d.fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:25,315 - stpipe.Image3Pipeline.resample - INFO - Step resample done
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:25,699 - stpipe.Image3Pipeline.source_catalog - INFO - Step source_catalog running with args (&lt;ImageModel(1149, 1118) from skymatch_combined_i2d.fits&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:25,702 - stpipe.Image3Pipeline.source_catalog - INFO - Step source_catalog parameters are: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: None, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: False, &#39;output_use_index&#39;: True, &#39;save_results&#39;: True, &#39;skip&#39;: True, &#39;suffix&#39;: &#39;cat&#39;, &#39;search_output_file&#39;: True, &#39;input_dir&#39;: &#39;&#39;, &#39;bkg_boxsize&#39;: 100, &#39;kernel_fwhm&#39;: 2.0, &#39;snr_threshold&#39;: 3.0, &#39;npixels&#39;: 5, &#39;deblend&#39;: False, &#39;aperture_ee1&#39;: 30, &#39;aperture_ee2&#39;: 50, &#39;aperture_ee3&#39;: 70, &#39;ci1_star_threshold&#39;: 2.0, &#39;ci2_star_threshold&#39;: 1.8}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:25,704 - stpipe.Image3Pipeline.source_catalog - INFO - Step skipped.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:25,709 - stpipe.Image3Pipeline.source_catalog - INFO - Step source_catalog done
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:25,711 - stpipe.Image3Pipeline - INFO - Step Image3Pipeline done
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Image 3 pipeline finished.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check values out of skymatch step. With subtract = False, values should be equal.</span>

<span class="n">img01_1_new</span> <span class="o">=</span> <span class="n">datamodels</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;MIRI_0_skymatch.fits&#39;</span><span class="p">)</span>
<span class="n">img01_2_new</span> <span class="o">=</span> <span class="n">datamodels</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;MIRI_1_skymatch.fits&#39;</span><span class="p">)</span>
<span class="n">img02_1_new</span> <span class="o">=</span> <span class="n">datamodels</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;MIRI_2_skymatch.fits&#39;</span><span class="p">)</span>
<span class="n">img02_2_new</span> <span class="o">=</span> <span class="n">datamodels</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;MIRI_3_skymatch.fits&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Original and new levels should be equal. If subtract=False, skymatch should not subtract.&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean: original, new (local)&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">img01_1</span><span class="o">.</span><span class="n">data</span><span class="p">),</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">img01_1_new</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">img01_2</span><span class="o">.</span><span class="n">data</span><span class="p">),</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">img01_2_new</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">img02_1</span><span class="o">.</span><span class="n">data</span><span class="p">),</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">img02_1_new</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">img02_2</span><span class="o">.</span><span class="n">data</span><span class="p">),</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">img02_2_new</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Original and new levels should be equal. If subtract=False, skymatch should not subtract.
Mean: original, new (local)
Mean: 2.0004356 , 2.0004356
Mean: 2.9994354 , 2.9994354
Mean: 4.9994936 , 4.9994936
Mean: 2.0004356 , 2.0004356
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Look at combined image</span>
<span class="n">im_file</span> <span class="o">=</span> <span class="n">ImageModel</span><span class="p">(</span><span class="s1">&#39;skymatch_combined_i2d.fits&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The resample step should subtract the individual backgrounds found in the skymatch step.&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Since the local individual background level is subtracted from each image, final expected result is near zero.&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">im_file</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">600</span><span class="p">:</span><span class="mi">700</span><span class="p">,</span><span class="mi">600</span><span class="p">:</span><span class="mi">700</span><span class="p">]))</span>

<span class="c1"># read in ecsv photom file</span>
<span class="kn">from</span> <span class="nn">astropy.visualization</span> <span class="kn">import</span> <span class="n">LogStretch</span><span class="p">,</span> <span class="n">PercentileInterval</span><span class="p">,</span> <span class="n">ManualInterval</span>

<span class="c1">#viz2 = LogStretch() + ManualInterval(0,10)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>
<span class="c1">#plt.imshow(viz2(im_file.data), origin=&#39;lower&#39;)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">im_file</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;rainbow&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The resample step should subtract the individual backgrounds found in the skymatch step.
Since the local individual background level is subtracted from each image, final expected result is near zero.
Mean: 0.015529375
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.colorbar.Colorbar at 0x7fed5c7e55d0&gt;
</pre></div>
</div>
<img alt="../../../_images/exec_jwst_skymatch_miri_test_31_2.png" src="../../../_images/exec_jwst_skymatch_miri_test_31_2.png" />
</div>
</div>
</section>
<section id="skymatch-method-local-subtract-true">
<h3>1.2  Skymatch method = ‘Local’, subtract= True.<a class="headerlink" href="#skymatch-method-local-subtract-true" title="Permalink to this headline">#</a></h3>
<p>Skymatch step should subtract the background. Resample background level should match the skymatch background level since subtraction has already been done</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># skymatch, local, subtract = True, all 4 images used</span>
<span class="c1">#jwst.skymatch.skymatch_step.SkyMatchStep.call(skymatch_json_file2, skymethod=&#39;local&#39;, subtract=True,output_file=&#39;MIRI&#39;,save_results=True)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Test running just skymatch and resample and skiping other steps.</span>

<span class="c1"># Run Calwebb_image3 on the association table</span>
    
<span class="c1"># set any specific parameters</span>
<span class="n">skymethod</span> <span class="o">=</span> <span class="s1">&#39;local&#39;</span> <span class="c1"># sky computation algorithm to be used. Allowed values: {local, global, match, global+match} (Default = global+match</span>
<span class="c1">#match_down = True # Specifies whether the sky differences should be subtracted from images with higher sky values (match_down = True) in order to match the image with the lowest sky or sky differences should be added to the images with lower sky values to match the sky of the image with the highest sky value (match_down = False). (Default = True</span>
<span class="n">subtract</span> <span class="o">=</span> <span class="kc">True</span> <span class="c1"># Specifies whether the computed sky background values are to be subtracted from the images. (Default = False   </span>
    
<span class="n">pipe3</span><span class="o">=</span><span class="n">Image3Pipeline</span><span class="p">()</span>    
<span class="n">pipe3</span><span class="o">.</span><span class="n">tweakreg</span><span class="o">.</span><span class="n">skip</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">outlier_detection</span><span class="o">.</span><span class="n">skip</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">source_catalog</span><span class="o">.</span><span class="n">skip</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">pipe3</span><span class="o">.</span><span class="n">skymatch</span><span class="o">.</span><span class="n">skymethod</span> <span class="o">=</span> <span class="n">skymethod</span>
<span class="c1">#pipe3.skymatch.match_down = match_down</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">skymatch</span><span class="o">.</span><span class="n">subtract</span> <span class="o">=</span> <span class="n">subtract</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">skymatch</span><span class="o">.</span><span class="n">output_file</span> <span class="o">=</span> <span class="s1">&#39;MIRI&#39;</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">skymatch</span><span class="o">.</span><span class="n">save_results</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">pipe3</span><span class="o">.</span><span class="n">resample</span><span class="o">.</span><span class="n">save_results</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">pipe3</span><span class="o">.</span><span class="n">save_results</span> <span class="o">=</span> <span class="kc">True</span>

<span class="c1"># run Image3</span>

<span class="n">image</span> <span class="o">=</span> <span class="n">pipe3</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">skymatch_json_file2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Image 3 pipeline finished.&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:27,107 - stpipe.Image3Pipeline - INFO - Image3Pipeline instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:27,109 - stpipe.Image3Pipeline.assign_mtwcs - INFO - AssignMTWcsStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:27,112 - stpipe.Image3Pipeline.tweakreg - INFO - TweakRegStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:27,113 - stpipe.Image3Pipeline.skymatch - INFO - SkyMatchStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:27,115 - stpipe.Image3Pipeline.outlier_detection - INFO - OutlierDetectionStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:27,117 - stpipe.Image3Pipeline.resample - INFO - ResampleStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:27,119 - stpipe.Image3Pipeline.source_catalog - INFO - SourceCatalogStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:27,418 - stpipe.Image3Pipeline - INFO - Step Image3Pipeline running with args (&#39;skymatch_asnfile2.json&#39;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:27,435 - stpipe.Image3Pipeline - INFO - Step Image3Pipeline parameters are: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: None, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: False, &#39;output_use_index&#39;: True, &#39;save_results&#39;: True, &#39;skip&#39;: False, &#39;suffix&#39;: None, &#39;search_output_file&#39;: True, &#39;input_dir&#39;: &#39;&#39;, &#39;steps&#39;: {&#39;assign_mtwcs&#39;: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: None, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: True, &#39;output_use_index&#39;: True, &#39;save_results&#39;: False, &#39;skip&#39;: False, &#39;suffix&#39;: &#39;assign_mtwcs&#39;, &#39;search_output_file&#39;: True, &#39;input_dir&#39;: &#39;&#39;}, &#39;tweakreg&#39;: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: None, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: True, &#39;output_use_index&#39;: True, &#39;save_results&#39;: False, &#39;skip&#39;: True, &#39;suffix&#39;: None, &#39;search_output_file&#39;: True, &#39;input_dir&#39;: &#39;&#39;, &#39;save_catalogs&#39;: False, &#39;catalog_format&#39;: &#39;ecsv&#39;, &#39;kernel_fwhm&#39;: 2.5, &#39;snr_threshold&#39;: 10.0, &#39;brightest&#39;: 200, &#39;peakmax&#39;: None, &#39;enforce_user_order&#39;: False, &#39;expand_refcat&#39;: False, &#39;minobj&#39;: 15, &#39;searchrad&#39;: 2.0, &#39;use2dhist&#39;: True, &#39;separation&#39;: 1.0, &#39;tolerance&#39;: 0.7, &#39;xoffset&#39;: 0.0, &#39;yoffset&#39;: 0.0, &#39;fitgeometry&#39;: &#39;rshift&#39;, &#39;nclip&#39;: 3, &#39;sigma&#39;: 3.0, &#39;align_to_gaia&#39;: False, &#39;gaia_catalog&#39;: &#39;GAIADR2&#39;, &#39;min_gaia&#39;: 5, &#39;save_gaia_catalog&#39;: False}, &#39;skymatch&#39;: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: &#39;/internal/data1/jenkins/workspace/Notebooks/jwst_validation_notebooks_spacetelescope/tmp/tmpt_z84t1b/MIRI&#39;, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: False, &#39;output_use_index&#39;: True, &#39;save_results&#39;: True, &#39;skip&#39;: False, &#39;suffix&#39;: None, &#39;search_output_file&#39;: True, &#39;input_dir&#39;: &#39;&#39;, &#39;skymethod&#39;: &#39;local&#39;, &#39;match_down&#39;: True, &#39;subtract&#39;: True, &#39;stepsize&#39;: None, &#39;skystat&#39;: &#39;mode&#39;, &#39;dqbits&#39;: &#39;~DO_NOT_USE+NON_SCIENCE&#39;, &#39;lower&#39;: None, &#39;upper&#39;: None, &#39;nclip&#39;: 5, &#39;lsigma&#39;: 4.0, &#39;usigma&#39;: 4.0, &#39;binwidth&#39;: 0.1}, &#39;outlier_detection&#39;: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: None, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: False, &#39;output_use_index&#39;: True, &#39;save_results&#39;: False, &#39;skip&#39;: True, &#39;suffix&#39;: None, &#39;search_output_file&#39;: False, &#39;input_dir&#39;: &#39;&#39;, &#39;weight_type&#39;: &#39;ivm&#39;, &#39;pixfrac&#39;: 1.0, &#39;kernel&#39;: &#39;square&#39;, &#39;fillval&#39;: &#39;INDEF&#39;, &#39;nlow&#39;: 0, &#39;nhigh&#39;: 0, &#39;maskpt&#39;: 0.7, &#39;grow&#39;: 1, &#39;snr&#39;: &#39;5.0 4.0&#39;, &#39;scale&#39;: &#39;1.2 0.7&#39;, &#39;backg&#39;: 0.0, &#39;save_intermediate_results&#39;: False, &#39;resample_data&#39;: True, &#39;good_bits&#39;: &#39;~DO_NOT_USE&#39;, &#39;scale_detection&#39;: False, &#39;allowed_memory&#39;: None}, &#39;resample&#39;: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: None, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: False, &#39;output_use_index&#39;: True, &#39;save_results&#39;: True, &#39;skip&#39;: False, &#39;suffix&#39;: None, &#39;search_output_file&#39;: True, &#39;input_dir&#39;: &#39;&#39;, &#39;pixfrac&#39;: 1.0, &#39;kernel&#39;: &#39;square&#39;, &#39;fillval&#39;: &#39;INDEF&#39;, &#39;weight_type&#39;: &#39;ivm&#39;, &#39;output_shape&#39;: None, &#39;crpix&#39;: None, &#39;crval&#39;: None, &#39;rotation&#39;: None, &#39;pixel_scale_ratio&#39;: 1.0, &#39;pixel_scale&#39;: None, &#39;single&#39;: False, &#39;blendheaders&#39;: True, &#39;allowed_memory&#39;: None}, &#39;source_catalog&#39;: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: None, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: False, &#39;output_use_index&#39;: True, &#39;save_results&#39;: False, &#39;skip&#39;: True, &#39;suffix&#39;: &#39;cat&#39;, &#39;search_output_file&#39;: True, &#39;input_dir&#39;: &#39;&#39;, &#39;bkg_boxsize&#39;: 100, &#39;kernel_fwhm&#39;: 2.0, &#39;snr_threshold&#39;: 3.0, &#39;npixels&#39;: 5, &#39;deblend&#39;: False, &#39;aperture_ee1&#39;: 30, &#39;aperture_ee2&#39;: 50, &#39;aperture_ee3&#39;: 70, &#39;ci1_star_threshold&#39;: 2.0, &#39;ci2_star_threshold&#39;: 1.8}}}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:27,584 - stpipe.Image3Pipeline - INFO - Prefetching reference files for dataset: &#39;det_image_seq1_MIRIMAGE_F560Wexp1_cal_skymatch.fits&#39; reftypes = [&#39;drizpars&#39;]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:27,587 - stpipe.Image3Pipeline - INFO - Prefetch for DRIZPARS reference file is &#39;/grp/crds/cache/references/jwst/jwst_miri_drizpars_0001.fits&#39;.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:27,590 - stpipe.Image3Pipeline - INFO - Starting calwebb_image3 ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:28,339 - stpipe.Image3Pipeline.tweakreg - INFO - Step tweakreg running with args (&lt;ModelContainer&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:28,342 - stpipe.Image3Pipeline.tweakreg - INFO - Step tweakreg parameters are: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: None, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: True, &#39;output_use_index&#39;: True, &#39;save_results&#39;: False, &#39;skip&#39;: True, &#39;suffix&#39;: None, &#39;search_output_file&#39;: True, &#39;input_dir&#39;: &#39;&#39;, &#39;save_catalogs&#39;: False, &#39;catalog_format&#39;: &#39;ecsv&#39;, &#39;kernel_fwhm&#39;: 2.5, &#39;snr_threshold&#39;: 10.0, &#39;brightest&#39;: 200, &#39;peakmax&#39;: None, &#39;enforce_user_order&#39;: False, &#39;expand_refcat&#39;: False, &#39;minobj&#39;: 15, &#39;searchrad&#39;: 2.0, &#39;use2dhist&#39;: True, &#39;separation&#39;: 1.0, &#39;tolerance&#39;: 0.7, &#39;xoffset&#39;: 0.0, &#39;yoffset&#39;: 0.0, &#39;fitgeometry&#39;: &#39;rshift&#39;, &#39;nclip&#39;: 3, &#39;sigma&#39;: 3.0, &#39;align_to_gaia&#39;: False, &#39;gaia_catalog&#39;: &#39;GAIADR2&#39;, &#39;min_gaia&#39;: 5, &#39;save_gaia_catalog&#39;: False}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:28,343 - stpipe.Image3Pipeline.tweakreg - INFO - Step skipped.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:28,349 - stpipe.Image3Pipeline.tweakreg - INFO - Step tweakreg done
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:28,624 - stpipe.Image3Pipeline.skymatch - INFO - Step skymatch running with args (&lt;ModelContainer&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:28,626 - stpipe.Image3Pipeline.skymatch - INFO - Step skymatch parameters are: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: &#39;/internal/data1/jenkins/workspace/Notebooks/jwst_validation_notebooks_spacetelescope/tmp/tmpt_z84t1b/MIRI&#39;, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: False, &#39;output_use_index&#39;: True, &#39;save_results&#39;: True, &#39;skip&#39;: False, &#39;suffix&#39;: None, &#39;search_output_file&#39;: True, &#39;input_dir&#39;: &#39;&#39;, &#39;skymethod&#39;: &#39;local&#39;, &#39;match_down&#39;: True, &#39;subtract&#39;: True, &#39;stepsize&#39;: None, &#39;skystat&#39;: &#39;mode&#39;, &#39;dqbits&#39;: &#39;~DO_NOT_USE+NON_SCIENCE&#39;, &#39;lower&#39;: None, &#39;upper&#39;: None, &#39;nclip&#39;: 5, &#39;lsigma&#39;: 4.0, &#39;usigma&#39;: 4.0, &#39;binwidth&#39;: 0.1}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:28,774 - stpipe.Image3Pipeline.skymatch - INFO -  
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:28,775 - stpipe.Image3Pipeline.skymatch - INFO - ***** jwst.skymatch.skymatch.match() started on 2022-07-07 08:10:28.774167
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:28,775 - stpipe.Image3Pipeline.skymatch - INFO -  
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:28,775 - stpipe.Image3Pipeline.skymatch - INFO - Sky computation method: &#39;local&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:28,776 - stpipe.Image3Pipeline.skymatch - INFO - Sky subtraction from image data: ON
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:28,776 - stpipe.Image3Pipeline.skymatch - INFO -  
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:28,777 - stpipe.Image3Pipeline.skymatch - INFO - ----  Sky values computed per image and/or image groups.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:28,862 - stpipe.Image3Pipeline.skymatch - INFO -    *  Image ID=det_image_seq1_MIRIMAGE_F560Wexp1_cal_skymatch.fits. Sky background: 1.98114 (old=0, delta=1.98114)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:28,865 - stpipe.Image3Pipeline.skymatch - INFO -    *  Image ID=det_image_seq2_MIRIMAGE_F560Wexp1_cal_skymatch.fits. Sky background: 2.97636 (old=0, delta=2.97636)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:28,867 - stpipe.Image3Pipeline.skymatch - INFO -    *  Image ID=det_image_seq3_MIRIMAGE_F560Wexp1_cal_skymatch.fits. Sky background: 5.01324 (old=0, delta=5.01324)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:28,869 - stpipe.Image3Pipeline.skymatch - INFO -    *  Image ID=det_image_seq4_MIRIMAGE_F560Wexp1_cal_skymatch.fits. Sky background: 1.98114 (old=0, delta=1.98114)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:28,870 - stpipe.Image3Pipeline.skymatch - INFO -  
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:28,870 - stpipe.Image3Pipeline.skymatch - INFO - ***** jwst.skymatch.skymatch.match() ended on 2022-07-07 08:10:28.870309
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:28,871 - stpipe.Image3Pipeline.skymatch - INFO - ***** jwst.skymatch.skymatch.match() TOTAL RUN TIME: 0:00:00.096142
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:28,872 - stpipe.Image3Pipeline.skymatch - INFO -  
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:29,165 - stpipe.Image3Pipeline.skymatch - INFO - Saved model in MIRI_0_skymatch.fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:29,428 - stpipe.Image3Pipeline.skymatch - INFO - Saved model in MIRI_1_skymatch.fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:29,692 - stpipe.Image3Pipeline.skymatch - INFO - Saved model in MIRI_2_skymatch.fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:29,949 - stpipe.Image3Pipeline.skymatch - INFO - Saved model in MIRI_3_skymatch.fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:29,950 - stpipe.Image3Pipeline.skymatch - INFO - Step skymatch done
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:30,245 - stpipe.Image3Pipeline.outlier_detection - INFO - Step outlier_detection running with args (&lt;ModelContainer&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:30,247 - stpipe.Image3Pipeline.outlier_detection - INFO - Step outlier_detection parameters are: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: None, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: False, &#39;output_use_index&#39;: True, &#39;save_results&#39;: True, &#39;skip&#39;: True, &#39;suffix&#39;: &#39;crf&#39;, &#39;search_output_file&#39;: False, &#39;input_dir&#39;: &#39;&#39;, &#39;weight_type&#39;: &#39;ivm&#39;, &#39;pixfrac&#39;: 1.0, &#39;kernel&#39;: &#39;square&#39;, &#39;fillval&#39;: &#39;INDEF&#39;, &#39;nlow&#39;: 0, &#39;nhigh&#39;: 0, &#39;maskpt&#39;: 0.7, &#39;grow&#39;: 1, &#39;snr&#39;: &#39;5.0 4.0&#39;, &#39;scale&#39;: &#39;1.2 0.7&#39;, &#39;backg&#39;: 0.0, &#39;save_intermediate_results&#39;: False, &#39;resample_data&#39;: True, &#39;good_bits&#39;: &#39;~DO_NOT_USE&#39;, &#39;scale_detection&#39;: False, &#39;allowed_memory&#39;: None}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:30,248 - stpipe.Image3Pipeline.outlier_detection - INFO - Step skipped.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:30,254 - stpipe.Image3Pipeline.outlier_detection - INFO - Step outlier_detection done
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:30,523 - stpipe.Image3Pipeline.resample - INFO - Step resample running with args (&lt;ModelContainer&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:30,527 - stpipe.Image3Pipeline.resample - INFO - Step resample parameters are: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: None, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: False, &#39;output_use_index&#39;: True, &#39;save_results&#39;: True, &#39;skip&#39;: False, &#39;suffix&#39;: &#39;i2d&#39;, &#39;search_output_file&#39;: True, &#39;input_dir&#39;: &#39;&#39;, &#39;pixfrac&#39;: 1.0, &#39;kernel&#39;: &#39;square&#39;, &#39;fillval&#39;: &#39;INDEF&#39;, &#39;weight_type&#39;: &#39;ivm&#39;, &#39;output_shape&#39;: None, &#39;crpix&#39;: None, &#39;crval&#39;: None, &#39;rotation&#39;: None, &#39;pixel_scale_ratio&#39;: 1.0, &#39;pixel_scale&#39;: None, &#39;single&#39;: False, &#39;blendheaders&#39;: True, &#39;allowed_memory&#39;: None}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:30,555 - stpipe.Image3Pipeline.resample - INFO - Drizpars reference file: /grp/crds/cache/references/jwst/jwst_miri_drizpars_0001.fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:30,716 - stpipe.Image3Pipeline.resample - INFO - Blending metadata for skymatch_combined.fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:31,385 - stpipe.Image3Pipeline.resample - INFO - Resampling science data
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:32,018 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:32,992 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:34,011 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:35,038 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:35,416 - stpipe.Image3Pipeline.resample - INFO - Resampling var_rnoise
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:36,043 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:37,034 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:38,029 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:38,998 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:39,365 - stpipe.Image3Pipeline.resample - INFO - Resampling var_poisson
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:40,011 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:41,002 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:42,019 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:43,001 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:43,365 - stpipe.Image3Pipeline.resample - INFO - Resampling var_flat
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:43,948 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:44,913 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:45,869 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:46,800 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:47,185 - stpipe.Image3Pipeline.resample - INFO - Update S_REGION to POLYGON ICRS  0.020232898 -0.018692220 0.023327823 0.016575172 359.989011943 0.019586596 359.985917018 -0.015680796
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:47,656 - stpipe.Image3Pipeline.resample - INFO - Saved model in skymatch_combined_i2d.fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:47,658 - stpipe.Image3Pipeline.resample - INFO - Step resample done
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:47,974 - stpipe.Image3Pipeline.source_catalog - INFO - Step source_catalog running with args (&lt;ImageModel(1149, 1118) from skymatch_combined_i2d.fits&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:47,976 - stpipe.Image3Pipeline.source_catalog - INFO - Step source_catalog parameters are: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: None, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: False, &#39;output_use_index&#39;: True, &#39;save_results&#39;: True, &#39;skip&#39;: True, &#39;suffix&#39;: &#39;cat&#39;, &#39;search_output_file&#39;: True, &#39;input_dir&#39;: &#39;&#39;, &#39;bkg_boxsize&#39;: 100, &#39;kernel_fwhm&#39;: 2.0, &#39;snr_threshold&#39;: 3.0, &#39;npixels&#39;: 5, &#39;deblend&#39;: False, &#39;aperture_ee1&#39;: 30, &#39;aperture_ee2&#39;: 50, &#39;aperture_ee3&#39;: 70, &#39;ci1_star_threshold&#39;: 2.0, &#39;ci2_star_threshold&#39;: 1.8}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:47,977 - stpipe.Image3Pipeline.source_catalog - INFO - Step skipped.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:47,980 - stpipe.Image3Pipeline.source_catalog - INFO - Step source_catalog done
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:47,982 - stpipe.Image3Pipeline - INFO - Step Image3Pipeline done
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Image 3 pipeline finished.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">img01_1_new</span> <span class="o">=</span> <span class="n">datamodels</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;MIRI_0_skymatch.fits&#39;</span><span class="p">)</span>
<span class="n">img01_2_new</span> <span class="o">=</span> <span class="n">datamodels</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;MIRI_1_skymatch.fits&#39;</span><span class="p">)</span>
<span class="n">img02_1_new</span> <span class="o">=</span> <span class="n">datamodels</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;MIRI_2_skymatch.fits&#39;</span><span class="p">)</span>
<span class="n">img02_2_new</span> <span class="o">=</span> <span class="n">datamodels</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;MIRI_3_skymatch.fits&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;With subtract=True, the new value should show that the background value was subtracted.&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean: original, new (local)&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">img01_1</span><span class="o">.</span><span class="n">data</span><span class="p">),</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">img01_1_new</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">img01_2</span><span class="o">.</span><span class="n">data</span><span class="p">),</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">img01_2_new</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">img02_1</span><span class="o">.</span><span class="n">data</span><span class="p">),</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">img02_1_new</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">img02_2</span><span class="o">.</span><span class="n">data</span><span class="p">),</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">img02_2_new</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>With subtract=True, the new value should show that the background value was subtracted.
Mean: original, new (local)
Mean: 2.0004356 , 2.0004356
Mean: 2.9994354 , 2.9994354
Mean: 4.9994936 , 4.9994936
Mean: 2.0004356 , 2.0004356
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Look at combined image</span>
<span class="n">im_file</span> <span class="o">=</span> <span class="n">ImageModel</span><span class="p">(</span><span class="s1">&#39;skymatch_combined_i2d.fits&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The background value was subtracted in the skymatch step, no additional subtraction should be done here.&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;This value should match the values in the new column above.&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">im_file</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">600</span><span class="p">:</span><span class="mi">700</span><span class="p">,</span><span class="mi">600</span><span class="p">:</span><span class="mi">700</span><span class="p">]))</span>

<span class="c1"># read in ecsv photom file</span>
<span class="kn">from</span> <span class="nn">astropy.visualization</span> <span class="kn">import</span> <span class="n">LogStretch</span><span class="p">,</span> <span class="n">PercentileInterval</span><span class="p">,</span> <span class="n">ManualInterval</span>

<span class="c1">#viz2 = LogStretch() + ManualInterval(0,10)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>
<span class="c1">#plt.imshow(viz2(im_file.data), origin=&#39;lower&#39;)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">im_file</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;rainbow&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The background value was subtracted in the skymatch step, no additional subtraction should be done here.
This value should match the values in the new column above.
Mean: 3.0036535
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.colorbar.Colorbar at 0x7fed577cf430&gt;
</pre></div>
</div>
<img alt="../../../_images/exec_jwst_skymatch_miri_test_36_2.png" src="../../../_images/exec_jwst_skymatch_miri_test_36_2.png" />
</div>
</div>
</section>
</section>
<section id="run-skymatch-for-skymethod-global">
<h2>2. Run skymatch for skymethod = ‘global’.<a class="headerlink" href="#run-skymatch-for-skymethod-global" title="Permalink to this headline">#</a></h2>
<section id="notes-global-compute-a-common-sky-value-for-all-input-image-and-groups-of-images-in-this-setting-match-will-compute-sky-values-for-each-input-image-group-find-the-minimum-sky-value-and-then-it-will-set-and-or-subtract-sky-value-of-each-input-image-to-this-minimum-value-this-method-may-be-useful-when-input-images-have-been-already-matched-the-global-method-computes-the-minimum-sky-value-across-all-input-images-and-or-groups-that-sky-value-is-then-considered-to-be-the-background-in-all-input-images">
<h3>Notes: ‘global’: compute a common sky value for all input image and groups of images. In this setting match will compute sky values for each input image/group, find the minimum sky value, and then it will set (and/or subtract) sky value of each input image to this minimum value. This method may be useful when input images have been already matched. The ‘global’ method computes the minimum sky value across all input images and/or groups. That sky value is then considered to be the background in all input images.<a class="headerlink" href="#notes-global-compute-a-common-sky-value-for-all-input-image-and-groups-of-images-in-this-setting-match-will-compute-sky-values-for-each-input-image-group-find-the-minimum-sky-value-and-then-it-will-set-and-or-subtract-sky-value-of-each-input-image-to-this-minimum-value-this-method-may-be-useful-when-input-images-have-been-already-matched-the-global-method-computes-the-minimum-sky-value-across-all-input-images-and-or-groups-that-sky-value-is-then-considered-to-be-the-background-in-all-input-images" title="Permalink to this headline">#</a></h3>
<p>This calculates an average sky across all images and subtracts that average from all images. There should be a warning for users for this step that makes it clear that this should not be used on images with differences in background levels.</p>
</section>
<section id="skymethod-global-with-subtraction-false">
<h3>2.1 skymethod = ‘global’ with subtraction = False<a class="headerlink" href="#skymethod-global-with-subtraction-false" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># skymatch, local</span>
<span class="c1">#jwst.skymatch.skymatch_step.SkyMatchStep.call(skymatch_json_file2, skymethod=&#39;local&#39;, subtract=False,output_file=&#39;MIRI&#39;,save_results=True)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Test running just skymatch and resample and skiping other steps.</span>

<span class="c1"># Run Calwebb_image3 on the association table</span>
    
<span class="c1"># set any specific parameters</span>
<span class="n">skymethod</span> <span class="o">=</span> <span class="s1">&#39;global&#39;</span> <span class="c1"># sky computation algorithm to be used. Allowed values: {local, global, match, global+match} (Default = global+match</span>
<span class="c1">#match_down = True # Specifies whether the sky differences should be subtracted from images with higher sky values (match_down = True) in order to match the image with the lowest sky or sky differences should be added to the images with lower sky values to match the sky of the image with the highest sky value (match_down = False). (Default = True</span>
<span class="n">subtract</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1"># Specifies whether the computed sky background values are to be subtracted from the images. (Default = False   </span>
    
<span class="n">pipe3</span><span class="o">=</span><span class="n">Image3Pipeline</span><span class="p">()</span>    
<span class="n">pipe3</span><span class="o">.</span><span class="n">tweakreg</span><span class="o">.</span><span class="n">skip</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">outlier_detection</span><span class="o">.</span><span class="n">skip</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">source_catalog</span><span class="o">.</span><span class="n">skip</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">pipe3</span><span class="o">.</span><span class="n">skymatch</span><span class="o">.</span><span class="n">skymethod</span> <span class="o">=</span> <span class="n">skymethod</span>
<span class="c1">#pipe3.skymatch.match_down = match_down</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">skymatch</span><span class="o">.</span><span class="n">subtract</span> <span class="o">=</span> <span class="n">subtract</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">skymatch</span><span class="o">.</span><span class="n">output_file</span> <span class="o">=</span> <span class="s1">&#39;MIRI&#39;</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">skymatch</span><span class="o">.</span><span class="n">save_results</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">pipe3</span><span class="o">.</span><span class="n">resample</span><span class="o">.</span><span class="n">save_results</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">pipe3</span><span class="o">.</span><span class="n">save_results</span> <span class="o">=</span> <span class="kc">True</span>

<span class="c1"># run Image3</span>

<span class="n">image</span> <span class="o">=</span> <span class="n">pipe3</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">skymatch_json_file2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Image 3 pipeline finished.&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:49,381 - stpipe.Image3Pipeline - INFO - Image3Pipeline instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:49,383 - stpipe.Image3Pipeline.assign_mtwcs - INFO - AssignMTWcsStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:49,386 - stpipe.Image3Pipeline.tweakreg - INFO - TweakRegStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:49,388 - stpipe.Image3Pipeline.skymatch - INFO - SkyMatchStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:49,389 - stpipe.Image3Pipeline.outlier_detection - INFO - OutlierDetectionStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:49,391 - stpipe.Image3Pipeline.resample - INFO - ResampleStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:49,393 - stpipe.Image3Pipeline.source_catalog - INFO - SourceCatalogStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:49,761 - stpipe.Image3Pipeline - INFO - Step Image3Pipeline running with args (&#39;skymatch_asnfile2.json&#39;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:49,768 - stpipe.Image3Pipeline - INFO - Step Image3Pipeline parameters are: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: None, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: False, &#39;output_use_index&#39;: True, &#39;save_results&#39;: True, &#39;skip&#39;: False, &#39;suffix&#39;: None, &#39;search_output_file&#39;: True, &#39;input_dir&#39;: &#39;&#39;, &#39;steps&#39;: {&#39;assign_mtwcs&#39;: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: None, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: True, &#39;output_use_index&#39;: True, &#39;save_results&#39;: False, &#39;skip&#39;: False, &#39;suffix&#39;: &#39;assign_mtwcs&#39;, &#39;search_output_file&#39;: True, &#39;input_dir&#39;: &#39;&#39;}, &#39;tweakreg&#39;: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: None, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: True, &#39;output_use_index&#39;: True, &#39;save_results&#39;: False, &#39;skip&#39;: True, &#39;suffix&#39;: None, &#39;search_output_file&#39;: True, &#39;input_dir&#39;: &#39;&#39;, &#39;save_catalogs&#39;: False, &#39;catalog_format&#39;: &#39;ecsv&#39;, &#39;kernel_fwhm&#39;: 2.5, &#39;snr_threshold&#39;: 10.0, &#39;brightest&#39;: 200, &#39;peakmax&#39;: None, &#39;enforce_user_order&#39;: False, &#39;expand_refcat&#39;: False, &#39;minobj&#39;: 15, &#39;searchrad&#39;: 2.0, &#39;use2dhist&#39;: True, &#39;separation&#39;: 1.0, &#39;tolerance&#39;: 0.7, &#39;xoffset&#39;: 0.0, &#39;yoffset&#39;: 0.0, &#39;fitgeometry&#39;: &#39;rshift&#39;, &#39;nclip&#39;: 3, &#39;sigma&#39;: 3.0, &#39;align_to_gaia&#39;: False, &#39;gaia_catalog&#39;: &#39;GAIADR2&#39;, &#39;min_gaia&#39;: 5, &#39;save_gaia_catalog&#39;: False}, &#39;skymatch&#39;: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: &#39;/internal/data1/jenkins/workspace/Notebooks/jwst_validation_notebooks_spacetelescope/tmp/tmpt_z84t1b/MIRI&#39;, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: False, &#39;output_use_index&#39;: True, &#39;save_results&#39;: True, &#39;skip&#39;: False, &#39;suffix&#39;: None, &#39;search_output_file&#39;: True, &#39;input_dir&#39;: &#39;&#39;, &#39;skymethod&#39;: &#39;global&#39;, &#39;match_down&#39;: True, &#39;subtract&#39;: False, &#39;stepsize&#39;: None, &#39;skystat&#39;: &#39;mode&#39;, &#39;dqbits&#39;: &#39;~DO_NOT_USE+NON_SCIENCE&#39;, &#39;lower&#39;: None, &#39;upper&#39;: None, &#39;nclip&#39;: 5, &#39;lsigma&#39;: 4.0, &#39;usigma&#39;: 4.0, &#39;binwidth&#39;: 0.1}, &#39;outlier_detection&#39;: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: None, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: False, &#39;output_use_index&#39;: True, &#39;save_results&#39;: False, &#39;skip&#39;: True, &#39;suffix&#39;: None, &#39;search_output_file&#39;: False, &#39;input_dir&#39;: &#39;&#39;, &#39;weight_type&#39;: &#39;ivm&#39;, &#39;pixfrac&#39;: 1.0, &#39;kernel&#39;: &#39;square&#39;, &#39;fillval&#39;: &#39;INDEF&#39;, &#39;nlow&#39;: 0, &#39;nhigh&#39;: 0, &#39;maskpt&#39;: 0.7, &#39;grow&#39;: 1, &#39;snr&#39;: &#39;5.0 4.0&#39;, &#39;scale&#39;: &#39;1.2 0.7&#39;, &#39;backg&#39;: 0.0, &#39;save_intermediate_results&#39;: False, &#39;resample_data&#39;: True, &#39;good_bits&#39;: &#39;~DO_NOT_USE&#39;, &#39;scale_detection&#39;: False, &#39;allowed_memory&#39;: None}, &#39;resample&#39;: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: None, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: False, &#39;output_use_index&#39;: True, &#39;save_results&#39;: True, &#39;skip&#39;: False, &#39;suffix&#39;: None, &#39;search_output_file&#39;: True, &#39;input_dir&#39;: &#39;&#39;, &#39;pixfrac&#39;: 1.0, &#39;kernel&#39;: &#39;square&#39;, &#39;fillval&#39;: &#39;INDEF&#39;, &#39;weight_type&#39;: &#39;ivm&#39;, &#39;output_shape&#39;: None, &#39;crpix&#39;: None, &#39;crval&#39;: None, &#39;rotation&#39;: None, &#39;pixel_scale_ratio&#39;: 1.0, &#39;pixel_scale&#39;: None, &#39;single&#39;: False, &#39;blendheaders&#39;: True, &#39;allowed_memory&#39;: None}, &#39;source_catalog&#39;: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: None, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: False, &#39;output_use_index&#39;: True, &#39;save_results&#39;: False, &#39;skip&#39;: True, &#39;suffix&#39;: &#39;cat&#39;, &#39;search_output_file&#39;: True, &#39;input_dir&#39;: &#39;&#39;, &#39;bkg_boxsize&#39;: 100, &#39;kernel_fwhm&#39;: 2.0, &#39;snr_threshold&#39;: 3.0, &#39;npixels&#39;: 5, &#39;deblend&#39;: False, &#39;aperture_ee1&#39;: 30, &#39;aperture_ee2&#39;: 50, &#39;aperture_ee3&#39;: 70, &#39;ci1_star_threshold&#39;: 2.0, &#39;ci2_star_threshold&#39;: 1.8}}}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:49,905 - stpipe.Image3Pipeline - INFO - Prefetching reference files for dataset: &#39;det_image_seq1_MIRIMAGE_F560Wexp1_cal_skymatch.fits&#39; reftypes = [&#39;drizpars&#39;]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:49,908 - stpipe.Image3Pipeline - INFO - Prefetch for DRIZPARS reference file is &#39;/grp/crds/cache/references/jwst/jwst_miri_drizpars_0001.fits&#39;.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:49,911 - stpipe.Image3Pipeline - INFO - Starting calwebb_image3 ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:50,688 - stpipe.Image3Pipeline.tweakreg - INFO - Step tweakreg running with args (&lt;ModelContainer&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:50,693 - stpipe.Image3Pipeline.tweakreg - INFO - Step tweakreg parameters are: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: None, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: True, &#39;output_use_index&#39;: True, &#39;save_results&#39;: False, &#39;skip&#39;: True, &#39;suffix&#39;: None, &#39;search_output_file&#39;: True, &#39;input_dir&#39;: &#39;&#39;, &#39;save_catalogs&#39;: False, &#39;catalog_format&#39;: &#39;ecsv&#39;, &#39;kernel_fwhm&#39;: 2.5, &#39;snr_threshold&#39;: 10.0, &#39;brightest&#39;: 200, &#39;peakmax&#39;: None, &#39;enforce_user_order&#39;: False, &#39;expand_refcat&#39;: False, &#39;minobj&#39;: 15, &#39;searchrad&#39;: 2.0, &#39;use2dhist&#39;: True, &#39;separation&#39;: 1.0, &#39;tolerance&#39;: 0.7, &#39;xoffset&#39;: 0.0, &#39;yoffset&#39;: 0.0, &#39;fitgeometry&#39;: &#39;rshift&#39;, &#39;nclip&#39;: 3, &#39;sigma&#39;: 3.0, &#39;align_to_gaia&#39;: False, &#39;gaia_catalog&#39;: &#39;GAIADR2&#39;, &#39;min_gaia&#39;: 5, &#39;save_gaia_catalog&#39;: False}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:50,695 - stpipe.Image3Pipeline.tweakreg - INFO - Step skipped.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:50,707 - stpipe.Image3Pipeline.tweakreg - INFO - Step tweakreg done
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:50,977 - stpipe.Image3Pipeline.skymatch - INFO - Step skymatch running with args (&lt;ModelContainer&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:50,979 - stpipe.Image3Pipeline.skymatch - INFO - Step skymatch parameters are: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: &#39;/internal/data1/jenkins/workspace/Notebooks/jwst_validation_notebooks_spacetelescope/tmp/tmpt_z84t1b/MIRI&#39;, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: False, &#39;output_use_index&#39;: True, &#39;save_results&#39;: True, &#39;skip&#39;: False, &#39;suffix&#39;: None, &#39;search_output_file&#39;: True, &#39;input_dir&#39;: &#39;&#39;, &#39;skymethod&#39;: &#39;global&#39;, &#39;match_down&#39;: True, &#39;subtract&#39;: False, &#39;stepsize&#39;: None, &#39;skystat&#39;: &#39;mode&#39;, &#39;dqbits&#39;: &#39;~DO_NOT_USE+NON_SCIENCE&#39;, &#39;lower&#39;: None, &#39;upper&#39;: None, &#39;nclip&#39;: 5, &#39;lsigma&#39;: 4.0, &#39;usigma&#39;: 4.0, &#39;binwidth&#39;: 0.1}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:51,124 - stpipe.Image3Pipeline.skymatch - INFO -  
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:51,125 - stpipe.Image3Pipeline.skymatch - INFO - ***** jwst.skymatch.skymatch.match() started on 2022-07-07 08:10:51.124685
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:51,126 - stpipe.Image3Pipeline.skymatch - INFO -  
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:51,127 - stpipe.Image3Pipeline.skymatch - INFO - Sky computation method: &#39;global&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:51,128 - stpipe.Image3Pipeline.skymatch - INFO - Sky subtraction from image data: OFF
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:51,129 - stpipe.Image3Pipeline.skymatch - INFO -  
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:51,130 - stpipe.Image3Pipeline.skymatch - INFO - ----  Computing &quot;global&quot; sky - smallest sky value across *all* input images.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:51,215 - stpipe.Image3Pipeline.skymatch - INFO -  
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:51,216 - stpipe.Image3Pipeline.skymatch - INFO -    &quot;Global&quot; sky value correction: 1.9811433658255422 [not converted]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:51,217 - stpipe.Image3Pipeline.skymatch - INFO -    *  Image ID=det_image_seq1_MIRIMAGE_F560Wexp1_cal_skymatch.fits. Sky background: 1.98114
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:51,218 - stpipe.Image3Pipeline.skymatch - INFO -    *  Image ID=det_image_seq2_MIRIMAGE_F560Wexp1_cal_skymatch.fits. Sky background: 1.98114
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:51,218 - stpipe.Image3Pipeline.skymatch - INFO -    *  Image ID=det_image_seq3_MIRIMAGE_F560Wexp1_cal_skymatch.fits. Sky background: 1.98114
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:51,219 - stpipe.Image3Pipeline.skymatch - INFO -    *  Image ID=det_image_seq4_MIRIMAGE_F560Wexp1_cal_skymatch.fits. Sky background: 1.98114
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:51,220 - stpipe.Image3Pipeline.skymatch - INFO -  
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:51,221 - stpipe.Image3Pipeline.skymatch - INFO - ***** jwst.skymatch.skymatch.match() ended on 2022-07-07 08:10:51.220375
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:51,221 - stpipe.Image3Pipeline.skymatch - INFO - ***** jwst.skymatch.skymatch.match() TOTAL RUN TIME: 0:00:00.095690
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:51,222 - stpipe.Image3Pipeline.skymatch - INFO -  
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:51,505 - stpipe.Image3Pipeline.skymatch - INFO - Saved model in MIRI_0_skymatch.fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:51,765 - stpipe.Image3Pipeline.skymatch - INFO - Saved model in MIRI_1_skymatch.fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:52,034 - stpipe.Image3Pipeline.skymatch - INFO - Saved model in MIRI_2_skymatch.fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:52,308 - stpipe.Image3Pipeline.skymatch - INFO - Saved model in MIRI_3_skymatch.fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:52,310 - stpipe.Image3Pipeline.skymatch - INFO - Step skymatch done
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:52,599 - stpipe.Image3Pipeline.outlier_detection - INFO - Step outlier_detection running with args (&lt;ModelContainer&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:52,601 - stpipe.Image3Pipeline.outlier_detection - INFO - Step outlier_detection parameters are: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: None, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: False, &#39;output_use_index&#39;: True, &#39;save_results&#39;: True, &#39;skip&#39;: True, &#39;suffix&#39;: &#39;crf&#39;, &#39;search_output_file&#39;: False, &#39;input_dir&#39;: &#39;&#39;, &#39;weight_type&#39;: &#39;ivm&#39;, &#39;pixfrac&#39;: 1.0, &#39;kernel&#39;: &#39;square&#39;, &#39;fillval&#39;: &#39;INDEF&#39;, &#39;nlow&#39;: 0, &#39;nhigh&#39;: 0, &#39;maskpt&#39;: 0.7, &#39;grow&#39;: 1, &#39;snr&#39;: &#39;5.0 4.0&#39;, &#39;scale&#39;: &#39;1.2 0.7&#39;, &#39;backg&#39;: 0.0, &#39;save_intermediate_results&#39;: False, &#39;resample_data&#39;: True, &#39;good_bits&#39;: &#39;~DO_NOT_USE&#39;, &#39;scale_detection&#39;: False, &#39;allowed_memory&#39;: None}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:52,603 - stpipe.Image3Pipeline.outlier_detection - INFO - Step skipped.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:52,609 - stpipe.Image3Pipeline.outlier_detection - INFO - Step outlier_detection done
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:52,871 - stpipe.Image3Pipeline.resample - INFO - Step resample running with args (&lt;ModelContainer&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:52,874 - stpipe.Image3Pipeline.resample - INFO - Step resample parameters are: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: None, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: False, &#39;output_use_index&#39;: True, &#39;save_results&#39;: True, &#39;skip&#39;: False, &#39;suffix&#39;: &#39;i2d&#39;, &#39;search_output_file&#39;: True, &#39;input_dir&#39;: &#39;&#39;, &#39;pixfrac&#39;: 1.0, &#39;kernel&#39;: &#39;square&#39;, &#39;fillval&#39;: &#39;INDEF&#39;, &#39;weight_type&#39;: &#39;ivm&#39;, &#39;output_shape&#39;: None, &#39;crpix&#39;: None, &#39;crval&#39;: None, &#39;rotation&#39;: None, &#39;pixel_scale_ratio&#39;: 1.0, &#39;pixel_scale&#39;: None, &#39;single&#39;: False, &#39;blendheaders&#39;: True, &#39;allowed_memory&#39;: None}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:52,892 - stpipe.Image3Pipeline.resample - INFO - Drizpars reference file: /grp/crds/cache/references/jwst/jwst_miri_drizpars_0001.fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:53,043 - stpipe.Image3Pipeline.resample - INFO - Blending metadata for skymatch_combined.fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:53,681 - stpipe.Image3Pipeline.resample - INFO - Resampling science data
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:54,316 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:55,294 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:56,254 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:57,229 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:57,594 - stpipe.Image3Pipeline.resample - INFO - Resampling var_rnoise
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:58,190 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:10:59,185 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:00,132 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:01,130 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:01,512 - stpipe.Image3Pipeline.resample - INFO - Resampling var_poisson
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:02,105 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:03,075 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:04,027 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:04,989 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:05,350 - stpipe.Image3Pipeline.resample - INFO - Resampling var_flat
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:05,920 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:06,849 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:07,797 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:08,749 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:09,130 - stpipe.Image3Pipeline.resample - INFO - Update S_REGION to POLYGON ICRS  0.020232898 -0.018692220 0.023327823 0.016575172 359.989011943 0.019586596 359.985917018 -0.015680796
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:09,572 - stpipe.Image3Pipeline.resample - INFO - Saved model in skymatch_combined_i2d.fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:09,574 - stpipe.Image3Pipeline.resample - INFO - Step resample done
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:09,871 - stpipe.Image3Pipeline.source_catalog - INFO - Step source_catalog running with args (&lt;ImageModel(1149, 1118) from skymatch_combined_i2d.fits&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:09,875 - stpipe.Image3Pipeline.source_catalog - INFO - Step source_catalog parameters are: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: None, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: False, &#39;output_use_index&#39;: True, &#39;save_results&#39;: True, &#39;skip&#39;: True, &#39;suffix&#39;: &#39;cat&#39;, &#39;search_output_file&#39;: True, &#39;input_dir&#39;: &#39;&#39;, &#39;bkg_boxsize&#39;: 100, &#39;kernel_fwhm&#39;: 2.0, &#39;snr_threshold&#39;: 3.0, &#39;npixels&#39;: 5, &#39;deblend&#39;: False, &#39;aperture_ee1&#39;: 30, &#39;aperture_ee2&#39;: 50, &#39;aperture_ee3&#39;: 70, &#39;ci1_star_threshold&#39;: 2.0, &#39;ci2_star_threshold&#39;: 1.8}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:09,876 - stpipe.Image3Pipeline.source_catalog - INFO - Step skipped.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:09,881 - stpipe.Image3Pipeline.source_catalog - INFO - Step source_catalog done
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:09,882 - stpipe.Image3Pipeline - INFO - Step Image3Pipeline done
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Image 3 pipeline finished.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">img01_1_new</span> <span class="o">=</span> <span class="n">datamodels</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;MIRI_0_skymatch.fits&#39;</span><span class="p">)</span>
<span class="n">img01_2_new</span> <span class="o">=</span> <span class="n">datamodels</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;MIRI_1_skymatch.fits&#39;</span><span class="p">)</span>
<span class="n">img02_1_new</span> <span class="o">=</span> <span class="n">datamodels</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;MIRI_2_skymatch.fits&#39;</span><span class="p">)</span>
<span class="n">img02_2_new</span> <span class="o">=</span> <span class="n">datamodels</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;MIRI_3_skymatch.fits&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;There should be no subtraction at this step, with subtraction = False.&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean: original, new (local)&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">img01_1</span><span class="o">.</span><span class="n">data</span><span class="p">),</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">img01_1_new</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">img01_2</span><span class="o">.</span><span class="n">data</span><span class="p">),</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">img01_2_new</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">img02_1</span><span class="o">.</span><span class="n">data</span><span class="p">),</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">img02_1_new</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">img02_2</span><span class="o">.</span><span class="n">data</span><span class="p">),</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">img02_2_new</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>There should be no subtraction at this step, with subtraction = False.
Mean: original, new (local)
Mean: 2.0004356 , 2.0004356
Mean: 2.9994354 , 2.9994354
Mean: 4.9994936 , 4.9994936
Mean: 2.0004356 , 2.0004356
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Look at combined image</span>
<span class="n">im_file</span> <span class="o">=</span> <span class="n">ImageModel</span><span class="p">(</span><span class="s1">&#39;skymatch_combined_i2d.fits&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Global finds a single value for the background, and subtracts that value from all images.&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The value listed here should be the average of the subtracted sky values across images.&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The combined image will look messy as the same value was subtracted from the image with background = 5&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;and from the images with background = 2. This shows the differing backgrounds strongly.&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">im_file</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">600</span><span class="p">:</span><span class="mi">700</span><span class="p">,</span><span class="mi">600</span><span class="p">:</span><span class="mi">700</span><span class="p">]))</span>

<span class="c1"># read in ecsv photom file</span>
<span class="kn">from</span> <span class="nn">astropy.visualization</span> <span class="kn">import</span> <span class="n">LogStretch</span><span class="p">,</span> <span class="n">PercentileInterval</span><span class="p">,</span> <span class="n">ManualInterval</span>

<span class="c1">#viz2 = LogStretch() + ManualInterval(0,10)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>
<span class="c1">#plt.imshow(viz2(im_file.data), origin=&#39;lower&#39;)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">im_file</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;rainbow&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Global finds a single value for the background, and subtracts that value from all images.
The value listed here should be the average of the subtracted sky values across images.
The combined image will look messy as the same value was subtracted from the image with background = 5
and from the images with background = 2. This shows the differing backgrounds strongly.
Mean: 1.0225104
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.colorbar.Colorbar at 0x7fed57046e90&gt;
</pre></div>
</div>
<img alt="../../../_images/exec_jwst_skymatch_miri_test_42_2.png" src="../../../_images/exec_jwst_skymatch_miri_test_42_2.png" />
</div>
</div>
</section>
<section id="skymethod-global-with-subtraction-true">
<h3>2.2 skymethod = ‘global’ with subtraction = True<a class="headerlink" href="#skymethod-global-with-subtraction-true" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># skymatch, global, subtract = True</span>
<span class="c1">#jwst.skymatch.skymatch_step.SkyMatchStep.call(skymatch_json_file2, skymethod=&#39;global&#39;, subtract=True,output_file=&#39;MIRI&#39;,save_results=True)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Test running just skymatch and resample and skiping other steps.</span>

<span class="c1"># Run Calwebb_image3 on the association table</span>
    
<span class="c1"># set any specific parameters</span>
<span class="n">skymethod</span> <span class="o">=</span> <span class="s1">&#39;global&#39;</span> <span class="c1"># sky computation algorithm to be used. Allowed values: {local, global, match, global+match} (Default = global+match</span>
<span class="c1">#match_down = True # Specifies whether the sky differences should be subtracted from images with higher sky values (match_down = True) in order to match the image with the lowest sky or sky differences should be added to the images with lower sky values to match the sky of the image with the highest sky value (match_down = False). (Default = True</span>
<span class="n">subtract</span> <span class="o">=</span> <span class="kc">True</span> <span class="c1"># Specifies whether the computed sky background values are to be subtracted from the images. (Default = False   </span>
    
<span class="n">pipe3</span><span class="o">=</span><span class="n">Image3Pipeline</span><span class="p">()</span>    
<span class="n">pipe3</span><span class="o">.</span><span class="n">tweakreg</span><span class="o">.</span><span class="n">skip</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">outlier_detection</span><span class="o">.</span><span class="n">skip</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">source_catalog</span><span class="o">.</span><span class="n">skip</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">pipe3</span><span class="o">.</span><span class="n">skymatch</span><span class="o">.</span><span class="n">skymethod</span> <span class="o">=</span> <span class="n">skymethod</span>
<span class="c1">#pipe3.skymatch.match_down = match_down</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">skymatch</span><span class="o">.</span><span class="n">subtract</span> <span class="o">=</span> <span class="n">subtract</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">skymatch</span><span class="o">.</span><span class="n">output_file</span> <span class="o">=</span> <span class="s1">&#39;MIRI&#39;</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">skymatch</span><span class="o">.</span><span class="n">save_results</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">pipe3</span><span class="o">.</span><span class="n">resample</span><span class="o">.</span><span class="n">save_results</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">pipe3</span><span class="o">.</span><span class="n">save_results</span> <span class="o">=</span> <span class="kc">True</span>

<span class="c1"># run Image3</span>

<span class="n">image</span> <span class="o">=</span> <span class="n">pipe3</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">skymatch_json_file2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Image 3 pipeline finished.&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:11,171 - stpipe.Image3Pipeline - INFO - Image3Pipeline instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:11,173 - stpipe.Image3Pipeline.assign_mtwcs - INFO - AssignMTWcsStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:11,175 - stpipe.Image3Pipeline.tweakreg - INFO - TweakRegStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:11,177 - stpipe.Image3Pipeline.skymatch - INFO - SkyMatchStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:11,179 - stpipe.Image3Pipeline.outlier_detection - INFO - OutlierDetectionStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:11,181 - stpipe.Image3Pipeline.resample - INFO - ResampleStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:11,183 - stpipe.Image3Pipeline.source_catalog - INFO - SourceCatalogStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:11,433 - stpipe.Image3Pipeline - INFO - Step Image3Pipeline running with args (&#39;skymatch_asnfile2.json&#39;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:11,440 - stpipe.Image3Pipeline - INFO - Step Image3Pipeline parameters are: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: None, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: False, &#39;output_use_index&#39;: True, &#39;save_results&#39;: True, &#39;skip&#39;: False, &#39;suffix&#39;: None, &#39;search_output_file&#39;: True, &#39;input_dir&#39;: &#39;&#39;, &#39;steps&#39;: {&#39;assign_mtwcs&#39;: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: None, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: True, &#39;output_use_index&#39;: True, &#39;save_results&#39;: False, &#39;skip&#39;: False, &#39;suffix&#39;: &#39;assign_mtwcs&#39;, &#39;search_output_file&#39;: True, &#39;input_dir&#39;: &#39;&#39;}, &#39;tweakreg&#39;: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: None, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: True, &#39;output_use_index&#39;: True, &#39;save_results&#39;: False, &#39;skip&#39;: True, &#39;suffix&#39;: None, &#39;search_output_file&#39;: True, &#39;input_dir&#39;: &#39;&#39;, &#39;save_catalogs&#39;: False, &#39;catalog_format&#39;: &#39;ecsv&#39;, &#39;kernel_fwhm&#39;: 2.5, &#39;snr_threshold&#39;: 10.0, &#39;brightest&#39;: 200, &#39;peakmax&#39;: None, &#39;enforce_user_order&#39;: False, &#39;expand_refcat&#39;: False, &#39;minobj&#39;: 15, &#39;searchrad&#39;: 2.0, &#39;use2dhist&#39;: True, &#39;separation&#39;: 1.0, &#39;tolerance&#39;: 0.7, &#39;xoffset&#39;: 0.0, &#39;yoffset&#39;: 0.0, &#39;fitgeometry&#39;: &#39;rshift&#39;, &#39;nclip&#39;: 3, &#39;sigma&#39;: 3.0, &#39;align_to_gaia&#39;: False, &#39;gaia_catalog&#39;: &#39;GAIADR2&#39;, &#39;min_gaia&#39;: 5, &#39;save_gaia_catalog&#39;: False}, &#39;skymatch&#39;: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: &#39;/internal/data1/jenkins/workspace/Notebooks/jwst_validation_notebooks_spacetelescope/tmp/tmpt_z84t1b/MIRI&#39;, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: False, &#39;output_use_index&#39;: True, &#39;save_results&#39;: True, &#39;skip&#39;: False, &#39;suffix&#39;: None, &#39;search_output_file&#39;: True, &#39;input_dir&#39;: &#39;&#39;, &#39;skymethod&#39;: &#39;global&#39;, &#39;match_down&#39;: True, &#39;subtract&#39;: True, &#39;stepsize&#39;: None, &#39;skystat&#39;: &#39;mode&#39;, &#39;dqbits&#39;: &#39;~DO_NOT_USE+NON_SCIENCE&#39;, &#39;lower&#39;: None, &#39;upper&#39;: None, &#39;nclip&#39;: 5, &#39;lsigma&#39;: 4.0, &#39;usigma&#39;: 4.0, &#39;binwidth&#39;: 0.1}, &#39;outlier_detection&#39;: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: None, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: False, &#39;output_use_index&#39;: True, &#39;save_results&#39;: False, &#39;skip&#39;: True, &#39;suffix&#39;: None, &#39;search_output_file&#39;: False, &#39;input_dir&#39;: &#39;&#39;, &#39;weight_type&#39;: &#39;ivm&#39;, &#39;pixfrac&#39;: 1.0, &#39;kernel&#39;: &#39;square&#39;, &#39;fillval&#39;: &#39;INDEF&#39;, &#39;nlow&#39;: 0, &#39;nhigh&#39;: 0, &#39;maskpt&#39;: 0.7, &#39;grow&#39;: 1, &#39;snr&#39;: &#39;5.0 4.0&#39;, &#39;scale&#39;: &#39;1.2 0.7&#39;, &#39;backg&#39;: 0.0, &#39;save_intermediate_results&#39;: False, &#39;resample_data&#39;: True, &#39;good_bits&#39;: &#39;~DO_NOT_USE&#39;, &#39;scale_detection&#39;: False, &#39;allowed_memory&#39;: None}, &#39;resample&#39;: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: None, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: False, &#39;output_use_index&#39;: True, &#39;save_results&#39;: True, &#39;skip&#39;: False, &#39;suffix&#39;: None, &#39;search_output_file&#39;: True, &#39;input_dir&#39;: &#39;&#39;, &#39;pixfrac&#39;: 1.0, &#39;kernel&#39;: &#39;square&#39;, &#39;fillval&#39;: &#39;INDEF&#39;, &#39;weight_type&#39;: &#39;ivm&#39;, &#39;output_shape&#39;: None, &#39;crpix&#39;: None, &#39;crval&#39;: None, &#39;rotation&#39;: None, &#39;pixel_scale_ratio&#39;: 1.0, &#39;pixel_scale&#39;: None, &#39;single&#39;: False, &#39;blendheaders&#39;: True, &#39;allowed_memory&#39;: None}, &#39;source_catalog&#39;: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: None, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: False, &#39;output_use_index&#39;: True, &#39;save_results&#39;: False, &#39;skip&#39;: True, &#39;suffix&#39;: &#39;cat&#39;, &#39;search_output_file&#39;: True, &#39;input_dir&#39;: &#39;&#39;, &#39;bkg_boxsize&#39;: 100, &#39;kernel_fwhm&#39;: 2.0, &#39;snr_threshold&#39;: 3.0, &#39;npixels&#39;: 5, &#39;deblend&#39;: False, &#39;aperture_ee1&#39;: 30, &#39;aperture_ee2&#39;: 50, &#39;aperture_ee3&#39;: 70, &#39;ci1_star_threshold&#39;: 2.0, &#39;ci2_star_threshold&#39;: 1.8}}}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:11,572 - stpipe.Image3Pipeline - INFO - Prefetching reference files for dataset: &#39;det_image_seq1_MIRIMAGE_F560Wexp1_cal_skymatch.fits&#39; reftypes = [&#39;drizpars&#39;]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:11,583 - stpipe.Image3Pipeline - INFO - Prefetch for DRIZPARS reference file is &#39;/grp/crds/cache/references/jwst/jwst_miri_drizpars_0001.fits&#39;.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:11,586 - stpipe.Image3Pipeline - INFO - Starting calwebb_image3 ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:12,256 - stpipe.Image3Pipeline.tweakreg - INFO - Step tweakreg running with args (&lt;ModelContainer&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:12,259 - stpipe.Image3Pipeline.tweakreg - INFO - Step tweakreg parameters are: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: None, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: True, &#39;output_use_index&#39;: True, &#39;save_results&#39;: False, &#39;skip&#39;: True, &#39;suffix&#39;: None, &#39;search_output_file&#39;: True, &#39;input_dir&#39;: &#39;&#39;, &#39;save_catalogs&#39;: False, &#39;catalog_format&#39;: &#39;ecsv&#39;, &#39;kernel_fwhm&#39;: 2.5, &#39;snr_threshold&#39;: 10.0, &#39;brightest&#39;: 200, &#39;peakmax&#39;: None, &#39;enforce_user_order&#39;: False, &#39;expand_refcat&#39;: False, &#39;minobj&#39;: 15, &#39;searchrad&#39;: 2.0, &#39;use2dhist&#39;: True, &#39;separation&#39;: 1.0, &#39;tolerance&#39;: 0.7, &#39;xoffset&#39;: 0.0, &#39;yoffset&#39;: 0.0, &#39;fitgeometry&#39;: &#39;rshift&#39;, &#39;nclip&#39;: 3, &#39;sigma&#39;: 3.0, &#39;align_to_gaia&#39;: False, &#39;gaia_catalog&#39;: &#39;GAIADR2&#39;, &#39;min_gaia&#39;: 5, &#39;save_gaia_catalog&#39;: False}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:12,260 - stpipe.Image3Pipeline.tweakreg - INFO - Step skipped.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:12,267 - stpipe.Image3Pipeline.tweakreg - INFO - Step tweakreg done
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:12,454 - stpipe.Image3Pipeline.skymatch - INFO - Step skymatch running with args (&lt;ModelContainer&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:12,456 - stpipe.Image3Pipeline.skymatch - INFO - Step skymatch parameters are: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: &#39;/internal/data1/jenkins/workspace/Notebooks/jwst_validation_notebooks_spacetelescope/tmp/tmpt_z84t1b/MIRI&#39;, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: False, &#39;output_use_index&#39;: True, &#39;save_results&#39;: True, &#39;skip&#39;: False, &#39;suffix&#39;: None, &#39;search_output_file&#39;: True, &#39;input_dir&#39;: &#39;&#39;, &#39;skymethod&#39;: &#39;global&#39;, &#39;match_down&#39;: True, &#39;subtract&#39;: True, &#39;stepsize&#39;: None, &#39;skystat&#39;: &#39;mode&#39;, &#39;dqbits&#39;: &#39;~DO_NOT_USE+NON_SCIENCE&#39;, &#39;lower&#39;: None, &#39;upper&#39;: None, &#39;nclip&#39;: 5, &#39;lsigma&#39;: 4.0, &#39;usigma&#39;: 4.0, &#39;binwidth&#39;: 0.1}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:12,606 - stpipe.Image3Pipeline.skymatch - INFO -  
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:12,607 - stpipe.Image3Pipeline.skymatch - INFO - ***** jwst.skymatch.skymatch.match() started on 2022-07-07 08:11:12.606145
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:12,608 - stpipe.Image3Pipeline.skymatch - INFO -  
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:12,609 - stpipe.Image3Pipeline.skymatch - INFO - Sky computation method: &#39;global&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:12,610 - stpipe.Image3Pipeline.skymatch - INFO - Sky subtraction from image data: ON
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:12,611 - stpipe.Image3Pipeline.skymatch - INFO -  
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:12,612 - stpipe.Image3Pipeline.skymatch - INFO - ----  Computing &quot;global&quot; sky - smallest sky value across *all* input images.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:12,695 - stpipe.Image3Pipeline.skymatch - INFO -  
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:12,697 - stpipe.Image3Pipeline.skymatch - INFO -    &quot;Global&quot; sky value correction: 1.9811433658255422 [not converted]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:12,700 - stpipe.Image3Pipeline.skymatch - INFO -    *  Image ID=det_image_seq1_MIRIMAGE_F560Wexp1_cal_skymatch.fits. Sky background: 1.98114 (old=0, delta=1.98114)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:12,703 - stpipe.Image3Pipeline.skymatch - INFO -    *  Image ID=det_image_seq2_MIRIMAGE_F560Wexp1_cal_skymatch.fits. Sky background: 1.98114 (old=0, delta=1.98114)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:12,705 - stpipe.Image3Pipeline.skymatch - INFO -    *  Image ID=det_image_seq3_MIRIMAGE_F560Wexp1_cal_skymatch.fits. Sky background: 1.98114 (old=0, delta=1.98114)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:12,707 - stpipe.Image3Pipeline.skymatch - INFO -    *  Image ID=det_image_seq4_MIRIMAGE_F560Wexp1_cal_skymatch.fits. Sky background: 1.98114 (old=0, delta=1.98114)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:12,708 - stpipe.Image3Pipeline.skymatch - INFO -  
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:12,708 - stpipe.Image3Pipeline.skymatch - INFO - ***** jwst.skymatch.skymatch.match() ended on 2022-07-07 08:11:12.708165
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:12,709 - stpipe.Image3Pipeline.skymatch - INFO - ***** jwst.skymatch.skymatch.match() TOTAL RUN TIME: 0:00:00.102020
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:12,710 - stpipe.Image3Pipeline.skymatch - INFO -  
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:12,981 - stpipe.Image3Pipeline.skymatch - INFO - Saved model in MIRI_0_skymatch.fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:13,230 - stpipe.Image3Pipeline.skymatch - INFO - Saved model in MIRI_1_skymatch.fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:13,478 - stpipe.Image3Pipeline.skymatch - INFO - Saved model in MIRI_2_skymatch.fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:13,736 - stpipe.Image3Pipeline.skymatch - INFO - Saved model in MIRI_3_skymatch.fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:13,737 - stpipe.Image3Pipeline.skymatch - INFO - Step skymatch done
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:13,942 - stpipe.Image3Pipeline.outlier_detection - INFO - Step outlier_detection running with args (&lt;ModelContainer&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:13,944 - stpipe.Image3Pipeline.outlier_detection - INFO - Step outlier_detection parameters are: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: None, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: False, &#39;output_use_index&#39;: True, &#39;save_results&#39;: True, &#39;skip&#39;: True, &#39;suffix&#39;: &#39;crf&#39;, &#39;search_output_file&#39;: False, &#39;input_dir&#39;: &#39;&#39;, &#39;weight_type&#39;: &#39;ivm&#39;, &#39;pixfrac&#39;: 1.0, &#39;kernel&#39;: &#39;square&#39;, &#39;fillval&#39;: &#39;INDEF&#39;, &#39;nlow&#39;: 0, &#39;nhigh&#39;: 0, &#39;maskpt&#39;: 0.7, &#39;grow&#39;: 1, &#39;snr&#39;: &#39;5.0 4.0&#39;, &#39;scale&#39;: &#39;1.2 0.7&#39;, &#39;backg&#39;: 0.0, &#39;save_intermediate_results&#39;: False, &#39;resample_data&#39;: True, &#39;good_bits&#39;: &#39;~DO_NOT_USE&#39;, &#39;scale_detection&#39;: False, &#39;allowed_memory&#39;: None}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:13,945 - stpipe.Image3Pipeline.outlier_detection - INFO - Step skipped.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:13,955 - stpipe.Image3Pipeline.outlier_detection - INFO - Step outlier_detection done
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:14,138 - stpipe.Image3Pipeline.resample - INFO - Step resample running with args (&lt;ModelContainer&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:14,141 - stpipe.Image3Pipeline.resample - INFO - Step resample parameters are: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: None, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: False, &#39;output_use_index&#39;: True, &#39;save_results&#39;: True, &#39;skip&#39;: False, &#39;suffix&#39;: &#39;i2d&#39;, &#39;search_output_file&#39;: True, &#39;input_dir&#39;: &#39;&#39;, &#39;pixfrac&#39;: 1.0, &#39;kernel&#39;: &#39;square&#39;, &#39;fillval&#39;: &#39;INDEF&#39;, &#39;weight_type&#39;: &#39;ivm&#39;, &#39;output_shape&#39;: None, &#39;crpix&#39;: None, &#39;crval&#39;: None, &#39;rotation&#39;: None, &#39;pixel_scale_ratio&#39;: 1.0, &#39;pixel_scale&#39;: None, &#39;single&#39;: False, &#39;blendheaders&#39;: True, &#39;allowed_memory&#39;: None}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:14,159 - stpipe.Image3Pipeline.resample - INFO - Drizpars reference file: /grp/crds/cache/references/jwst/jwst_miri_drizpars_0001.fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:14,302 - stpipe.Image3Pipeline.resample - INFO - Blending metadata for skymatch_combined.fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:14,943 - stpipe.Image3Pipeline.resample - INFO - Resampling science data
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:15,549 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:16,496 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:17,422 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:18,358 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:18,716 - stpipe.Image3Pipeline.resample - INFO - Resampling var_rnoise
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:19,297 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:20,264 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:21,185 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:22,103 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:22,466 - stpipe.Image3Pipeline.resample - INFO - Resampling var_poisson
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:23,046 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:23,972 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:24,911 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:25,832 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:26,189 - stpipe.Image3Pipeline.resample - INFO - Resampling var_flat
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:26,765 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:27,688 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:28,633 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:29,570 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:29,955 - stpipe.Image3Pipeline.resample - INFO - Update S_REGION to POLYGON ICRS  0.020232898 -0.018692220 0.023327823 0.016575172 359.989011943 0.019586596 359.985917018 -0.015680796
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:30,389 - stpipe.Image3Pipeline.resample - INFO - Saved model in skymatch_combined_i2d.fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:30,390 - stpipe.Image3Pipeline.resample - INFO - Step resample done
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:30,597 - stpipe.Image3Pipeline.source_catalog - INFO - Step source_catalog running with args (&lt;ImageModel(1149, 1118) from skymatch_combined_i2d.fits&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:30,599 - stpipe.Image3Pipeline.source_catalog - INFO - Step source_catalog parameters are: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: None, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: False, &#39;output_use_index&#39;: True, &#39;save_results&#39;: True, &#39;skip&#39;: True, &#39;suffix&#39;: &#39;cat&#39;, &#39;search_output_file&#39;: True, &#39;input_dir&#39;: &#39;&#39;, &#39;bkg_boxsize&#39;: 100, &#39;kernel_fwhm&#39;: 2.0, &#39;snr_threshold&#39;: 3.0, &#39;npixels&#39;: 5, &#39;deblend&#39;: False, &#39;aperture_ee1&#39;: 30, &#39;aperture_ee2&#39;: 50, &#39;aperture_ee3&#39;: 70, &#39;ci1_star_threshold&#39;: 2.0, &#39;ci2_star_threshold&#39;: 1.8}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:30,600 - stpipe.Image3Pipeline.source_catalog - INFO - Step skipped.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:30,603 - stpipe.Image3Pipeline.source_catalog - INFO - Step source_catalog done
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:30,604 - stpipe.Image3Pipeline - INFO - Step Image3Pipeline done
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Image 3 pipeline finished.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">img01_1_new</span> <span class="o">=</span> <span class="n">datamodels</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;MIRI_0_skymatch.fits&#39;</span><span class="p">)</span>
<span class="n">img01_2_new</span> <span class="o">=</span> <span class="n">datamodels</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;MIRI_1_skymatch.fits&#39;</span><span class="p">)</span>
<span class="n">img02_1_new</span> <span class="o">=</span> <span class="n">datamodels</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;MIRI_2_skymatch.fits&#39;</span><span class="p">)</span>
<span class="n">img02_2_new</span> <span class="o">=</span> <span class="n">datamodels</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;MIRI_3_skymatch.fits&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Global finds a single value for the background, and subtracts that value from all images.&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The values listed here should be the average of the subtracted sky values across images subtracted from each image.&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean: original, new (global)&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">img01_1</span><span class="o">.</span><span class="n">data</span><span class="p">),</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">img01_1_new</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">img01_2</span><span class="o">.</span><span class="n">data</span><span class="p">),</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">img01_2_new</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">img02_1</span><span class="o">.</span><span class="n">data</span><span class="p">),</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">img02_1_new</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">img02_2</span><span class="o">.</span><span class="n">data</span><span class="p">),</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">img02_2_new</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Global finds a single value for the background, and subtracts that value from all images.
The values listed here should be the average of the subtracted sky values across images subtracted from each image.
Mean: original, new (global)
Mean: 2.0004356 , 2.0004356
Mean: 2.9994354 , 2.9994354
Mean: 4.9994936 , 4.9994936
Mean: 2.0004356 , 2.0004356
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Look at combined image</span>
<span class="n">im_file</span> <span class="o">=</span> <span class="n">ImageModel</span><span class="p">(</span><span class="s1">&#39;skymatch_combined_i2d.fits&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Global finds a single value for the background, and subtracts that value from all images.&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The value listed here should be the average of the subtracted sky values across images.&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The combined image will look messy as the same value was subtracted from the image with background = 5&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;and from the images with background = 2. This shows the differing backgrounds strongly.&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">im_file</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">600</span><span class="p">:</span><span class="mi">700</span><span class="p">,</span><span class="mi">600</span><span class="p">:</span><span class="mi">700</span><span class="p">]))</span>

<span class="c1"># read in ecsv photom file</span>
<span class="kn">from</span> <span class="nn">astropy.visualization</span> <span class="kn">import</span> <span class="n">LogStretch</span><span class="p">,</span> <span class="n">PercentileInterval</span><span class="p">,</span> <span class="n">ManualInterval</span>

<span class="c1">#viz2 = LogStretch() + ManualInterval(0,10)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>
<span class="c1">#plt.imshow(viz2(im_file.data), origin=&#39;lower&#39;)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">im_file</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;rainbow&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Global finds a single value for the background, and subtracts that value from all images.
The value listed here should be the average of the subtracted sky values across images.
The combined image will look messy as the same value was subtracted from the image with background = 5
and from the images with background = 2. This shows the differing backgrounds strongly.
Mean: 3.0036535
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.colorbar.Colorbar at 0x7fed56af9390&gt;
</pre></div>
</div>
<img alt="../../../_images/exec_jwst_skymatch_miri_test_47_2.png" src="../../../_images/exec_jwst_skymatch_miri_test_47_2.png" />
</div>
</div>
</section>
</section>
<section id="run-tests-on-skymatch-method-match">
<h2>3. Run tests on Skymatch method ‘Match’<a class="headerlink" href="#run-tests-on-skymatch-method-match" title="Permalink to this headline">#</a></h2>
<section id="notes-match-compute-differences-in-sky-values-between-images-and-or-groups-in-pair-wise-common-sky-regions-in-this-case-computed-sky-values-will-be-relative-delta-to-the-sky-computed-in-one-of-the-input-images-whose-sky-value-will-be-set-to-reported-to-be-0-this-case-matches-to-the-lowest-sky-value">
<h3>Notes: ‘match’: compute differences in sky values between images and/or groups in (pair-wise) common sky regions. In this case computed sky values will be relative (delta) to the sky computed in one of the input images whose sky value will be set to (reported to be) 0. This case matches to the lowest sky value.<a class="headerlink" href="#notes-match-compute-differences-in-sky-values-between-images-and-or-groups-in-pair-wise-common-sky-regions-in-this-case-computed-sky-values-will-be-relative-delta-to-the-sky-computed-in-one-of-the-input-images-whose-sky-value-will-be-set-to-reported-to-be-0-this-case-matches-to-the-lowest-sky-value" title="Permalink to this headline">#</a></h3>
<p>Based on whether match_down is set to True or False, Match will calculate the difference between the lowest background level or highest level (respectively), and subtract the difference between the calculated level and the ‘matched’ level.</p>
<p>This is the preferred default option as it subtracts the differences between the background levels, normalizing all of the backgrounds to a common level (either lowest or highest background), rather than subtracting off all of the background.</p>
</section>
<section id="skymethod-match-match-down-true-subtract-true">
<h3>3.1 skymethod = ‘match’, match_down=True, subtract=True<a class="headerlink" href="#skymethod-match-match-down-true-subtract-true" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># skymatch, match down, subtract = True</span>
<span class="c1">#jwst.skymatch.skymatch_step.SkyMatchStep.call(skymatch_json_file2, skymethod=&#39;match&#39;, match_down=True,subtract=True,output_file=&#39;MIRI&#39;,save_results=True)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Test running just skymatch and resample and skiping other steps.</span>

<span class="c1"># Run Calwebb_image3 on the association table</span>
    
<span class="c1"># set any specific parameters</span>
<span class="n">skymethod</span> <span class="o">=</span> <span class="s1">&#39;match&#39;</span> <span class="c1"># sky computation algorithm to be used. Allowed values: {local, global, match, global+match} (Default = global+match</span>
<span class="n">match_down</span> <span class="o">=</span> <span class="kc">True</span> <span class="c1"># Specifies whether the sky differences should be subtracted from images with higher sky values (match_down = True) in order to match the image with the lowest sky or sky differences should be added to the images with lower sky values to match the sky of the image with the highest sky value (match_down = False). (Default = True</span>
<span class="n">subtract</span> <span class="o">=</span> <span class="kc">True</span> <span class="c1"># Specifies whether the computed sky background values are to be subtracted from the images. (Default = False   </span>
    
<span class="n">pipe3</span><span class="o">=</span><span class="n">Image3Pipeline</span><span class="p">()</span>    
<span class="n">pipe3</span><span class="o">.</span><span class="n">tweakreg</span><span class="o">.</span><span class="n">skip</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">outlier_detection</span><span class="o">.</span><span class="n">skip</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">source_catalog</span><span class="o">.</span><span class="n">skip</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">pipe3</span><span class="o">.</span><span class="n">skymatch</span><span class="o">.</span><span class="n">skymethod</span> <span class="o">=</span> <span class="n">skymethod</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">skymatch</span><span class="o">.</span><span class="n">match_down</span> <span class="o">=</span> <span class="n">match_down</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">skymatch</span><span class="o">.</span><span class="n">subtract</span> <span class="o">=</span> <span class="n">subtract</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">skymatch</span><span class="o">.</span><span class="n">output_file</span> <span class="o">=</span> <span class="s1">&#39;MIRI&#39;</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">skymatch</span><span class="o">.</span><span class="n">save_results</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">pipe3</span><span class="o">.</span><span class="n">resample</span><span class="o">.</span><span class="n">save_results</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">pipe3</span><span class="o">.</span><span class="n">save_results</span> <span class="o">=</span> <span class="kc">True</span>

<span class="c1"># run Image3</span>

<span class="n">image</span> <span class="o">=</span> <span class="n">pipe3</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">skymatch_json_file2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Image 3 pipeline finished.&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:31,967 - stpipe.Image3Pipeline - INFO - Image3Pipeline instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:31,969 - stpipe.Image3Pipeline.assign_mtwcs - INFO - AssignMTWcsStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:31,971 - stpipe.Image3Pipeline.tweakreg - INFO - TweakRegStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:31,973 - stpipe.Image3Pipeline.skymatch - INFO - SkyMatchStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:31,975 - stpipe.Image3Pipeline.outlier_detection - INFO - OutlierDetectionStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:31,977 - stpipe.Image3Pipeline.resample - INFO - ResampleStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:31,978 - stpipe.Image3Pipeline.source_catalog - INFO - SourceCatalogStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:32,246 - stpipe.Image3Pipeline - INFO - Step Image3Pipeline running with args (&#39;skymatch_asnfile2.json&#39;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:32,253 - stpipe.Image3Pipeline - INFO - Step Image3Pipeline parameters are: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: None, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: False, &#39;output_use_index&#39;: True, &#39;save_results&#39;: True, &#39;skip&#39;: False, &#39;suffix&#39;: None, &#39;search_output_file&#39;: True, &#39;input_dir&#39;: &#39;&#39;, &#39;steps&#39;: {&#39;assign_mtwcs&#39;: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: None, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: True, &#39;output_use_index&#39;: True, &#39;save_results&#39;: False, &#39;skip&#39;: False, &#39;suffix&#39;: &#39;assign_mtwcs&#39;, &#39;search_output_file&#39;: True, &#39;input_dir&#39;: &#39;&#39;}, &#39;tweakreg&#39;: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: None, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: True, &#39;output_use_index&#39;: True, &#39;save_results&#39;: False, &#39;skip&#39;: True, &#39;suffix&#39;: None, &#39;search_output_file&#39;: True, &#39;input_dir&#39;: &#39;&#39;, &#39;save_catalogs&#39;: False, &#39;catalog_format&#39;: &#39;ecsv&#39;, &#39;kernel_fwhm&#39;: 2.5, &#39;snr_threshold&#39;: 10.0, &#39;brightest&#39;: 200, &#39;peakmax&#39;: None, &#39;enforce_user_order&#39;: False, &#39;expand_refcat&#39;: False, &#39;minobj&#39;: 15, &#39;searchrad&#39;: 2.0, &#39;use2dhist&#39;: True, &#39;separation&#39;: 1.0, &#39;tolerance&#39;: 0.7, &#39;xoffset&#39;: 0.0, &#39;yoffset&#39;: 0.0, &#39;fitgeometry&#39;: &#39;rshift&#39;, &#39;nclip&#39;: 3, &#39;sigma&#39;: 3.0, &#39;align_to_gaia&#39;: False, &#39;gaia_catalog&#39;: &#39;GAIADR2&#39;, &#39;min_gaia&#39;: 5, &#39;save_gaia_catalog&#39;: False}, &#39;skymatch&#39;: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: &#39;/internal/data1/jenkins/workspace/Notebooks/jwst_validation_notebooks_spacetelescope/tmp/tmpt_z84t1b/MIRI&#39;, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: False, &#39;output_use_index&#39;: True, &#39;save_results&#39;: True, &#39;skip&#39;: False, &#39;suffix&#39;: None, &#39;search_output_file&#39;: True, &#39;input_dir&#39;: &#39;&#39;, &#39;skymethod&#39;: &#39;match&#39;, &#39;match_down&#39;: True, &#39;subtract&#39;: True, &#39;stepsize&#39;: None, &#39;skystat&#39;: &#39;mode&#39;, &#39;dqbits&#39;: &#39;~DO_NOT_USE+NON_SCIENCE&#39;, &#39;lower&#39;: None, &#39;upper&#39;: None, &#39;nclip&#39;: 5, &#39;lsigma&#39;: 4.0, &#39;usigma&#39;: 4.0, &#39;binwidth&#39;: 0.1}, &#39;outlier_detection&#39;: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: None, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: False, &#39;output_use_index&#39;: True, &#39;save_results&#39;: False, &#39;skip&#39;: True, &#39;suffix&#39;: None, &#39;search_output_file&#39;: False, &#39;input_dir&#39;: &#39;&#39;, &#39;weight_type&#39;: &#39;ivm&#39;, &#39;pixfrac&#39;: 1.0, &#39;kernel&#39;: &#39;square&#39;, &#39;fillval&#39;: &#39;INDEF&#39;, &#39;nlow&#39;: 0, &#39;nhigh&#39;: 0, &#39;maskpt&#39;: 0.7, &#39;grow&#39;: 1, &#39;snr&#39;: &#39;5.0 4.0&#39;, &#39;scale&#39;: &#39;1.2 0.7&#39;, &#39;backg&#39;: 0.0, &#39;save_intermediate_results&#39;: False, &#39;resample_data&#39;: True, &#39;good_bits&#39;: &#39;~DO_NOT_USE&#39;, &#39;scale_detection&#39;: False, &#39;allowed_memory&#39;: None}, &#39;resample&#39;: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: None, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: False, &#39;output_use_index&#39;: True, &#39;save_results&#39;: True, &#39;skip&#39;: False, &#39;suffix&#39;: None, &#39;search_output_file&#39;: True, &#39;input_dir&#39;: &#39;&#39;, &#39;pixfrac&#39;: 1.0, &#39;kernel&#39;: &#39;square&#39;, &#39;fillval&#39;: &#39;INDEF&#39;, &#39;weight_type&#39;: &#39;ivm&#39;, &#39;output_shape&#39;: None, &#39;crpix&#39;: None, &#39;crval&#39;: None, &#39;rotation&#39;: None, &#39;pixel_scale_ratio&#39;: 1.0, &#39;pixel_scale&#39;: None, &#39;single&#39;: False, &#39;blendheaders&#39;: True, &#39;allowed_memory&#39;: None}, &#39;source_catalog&#39;: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: None, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: False, &#39;output_use_index&#39;: True, &#39;save_results&#39;: False, &#39;skip&#39;: True, &#39;suffix&#39;: &#39;cat&#39;, &#39;search_output_file&#39;: True, &#39;input_dir&#39;: &#39;&#39;, &#39;bkg_boxsize&#39;: 100, &#39;kernel_fwhm&#39;: 2.0, &#39;snr_threshold&#39;: 3.0, &#39;npixels&#39;: 5, &#39;deblend&#39;: False, &#39;aperture_ee1&#39;: 30, &#39;aperture_ee2&#39;: 50, &#39;aperture_ee3&#39;: 70, &#39;ci1_star_threshold&#39;: 2.0, &#39;ci2_star_threshold&#39;: 1.8}}}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:32,385 - stpipe.Image3Pipeline - INFO - Prefetching reference files for dataset: &#39;det_image_seq1_MIRIMAGE_F560Wexp1_cal_skymatch.fits&#39; reftypes = [&#39;drizpars&#39;]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:32,387 - stpipe.Image3Pipeline - INFO - Prefetch for DRIZPARS reference file is &#39;/grp/crds/cache/references/jwst/jwst_miri_drizpars_0001.fits&#39;.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:32,391 - stpipe.Image3Pipeline - INFO - Starting calwebb_image3 ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:33,059 - stpipe.Image3Pipeline.tweakreg - INFO - Step tweakreg running with args (&lt;ModelContainer&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:33,061 - stpipe.Image3Pipeline.tweakreg - INFO - Step tweakreg parameters are: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: None, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: True, &#39;output_use_index&#39;: True, &#39;save_results&#39;: False, &#39;skip&#39;: True, &#39;suffix&#39;: None, &#39;search_output_file&#39;: True, &#39;input_dir&#39;: &#39;&#39;, &#39;save_catalogs&#39;: False, &#39;catalog_format&#39;: &#39;ecsv&#39;, &#39;kernel_fwhm&#39;: 2.5, &#39;snr_threshold&#39;: 10.0, &#39;brightest&#39;: 200, &#39;peakmax&#39;: None, &#39;enforce_user_order&#39;: False, &#39;expand_refcat&#39;: False, &#39;minobj&#39;: 15, &#39;searchrad&#39;: 2.0, &#39;use2dhist&#39;: True, &#39;separation&#39;: 1.0, &#39;tolerance&#39;: 0.7, &#39;xoffset&#39;: 0.0, &#39;yoffset&#39;: 0.0, &#39;fitgeometry&#39;: &#39;rshift&#39;, &#39;nclip&#39;: 3, &#39;sigma&#39;: 3.0, &#39;align_to_gaia&#39;: False, &#39;gaia_catalog&#39;: &#39;GAIADR2&#39;, &#39;min_gaia&#39;: 5, &#39;save_gaia_catalog&#39;: False}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:33,062 - stpipe.Image3Pipeline.tweakreg - INFO - Step skipped.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:33,069 - stpipe.Image3Pipeline.tweakreg - INFO - Step tweakreg done
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:33,254 - stpipe.Image3Pipeline.skymatch - INFO - Step skymatch running with args (&lt;ModelContainer&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:33,257 - stpipe.Image3Pipeline.skymatch - INFO - Step skymatch parameters are: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: &#39;/internal/data1/jenkins/workspace/Notebooks/jwst_validation_notebooks_spacetelescope/tmp/tmpt_z84t1b/MIRI&#39;, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: False, &#39;output_use_index&#39;: True, &#39;save_results&#39;: True, &#39;skip&#39;: False, &#39;suffix&#39;: None, &#39;search_output_file&#39;: True, &#39;input_dir&#39;: &#39;&#39;, &#39;skymethod&#39;: &#39;match&#39;, &#39;match_down&#39;: True, &#39;subtract&#39;: True, &#39;stepsize&#39;: None, &#39;skystat&#39;: &#39;mode&#39;, &#39;dqbits&#39;: &#39;~DO_NOT_USE+NON_SCIENCE&#39;, &#39;lower&#39;: None, &#39;upper&#39;: None, &#39;nclip&#39;: 5, &#39;lsigma&#39;: 4.0, &#39;usigma&#39;: 4.0, &#39;binwidth&#39;: 0.1}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:33,394 - stpipe.Image3Pipeline.skymatch - INFO -  
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:33,394 - stpipe.Image3Pipeline.skymatch - INFO - ***** jwst.skymatch.skymatch.match() started on 2022-07-07 08:11:33.394012
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:33,395 - stpipe.Image3Pipeline.skymatch - INFO -  
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:33,396 - stpipe.Image3Pipeline.skymatch - INFO - Sky computation method: &#39;match&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:33,396 - stpipe.Image3Pipeline.skymatch - INFO - Sky matching direction: DOWN
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:33,397 - stpipe.Image3Pipeline.skymatch - INFO - Sky subtraction from image data: ON
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:33,397 - stpipe.Image3Pipeline.skymatch - INFO -  
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:33,398 - stpipe.Image3Pipeline.skymatch - INFO - ----  Computing differences in sky values in overlapping regions.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:35,978 - stpipe.Image3Pipeline.skymatch - INFO -    *  Image ID=det_image_seq1_MIRIMAGE_F560Wexp1_cal_skymatch.fits. Sky background: 0 (old=0, delta=0)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:35,981 - stpipe.Image3Pipeline.skymatch - INFO -    *  Image ID=det_image_seq2_MIRIMAGE_F560Wexp1_cal_skymatch.fits. Sky background: 1.01058 (old=0, delta=1.01058)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:35,983 - stpipe.Image3Pipeline.skymatch - INFO -    *  Image ID=det_image_seq3_MIRIMAGE_F560Wexp1_cal_skymatch.fits. Sky background: 2.94606 (old=0, delta=2.94606)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:35,985 - stpipe.Image3Pipeline.skymatch - INFO -    *  Image ID=det_image_seq4_MIRIMAGE_F560Wexp1_cal_skymatch.fits. Sky background: 0.0109085 (old=0, delta=0.0109085)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:35,985 - stpipe.Image3Pipeline.skymatch - INFO -  
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:35,986 - stpipe.Image3Pipeline.skymatch - INFO - ***** jwst.skymatch.skymatch.match() ended on 2022-07-07 08:11:35.985762
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:35,987 - stpipe.Image3Pipeline.skymatch - INFO - ***** jwst.skymatch.skymatch.match() TOTAL RUN TIME: 0:00:02.591750
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:35,987 - stpipe.Image3Pipeline.skymatch - INFO -  
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:36,251 - stpipe.Image3Pipeline.skymatch - INFO - Saved model in MIRI_0_skymatch.fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:36,490 - stpipe.Image3Pipeline.skymatch - INFO - Saved model in MIRI_1_skymatch.fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:36,728 - stpipe.Image3Pipeline.skymatch - INFO - Saved model in MIRI_2_skymatch.fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:36,967 - stpipe.Image3Pipeline.skymatch - INFO - Saved model in MIRI_3_skymatch.fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:36,968 - stpipe.Image3Pipeline.skymatch - INFO - Step skymatch done
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:37,182 - stpipe.Image3Pipeline.outlier_detection - INFO - Step outlier_detection running with args (&lt;ModelContainer&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:37,184 - stpipe.Image3Pipeline.outlier_detection - INFO - Step outlier_detection parameters are: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: None, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: False, &#39;output_use_index&#39;: True, &#39;save_results&#39;: True, &#39;skip&#39;: True, &#39;suffix&#39;: &#39;crf&#39;, &#39;search_output_file&#39;: False, &#39;input_dir&#39;: &#39;&#39;, &#39;weight_type&#39;: &#39;ivm&#39;, &#39;pixfrac&#39;: 1.0, &#39;kernel&#39;: &#39;square&#39;, &#39;fillval&#39;: &#39;INDEF&#39;, &#39;nlow&#39;: 0, &#39;nhigh&#39;: 0, &#39;maskpt&#39;: 0.7, &#39;grow&#39;: 1, &#39;snr&#39;: &#39;5.0 4.0&#39;, &#39;scale&#39;: &#39;1.2 0.7&#39;, &#39;backg&#39;: 0.0, &#39;save_intermediate_results&#39;: False, &#39;resample_data&#39;: True, &#39;good_bits&#39;: &#39;~DO_NOT_USE&#39;, &#39;scale_detection&#39;: False, &#39;allowed_memory&#39;: None}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:37,185 - stpipe.Image3Pipeline.outlier_detection - INFO - Step skipped.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:37,191 - stpipe.Image3Pipeline.outlier_detection - INFO - Step outlier_detection done
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:37,377 - stpipe.Image3Pipeline.resample - INFO - Step resample running with args (&lt;ModelContainer&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:37,379 - stpipe.Image3Pipeline.resample - INFO - Step resample parameters are: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: None, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: False, &#39;output_use_index&#39;: True, &#39;save_results&#39;: True, &#39;skip&#39;: False, &#39;suffix&#39;: &#39;i2d&#39;, &#39;search_output_file&#39;: True, &#39;input_dir&#39;: &#39;&#39;, &#39;pixfrac&#39;: 1.0, &#39;kernel&#39;: &#39;square&#39;, &#39;fillval&#39;: &#39;INDEF&#39;, &#39;weight_type&#39;: &#39;ivm&#39;, &#39;output_shape&#39;: None, &#39;crpix&#39;: None, &#39;crval&#39;: None, &#39;rotation&#39;: None, &#39;pixel_scale_ratio&#39;: 1.0, &#39;pixel_scale&#39;: None, &#39;single&#39;: False, &#39;blendheaders&#39;: True, &#39;allowed_memory&#39;: None}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:37,400 - stpipe.Image3Pipeline.resample - INFO - Drizpars reference file: /grp/crds/cache/references/jwst/jwst_miri_drizpars_0001.fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:37,551 - stpipe.Image3Pipeline.resample - INFO - Blending metadata for skymatch_combined.fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:38,177 - stpipe.Image3Pipeline.resample - INFO - Resampling science data
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:38,779 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:39,731 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:40,693 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:41,703 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:42,065 - stpipe.Image3Pipeline.resample - INFO - Resampling var_rnoise
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:42,656 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:43,600 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:44,639 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:45,596 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:45,955 - stpipe.Image3Pipeline.resample - INFO - Resampling var_poisson
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:46,543 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:47,476 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:48,412 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:49,351 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:49,712 - stpipe.Image3Pipeline.resample - INFO - Resampling var_flat
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:50,302 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:51,246 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:52,189 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:53,164 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:53,544 - stpipe.Image3Pipeline.resample - INFO - Update S_REGION to POLYGON ICRS  0.020232898 -0.018692220 0.023327823 0.016575172 359.989011943 0.019586596 359.985917018 -0.015680796
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:53,966 - stpipe.Image3Pipeline.resample - INFO - Saved model in skymatch_combined_i2d.fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:53,968 - stpipe.Image3Pipeline.resample - INFO - Step resample done
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:54,187 - stpipe.Image3Pipeline.source_catalog - INFO - Step source_catalog running with args (&lt;ImageModel(1149, 1118) from skymatch_combined_i2d.fits&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:54,189 - stpipe.Image3Pipeline.source_catalog - INFO - Step source_catalog parameters are: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: None, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: False, &#39;output_use_index&#39;: True, &#39;save_results&#39;: True, &#39;skip&#39;: True, &#39;suffix&#39;: &#39;cat&#39;, &#39;search_output_file&#39;: True, &#39;input_dir&#39;: &#39;&#39;, &#39;bkg_boxsize&#39;: 100, &#39;kernel_fwhm&#39;: 2.0, &#39;snr_threshold&#39;: 3.0, &#39;npixels&#39;: 5, &#39;deblend&#39;: False, &#39;aperture_ee1&#39;: 30, &#39;aperture_ee2&#39;: 50, &#39;aperture_ee3&#39;: 70, &#39;ci1_star_threshold&#39;: 2.0, &#39;ci2_star_threshold&#39;: 1.8}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:54,190 - stpipe.Image3Pipeline.source_catalog - INFO - Step skipped.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:54,193 - stpipe.Image3Pipeline.source_catalog - INFO - Step source_catalog done
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:54,195 - stpipe.Image3Pipeline - INFO - Step Image3Pipeline done
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Image 3 pipeline finished.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">img01_1_new</span> <span class="o">=</span> <span class="n">datamodels</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;MIRI_0_skymatch.fits&#39;</span><span class="p">)</span>
<span class="n">img01_2_new</span> <span class="o">=</span> <span class="n">datamodels</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;MIRI_1_skymatch.fits&#39;</span><span class="p">)</span>
<span class="n">img02_1_new</span> <span class="o">=</span> <span class="n">datamodels</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;MIRI_2_skymatch.fits&#39;</span><span class="p">)</span>
<span class="n">img02_2_new</span> <span class="o">=</span> <span class="n">datamodels</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;MIRI_3_skymatch.fits&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;There should be no subtraction at this step, with subtraction = False.&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean: original, new (match down)&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">img01_1</span><span class="o">.</span><span class="n">data</span><span class="p">),</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">img01_1_new</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">img01_2</span><span class="o">.</span><span class="n">data</span><span class="p">),</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">img01_2_new</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">img02_1</span><span class="o">.</span><span class="n">data</span><span class="p">),</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">img02_1_new</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">img02_2</span><span class="o">.</span><span class="n">data</span><span class="p">),</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">img02_2_new</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>There should be no subtraction at this step, with subtraction = False.
Mean: original, new (match down)
Mean: 2.0004356 , 2.0004356
Mean: 2.9994354 , 2.9994354
Mean: 4.9994936 , 4.9994936
Mean: 2.0004356 , 2.0004356
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Look at combined image</span>
<span class="n">im_file</span> <span class="o">=</span> <span class="n">ImageModel</span><span class="p">(</span><span class="s1">&#39;skymatch_combined_i2d.fits&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;For the method match with match_down= True, the value of the background should match the minimum of the individual backgrounds.&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;This value should match the values in the new column above. Subtraction was done in skymatch step.&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">im_file</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">600</span><span class="p">:</span><span class="mi">700</span><span class="p">,</span><span class="mi">600</span><span class="p">:</span><span class="mi">700</span><span class="p">]))</span>

<span class="c1"># read in ecsv photom file</span>
<span class="kn">from</span> <span class="nn">astropy.visualization</span> <span class="kn">import</span> <span class="n">LogStretch</span><span class="p">,</span> <span class="n">PercentileInterval</span><span class="p">,</span> <span class="n">ManualInterval</span>

<span class="c1">#viz2 = LogStretch() + ManualInterval(0,10)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>
<span class="c1">#plt.imshow(viz2(im_file.data), origin=&#39;lower&#39;)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">im_file</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;rainbow&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>For the method match with match_down= True, the value of the background should match the minimum of the individual backgrounds.
This value should match the values in the new column above. Subtraction was done in skymatch step.
Mean: 3.0036535
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.colorbar.Colorbar at 0x7fed56541d20&gt;
</pre></div>
</div>
<img alt="../../../_images/exec_jwst_skymatch_miri_test_53_2.png" src="../../../_images/exec_jwst_skymatch_miri_test_53_2.png" />
</div>
</div>
</section>
<section id="check-that-all-output-new-sky-values-are-equal-to-the-lowest-original-sky-value">
<h3>** Check that all output (new) sky values are equal to the lowest original sky value<a class="headerlink" href="#check-that-all-output-new-sky-values-are-equal-to-the-lowest-original-sky-value" title="Permalink to this headline">#</a></h3>
</section>
<section id="skymethod-match-match-down-false-subtract-true">
<h3>3.2 skymethod = ‘match’, match_down=False, subtract = True<a class="headerlink" href="#skymethod-match-match-down-false-subtract-true" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># skymatch, match up, subtract = True</span>
<span class="c1">#jwst.skymatch.skymatch_step.SkyMatchStep.call(skymatch_json_file2, skymethod=&#39;match&#39;, match_down=False,subtract=True,output_file=&#39;MIRI&#39;,save_results=True)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Test running just skymatch and resample and skiping other steps.</span>

<span class="c1"># Run Calwebb_image3 on the association table</span>
    
<span class="c1"># set any specific parameters</span>
<span class="n">skymethod</span> <span class="o">=</span> <span class="s1">&#39;match&#39;</span> <span class="c1"># sky computation algorithm to be used. Allowed values: {local, global, match, global+match} (Default = global+match</span>
<span class="n">match_down</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1"># Specifies whether the sky differences should be subtracted from images with higher sky values (match_down = True) in order to match the image with the lowest sky or sky differences should be added to the images with lower sky values to match the sky of the image with the highest sky value (match_down = False). (Default = True</span>
<span class="n">subtract</span> <span class="o">=</span> <span class="kc">True</span> <span class="c1"># Specifies whether the computed sky background values are to be subtracted from the images. (Default = False   </span>
    
<span class="n">pipe3</span><span class="o">=</span><span class="n">Image3Pipeline</span><span class="p">()</span>    
<span class="n">pipe3</span><span class="o">.</span><span class="n">tweakreg</span><span class="o">.</span><span class="n">skip</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">outlier_detection</span><span class="o">.</span><span class="n">skip</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">source_catalog</span><span class="o">.</span><span class="n">skip</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">pipe3</span><span class="o">.</span><span class="n">skymatch</span><span class="o">.</span><span class="n">skymethod</span> <span class="o">=</span> <span class="n">skymethod</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">skymatch</span><span class="o">.</span><span class="n">match_down</span> <span class="o">=</span> <span class="n">match_down</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">skymatch</span><span class="o">.</span><span class="n">subtract</span> <span class="o">=</span> <span class="n">subtract</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">skymatch</span><span class="o">.</span><span class="n">output_file</span> <span class="o">=</span> <span class="s1">&#39;MIRI&#39;</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">skymatch</span><span class="o">.</span><span class="n">save_results</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">pipe3</span><span class="o">.</span><span class="n">resample</span><span class="o">.</span><span class="n">save_results</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">pipe3</span><span class="o">.</span><span class="n">save_results</span> <span class="o">=</span> <span class="kc">True</span>

<span class="c1"># run Image3</span>

<span class="n">image</span> <span class="o">=</span> <span class="n">pipe3</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">skymatch_json_file2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Image 3 pipeline finished.&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:55,519 - stpipe.Image3Pipeline - INFO - Image3Pipeline instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:55,520 - stpipe.Image3Pipeline.assign_mtwcs - INFO - AssignMTWcsStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:55,522 - stpipe.Image3Pipeline.tweakreg - INFO - TweakRegStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:55,524 - stpipe.Image3Pipeline.skymatch - INFO - SkyMatchStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:55,526 - stpipe.Image3Pipeline.outlier_detection - INFO - OutlierDetectionStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:55,527 - stpipe.Image3Pipeline.resample - INFO - ResampleStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:55,529 - stpipe.Image3Pipeline.source_catalog - INFO - SourceCatalogStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:55,785 - stpipe.Image3Pipeline - INFO - Step Image3Pipeline running with args (&#39;skymatch_asnfile2.json&#39;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:55,792 - stpipe.Image3Pipeline - INFO - Step Image3Pipeline parameters are: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: None, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: False, &#39;output_use_index&#39;: True, &#39;save_results&#39;: True, &#39;skip&#39;: False, &#39;suffix&#39;: None, &#39;search_output_file&#39;: True, &#39;input_dir&#39;: &#39;&#39;, &#39;steps&#39;: {&#39;assign_mtwcs&#39;: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: None, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: True, &#39;output_use_index&#39;: True, &#39;save_results&#39;: False, &#39;skip&#39;: False, &#39;suffix&#39;: &#39;assign_mtwcs&#39;, &#39;search_output_file&#39;: True, &#39;input_dir&#39;: &#39;&#39;}, &#39;tweakreg&#39;: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: None, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: True, &#39;output_use_index&#39;: True, &#39;save_results&#39;: False, &#39;skip&#39;: True, &#39;suffix&#39;: None, &#39;search_output_file&#39;: True, &#39;input_dir&#39;: &#39;&#39;, &#39;save_catalogs&#39;: False, &#39;catalog_format&#39;: &#39;ecsv&#39;, &#39;kernel_fwhm&#39;: 2.5, &#39;snr_threshold&#39;: 10.0, &#39;brightest&#39;: 200, &#39;peakmax&#39;: None, &#39;enforce_user_order&#39;: False, &#39;expand_refcat&#39;: False, &#39;minobj&#39;: 15, &#39;searchrad&#39;: 2.0, &#39;use2dhist&#39;: True, &#39;separation&#39;: 1.0, &#39;tolerance&#39;: 0.7, &#39;xoffset&#39;: 0.0, &#39;yoffset&#39;: 0.0, &#39;fitgeometry&#39;: &#39;rshift&#39;, &#39;nclip&#39;: 3, &#39;sigma&#39;: 3.0, &#39;align_to_gaia&#39;: False, &#39;gaia_catalog&#39;: &#39;GAIADR2&#39;, &#39;min_gaia&#39;: 5, &#39;save_gaia_catalog&#39;: False}, &#39;skymatch&#39;: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: &#39;/internal/data1/jenkins/workspace/Notebooks/jwst_validation_notebooks_spacetelescope/tmp/tmpt_z84t1b/MIRI&#39;, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: False, &#39;output_use_index&#39;: True, &#39;save_results&#39;: True, &#39;skip&#39;: False, &#39;suffix&#39;: None, &#39;search_output_file&#39;: True, &#39;input_dir&#39;: &#39;&#39;, &#39;skymethod&#39;: &#39;match&#39;, &#39;match_down&#39;: False, &#39;subtract&#39;: True, &#39;stepsize&#39;: None, &#39;skystat&#39;: &#39;mode&#39;, &#39;dqbits&#39;: &#39;~DO_NOT_USE+NON_SCIENCE&#39;, &#39;lower&#39;: None, &#39;upper&#39;: None, &#39;nclip&#39;: 5, &#39;lsigma&#39;: 4.0, &#39;usigma&#39;: 4.0, &#39;binwidth&#39;: 0.1}, &#39;outlier_detection&#39;: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: None, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: False, &#39;output_use_index&#39;: True, &#39;save_results&#39;: False, &#39;skip&#39;: True, &#39;suffix&#39;: None, &#39;search_output_file&#39;: False, &#39;input_dir&#39;: &#39;&#39;, &#39;weight_type&#39;: &#39;ivm&#39;, &#39;pixfrac&#39;: 1.0, &#39;kernel&#39;: &#39;square&#39;, &#39;fillval&#39;: &#39;INDEF&#39;, &#39;nlow&#39;: 0, &#39;nhigh&#39;: 0, &#39;maskpt&#39;: 0.7, &#39;grow&#39;: 1, &#39;snr&#39;: &#39;5.0 4.0&#39;, &#39;scale&#39;: &#39;1.2 0.7&#39;, &#39;backg&#39;: 0.0, &#39;save_intermediate_results&#39;: False, &#39;resample_data&#39;: True, &#39;good_bits&#39;: &#39;~DO_NOT_USE&#39;, &#39;scale_detection&#39;: False, &#39;allowed_memory&#39;: None}, &#39;resample&#39;: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: None, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: False, &#39;output_use_index&#39;: True, &#39;save_results&#39;: True, &#39;skip&#39;: False, &#39;suffix&#39;: None, &#39;search_output_file&#39;: True, &#39;input_dir&#39;: &#39;&#39;, &#39;pixfrac&#39;: 1.0, &#39;kernel&#39;: &#39;square&#39;, &#39;fillval&#39;: &#39;INDEF&#39;, &#39;weight_type&#39;: &#39;ivm&#39;, &#39;output_shape&#39;: None, &#39;crpix&#39;: None, &#39;crval&#39;: None, &#39;rotation&#39;: None, &#39;pixel_scale_ratio&#39;: 1.0, &#39;pixel_scale&#39;: None, &#39;single&#39;: False, &#39;blendheaders&#39;: True, &#39;allowed_memory&#39;: None}, &#39;source_catalog&#39;: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: None, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: False, &#39;output_use_index&#39;: True, &#39;save_results&#39;: False, &#39;skip&#39;: True, &#39;suffix&#39;: &#39;cat&#39;, &#39;search_output_file&#39;: True, &#39;input_dir&#39;: &#39;&#39;, &#39;bkg_boxsize&#39;: 100, &#39;kernel_fwhm&#39;: 2.0, &#39;snr_threshold&#39;: 3.0, &#39;npixels&#39;: 5, &#39;deblend&#39;: False, &#39;aperture_ee1&#39;: 30, &#39;aperture_ee2&#39;: 50, &#39;aperture_ee3&#39;: 70, &#39;ci1_star_threshold&#39;: 2.0, &#39;ci2_star_threshold&#39;: 1.8}}}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:55,923 - stpipe.Image3Pipeline - INFO - Prefetching reference files for dataset: &#39;det_image_seq1_MIRIMAGE_F560Wexp1_cal_skymatch.fits&#39; reftypes = [&#39;drizpars&#39;]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:55,925 - stpipe.Image3Pipeline - INFO - Prefetch for DRIZPARS reference file is &#39;/grp/crds/cache/references/jwst/jwst_miri_drizpars_0001.fits&#39;.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:55,928 - stpipe.Image3Pipeline - INFO - Starting calwebb_image3 ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:56,615 - stpipe.Image3Pipeline.tweakreg - INFO - Step tweakreg running with args (&lt;ModelContainer&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:56,617 - stpipe.Image3Pipeline.tweakreg - INFO - Step tweakreg parameters are: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: None, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: True, &#39;output_use_index&#39;: True, &#39;save_results&#39;: False, &#39;skip&#39;: True, &#39;suffix&#39;: None, &#39;search_output_file&#39;: True, &#39;input_dir&#39;: &#39;&#39;, &#39;save_catalogs&#39;: False, &#39;catalog_format&#39;: &#39;ecsv&#39;, &#39;kernel_fwhm&#39;: 2.5, &#39;snr_threshold&#39;: 10.0, &#39;brightest&#39;: 200, &#39;peakmax&#39;: None, &#39;enforce_user_order&#39;: False, &#39;expand_refcat&#39;: False, &#39;minobj&#39;: 15, &#39;searchrad&#39;: 2.0, &#39;use2dhist&#39;: True, &#39;separation&#39;: 1.0, &#39;tolerance&#39;: 0.7, &#39;xoffset&#39;: 0.0, &#39;yoffset&#39;: 0.0, &#39;fitgeometry&#39;: &#39;rshift&#39;, &#39;nclip&#39;: 3, &#39;sigma&#39;: 3.0, &#39;align_to_gaia&#39;: False, &#39;gaia_catalog&#39;: &#39;GAIADR2&#39;, &#39;min_gaia&#39;: 5, &#39;save_gaia_catalog&#39;: False}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:56,618 - stpipe.Image3Pipeline.tweakreg - INFO - Step skipped.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:56,625 - stpipe.Image3Pipeline.tweakreg - INFO - Step tweakreg done
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:56,820 - stpipe.Image3Pipeline.skymatch - INFO - Step skymatch running with args (&lt;ModelContainer&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:56,822 - stpipe.Image3Pipeline.skymatch - INFO - Step skymatch parameters are: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: &#39;/internal/data1/jenkins/workspace/Notebooks/jwst_validation_notebooks_spacetelescope/tmp/tmpt_z84t1b/MIRI&#39;, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: False, &#39;output_use_index&#39;: True, &#39;save_results&#39;: True, &#39;skip&#39;: False, &#39;suffix&#39;: None, &#39;search_output_file&#39;: True, &#39;input_dir&#39;: &#39;&#39;, &#39;skymethod&#39;: &#39;match&#39;, &#39;match_down&#39;: False, &#39;subtract&#39;: True, &#39;stepsize&#39;: None, &#39;skystat&#39;: &#39;mode&#39;, &#39;dqbits&#39;: &#39;~DO_NOT_USE+NON_SCIENCE&#39;, &#39;lower&#39;: None, &#39;upper&#39;: None, &#39;nclip&#39;: 5, &#39;lsigma&#39;: 4.0, &#39;usigma&#39;: 4.0, &#39;binwidth&#39;: 0.1}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:56,961 - stpipe.Image3Pipeline.skymatch - INFO -  
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:56,962 - stpipe.Image3Pipeline.skymatch - INFO - ***** jwst.skymatch.skymatch.match() started on 2022-07-07 08:11:56.961183
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:56,963 - stpipe.Image3Pipeline.skymatch - INFO -  
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:56,963 - stpipe.Image3Pipeline.skymatch - INFO - Sky computation method: &#39;match&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:56,964 - stpipe.Image3Pipeline.skymatch - INFO - Sky matching direction: UP
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:56,964 - stpipe.Image3Pipeline.skymatch - INFO - Sky subtraction from image data: ON
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:56,965 - stpipe.Image3Pipeline.skymatch - INFO -  
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:56,966 - stpipe.Image3Pipeline.skymatch - INFO - ----  Computing differences in sky values in overlapping regions.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:59,530 - stpipe.Image3Pipeline.skymatch - INFO -    *  Image ID=det_image_seq1_MIRIMAGE_F560Wexp1_cal_skymatch.fits. Sky background: -2.94606 (old=0, delta=-2.94606)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:59,533 - stpipe.Image3Pipeline.skymatch - INFO -    *  Image ID=det_image_seq2_MIRIMAGE_F560Wexp1_cal_skymatch.fits. Sky background: -1.93548 (old=0, delta=-1.93548)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:59,534 - stpipe.Image3Pipeline.skymatch - INFO -    *  Image ID=det_image_seq3_MIRIMAGE_F560Wexp1_cal_skymatch.fits. Sky background: 0 (old=0, delta=0)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:59,536 - stpipe.Image3Pipeline.skymatch - INFO -    *  Image ID=det_image_seq4_MIRIMAGE_F560Wexp1_cal_skymatch.fits. Sky background: -2.93515 (old=0, delta=-2.93515)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:59,537 - stpipe.Image3Pipeline.skymatch - INFO -  
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:59,538 - stpipe.Image3Pipeline.skymatch - INFO - ***** jwst.skymatch.skymatch.match() ended on 2022-07-07 08:11:59.537403
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:59,538 - stpipe.Image3Pipeline.skymatch - INFO - ***** jwst.skymatch.skymatch.match() TOTAL RUN TIME: 0:00:02.576220
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:59,539 - stpipe.Image3Pipeline.skymatch - INFO -  
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:11:59,798 - stpipe.Image3Pipeline.skymatch - INFO - Saved model in MIRI_0_skymatch.fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:00,036 - stpipe.Image3Pipeline.skymatch - INFO - Saved model in MIRI_1_skymatch.fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:00,274 - stpipe.Image3Pipeline.skymatch - INFO - Saved model in MIRI_2_skymatch.fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:00,515 - stpipe.Image3Pipeline.skymatch - INFO - Saved model in MIRI_3_skymatch.fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:00,516 - stpipe.Image3Pipeline.skymatch - INFO - Step skymatch done
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:00,741 - stpipe.Image3Pipeline.outlier_detection - INFO - Step outlier_detection running with args (&lt;ModelContainer&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:00,744 - stpipe.Image3Pipeline.outlier_detection - INFO - Step outlier_detection parameters are: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: None, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: False, &#39;output_use_index&#39;: True, &#39;save_results&#39;: True, &#39;skip&#39;: True, &#39;suffix&#39;: &#39;crf&#39;, &#39;search_output_file&#39;: False, &#39;input_dir&#39;: &#39;&#39;, &#39;weight_type&#39;: &#39;ivm&#39;, &#39;pixfrac&#39;: 1.0, &#39;kernel&#39;: &#39;square&#39;, &#39;fillval&#39;: &#39;INDEF&#39;, &#39;nlow&#39;: 0, &#39;nhigh&#39;: 0, &#39;maskpt&#39;: 0.7, &#39;grow&#39;: 1, &#39;snr&#39;: &#39;5.0 4.0&#39;, &#39;scale&#39;: &#39;1.2 0.7&#39;, &#39;backg&#39;: 0.0, &#39;save_intermediate_results&#39;: False, &#39;resample_data&#39;: True, &#39;good_bits&#39;: &#39;~DO_NOT_USE&#39;, &#39;scale_detection&#39;: False, &#39;allowed_memory&#39;: None}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:00,744 - stpipe.Image3Pipeline.outlier_detection - INFO - Step skipped.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:00,751 - stpipe.Image3Pipeline.outlier_detection - INFO - Step outlier_detection done
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:00,945 - stpipe.Image3Pipeline.resample - INFO - Step resample running with args (&lt;ModelContainer&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:00,947 - stpipe.Image3Pipeline.resample - INFO - Step resample parameters are: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: None, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: False, &#39;output_use_index&#39;: True, &#39;save_results&#39;: True, &#39;skip&#39;: False, &#39;suffix&#39;: &#39;i2d&#39;, &#39;search_output_file&#39;: True, &#39;input_dir&#39;: &#39;&#39;, &#39;pixfrac&#39;: 1.0, &#39;kernel&#39;: &#39;square&#39;, &#39;fillval&#39;: &#39;INDEF&#39;, &#39;weight_type&#39;: &#39;ivm&#39;, &#39;output_shape&#39;: None, &#39;crpix&#39;: None, &#39;crval&#39;: None, &#39;rotation&#39;: None, &#39;pixel_scale_ratio&#39;: 1.0, &#39;pixel_scale&#39;: None, &#39;single&#39;: False, &#39;blendheaders&#39;: True, &#39;allowed_memory&#39;: None}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:00,965 - stpipe.Image3Pipeline.resample - INFO - Drizpars reference file: /grp/crds/cache/references/jwst/jwst_miri_drizpars_0001.fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:01,108 - stpipe.Image3Pipeline.resample - INFO - Blending metadata for skymatch_combined.fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:01,733 - stpipe.Image3Pipeline.resample - INFO - Resampling science data
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:02,324 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:03,284 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:04,236 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:05,176 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:05,533 - stpipe.Image3Pipeline.resample - INFO - Resampling var_rnoise
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:06,144 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:07,140 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:08,081 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:09,023 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:09,384 - stpipe.Image3Pipeline.resample - INFO - Resampling var_poisson
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:09,984 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:10,921 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:11,881 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:12,830 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:13,188 - stpipe.Image3Pipeline.resample - INFO - Resampling var_flat
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:13,762 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:14,707 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:15,686 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:16,628 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:17,007 - stpipe.Image3Pipeline.resample - INFO - Update S_REGION to POLYGON ICRS  0.020232898 -0.018692220 0.023327823 0.016575172 359.989011943 0.019586596 359.985917018 -0.015680796
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:17,445 - stpipe.Image3Pipeline.resample - INFO - Saved model in skymatch_combined_i2d.fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:17,446 - stpipe.Image3Pipeline.resample - INFO - Step resample done
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:17,712 - stpipe.Image3Pipeline.source_catalog - INFO - Step source_catalog running with args (&lt;ImageModel(1149, 1118) from skymatch_combined_i2d.fits&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:17,714 - stpipe.Image3Pipeline.source_catalog - INFO - Step source_catalog parameters are: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: None, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: False, &#39;output_use_index&#39;: True, &#39;save_results&#39;: True, &#39;skip&#39;: True, &#39;suffix&#39;: &#39;cat&#39;, &#39;search_output_file&#39;: True, &#39;input_dir&#39;: &#39;&#39;, &#39;bkg_boxsize&#39;: 100, &#39;kernel_fwhm&#39;: 2.0, &#39;snr_threshold&#39;: 3.0, &#39;npixels&#39;: 5, &#39;deblend&#39;: False, &#39;aperture_ee1&#39;: 30, &#39;aperture_ee2&#39;: 50, &#39;aperture_ee3&#39;: 70, &#39;ci1_star_threshold&#39;: 2.0, &#39;ci2_star_threshold&#39;: 1.8}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:17,715 - stpipe.Image3Pipeline.source_catalog - INFO - Step skipped.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:17,717 - stpipe.Image3Pipeline.source_catalog - INFO - Step source_catalog done
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:17,718 - stpipe.Image3Pipeline - INFO - Step Image3Pipeline done
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Image 3 pipeline finished.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">img01_1_new</span> <span class="o">=</span> <span class="n">datamodels</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;MIRI_0_skymatch.fits&#39;</span><span class="p">)</span>
<span class="n">img01_2_new</span> <span class="o">=</span> <span class="n">datamodels</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;MIRI_1_skymatch.fits&#39;</span><span class="p">)</span>
<span class="n">img02_1_new</span> <span class="o">=</span> <span class="n">datamodels</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;MIRI_2_skymatch.fits&#39;</span><span class="p">)</span>
<span class="n">img02_2_new</span> <span class="o">=</span> <span class="n">datamodels</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;MIRI_3_skymatch.fits&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;With match_down = False, match will match the backgrounds of all to the highest background.&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;With subtract = True, the background matching is done at the skymatch step.&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean: original, new (match up)&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">img01_1</span><span class="o">.</span><span class="n">data</span><span class="p">),</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">img01_1_new</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">img01_2</span><span class="o">.</span><span class="n">data</span><span class="p">),</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">img01_2_new</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">img02_1</span><span class="o">.</span><span class="n">data</span><span class="p">),</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">img02_1_new</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">img02_2</span><span class="o">.</span><span class="n">data</span><span class="p">),</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">img02_2_new</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>With match_down = False, match will match the backgrounds of all to the highest background.
With subtract = True, the background matching is done at the skymatch step.
Mean: original, new (match up)
Mean: 2.0004356 , 2.0004356
Mean: 2.9994354 , 2.9994354
Mean: 4.9994936 , 4.9994936
Mean: 2.0004356 , 2.0004356
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Look at combined image</span>
<span class="n">im_file</span> <span class="o">=</span> <span class="n">ImageModel</span><span class="p">(</span><span class="s1">&#39;skymatch_combined_i2d.fits&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;For the method match with match_down=False, the value of the background should match the maximum of the individual backgrounds&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;This value should match the values in the new column above. Subtraction was done in skymatch step.&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">im_file</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">600</span><span class="p">:</span><span class="mi">700</span><span class="p">,</span><span class="mi">600</span><span class="p">:</span><span class="mi">700</span><span class="p">]))</span>

<span class="c1"># read in ecsv photom file</span>
<span class="kn">from</span> <span class="nn">astropy.visualization</span> <span class="kn">import</span> <span class="n">LogStretch</span><span class="p">,</span> <span class="n">PercentileInterval</span><span class="p">,</span> <span class="n">ManualInterval</span>

<span class="c1">#viz2 = LogStretch() + ManualInterval(0,10)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>
<span class="c1">#plt.imshow(viz2(im_file.data), origin=&#39;lower&#39;)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">im_file</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;rainbow&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>For the method match with match_down=False, the value of the background should match the maximum of the individual backgrounds
This value should match the values in the new column above. Subtraction was done in skymatch step.
Mean: 3.0036535
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.colorbar.Colorbar at 0x7fed5620bc10&gt;
</pre></div>
</div>
<img alt="../../../_images/exec_jwst_skymatch_miri_test_59_2.png" src="../../../_images/exec_jwst_skymatch_miri_test_59_2.png" />
</div>
</div>
</section>
<section id="check-that-all-output-new-sky-values-are-equal-to-the-highest-original-sky-value">
<h3>** Check that all output (new) sky values are equal to the highest original sky value<a class="headerlink" href="#check-that-all-output-new-sky-values-are-equal-to-the-highest-original-sky-value" title="Permalink to this headline">#</a></h3>
</section>
<section id="skymethod-match-match-down-true-subtract-false">
<h3>3.3 skymethod = ‘match’, match_down = True, subtract = False<a class="headerlink" href="#skymethod-match-match-down-true-subtract-false" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Test running just skymatch and resample and skiping other steps.</span>

<span class="c1"># Run Calwebb_image3 on the association table</span>
    
<span class="c1"># set any specific parameters</span>
<span class="n">skymethod</span> <span class="o">=</span> <span class="s1">&#39;match&#39;</span> <span class="c1"># sky computation algorithm to be used. Allowed values: {local, global, match, global+match} (Default = global+match</span>
<span class="n">match_down</span> <span class="o">=</span> <span class="kc">True</span> <span class="c1"># Specifies whether the sky differences should be subtracted from images with higher sky values (match_down = True) in order to match the image with the lowest sky or sky differences should be added to the images with lower sky values to match the sky of the image with the highest sky value (match_down = False). (Default = True</span>
<span class="n">subtract</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1"># Specifies whether the computed sky background values are to be subtracted from the images. (Default = False   </span>
    
<span class="n">pipe3</span><span class="o">=</span><span class="n">Image3Pipeline</span><span class="p">()</span>    
<span class="n">pipe3</span><span class="o">.</span><span class="n">tweakreg</span><span class="o">.</span><span class="n">skip</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">outlier_detection</span><span class="o">.</span><span class="n">skip</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">source_catalog</span><span class="o">.</span><span class="n">skip</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">pipe3</span><span class="o">.</span><span class="n">skymatch</span><span class="o">.</span><span class="n">skymethod</span> <span class="o">=</span> <span class="n">skymethod</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">skymatch</span><span class="o">.</span><span class="n">match_down</span> <span class="o">=</span> <span class="n">match_down</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">skymatch</span><span class="o">.</span><span class="n">subtract</span> <span class="o">=</span> <span class="n">subtract</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">skymatch</span><span class="o">.</span><span class="n">output_file</span> <span class="o">=</span> <span class="s1">&#39;MIRI&#39;</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">skymatch</span><span class="o">.</span><span class="n">save_results</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">pipe3</span><span class="o">.</span><span class="n">resample</span><span class="o">.</span><span class="n">save_results</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">pipe3</span><span class="o">.</span><span class="n">save_results</span> <span class="o">=</span> <span class="kc">True</span>

<span class="c1"># run Image3</span>

<span class="n">image</span> <span class="o">=</span> <span class="n">pipe3</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">skymatch_json_file2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Image 3 pipeline finished.&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:19,047 - stpipe.Image3Pipeline - INFO - Image3Pipeline instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:19,048 - stpipe.Image3Pipeline.assign_mtwcs - INFO - AssignMTWcsStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:19,051 - stpipe.Image3Pipeline.tweakreg - INFO - TweakRegStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:19,053 - stpipe.Image3Pipeline.skymatch - INFO - SkyMatchStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:19,054 - stpipe.Image3Pipeline.outlier_detection - INFO - OutlierDetectionStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:19,056 - stpipe.Image3Pipeline.resample - INFO - ResampleStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:19,058 - stpipe.Image3Pipeline.source_catalog - INFO - SourceCatalogStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:19,317 - stpipe.Image3Pipeline - INFO - Step Image3Pipeline running with args (&#39;skymatch_asnfile2.json&#39;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:19,323 - stpipe.Image3Pipeline - INFO - Step Image3Pipeline parameters are: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: None, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: False, &#39;output_use_index&#39;: True, &#39;save_results&#39;: True, &#39;skip&#39;: False, &#39;suffix&#39;: None, &#39;search_output_file&#39;: True, &#39;input_dir&#39;: &#39;&#39;, &#39;steps&#39;: {&#39;assign_mtwcs&#39;: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: None, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: True, &#39;output_use_index&#39;: True, &#39;save_results&#39;: False, &#39;skip&#39;: False, &#39;suffix&#39;: &#39;assign_mtwcs&#39;, &#39;search_output_file&#39;: True, &#39;input_dir&#39;: &#39;&#39;}, &#39;tweakreg&#39;: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: None, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: True, &#39;output_use_index&#39;: True, &#39;save_results&#39;: False, &#39;skip&#39;: True, &#39;suffix&#39;: None, &#39;search_output_file&#39;: True, &#39;input_dir&#39;: &#39;&#39;, &#39;save_catalogs&#39;: False, &#39;catalog_format&#39;: &#39;ecsv&#39;, &#39;kernel_fwhm&#39;: 2.5, &#39;snr_threshold&#39;: 10.0, &#39;brightest&#39;: 200, &#39;peakmax&#39;: None, &#39;enforce_user_order&#39;: False, &#39;expand_refcat&#39;: False, &#39;minobj&#39;: 15, &#39;searchrad&#39;: 2.0, &#39;use2dhist&#39;: True, &#39;separation&#39;: 1.0, &#39;tolerance&#39;: 0.7, &#39;xoffset&#39;: 0.0, &#39;yoffset&#39;: 0.0, &#39;fitgeometry&#39;: &#39;rshift&#39;, &#39;nclip&#39;: 3, &#39;sigma&#39;: 3.0, &#39;align_to_gaia&#39;: False, &#39;gaia_catalog&#39;: &#39;GAIADR2&#39;, &#39;min_gaia&#39;: 5, &#39;save_gaia_catalog&#39;: False}, &#39;skymatch&#39;: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: &#39;/internal/data1/jenkins/workspace/Notebooks/jwst_validation_notebooks_spacetelescope/tmp/tmpt_z84t1b/MIRI&#39;, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: False, &#39;output_use_index&#39;: True, &#39;save_results&#39;: True, &#39;skip&#39;: False, &#39;suffix&#39;: None, &#39;search_output_file&#39;: True, &#39;input_dir&#39;: &#39;&#39;, &#39;skymethod&#39;: &#39;match&#39;, &#39;match_down&#39;: True, &#39;subtract&#39;: False, &#39;stepsize&#39;: None, &#39;skystat&#39;: &#39;mode&#39;, &#39;dqbits&#39;: &#39;~DO_NOT_USE+NON_SCIENCE&#39;, &#39;lower&#39;: None, &#39;upper&#39;: None, &#39;nclip&#39;: 5, &#39;lsigma&#39;: 4.0, &#39;usigma&#39;: 4.0, &#39;binwidth&#39;: 0.1}, &#39;outlier_detection&#39;: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: None, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: False, &#39;output_use_index&#39;: True, &#39;save_results&#39;: False, &#39;skip&#39;: True, &#39;suffix&#39;: None, &#39;search_output_file&#39;: False, &#39;input_dir&#39;: &#39;&#39;, &#39;weight_type&#39;: &#39;ivm&#39;, &#39;pixfrac&#39;: 1.0, &#39;kernel&#39;: &#39;square&#39;, &#39;fillval&#39;: &#39;INDEF&#39;, &#39;nlow&#39;: 0, &#39;nhigh&#39;: 0, &#39;maskpt&#39;: 0.7, &#39;grow&#39;: 1, &#39;snr&#39;: &#39;5.0 4.0&#39;, &#39;scale&#39;: &#39;1.2 0.7&#39;, &#39;backg&#39;: 0.0, &#39;save_intermediate_results&#39;: False, &#39;resample_data&#39;: True, &#39;good_bits&#39;: &#39;~DO_NOT_USE&#39;, &#39;scale_detection&#39;: False, &#39;allowed_memory&#39;: None}, &#39;resample&#39;: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: None, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: False, &#39;output_use_index&#39;: True, &#39;save_results&#39;: True, &#39;skip&#39;: False, &#39;suffix&#39;: None, &#39;search_output_file&#39;: True, &#39;input_dir&#39;: &#39;&#39;, &#39;pixfrac&#39;: 1.0, &#39;kernel&#39;: &#39;square&#39;, &#39;fillval&#39;: &#39;INDEF&#39;, &#39;weight_type&#39;: &#39;ivm&#39;, &#39;output_shape&#39;: None, &#39;crpix&#39;: None, &#39;crval&#39;: None, &#39;rotation&#39;: None, &#39;pixel_scale_ratio&#39;: 1.0, &#39;pixel_scale&#39;: None, &#39;single&#39;: False, &#39;blendheaders&#39;: True, &#39;allowed_memory&#39;: None}, &#39;source_catalog&#39;: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: None, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: False, &#39;output_use_index&#39;: True, &#39;save_results&#39;: False, &#39;skip&#39;: True, &#39;suffix&#39;: &#39;cat&#39;, &#39;search_output_file&#39;: True, &#39;input_dir&#39;: &#39;&#39;, &#39;bkg_boxsize&#39;: 100, &#39;kernel_fwhm&#39;: 2.0, &#39;snr_threshold&#39;: 3.0, &#39;npixels&#39;: 5, &#39;deblend&#39;: False, &#39;aperture_ee1&#39;: 30, &#39;aperture_ee2&#39;: 50, &#39;aperture_ee3&#39;: 70, &#39;ci1_star_threshold&#39;: 2.0, &#39;ci2_star_threshold&#39;: 1.8}}}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:19,455 - stpipe.Image3Pipeline - INFO - Prefetching reference files for dataset: &#39;det_image_seq1_MIRIMAGE_F560Wexp1_cal_skymatch.fits&#39; reftypes = [&#39;drizpars&#39;]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:19,464 - stpipe.Image3Pipeline - INFO - Prefetch for DRIZPARS reference file is &#39;/grp/crds/cache/references/jwst/jwst_miri_drizpars_0001.fits&#39;.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:19,468 - stpipe.Image3Pipeline - INFO - Starting calwebb_image3 ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:20,145 - stpipe.Image3Pipeline.tweakreg - INFO - Step tweakreg running with args (&lt;ModelContainer&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:20,148 - stpipe.Image3Pipeline.tweakreg - INFO - Step tweakreg parameters are: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: None, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: True, &#39;output_use_index&#39;: True, &#39;save_results&#39;: False, &#39;skip&#39;: True, &#39;suffix&#39;: None, &#39;search_output_file&#39;: True, &#39;input_dir&#39;: &#39;&#39;, &#39;save_catalogs&#39;: False, &#39;catalog_format&#39;: &#39;ecsv&#39;, &#39;kernel_fwhm&#39;: 2.5, &#39;snr_threshold&#39;: 10.0, &#39;brightest&#39;: 200, &#39;peakmax&#39;: None, &#39;enforce_user_order&#39;: False, &#39;expand_refcat&#39;: False, &#39;minobj&#39;: 15, &#39;searchrad&#39;: 2.0, &#39;use2dhist&#39;: True, &#39;separation&#39;: 1.0, &#39;tolerance&#39;: 0.7, &#39;xoffset&#39;: 0.0, &#39;yoffset&#39;: 0.0, &#39;fitgeometry&#39;: &#39;rshift&#39;, &#39;nclip&#39;: 3, &#39;sigma&#39;: 3.0, &#39;align_to_gaia&#39;: False, &#39;gaia_catalog&#39;: &#39;GAIADR2&#39;, &#39;min_gaia&#39;: 5, &#39;save_gaia_catalog&#39;: False}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:20,149 - stpipe.Image3Pipeline.tweakreg - INFO - Step skipped.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:20,155 - stpipe.Image3Pipeline.tweakreg - INFO - Step tweakreg done
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:20,354 - stpipe.Image3Pipeline.skymatch - INFO - Step skymatch running with args (&lt;ModelContainer&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:20,356 - stpipe.Image3Pipeline.skymatch - INFO - Step skymatch parameters are: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: &#39;/internal/data1/jenkins/workspace/Notebooks/jwst_validation_notebooks_spacetelescope/tmp/tmpt_z84t1b/MIRI&#39;, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: False, &#39;output_use_index&#39;: True, &#39;save_results&#39;: True, &#39;skip&#39;: False, &#39;suffix&#39;: None, &#39;search_output_file&#39;: True, &#39;input_dir&#39;: &#39;&#39;, &#39;skymethod&#39;: &#39;match&#39;, &#39;match_down&#39;: True, &#39;subtract&#39;: False, &#39;stepsize&#39;: None, &#39;skystat&#39;: &#39;mode&#39;, &#39;dqbits&#39;: &#39;~DO_NOT_USE+NON_SCIENCE&#39;, &#39;lower&#39;: None, &#39;upper&#39;: None, &#39;nclip&#39;: 5, &#39;lsigma&#39;: 4.0, &#39;usigma&#39;: 4.0, &#39;binwidth&#39;: 0.1}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:20,486 - stpipe.Image3Pipeline.skymatch - INFO -  
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:20,488 - stpipe.Image3Pipeline.skymatch - INFO - ***** jwst.skymatch.skymatch.match() started on 2022-07-07 08:12:20.486827
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:20,488 - stpipe.Image3Pipeline.skymatch - INFO -  
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:20,489 - stpipe.Image3Pipeline.skymatch - INFO - Sky computation method: &#39;match&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:20,490 - stpipe.Image3Pipeline.skymatch - INFO - Sky matching direction: DOWN
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:20,490 - stpipe.Image3Pipeline.skymatch - INFO - Sky subtraction from image data: OFF
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:20,491 - stpipe.Image3Pipeline.skymatch - INFO -  
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:20,491 - stpipe.Image3Pipeline.skymatch - INFO - ----  Computing differences in sky values in overlapping regions.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:23,098 - stpipe.Image3Pipeline.skymatch - INFO -    *  Image ID=det_image_seq1_MIRIMAGE_F560Wexp1_cal_skymatch.fits. Sky background: 0
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:23,100 - stpipe.Image3Pipeline.skymatch - INFO -    *  Image ID=det_image_seq2_MIRIMAGE_F560Wexp1_cal_skymatch.fits. Sky background: 1.01058
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:23,101 - stpipe.Image3Pipeline.skymatch - INFO -    *  Image ID=det_image_seq3_MIRIMAGE_F560Wexp1_cal_skymatch.fits. Sky background: 2.94606
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:23,101 - stpipe.Image3Pipeline.skymatch - INFO -    *  Image ID=det_image_seq4_MIRIMAGE_F560Wexp1_cal_skymatch.fits. Sky background: 0.0109085
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:23,102 - stpipe.Image3Pipeline.skymatch - INFO -  
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:23,102 - stpipe.Image3Pipeline.skymatch - INFO - ***** jwst.skymatch.skymatch.match() ended on 2022-07-07 08:12:23.102304
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:23,103 - stpipe.Image3Pipeline.skymatch - INFO - ***** jwst.skymatch.skymatch.match() TOTAL RUN TIME: 0:00:02.615477
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:23,104 - stpipe.Image3Pipeline.skymatch - INFO -  
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:23,421 - stpipe.Image3Pipeline.skymatch - INFO - Saved model in MIRI_0_skymatch.fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:23,685 - stpipe.Image3Pipeline.skymatch - INFO - Saved model in MIRI_1_skymatch.fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:23,930 - stpipe.Image3Pipeline.skymatch - INFO - Saved model in MIRI_2_skymatch.fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:24,174 - stpipe.Image3Pipeline.skymatch - INFO - Saved model in MIRI_3_skymatch.fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:24,175 - stpipe.Image3Pipeline.skymatch - INFO - Step skymatch done
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:24,402 - stpipe.Image3Pipeline.outlier_detection - INFO - Step outlier_detection running with args (&lt;ModelContainer&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:24,405 - stpipe.Image3Pipeline.outlier_detection - INFO - Step outlier_detection parameters are: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: None, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: False, &#39;output_use_index&#39;: True, &#39;save_results&#39;: True, &#39;skip&#39;: True, &#39;suffix&#39;: &#39;crf&#39;, &#39;search_output_file&#39;: False, &#39;input_dir&#39;: &#39;&#39;, &#39;weight_type&#39;: &#39;ivm&#39;, &#39;pixfrac&#39;: 1.0, &#39;kernel&#39;: &#39;square&#39;, &#39;fillval&#39;: &#39;INDEF&#39;, &#39;nlow&#39;: 0, &#39;nhigh&#39;: 0, &#39;maskpt&#39;: 0.7, &#39;grow&#39;: 1, &#39;snr&#39;: &#39;5.0 4.0&#39;, &#39;scale&#39;: &#39;1.2 0.7&#39;, &#39;backg&#39;: 0.0, &#39;save_intermediate_results&#39;: False, &#39;resample_data&#39;: True, &#39;good_bits&#39;: &#39;~DO_NOT_USE&#39;, &#39;scale_detection&#39;: False, &#39;allowed_memory&#39;: None}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:24,406 - stpipe.Image3Pipeline.outlier_detection - INFO - Step skipped.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:24,414 - stpipe.Image3Pipeline.outlier_detection - INFO - Step outlier_detection done
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:24,621 - stpipe.Image3Pipeline.resample - INFO - Step resample running with args (&lt;ModelContainer&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:24,624 - stpipe.Image3Pipeline.resample - INFO - Step resample parameters are: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: None, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: False, &#39;output_use_index&#39;: True, &#39;save_results&#39;: True, &#39;skip&#39;: False, &#39;suffix&#39;: &#39;i2d&#39;, &#39;search_output_file&#39;: True, &#39;input_dir&#39;: &#39;&#39;, &#39;pixfrac&#39;: 1.0, &#39;kernel&#39;: &#39;square&#39;, &#39;fillval&#39;: &#39;INDEF&#39;, &#39;weight_type&#39;: &#39;ivm&#39;, &#39;output_shape&#39;: None, &#39;crpix&#39;: None, &#39;crval&#39;: None, &#39;rotation&#39;: None, &#39;pixel_scale_ratio&#39;: 1.0, &#39;pixel_scale&#39;: None, &#39;single&#39;: False, &#39;blendheaders&#39;: True, &#39;allowed_memory&#39;: None}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:24,642 - stpipe.Image3Pipeline.resample - INFO - Drizpars reference file: /grp/crds/cache/references/jwst/jwst_miri_drizpars_0001.fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:24,786 - stpipe.Image3Pipeline.resample - INFO - Blending metadata for skymatch_combined.fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:25,413 - stpipe.Image3Pipeline.resample - INFO - Resampling science data
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:26,065 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:27,088 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:28,077 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:29,051 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:29,442 - stpipe.Image3Pipeline.resample - INFO - Resampling var_rnoise
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:30,115 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:31,051 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:31,993 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:32,931 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:33,296 - stpipe.Image3Pipeline.resample - INFO - Resampling var_poisson
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:33,880 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:34,834 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:35,787 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:36,720 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:37,081 - stpipe.Image3Pipeline.resample - INFO - Resampling var_flat
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:37,660 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:38,626 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:39,628 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:40,594 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:40,987 - stpipe.Image3Pipeline.resample - INFO - Update S_REGION to POLYGON ICRS  0.020232898 -0.018692220 0.023327823 0.016575172 359.989011943 0.019586596 359.985917018 -0.015680796
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:41,430 - stpipe.Image3Pipeline.resample - INFO - Saved model in skymatch_combined_i2d.fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:41,432 - stpipe.Image3Pipeline.resample - INFO - Step resample done
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:41,695 - stpipe.Image3Pipeline.source_catalog - INFO - Step source_catalog running with args (&lt;ImageModel(1149, 1118) from skymatch_combined_i2d.fits&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:41,697 - stpipe.Image3Pipeline.source_catalog - INFO - Step source_catalog parameters are: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: None, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: False, &#39;output_use_index&#39;: True, &#39;save_results&#39;: True, &#39;skip&#39;: True, &#39;suffix&#39;: &#39;cat&#39;, &#39;search_output_file&#39;: True, &#39;input_dir&#39;: &#39;&#39;, &#39;bkg_boxsize&#39;: 100, &#39;kernel_fwhm&#39;: 2.0, &#39;snr_threshold&#39;: 3.0, &#39;npixels&#39;: 5, &#39;deblend&#39;: False, &#39;aperture_ee1&#39;: 30, &#39;aperture_ee2&#39;: 50, &#39;aperture_ee3&#39;: 70, &#39;ci1_star_threshold&#39;: 2.0, &#39;ci2_star_threshold&#39;: 1.8}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:41,698 - stpipe.Image3Pipeline.source_catalog - INFO - Step skipped.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:41,700 - stpipe.Image3Pipeline.source_catalog - INFO - Step source_catalog done
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:41,702 - stpipe.Image3Pipeline - INFO - Step Image3Pipeline done
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Image 3 pipeline finished.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">img01_1_new</span> <span class="o">=</span> <span class="n">datamodels</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;MIRI_0_skymatch.fits&#39;</span><span class="p">)</span>
<span class="n">img01_2_new</span> <span class="o">=</span> <span class="n">datamodels</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;MIRI_1_skymatch.fits&#39;</span><span class="p">)</span>
<span class="n">img02_1_new</span> <span class="o">=</span> <span class="n">datamodels</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;MIRI_2_skymatch.fits&#39;</span><span class="p">)</span>
<span class="n">img02_2_new</span> <span class="o">=</span> <span class="n">datamodels</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;MIRI_3_skymatch.fits&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;With subtract=False, no subtraction should be done here.&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean: original, new (match down)&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">img01_1</span><span class="o">.</span><span class="n">data</span><span class="p">),</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">img01_1_new</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">img01_2</span><span class="o">.</span><span class="n">data</span><span class="p">),</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">img01_2_new</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">img02_1</span><span class="o">.</span><span class="n">data</span><span class="p">),</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">img02_1_new</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">img02_2</span><span class="o">.</span><span class="n">data</span><span class="p">),</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">img02_2_new</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>With subtract=False, no subtraction should be done here.
Mean: original, new (match down)
Mean: 2.0004356 , 2.0004356
Mean: 2.9994354 , 2.9994354
Mean: 4.9994936 , 4.9994936
Mean: 2.0004356 , 2.0004356
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Look at combined image</span>
<span class="n">im_file</span> <span class="o">=</span> <span class="n">ImageModel</span><span class="p">(</span><span class="s1">&#39;skymatch_combined_i2d.fits&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;With the match method, subtract=False and match_down=True, the background value should match to the lowest individual background.&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;This value should match the minimum values in the new column above.&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">im_file</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">600</span><span class="p">:</span><span class="mi">700</span><span class="p">,</span><span class="mi">600</span><span class="p">:</span><span class="mi">700</span><span class="p">]))</span>

<span class="c1"># read in ecsv photom file</span>
<span class="kn">from</span> <span class="nn">astropy.visualization</span> <span class="kn">import</span> <span class="n">LogStretch</span><span class="p">,</span> <span class="n">PercentileInterval</span><span class="p">,</span> <span class="n">ManualInterval</span>

<span class="c1">#viz2 = LogStretch() + ManualInterval(0,10)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>
<span class="c1">#plt.imshow(viz2(im_file.data), origin=&#39;lower&#39;)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">im_file</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;rainbow&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>With the match method, subtract=False and match_down=True, the background value should match to the lowest individual background.
This value should match the minimum values in the new column above.
Mean: 2.0116198
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.colorbar.Colorbar at 0x7fed55ecd180&gt;
</pre></div>
</div>
<img alt="../../../_images/exec_jwst_skymatch_miri_test_64_2.png" src="../../../_images/exec_jwst_skymatch_miri_test_64_2.png" />
</div>
</div>
</section>
</section>
<section id="test-skymatch-method-global-match">
<h2>4. Test skymatch method ‘global+match’<a class="headerlink" href="#test-skymatch-method-global-match" title="Permalink to this headline">#</a></h2>
<section id="notes-global-match-first-use-match-method-to-equalize-sky-values-between-images-and-then-find-a-minimum-global-sky-value-in-all-input-images">
<h3>Notes: ‘global+match’: first use ‘match’ method to equalize sky values between images and then find a minimum “global” sky value in all input images.<a class="headerlink" href="#notes-global-match-first-use-match-method-to-equalize-sky-values-between-images-and-then-find-a-minimum-global-sky-value-in-all-input-images" title="Permalink to this headline">#</a></h3>
<p>The behavior of this step is that it subtracts all background. More documentation is needed on how exactly it gets to that point.</p>
</section>
<section id="skymethod-global-match-subtract-true">
<h3>4.1 skymethod = ‘global+match’, subtract = True<a class="headerlink" href="#skymethod-global-match-subtract-true" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># skymatch, global+match, subtract = True</span>
<span class="c1">#jwst.skymatch.skymatch_step.SkyMatchStep.call(skymatch_json_file2, skymethod=&#39;global+match&#39;, match_down=True,subtract=True,output_file=&#39;MIRI&#39;,save_results=True)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Test running just skymatch and resample and skiping other steps.</span>

<span class="c1"># Run Calwebb_image3 on the association table</span>
    
<span class="c1"># set any specific parameters</span>
<span class="n">skymethod</span> <span class="o">=</span> <span class="s1">&#39;global+match&#39;</span> <span class="c1"># sky computation algorithm to be used. Allowed values: {local, global, match, global+match} (Default = global+match</span>
<span class="c1">#match_down = True # Specifies whether the sky differences should be subtracted from images with higher sky values (match_down = True) in order to match the image with the lowest sky or sky differences should be added to the images with lower sky values to match the sky of the image with the highest sky value (match_down = False). (Default = True</span>
<span class="n">subtract</span> <span class="o">=</span> <span class="kc">True</span> <span class="c1"># Specifies whether the computed sky background values are to be subtracted from the images. (Default = False   </span>
    
<span class="n">pipe3</span><span class="o">=</span><span class="n">Image3Pipeline</span><span class="p">()</span>    
<span class="n">pipe3</span><span class="o">.</span><span class="n">tweakreg</span><span class="o">.</span><span class="n">skip</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">outlier_detection</span><span class="o">.</span><span class="n">skip</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">source_catalog</span><span class="o">.</span><span class="n">skip</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">pipe3</span><span class="o">.</span><span class="n">skymatch</span><span class="o">.</span><span class="n">skymethod</span> <span class="o">=</span> <span class="n">skymethod</span>
<span class="c1">#pipe3.skymatch.match_down = match_down</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">skymatch</span><span class="o">.</span><span class="n">subtract</span> <span class="o">=</span> <span class="n">subtract</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">skymatch</span><span class="o">.</span><span class="n">output_file</span> <span class="o">=</span> <span class="s1">&#39;MIRI&#39;</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">skymatch</span><span class="o">.</span><span class="n">save_results</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">pipe3</span><span class="o">.</span><span class="n">resample</span><span class="o">.</span><span class="n">save_results</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">pipe3</span><span class="o">.</span><span class="n">save_results</span> <span class="o">=</span> <span class="kc">True</span>

<span class="c1"># run Image3</span>

<span class="n">image</span> <span class="o">=</span> <span class="n">pipe3</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">skymatch_json_file2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Image 3 pipeline finished.&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:43,024 - stpipe.Image3Pipeline - INFO - Image3Pipeline instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:43,026 - stpipe.Image3Pipeline.assign_mtwcs - INFO - AssignMTWcsStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:43,028 - stpipe.Image3Pipeline.tweakreg - INFO - TweakRegStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:43,030 - stpipe.Image3Pipeline.skymatch - INFO - SkyMatchStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:43,032 - stpipe.Image3Pipeline.outlier_detection - INFO - OutlierDetectionStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:43,033 - stpipe.Image3Pipeline.resample - INFO - ResampleStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:43,035 - stpipe.Image3Pipeline.source_catalog - INFO - SourceCatalogStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:43,323 - stpipe.Image3Pipeline - INFO - Step Image3Pipeline running with args (&#39;skymatch_asnfile2.json&#39;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:43,330 - stpipe.Image3Pipeline - INFO - Step Image3Pipeline parameters are: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: None, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: False, &#39;output_use_index&#39;: True, &#39;save_results&#39;: True, &#39;skip&#39;: False, &#39;suffix&#39;: None, &#39;search_output_file&#39;: True, &#39;input_dir&#39;: &#39;&#39;, &#39;steps&#39;: {&#39;assign_mtwcs&#39;: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: None, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: True, &#39;output_use_index&#39;: True, &#39;save_results&#39;: False, &#39;skip&#39;: False, &#39;suffix&#39;: &#39;assign_mtwcs&#39;, &#39;search_output_file&#39;: True, &#39;input_dir&#39;: &#39;&#39;}, &#39;tweakreg&#39;: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: None, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: True, &#39;output_use_index&#39;: True, &#39;save_results&#39;: False, &#39;skip&#39;: True, &#39;suffix&#39;: None, &#39;search_output_file&#39;: True, &#39;input_dir&#39;: &#39;&#39;, &#39;save_catalogs&#39;: False, &#39;catalog_format&#39;: &#39;ecsv&#39;, &#39;kernel_fwhm&#39;: 2.5, &#39;snr_threshold&#39;: 10.0, &#39;brightest&#39;: 200, &#39;peakmax&#39;: None, &#39;enforce_user_order&#39;: False, &#39;expand_refcat&#39;: False, &#39;minobj&#39;: 15, &#39;searchrad&#39;: 2.0, &#39;use2dhist&#39;: True, &#39;separation&#39;: 1.0, &#39;tolerance&#39;: 0.7, &#39;xoffset&#39;: 0.0, &#39;yoffset&#39;: 0.0, &#39;fitgeometry&#39;: &#39;rshift&#39;, &#39;nclip&#39;: 3, &#39;sigma&#39;: 3.0, &#39;align_to_gaia&#39;: False, &#39;gaia_catalog&#39;: &#39;GAIADR2&#39;, &#39;min_gaia&#39;: 5, &#39;save_gaia_catalog&#39;: False}, &#39;skymatch&#39;: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: &#39;/internal/data1/jenkins/workspace/Notebooks/jwst_validation_notebooks_spacetelescope/tmp/tmpt_z84t1b/MIRI&#39;, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: False, &#39;output_use_index&#39;: True, &#39;save_results&#39;: True, &#39;skip&#39;: False, &#39;suffix&#39;: None, &#39;search_output_file&#39;: True, &#39;input_dir&#39;: &#39;&#39;, &#39;skymethod&#39;: &#39;global+match&#39;, &#39;match_down&#39;: True, &#39;subtract&#39;: True, &#39;stepsize&#39;: None, &#39;skystat&#39;: &#39;mode&#39;, &#39;dqbits&#39;: &#39;~DO_NOT_USE+NON_SCIENCE&#39;, &#39;lower&#39;: None, &#39;upper&#39;: None, &#39;nclip&#39;: 5, &#39;lsigma&#39;: 4.0, &#39;usigma&#39;: 4.0, &#39;binwidth&#39;: 0.1}, &#39;outlier_detection&#39;: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: None, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: False, &#39;output_use_index&#39;: True, &#39;save_results&#39;: False, &#39;skip&#39;: True, &#39;suffix&#39;: None, &#39;search_output_file&#39;: False, &#39;input_dir&#39;: &#39;&#39;, &#39;weight_type&#39;: &#39;ivm&#39;, &#39;pixfrac&#39;: 1.0, &#39;kernel&#39;: &#39;square&#39;, &#39;fillval&#39;: &#39;INDEF&#39;, &#39;nlow&#39;: 0, &#39;nhigh&#39;: 0, &#39;maskpt&#39;: 0.7, &#39;grow&#39;: 1, &#39;snr&#39;: &#39;5.0 4.0&#39;, &#39;scale&#39;: &#39;1.2 0.7&#39;, &#39;backg&#39;: 0.0, &#39;save_intermediate_results&#39;: False, &#39;resample_data&#39;: True, &#39;good_bits&#39;: &#39;~DO_NOT_USE&#39;, &#39;scale_detection&#39;: False, &#39;allowed_memory&#39;: None}, &#39;resample&#39;: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: None, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: False, &#39;output_use_index&#39;: True, &#39;save_results&#39;: True, &#39;skip&#39;: False, &#39;suffix&#39;: None, &#39;search_output_file&#39;: True, &#39;input_dir&#39;: &#39;&#39;, &#39;pixfrac&#39;: 1.0, &#39;kernel&#39;: &#39;square&#39;, &#39;fillval&#39;: &#39;INDEF&#39;, &#39;weight_type&#39;: &#39;ivm&#39;, &#39;output_shape&#39;: None, &#39;crpix&#39;: None, &#39;crval&#39;: None, &#39;rotation&#39;: None, &#39;pixel_scale_ratio&#39;: 1.0, &#39;pixel_scale&#39;: None, &#39;single&#39;: False, &#39;blendheaders&#39;: True, &#39;allowed_memory&#39;: None}, &#39;source_catalog&#39;: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: None, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: False, &#39;output_use_index&#39;: True, &#39;save_results&#39;: False, &#39;skip&#39;: True, &#39;suffix&#39;: &#39;cat&#39;, &#39;search_output_file&#39;: True, &#39;input_dir&#39;: &#39;&#39;, &#39;bkg_boxsize&#39;: 100, &#39;kernel_fwhm&#39;: 2.0, &#39;snr_threshold&#39;: 3.0, &#39;npixels&#39;: 5, &#39;deblend&#39;: False, &#39;aperture_ee1&#39;: 30, &#39;aperture_ee2&#39;: 50, &#39;aperture_ee3&#39;: 70, &#39;ci1_star_threshold&#39;: 2.0, &#39;ci2_star_threshold&#39;: 1.8}}}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:43,464 - stpipe.Image3Pipeline - INFO - Prefetching reference files for dataset: &#39;det_image_seq1_MIRIMAGE_F560Wexp1_cal_skymatch.fits&#39; reftypes = [&#39;drizpars&#39;]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:43,468 - stpipe.Image3Pipeline - INFO - Prefetch for DRIZPARS reference file is &#39;/grp/crds/cache/references/jwst/jwst_miri_drizpars_0001.fits&#39;.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:43,470 - stpipe.Image3Pipeline - INFO - Starting calwebb_image3 ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:44,197 - stpipe.Image3Pipeline.tweakreg - INFO - Step tweakreg running with args (&lt;ModelContainer&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:44,201 - stpipe.Image3Pipeline.tweakreg - INFO - Step tweakreg parameters are: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: None, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: True, &#39;output_use_index&#39;: True, &#39;save_results&#39;: False, &#39;skip&#39;: True, &#39;suffix&#39;: None, &#39;search_output_file&#39;: True, &#39;input_dir&#39;: &#39;&#39;, &#39;save_catalogs&#39;: False, &#39;catalog_format&#39;: &#39;ecsv&#39;, &#39;kernel_fwhm&#39;: 2.5, &#39;snr_threshold&#39;: 10.0, &#39;brightest&#39;: 200, &#39;peakmax&#39;: None, &#39;enforce_user_order&#39;: False, &#39;expand_refcat&#39;: False, &#39;minobj&#39;: 15, &#39;searchrad&#39;: 2.0, &#39;use2dhist&#39;: True, &#39;separation&#39;: 1.0, &#39;tolerance&#39;: 0.7, &#39;xoffset&#39;: 0.0, &#39;yoffset&#39;: 0.0, &#39;fitgeometry&#39;: &#39;rshift&#39;, &#39;nclip&#39;: 3, &#39;sigma&#39;: 3.0, &#39;align_to_gaia&#39;: False, &#39;gaia_catalog&#39;: &#39;GAIADR2&#39;, &#39;min_gaia&#39;: 5, &#39;save_gaia_catalog&#39;: False}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:44,202 - stpipe.Image3Pipeline.tweakreg - INFO - Step skipped.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:44,209 - stpipe.Image3Pipeline.tweakreg - INFO - Step tweakreg done
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:44,437 - stpipe.Image3Pipeline.skymatch - INFO - Step skymatch running with args (&lt;ModelContainer&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:44,439 - stpipe.Image3Pipeline.skymatch - INFO - Step skymatch parameters are: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: &#39;/internal/data1/jenkins/workspace/Notebooks/jwst_validation_notebooks_spacetelescope/tmp/tmpt_z84t1b/MIRI&#39;, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: False, &#39;output_use_index&#39;: True, &#39;save_results&#39;: True, &#39;skip&#39;: False, &#39;suffix&#39;: None, &#39;search_output_file&#39;: True, &#39;input_dir&#39;: &#39;&#39;, &#39;skymethod&#39;: &#39;global+match&#39;, &#39;match_down&#39;: True, &#39;subtract&#39;: True, &#39;stepsize&#39;: None, &#39;skystat&#39;: &#39;mode&#39;, &#39;dqbits&#39;: &#39;~DO_NOT_USE+NON_SCIENCE&#39;, &#39;lower&#39;: None, &#39;upper&#39;: None, &#39;nclip&#39;: 5, &#39;lsigma&#39;: 4.0, &#39;usigma&#39;: 4.0, &#39;binwidth&#39;: 0.1}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:44,573 - stpipe.Image3Pipeline.skymatch - INFO -  
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:44,574 - stpipe.Image3Pipeline.skymatch - INFO - ***** jwst.skymatch.skymatch.match() started on 2022-07-07 08:12:44.573465
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:44,575 - stpipe.Image3Pipeline.skymatch - INFO -  
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:44,576 - stpipe.Image3Pipeline.skymatch - INFO - Sky computation method: &#39;global+match&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:44,576 - stpipe.Image3Pipeline.skymatch - INFO - Sky matching direction: DOWN
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:44,577 - stpipe.Image3Pipeline.skymatch - INFO - Sky subtraction from image data: ON
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:44,578 - stpipe.Image3Pipeline.skymatch - INFO -  
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:44,578 - stpipe.Image3Pipeline.skymatch - INFO - ----  Computing differences in sky values in overlapping regions.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:47,211 - stpipe.Image3Pipeline.skymatch - INFO -    *  Image ID=det_image_seq1_MIRIMAGE_F560Wexp1_cal_skymatch.fits. Sky background: 0 (old=0, delta=0)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:47,216 - stpipe.Image3Pipeline.skymatch - INFO -    *  Image ID=det_image_seq2_MIRIMAGE_F560Wexp1_cal_skymatch.fits. Sky background: 1.01058 (old=0, delta=1.01058)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:47,218 - stpipe.Image3Pipeline.skymatch - INFO -    *  Image ID=det_image_seq3_MIRIMAGE_F560Wexp1_cal_skymatch.fits. Sky background: 2.94606 (old=0, delta=2.94606)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:47,220 - stpipe.Image3Pipeline.skymatch - INFO -    *  Image ID=det_image_seq4_MIRIMAGE_F560Wexp1_cal_skymatch.fits. Sky background: 0.0109085 (old=0, delta=0.0109085)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:47,220 - stpipe.Image3Pipeline.skymatch - INFO -  
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:47,221 - stpipe.Image3Pipeline.skymatch - INFO - ----  Computing &quot;global&quot; sky - smallest sky value across *all* input images.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:47,309 - stpipe.Image3Pipeline.skymatch - INFO -  
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:47,311 - stpipe.Image3Pipeline.skymatch - INFO -    &quot;Global&quot; sky value correction: 1.965785762998793 [not converted]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:47,312 - stpipe.Image3Pipeline.skymatch - INFO -  
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:47,313 - stpipe.Image3Pipeline.skymatch - INFO - ----  Final (match+global) sky for:
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:47,315 - stpipe.Image3Pipeline.skymatch - INFO -    *  Image ID=det_image_seq1_MIRIMAGE_F560Wexp1_cal_skymatch.fits. Sky background: 1.96579 (old=0, delta=1.96579)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:47,317 - stpipe.Image3Pipeline.skymatch - INFO -    *  Image ID=det_image_seq2_MIRIMAGE_F560Wexp1_cal_skymatch.fits. Sky background: 2.97636 (old=1.01058, delta=1.96579)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:47,319 - stpipe.Image3Pipeline.skymatch - INFO -    *  Image ID=det_image_seq3_MIRIMAGE_F560Wexp1_cal_skymatch.fits. Sky background: 4.91184 (old=2.94606, delta=1.96579)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:47,321 - stpipe.Image3Pipeline.skymatch - INFO -    *  Image ID=det_image_seq4_MIRIMAGE_F560Wexp1_cal_skymatch.fits. Sky background: 1.97669 (old=0.0109085, delta=1.96579)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:47,322 - stpipe.Image3Pipeline.skymatch - INFO -  
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:47,323 - stpipe.Image3Pipeline.skymatch - INFO - ***** jwst.skymatch.skymatch.match() ended on 2022-07-07 08:12:47.322406
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:47,323 - stpipe.Image3Pipeline.skymatch - INFO - ***** jwst.skymatch.skymatch.match() TOTAL RUN TIME: 0:00:02.748941
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:47,324 - stpipe.Image3Pipeline.skymatch - INFO -  
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:47,593 - stpipe.Image3Pipeline.skymatch - INFO - Saved model in MIRI_0_skymatch.fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:47,833 - stpipe.Image3Pipeline.skymatch - INFO - Saved model in MIRI_1_skymatch.fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:48,073 - stpipe.Image3Pipeline.skymatch - INFO - Saved model in MIRI_2_skymatch.fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:48,315 - stpipe.Image3Pipeline.skymatch - INFO - Saved model in MIRI_3_skymatch.fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:48,317 - stpipe.Image3Pipeline.skymatch - INFO - Step skymatch done
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:48,564 - stpipe.Image3Pipeline.outlier_detection - INFO - Step outlier_detection running with args (&lt;ModelContainer&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:48,566 - stpipe.Image3Pipeline.outlier_detection - INFO - Step outlier_detection parameters are: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: None, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: False, &#39;output_use_index&#39;: True, &#39;save_results&#39;: True, &#39;skip&#39;: True, &#39;suffix&#39;: &#39;crf&#39;, &#39;search_output_file&#39;: False, &#39;input_dir&#39;: &#39;&#39;, &#39;weight_type&#39;: &#39;ivm&#39;, &#39;pixfrac&#39;: 1.0, &#39;kernel&#39;: &#39;square&#39;, &#39;fillval&#39;: &#39;INDEF&#39;, &#39;nlow&#39;: 0, &#39;nhigh&#39;: 0, &#39;maskpt&#39;: 0.7, &#39;grow&#39;: 1, &#39;snr&#39;: &#39;5.0 4.0&#39;, &#39;scale&#39;: &#39;1.2 0.7&#39;, &#39;backg&#39;: 0.0, &#39;save_intermediate_results&#39;: False, &#39;resample_data&#39;: True, &#39;good_bits&#39;: &#39;~DO_NOT_USE&#39;, &#39;scale_detection&#39;: False, &#39;allowed_memory&#39;: None}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:48,567 - stpipe.Image3Pipeline.outlier_detection - INFO - Step skipped.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:48,574 - stpipe.Image3Pipeline.outlier_detection - INFO - Step outlier_detection done
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:48,803 - stpipe.Image3Pipeline.resample - INFO - Step resample running with args (&lt;ModelContainer&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:48,805 - stpipe.Image3Pipeline.resample - INFO - Step resample parameters are: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: None, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: False, &#39;output_use_index&#39;: True, &#39;save_results&#39;: True, &#39;skip&#39;: False, &#39;suffix&#39;: &#39;i2d&#39;, &#39;search_output_file&#39;: True, &#39;input_dir&#39;: &#39;&#39;, &#39;pixfrac&#39;: 1.0, &#39;kernel&#39;: &#39;square&#39;, &#39;fillval&#39;: &#39;INDEF&#39;, &#39;weight_type&#39;: &#39;ivm&#39;, &#39;output_shape&#39;: None, &#39;crpix&#39;: None, &#39;crval&#39;: None, &#39;rotation&#39;: None, &#39;pixel_scale_ratio&#39;: 1.0, &#39;pixel_scale&#39;: None, &#39;single&#39;: False, &#39;blendheaders&#39;: True, &#39;allowed_memory&#39;: None}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:48,822 - stpipe.Image3Pipeline.resample - INFO - Drizpars reference file: /grp/crds/cache/references/jwst/jwst_miri_drizpars_0001.fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:48,969 - stpipe.Image3Pipeline.resample - INFO - Blending metadata for skymatch_combined.fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:49,617 - stpipe.Image3Pipeline.resample - INFO - Resampling science data
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:50,253 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:51,230 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:52,211 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:53,178 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:53,543 - stpipe.Image3Pipeline.resample - INFO - Resampling var_rnoise
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:54,126 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:55,064 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:56,006 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:56,961 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:57,318 - stpipe.Image3Pipeline.resample - INFO - Resampling var_poisson
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:57,916 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:58,843 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:12:59,780 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:13:00,708 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:13:01,071 - stpipe.Image3Pipeline.resample - INFO - Resampling var_flat
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:13:01,645 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:13:02,570 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:13:03,507 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:13:04,494 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:13:04,873 - stpipe.Image3Pipeline.resample - INFO - Update S_REGION to POLYGON ICRS  0.020232898 -0.018692220 0.023327823 0.016575172 359.989011943 0.019586596 359.985917018 -0.015680796
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:13:05,300 - stpipe.Image3Pipeline.resample - INFO - Saved model in skymatch_combined_i2d.fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:13:05,301 - stpipe.Image3Pipeline.resample - INFO - Step resample done
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:13:05,549 - stpipe.Image3Pipeline.source_catalog - INFO - Step source_catalog running with args (&lt;ImageModel(1149, 1118) from skymatch_combined_i2d.fits&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:13:05,551 - stpipe.Image3Pipeline.source_catalog - INFO - Step source_catalog parameters are: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: None, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: False, &#39;output_use_index&#39;: True, &#39;save_results&#39;: True, &#39;skip&#39;: True, &#39;suffix&#39;: &#39;cat&#39;, &#39;search_output_file&#39;: True, &#39;input_dir&#39;: &#39;&#39;, &#39;bkg_boxsize&#39;: 100, &#39;kernel_fwhm&#39;: 2.0, &#39;snr_threshold&#39;: 3.0, &#39;npixels&#39;: 5, &#39;deblend&#39;: False, &#39;aperture_ee1&#39;: 30, &#39;aperture_ee2&#39;: 50, &#39;aperture_ee3&#39;: 70, &#39;ci1_star_threshold&#39;: 2.0, &#39;ci2_star_threshold&#39;: 1.8}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:13:05,552 - stpipe.Image3Pipeline.source_catalog - INFO - Step skipped.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:13:05,554 - stpipe.Image3Pipeline.source_catalog - INFO - Step source_catalog done
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:13:05,557 - stpipe.Image3Pipeline - INFO - Step Image3Pipeline done
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Image 3 pipeline finished.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">img01_1_new</span> <span class="o">=</span> <span class="n">datamodels</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;MIRI_0_skymatch.fits&#39;</span><span class="p">)</span>
<span class="n">img01_2_new</span> <span class="o">=</span> <span class="n">datamodels</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;MIRI_1_skymatch.fits&#39;</span><span class="p">)</span>
<span class="n">img02_1_new</span> <span class="o">=</span> <span class="n">datamodels</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;MIRI_2_skymatch.fits&#39;</span><span class="p">)</span>
<span class="n">img02_2_new</span> <span class="o">=</span> <span class="n">datamodels</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;MIRI_3_skymatch.fits&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean: original, new (global+match)&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">img01_1</span><span class="o">.</span><span class="n">data</span><span class="p">),</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">img01_1_new</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">img01_2</span><span class="o">.</span><span class="n">data</span><span class="p">),</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">img01_2_new</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">img02_1</span><span class="o">.</span><span class="n">data</span><span class="p">),</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">img02_1_new</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">img02_2</span><span class="o">.</span><span class="n">data</span><span class="p">),</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">img02_2_new</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Mean: original, new (global+match)
Mean: 2.0004356 , 2.0004356
Mean: 2.9994354 , 2.9994354
Mean: 4.9994936 , 4.9994936
Mean: 2.0004356 , 2.0004356
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Look at combined image</span>
<span class="n">im_file</span> <span class="o">=</span> <span class="n">ImageModel</span><span class="p">(</span><span class="s1">&#39;skymatch_combined_i2d.fits&#39;</span><span class="p">)</span>

<span class="c1">#print(&#39;Did resample subtract a background level, and what was it?&#39;)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;This value should match the values in the new column above. Subtraction was done in skymatch step.&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">im_file</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">600</span><span class="p">:</span><span class="mi">700</span><span class="p">,</span><span class="mi">600</span><span class="p">:</span><span class="mi">700</span><span class="p">]))</span>

<span class="c1"># read in ecsv photom file</span>
<span class="kn">from</span> <span class="nn">astropy.visualization</span> <span class="kn">import</span> <span class="n">LogStretch</span><span class="p">,</span> <span class="n">PercentileInterval</span><span class="p">,</span> <span class="n">ManualInterval</span>

<span class="c1">#viz2 = LogStretch() + ManualInterval(0,10)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>
<span class="c1">#plt.imshow(viz2(im_file.data), origin=&#39;lower&#39;)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">im_file</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;rainbow&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>This value should match the values in the new column above. Subtraction was done in skymatch step.
Mean: 3.0036535
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.colorbar.Colorbar at 0x7fed55bfe740&gt;
</pre></div>
</div>
<img alt="../../../_images/exec_jwst_skymatch_miri_test_70_2.png" src="../../../_images/exec_jwst_skymatch_miri_test_70_2.png" />
</div>
</div>
</section>
<section id="skymatch-global-match-subtract-false">
<h3>4.2 skymatch = global+match, subtract = False<a class="headerlink" href="#skymatch-global-match-subtract-false" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Test running just skymatch and resample and skiping other steps.</span>

<span class="c1"># Run Calwebb_image3 on the association table</span>
    
<span class="c1"># set any specific parameters</span>
<span class="n">skymethod</span> <span class="o">=</span> <span class="s1">&#39;global+match&#39;</span> <span class="c1"># sky computation algorithm to be used. Allowed values: {local, global, match, global+match} (Default = global+match</span>
<span class="c1">#match_down = True # Specifies whether the sky differences should be subtracted from images with higher sky values (match_down = True) in order to match the image with the lowest sky or sky differences should be added to the images with lower sky values to match the sky of the image with the highest sky value (match_down = False). (Default = True</span>
<span class="n">subtract</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1"># Specifies whether the computed sky background values are to be subtracted from the images. (Default = False   </span>
    
<span class="n">pipe3</span><span class="o">=</span><span class="n">Image3Pipeline</span><span class="p">()</span>    
<span class="n">pipe3</span><span class="o">.</span><span class="n">tweakreg</span><span class="o">.</span><span class="n">skip</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">outlier_detection</span><span class="o">.</span><span class="n">skip</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">source_catalog</span><span class="o">.</span><span class="n">skip</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">pipe3</span><span class="o">.</span><span class="n">skymatch</span><span class="o">.</span><span class="n">skymethod</span> <span class="o">=</span> <span class="n">skymethod</span>
<span class="c1">#pipe3.skymatch.match_down = match_down</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">skymatch</span><span class="o">.</span><span class="n">subtract</span> <span class="o">=</span> <span class="n">subtract</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">skymatch</span><span class="o">.</span><span class="n">output_file</span> <span class="o">=</span> <span class="s1">&#39;MIRI&#39;</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">skymatch</span><span class="o">.</span><span class="n">save_results</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">pipe3</span><span class="o">.</span><span class="n">resample</span><span class="o">.</span><span class="n">save_results</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">pipe3</span><span class="o">.</span><span class="n">save_results</span> <span class="o">=</span> <span class="kc">True</span>

<span class="c1"># run Image3</span>

<span class="n">image</span> <span class="o">=</span> <span class="n">pipe3</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">skymatch_json_file2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Image 3 pipeline finished.&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:13:06,877 - stpipe.Image3Pipeline - INFO - Image3Pipeline instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:13:06,880 - stpipe.Image3Pipeline.assign_mtwcs - INFO - AssignMTWcsStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:13:06,882 - stpipe.Image3Pipeline.tweakreg - INFO - TweakRegStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:13:06,883 - stpipe.Image3Pipeline.skymatch - INFO - SkyMatchStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:13:06,885 - stpipe.Image3Pipeline.outlier_detection - INFO - OutlierDetectionStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:13:06,887 - stpipe.Image3Pipeline.resample - INFO - ResampleStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:13:06,888 - stpipe.Image3Pipeline.source_catalog - INFO - SourceCatalogStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:13:07,191 - stpipe.Image3Pipeline - INFO - Step Image3Pipeline running with args (&#39;skymatch_asnfile2.json&#39;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:13:07,198 - stpipe.Image3Pipeline - INFO - Step Image3Pipeline parameters are: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: None, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: False, &#39;output_use_index&#39;: True, &#39;save_results&#39;: True, &#39;skip&#39;: False, &#39;suffix&#39;: None, &#39;search_output_file&#39;: True, &#39;input_dir&#39;: &#39;&#39;, &#39;steps&#39;: {&#39;assign_mtwcs&#39;: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: None, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: True, &#39;output_use_index&#39;: True, &#39;save_results&#39;: False, &#39;skip&#39;: False, &#39;suffix&#39;: &#39;assign_mtwcs&#39;, &#39;search_output_file&#39;: True, &#39;input_dir&#39;: &#39;&#39;}, &#39;tweakreg&#39;: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: None, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: True, &#39;output_use_index&#39;: True, &#39;save_results&#39;: False, &#39;skip&#39;: True, &#39;suffix&#39;: None, &#39;search_output_file&#39;: True, &#39;input_dir&#39;: &#39;&#39;, &#39;save_catalogs&#39;: False, &#39;catalog_format&#39;: &#39;ecsv&#39;, &#39;kernel_fwhm&#39;: 2.5, &#39;snr_threshold&#39;: 10.0, &#39;brightest&#39;: 200, &#39;peakmax&#39;: None, &#39;enforce_user_order&#39;: False, &#39;expand_refcat&#39;: False, &#39;minobj&#39;: 15, &#39;searchrad&#39;: 2.0, &#39;use2dhist&#39;: True, &#39;separation&#39;: 1.0, &#39;tolerance&#39;: 0.7, &#39;xoffset&#39;: 0.0, &#39;yoffset&#39;: 0.0, &#39;fitgeometry&#39;: &#39;rshift&#39;, &#39;nclip&#39;: 3, &#39;sigma&#39;: 3.0, &#39;align_to_gaia&#39;: False, &#39;gaia_catalog&#39;: &#39;GAIADR2&#39;, &#39;min_gaia&#39;: 5, &#39;save_gaia_catalog&#39;: False}, &#39;skymatch&#39;: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: &#39;/internal/data1/jenkins/workspace/Notebooks/jwst_validation_notebooks_spacetelescope/tmp/tmpt_z84t1b/MIRI&#39;, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: False, &#39;output_use_index&#39;: True, &#39;save_results&#39;: True, &#39;skip&#39;: False, &#39;suffix&#39;: None, &#39;search_output_file&#39;: True, &#39;input_dir&#39;: &#39;&#39;, &#39;skymethod&#39;: &#39;global+match&#39;, &#39;match_down&#39;: True, &#39;subtract&#39;: False, &#39;stepsize&#39;: None, &#39;skystat&#39;: &#39;mode&#39;, &#39;dqbits&#39;: &#39;~DO_NOT_USE+NON_SCIENCE&#39;, &#39;lower&#39;: None, &#39;upper&#39;: None, &#39;nclip&#39;: 5, &#39;lsigma&#39;: 4.0, &#39;usigma&#39;: 4.0, &#39;binwidth&#39;: 0.1}, &#39;outlier_detection&#39;: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: None, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: False, &#39;output_use_index&#39;: True, &#39;save_results&#39;: False, &#39;skip&#39;: True, &#39;suffix&#39;: None, &#39;search_output_file&#39;: False, &#39;input_dir&#39;: &#39;&#39;, &#39;weight_type&#39;: &#39;ivm&#39;, &#39;pixfrac&#39;: 1.0, &#39;kernel&#39;: &#39;square&#39;, &#39;fillval&#39;: &#39;INDEF&#39;, &#39;nlow&#39;: 0, &#39;nhigh&#39;: 0, &#39;maskpt&#39;: 0.7, &#39;grow&#39;: 1, &#39;snr&#39;: &#39;5.0 4.0&#39;, &#39;scale&#39;: &#39;1.2 0.7&#39;, &#39;backg&#39;: 0.0, &#39;save_intermediate_results&#39;: False, &#39;resample_data&#39;: True, &#39;good_bits&#39;: &#39;~DO_NOT_USE&#39;, &#39;scale_detection&#39;: False, &#39;allowed_memory&#39;: None}, &#39;resample&#39;: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: None, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: False, &#39;output_use_index&#39;: True, &#39;save_results&#39;: True, &#39;skip&#39;: False, &#39;suffix&#39;: None, &#39;search_output_file&#39;: True, &#39;input_dir&#39;: &#39;&#39;, &#39;pixfrac&#39;: 1.0, &#39;kernel&#39;: &#39;square&#39;, &#39;fillval&#39;: &#39;INDEF&#39;, &#39;weight_type&#39;: &#39;ivm&#39;, &#39;output_shape&#39;: None, &#39;crpix&#39;: None, &#39;crval&#39;: None, &#39;rotation&#39;: None, &#39;pixel_scale_ratio&#39;: 1.0, &#39;pixel_scale&#39;: None, &#39;single&#39;: False, &#39;blendheaders&#39;: True, &#39;allowed_memory&#39;: None}, &#39;source_catalog&#39;: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: None, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: False, &#39;output_use_index&#39;: True, &#39;save_results&#39;: False, &#39;skip&#39;: True, &#39;suffix&#39;: &#39;cat&#39;, &#39;search_output_file&#39;: True, &#39;input_dir&#39;: &#39;&#39;, &#39;bkg_boxsize&#39;: 100, &#39;kernel_fwhm&#39;: 2.0, &#39;snr_threshold&#39;: 3.0, &#39;npixels&#39;: 5, &#39;deblend&#39;: False, &#39;aperture_ee1&#39;: 30, &#39;aperture_ee2&#39;: 50, &#39;aperture_ee3&#39;: 70, &#39;ci1_star_threshold&#39;: 2.0, &#39;ci2_star_threshold&#39;: 1.8}}}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:13:07,334 - stpipe.Image3Pipeline - INFO - Prefetching reference files for dataset: &#39;det_image_seq1_MIRIMAGE_F560Wexp1_cal_skymatch.fits&#39; reftypes = [&#39;drizpars&#39;]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:13:07,339 - stpipe.Image3Pipeline - INFO - Prefetch for DRIZPARS reference file is &#39;/grp/crds/cache/references/jwst/jwst_miri_drizpars_0001.fits&#39;.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:13:07,341 - stpipe.Image3Pipeline - INFO - Starting calwebb_image3 ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:13:08,066 - stpipe.Image3Pipeline.tweakreg - INFO - Step tweakreg running with args (&lt;ModelContainer&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:13:08,068 - stpipe.Image3Pipeline.tweakreg - INFO - Step tweakreg parameters are: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: None, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: True, &#39;output_use_index&#39;: True, &#39;save_results&#39;: False, &#39;skip&#39;: True, &#39;suffix&#39;: None, &#39;search_output_file&#39;: True, &#39;input_dir&#39;: &#39;&#39;, &#39;save_catalogs&#39;: False, &#39;catalog_format&#39;: &#39;ecsv&#39;, &#39;kernel_fwhm&#39;: 2.5, &#39;snr_threshold&#39;: 10.0, &#39;brightest&#39;: 200, &#39;peakmax&#39;: None, &#39;enforce_user_order&#39;: False, &#39;expand_refcat&#39;: False, &#39;minobj&#39;: 15, &#39;searchrad&#39;: 2.0, &#39;use2dhist&#39;: True, &#39;separation&#39;: 1.0, &#39;tolerance&#39;: 0.7, &#39;xoffset&#39;: 0.0, &#39;yoffset&#39;: 0.0, &#39;fitgeometry&#39;: &#39;rshift&#39;, &#39;nclip&#39;: 3, &#39;sigma&#39;: 3.0, &#39;align_to_gaia&#39;: False, &#39;gaia_catalog&#39;: &#39;GAIADR2&#39;, &#39;min_gaia&#39;: 5, &#39;save_gaia_catalog&#39;: False}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:13:08,069 - stpipe.Image3Pipeline.tweakreg - INFO - Step skipped.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:13:08,075 - stpipe.Image3Pipeline.tweakreg - INFO - Step tweakreg done
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:13:08,313 - stpipe.Image3Pipeline.skymatch - INFO - Step skymatch running with args (&lt;ModelContainer&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:13:08,315 - stpipe.Image3Pipeline.skymatch - INFO - Step skymatch parameters are: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: &#39;/internal/data1/jenkins/workspace/Notebooks/jwst_validation_notebooks_spacetelescope/tmp/tmpt_z84t1b/MIRI&#39;, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: False, &#39;output_use_index&#39;: True, &#39;save_results&#39;: True, &#39;skip&#39;: False, &#39;suffix&#39;: None, &#39;search_output_file&#39;: True, &#39;input_dir&#39;: &#39;&#39;, &#39;skymethod&#39;: &#39;global+match&#39;, &#39;match_down&#39;: True, &#39;subtract&#39;: False, &#39;stepsize&#39;: None, &#39;skystat&#39;: &#39;mode&#39;, &#39;dqbits&#39;: &#39;~DO_NOT_USE+NON_SCIENCE&#39;, &#39;lower&#39;: None, &#39;upper&#39;: None, &#39;nclip&#39;: 5, &#39;lsigma&#39;: 4.0, &#39;usigma&#39;: 4.0, &#39;binwidth&#39;: 0.1}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:13:08,452 - stpipe.Image3Pipeline.skymatch - INFO -  
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:13:08,453 - stpipe.Image3Pipeline.skymatch - INFO - ***** jwst.skymatch.skymatch.match() started on 2022-07-07 08:13:08.452251
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:13:08,453 - stpipe.Image3Pipeline.skymatch - INFO -  
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:13:08,454 - stpipe.Image3Pipeline.skymatch - INFO - Sky computation method: &#39;global+match&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:13:08,454 - stpipe.Image3Pipeline.skymatch - INFO - Sky matching direction: DOWN
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:13:08,455 - stpipe.Image3Pipeline.skymatch - INFO - Sky subtraction from image data: OFF
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:13:08,456 - stpipe.Image3Pipeline.skymatch - INFO -  
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:13:08,456 - stpipe.Image3Pipeline.skymatch - INFO - ----  Computing differences in sky values in overlapping regions.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:13:11,056 - stpipe.Image3Pipeline.skymatch - INFO -    *  Image ID=det_image_seq1_MIRIMAGE_F560Wexp1_cal_skymatch.fits. Sky background: 0
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:13:11,057 - stpipe.Image3Pipeline.skymatch - INFO -    *  Image ID=det_image_seq2_MIRIMAGE_F560Wexp1_cal_skymatch.fits. Sky background: 1.01058
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:13:11,058 - stpipe.Image3Pipeline.skymatch - INFO -    *  Image ID=det_image_seq3_MIRIMAGE_F560Wexp1_cal_skymatch.fits. Sky background: 2.94606
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:13:11,059 - stpipe.Image3Pipeline.skymatch - INFO -    *  Image ID=det_image_seq4_MIRIMAGE_F560Wexp1_cal_skymatch.fits. Sky background: 0.0109085
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:13:11,059 - stpipe.Image3Pipeline.skymatch - INFO -  
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:13:11,060 - stpipe.Image3Pipeline.skymatch - INFO - ----  Computing &quot;global&quot; sky - smallest sky value across *all* input images.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:13:11,142 - stpipe.Image3Pipeline.skymatch - INFO -  
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:13:11,143 - stpipe.Image3Pipeline.skymatch - INFO -    &quot;Global&quot; sky value correction: 1.9657857694641896 [not converted]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:13:11,143 - stpipe.Image3Pipeline.skymatch - INFO -  
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:13:11,144 - stpipe.Image3Pipeline.skymatch - INFO - ----  Final (match+global) sky for:
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:13:11,145 - stpipe.Image3Pipeline.skymatch - INFO -    *  Image ID=det_image_seq1_MIRIMAGE_F560Wexp1_cal_skymatch.fits. Sky background: 1.96579 (old=0, delta=1.96579)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:13:11,145 - stpipe.Image3Pipeline.skymatch - INFO -    *  Image ID=det_image_seq2_MIRIMAGE_F560Wexp1_cal_skymatch.fits. Sky background: 2.97636 (old=1.01058, delta=1.96579)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:13:11,146 - stpipe.Image3Pipeline.skymatch - INFO -    *  Image ID=det_image_seq3_MIRIMAGE_F560Wexp1_cal_skymatch.fits. Sky background: 4.91184 (old=2.94606, delta=1.96579)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:13:11,147 - stpipe.Image3Pipeline.skymatch - INFO -    *  Image ID=det_image_seq4_MIRIMAGE_F560Wexp1_cal_skymatch.fits. Sky background: 1.97669 (old=0.0109085, delta=1.96579)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:13:11,147 - stpipe.Image3Pipeline.skymatch - INFO -  
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:13:11,148 - stpipe.Image3Pipeline.skymatch - INFO - ***** jwst.skymatch.skymatch.match() ended on 2022-07-07 08:13:11.147827
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:13:11,149 - stpipe.Image3Pipeline.skymatch - INFO - ***** jwst.skymatch.skymatch.match() TOTAL RUN TIME: 0:00:02.695576
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:13:11,149 - stpipe.Image3Pipeline.skymatch - INFO -  
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:13:11,425 - stpipe.Image3Pipeline.skymatch - INFO - Saved model in MIRI_0_skymatch.fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:13:11,680 - stpipe.Image3Pipeline.skymatch - INFO - Saved model in MIRI_1_skymatch.fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:13:11,933 - stpipe.Image3Pipeline.skymatch - INFO - Saved model in MIRI_2_skymatch.fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:13:12,175 - stpipe.Image3Pipeline.skymatch - INFO - Saved model in MIRI_3_skymatch.fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:13:12,176 - stpipe.Image3Pipeline.skymatch - INFO - Step skymatch done
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:13:12,428 - stpipe.Image3Pipeline.outlier_detection - INFO - Step outlier_detection running with args (&lt;ModelContainer&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:13:12,430 - stpipe.Image3Pipeline.outlier_detection - INFO - Step outlier_detection parameters are: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: None, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: False, &#39;output_use_index&#39;: True, &#39;save_results&#39;: True, &#39;skip&#39;: True, &#39;suffix&#39;: &#39;crf&#39;, &#39;search_output_file&#39;: False, &#39;input_dir&#39;: &#39;&#39;, &#39;weight_type&#39;: &#39;ivm&#39;, &#39;pixfrac&#39;: 1.0, &#39;kernel&#39;: &#39;square&#39;, &#39;fillval&#39;: &#39;INDEF&#39;, &#39;nlow&#39;: 0, &#39;nhigh&#39;: 0, &#39;maskpt&#39;: 0.7, &#39;grow&#39;: 1, &#39;snr&#39;: &#39;5.0 4.0&#39;, &#39;scale&#39;: &#39;1.2 0.7&#39;, &#39;backg&#39;: 0.0, &#39;save_intermediate_results&#39;: False, &#39;resample_data&#39;: True, &#39;good_bits&#39;: &#39;~DO_NOT_USE&#39;, &#39;scale_detection&#39;: False, &#39;allowed_memory&#39;: None}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:13:12,431 - stpipe.Image3Pipeline.outlier_detection - INFO - Step skipped.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:13:12,438 - stpipe.Image3Pipeline.outlier_detection - INFO - Step outlier_detection done
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:13:12,672 - stpipe.Image3Pipeline.resample - INFO - Step resample running with args (&lt;ModelContainer&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:13:12,674 - stpipe.Image3Pipeline.resample - INFO - Step resample parameters are: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: None, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: False, &#39;output_use_index&#39;: True, &#39;save_results&#39;: True, &#39;skip&#39;: False, &#39;suffix&#39;: &#39;i2d&#39;, &#39;search_output_file&#39;: True, &#39;input_dir&#39;: &#39;&#39;, &#39;pixfrac&#39;: 1.0, &#39;kernel&#39;: &#39;square&#39;, &#39;fillval&#39;: &#39;INDEF&#39;, &#39;weight_type&#39;: &#39;ivm&#39;, &#39;output_shape&#39;: None, &#39;crpix&#39;: None, &#39;crval&#39;: None, &#39;rotation&#39;: None, &#39;pixel_scale_ratio&#39;: 1.0, &#39;pixel_scale&#39;: None, &#39;single&#39;: False, &#39;blendheaders&#39;: True, &#39;allowed_memory&#39;: None}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:13:12,693 - stpipe.Image3Pipeline.resample - INFO - Drizpars reference file: /grp/crds/cache/references/jwst/jwst_miri_drizpars_0001.fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:13:12,838 - stpipe.Image3Pipeline.resample - INFO - Blending metadata for skymatch_combined.fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:13:13,483 - stpipe.Image3Pipeline.resample - INFO - Resampling science data
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:13:14,096 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:13:15,104 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:13:16,160 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:13:17,165 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:13:17,529 - stpipe.Image3Pipeline.resample - INFO - Resampling var_rnoise
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:13:18,127 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:13:19,103 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:13:20,061 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:13:21,006 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:13:21,367 - stpipe.Image3Pipeline.resample - INFO - Resampling var_poisson
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:13:21,957 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:13:23,076 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:13:24,116 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:13:25,160 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:13:25,535 - stpipe.Image3Pipeline.resample - INFO - Resampling var_flat
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:13:26,199 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:13:27,253 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:13:28,309 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:13:29,349 - stpipe.Image3Pipeline.resample - INFO - Drizzling (1024, 1032) --&gt; (1149, 1118)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:13:29,737 - stpipe.Image3Pipeline.resample - INFO - Update S_REGION to POLYGON ICRS  0.020232898 -0.018692220 0.023327823 0.016575172 359.989011943 0.019586596 359.985917018 -0.015680796
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:13:30,203 - stpipe.Image3Pipeline.resample - INFO - Saved model in skymatch_combined_i2d.fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:13:30,204 - stpipe.Image3Pipeline.resample - INFO - Step resample done
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:13:30,765 - stpipe.Image3Pipeline.source_catalog - INFO - Step source_catalog running with args (&lt;ImageModel(1149, 1118) from skymatch_combined_i2d.fits&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:13:30,767 - stpipe.Image3Pipeline.source_catalog - INFO - Step source_catalog parameters are: {&#39;pre_hooks&#39;: [], &#39;post_hooks&#39;: [], &#39;output_file&#39;: None, &#39;output_dir&#39;: None, &#39;output_ext&#39;: &#39;.fits&#39;, &#39;output_use_model&#39;: False, &#39;output_use_index&#39;: True, &#39;save_results&#39;: True, &#39;skip&#39;: True, &#39;suffix&#39;: &#39;cat&#39;, &#39;search_output_file&#39;: True, &#39;input_dir&#39;: &#39;&#39;, &#39;bkg_boxsize&#39;: 100, &#39;kernel_fwhm&#39;: 2.0, &#39;snr_threshold&#39;: 3.0, &#39;npixels&#39;: 5, &#39;deblend&#39;: False, &#39;aperture_ee1&#39;: 30, &#39;aperture_ee2&#39;: 50, &#39;aperture_ee3&#39;: 70, &#39;ci1_star_threshold&#39;: 2.0, &#39;ci2_star_threshold&#39;: 1.8}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:13:30,769 - stpipe.Image3Pipeline.source_catalog - INFO - Step skipped.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:13:30,772 - stpipe.Image3Pipeline.source_catalog - INFO - Step source_catalog done
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-07 08:13:30,774 - stpipe.Image3Pipeline - INFO - Step Image3Pipeline done
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Image 3 pipeline finished.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">img01_1_new</span> <span class="o">=</span> <span class="n">datamodels</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;MIRI_0_skymatch.fits&#39;</span><span class="p">)</span>
<span class="n">img01_2_new</span> <span class="o">=</span> <span class="n">datamodels</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;MIRI_1_skymatch.fits&#39;</span><span class="p">)</span>
<span class="n">img02_1_new</span> <span class="o">=</span> <span class="n">datamodels</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;MIRI_2_skymatch.fits&#39;</span><span class="p">)</span>
<span class="n">img02_2_new</span> <span class="o">=</span> <span class="n">datamodels</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;MIRI_3_skymatch.fits&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean: original, new (global+match)&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">img01_1</span><span class="o">.</span><span class="n">data</span><span class="p">),</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">img01_1_new</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">img01_2</span><span class="o">.</span><span class="n">data</span><span class="p">),</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">img01_2_new</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">img02_1</span><span class="o">.</span><span class="n">data</span><span class="p">),</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">img02_1_new</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">img02_2</span><span class="o">.</span><span class="n">data</span><span class="p">),</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">img02_2_new</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Mean: original, new (global+match)
Mean: 2.0004356 , 2.0004356
Mean: 2.9994354 , 2.9994354
Mean: 4.9994936 , 4.9994936
Mean: 2.0004356 , 2.0004356
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Look at combined image</span>
<span class="n">im_file</span> <span class="o">=</span> <span class="n">ImageModel</span><span class="p">(</span><span class="s1">&#39;skymatch_combined_i2d.fits&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Did resample subtract a background level, and what was it?&#39;</span><span class="p">)</span>
<span class="c1">#print(&#39;This value should match the values in the new column above. Subtraction was done in skymatch step.&#39;)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean:&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">im_file</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">600</span><span class="p">:</span><span class="mi">700</span><span class="p">,</span><span class="mi">600</span><span class="p">:</span><span class="mi">700</span><span class="p">]))</span>

<span class="c1"># read in ecsv photom file</span>
<span class="kn">from</span> <span class="nn">astropy.visualization</span> <span class="kn">import</span> <span class="n">LogStretch</span><span class="p">,</span> <span class="n">PercentileInterval</span><span class="p">,</span> <span class="n">ManualInterval</span>

<span class="c1">#viz2 = LogStretch() + ManualInterval(0,10)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>
<span class="c1">#plt.imshow(viz2(im_file.data), origin=&#39;lower&#39;)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">im_file</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;rainbow&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Did resample subtract a background level, and what was it?
Mean: 0.045833968
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.colorbar.Colorbar at 0x7fed55603d60&gt;
</pre></div>
</div>
<img alt="../../../_images/exec_jwst_skymatch_miri_test_74_2.png" src="../../../_images/exec_jwst_skymatch_miri_test_74_2.png" />
</div>
</div>
</section>
<section id="check-that-all-output-new-sky-values-are-around-zero-within-a-standard-deviation">
<h3>** Check that all output (new) sky values are around zero (within a standard deviation)<a class="headerlink" href="#check-that-all-output-new-sky-values-are-around-zero-within-a-standard-deviation" title="Permalink to this headline">#</a></h3>
<section id="id1">
<h4>Notes: ‘global+match’: first use ‘match’ method to equalize sky values between images and then find a minimum “global” sky value in all input images.<a class="headerlink" href="#id1" title="Permalink to this headline">#</a></h4>
</section>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "TheRealZoidberg/jwst_validation_test",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./notebooks/skymatch/jwst_skymatch_miri_test"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="jwst_skymatch_photom_miri_test.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">JWST Pipeline Validation Notebook: skymatch and photometry with MIRI</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="exec_jwst_skymatch_photom_miri_test.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">JWST Pipeline Validation Notebook: skymatch and photometry with MIRI</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By STScI<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>