
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>JWST Pipeline Validation Notebook: calwebb_image3: source_catalog with MIRI &#8212; Notebook repository template</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" href="../../../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/main.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script src="../../../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../../_static/sphinx-thebe.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.1/dist/embed-amd.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="JWST Pipeline Validation Notebook: NIRCam, calwebb_image3, source_catalog" href="../jwst_source_catalog_nircam_test/jwst_nircam_imaging_source_catalog.html" />
    <link rel="prev" title="JWST Pipeline Validation Notebook: calwebb_image3: source_catalog with MIRI" href="exec_jwst_source_catalog_miri_test.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../../_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Notebook repository template</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../../index.html">
                    <no title>
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../background/jwst_background_miri_test/jwst_background_subtraction_miri_imaging_testing.html">
   JWST Pipeline Validation Notebook: calwebb_image2, background subtraction for MIRI imaging
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../background/jwst_background_miri_test/exec_jwst_background_subtraction_miri_imaging_testing.html">
   JWST Pipeline Validation Notebook: calwebb_image2, background subtraction for MIRI imaging
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../background/jwst_background_miri_test/exec_background_sub-miri-lrs-slit.html">
   JWST Pipeline Validation Testing Notebook: Background_subtract() for MIRI LRS SLIT
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../background/jwst_background_miri_test/background_sub-miri-lrs-slit.html">
   JWST Pipeline Validation Testing Notebook: Background_subtract() for MIRI LRS SLIT
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../pathloss/jwst_pathloss_nirspec_test/exec_jwst_pathloss_nirspec_test.html">
   JWST Pipeline Validation Testing Notebook: spec2, pathloss step
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../pathloss/jwst_pathloss_nirspec_test/jwst_pathloss_nirspec_test.html">
   JWST Pipeline Validation Testing Notebook: spec2, pathloss step
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../msaflagopen/jwst_msa_flagging_nirspec_test.html">
   JWST Pipeline Validation Testing Notebook: spec2, msa_flagging step
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../msaflagopen/exec_jwst_msa_flagging_nirspec_test.html">
   JWST Pipeline Validation Testing Notebook: spec2, msa_flagging step
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../resample/jwst_resample_miri_test/jwst_resample_miri_lrs_slit.html">
   JWST Pipeline Validation Testing Notebook: Calwebb_Image3, Resample step
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../resample/jwst_resample_miri_test/exec_jwst_resample_miri_lrs_slit.html">
   JWST Pipeline Validation Testing Notebook: Calwebb_Image3, Resample step
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../resample/jwst_resample_miri_test/jwst_resample_miri_testing.html">
   JWST Pipeline Validation Testing Notebook: Calwebb_Image3, Resample step with MIRI imaging
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../resample/jwst_resample_miri_test/exec_jwst_resample_miri_testing.html">
   JWST Pipeline Validation Testing Notebook: Calwebb_Image3, Resample step with MIRI imaging
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../example_notebook/example_notebook.html">
   Draft: Notebook title
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="exec_jwst_source_catalog_miri_test.html">
   JWST Pipeline Validation Notebook: calwebb_image3: source_catalog with MIRI
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   JWST Pipeline Validation Notebook: calwebb_image3: source_catalog with MIRI
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../jwst_source_catalog_nircam_test/jwst_nircam_imaging_source_catalog.html">
   JWST Pipeline Validation Notebook: NIRCam, calwebb_image3, source_catalog
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../jwst_source_catalog_nircam_test/exec_jwst_nircam_imaging_source_catalog.html">
   JWST Pipeline Validation Notebook: NIRCam, calwebb_image3, source_catalog
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../lastframe/exec_jwst_lastframe_unit_tests.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, lastframe unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../lastframe/jwst_lastframe_unit_tests.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, lastframe unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../photom/jwst_photom_miri_test/exec_photom_miri_lrs_slitless.html">
   JWST Pipeline Validation Testing Notebook: MIRI LRS Slitless spectroscopy
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../photom/jwst_photom_miri_test/photom_miri_mrs_test.html">
   JWST Pipeline Validation Testing Notebook: Spec2, photom, MIRI
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../photom/jwst_photom_miri_test/exec_photom_miri_lrs_slit.html">
   JWST Pipeline Validation Testing Notebook: MIRI LRS Slit spectroscopy
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../photom/jwst_photom_miri_test/exec_photom_miri_mrs_test.html">
   JWST Pipeline Validation Testing Notebook: Spec2, photom, MIRI
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../photom/jwst_photom_miri_test/photom_miri_lrs_slit.html">
   JWST Pipeline Validation Testing Notebook: MIRI LRS Slit spectroscopy
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../photom/jwst_photom_miri_test/photom_miri_lrs_slitless.html">
   JWST Pipeline Validation Testing Notebook: MIRI LRS Slitless spectroscopy
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../photom/jwst_photom_miri_test/exec_jwst_photom_miri_test.html">
   JWST Pipeline Validation Notebook: photom with MIRI Imager
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../photom/jwst_photom_miri_test/jwst_photom_miri_test.html">
   JWST Pipeline Validation Notebook: photom with MIRI Imager
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ami3/run_ami_pipeline.html">
   JWST Pipeline Validation Notebook:  AMI3, AMI3 Pipeline
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ami3/exec_ami_analyze_verify.html">
   JWST Pipeline Validation Notebook: AMI3, AmiAnalyze
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ami3/exec_ami_average.html">
   JWST Pipeline Validation Notebook:  calwebb_ami3, ami_average
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ami3/exec_ami_normalize.html">
   JWST Pipeline Validation Notebook: calwebb_ami3, ami_normalize
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ami3/exec_run_ami_pipeline.html">
   JWST Pipeline Validation Notebook:  AMI3, AMI3 Pipeline
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ami3/ami_normalize.html">
   JWST Pipeline Validation Notebook: calwebb_ami3, ami_normalize
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ami3/ami_average.html">
   JWST Pipeline Validation Notebook:  calwebb_ami3, ami_average
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ami3/ami_analyze_verify.html">
   JWST Pipeline Validation Notebook: AMI3, AmiAnalyze
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../assign_wcs/jwst_assign_wcs_nirspec_test/jwst_assign_wcs_nirspec_test.html">
   JWST Pipeline Validation Testing Notebook: NIRSpec, spec2, assign_wcs step
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../assign_wcs/jwst_assign_wcs_nirspec_test/exec_jwst_assign_wcs_nirspec_test.html">
   JWST Pipeline Validation Testing Notebook: NIRSpec, spec2, assign_wcs step
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../assign_wcs/jwst_assign_wcs_niriss_test/jwst_assign_wcs_niriss_image.html">
   JWST Pipeline Validation Notebook: NIRISS, image2, assign_wcs
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../assign_wcs/jwst_assign_wcs_niriss_test/exec_jwst_assign_wcs_niriss_image.html">
   JWST Pipeline Validation Notebook: NIRISS, image2, assign_wcs
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../assign_wcs/jwst_assign_wcs_miri_test/exec_assign_wcs-miri-mrs.html">
   JWST Pipeline Validation Testing Notebook: MIRI MRS Spec2: Assign_wcs()
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../assign_wcs/jwst_assign_wcs_miri_test/exec_assign_wcs-miri-lrs-tso.html">
   JWST Pipeline Validation Testing Notebook: MIRI LRS Time Series Observation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../assign_wcs/jwst_assign_wcs_miri_test/assign_wcs-miri-lrs-slit.html">
   JWST Pipeline Validation Testing Notebook: MIRI LRS Slit
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../assign_wcs/jwst_assign_wcs_miri_test/assign_wcs-miri-mrs.html">
   JWST Pipeline Validation Testing Notebook: MIRI MRS Spec2: Assign_wcs()
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../assign_wcs/jwst_assign_wcs_miri_test/assign_wcs-miri-lrs-tso.html">
   JWST Pipeline Validation Testing Notebook: MIRI LRS Time Series Observation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../assign_wcs/jwst_assign_wcs_miri_test/exec_assign_wcs-miri-lrs-slit.html">
   JWST Pipeline Validation Testing Notebook: MIRI LRS Slit
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../barshadow/jwst_barshadow_nirspec_test/jwst_barshadow_nirspec_test.html">
   JWST Pipeline Validation Testing Notebook: spec2, barshadow step
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../barshadow/jwst_barshadow_nirspec_test/exec_jwst_barshadow_nirspec_test.html">
   JWST Pipeline Validation Testing Notebook: spec2, barshadow step
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../reset/jwst_reset_miri_test/exec_jwst_reset_miri_testing.html">
   JWST Pipeline Validation Testing Notebook: Calwebb_detector1, reset step for MIRI
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../reset/jwst_reset_miri_test/jwst_reset_miri_testing.html">
   JWST Pipeline Validation Testing Notebook: Calwebb_detector1, reset step for MIRI
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../refpix/jwst_refpix_unit_tests.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, refpix unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../refpix/exec_jwst_refpix_unit_tests.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, refpix unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../flat_field/jwst_flat_field_nirspec_test/jwst_flat_field_nirspec_test.html">
   JWST Pipeline Validation Testing Notebook: spec2, flat_field step
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../flat_field/jwst_flat_field_nirspec_test/exec_jwst_flat_field_nirspec_test.html">
   JWST Pipeline Validation Testing Notebook: spec2, flat_field step
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../flat_field/jwst_flat_field_miri_test/exec_flatfield_analysis_slitless.html">
   JWST Pipeline Validation Testing Notebook: MIRI LRS Slitless spectroscopy
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../flat_field/jwst_flat_field_miri_test/exec_jwst_flat_field_miri_test.html">
   JWST Pipeline Validation Testing notebook: flat_field step with MIRI Imaging
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../flat_field/jwst_flat_field_miri_test/exec_flat-miri-lrs-slit.html">
   JWST Pipeline Validation Testing Notebook: MIRI LRS Slit spectroscopy
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../flat_field/jwst_flat_field_miri_test/flatfield_analysis_slitless.html">
   JWST Pipeline Validation Testing Notebook: MIRI LRS Slitless spectroscopy
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../flat_field/jwst_flat_field_miri_test/exec_flat_miri_mrs_test.html">
   JWST Pipeline Validation Testing Notebook: Spec2, flat_field, MIRI
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../flat_field/jwst_flat_field_miri_test/flat-miri-lrs-slit.html">
   JWST Pipeline Validation Testing Notebook: MIRI LRS Slit spectroscopy
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../flat_field/jwst_flat_field_miri_test/jwst_flat_field_miri_test.html">
   JWST Pipeline Validation Testing notebook: flat_field step with MIRI Imaging
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../flat_field/jwst_flat_field_miri_test/flat_miri_mrs_test.html">
   JWST Pipeline Validation Testing Notebook: Spec2, flat_field, MIRI
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../skymatch/jwst_skymatch_miri_test/jwst_skymatch_photom_miri_test.html">
   JWST Pipeline Validation Notebook: skymatch and photometry with MIRI
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../skymatch/jwst_skymatch_miri_test/exec_jwst_skymatch_miri_test.html">
   JWST Pipeline Validation Notebook: skymatch with MIRI
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../skymatch/jwst_skymatch_miri_test/exec_jwst_skymatch_photom_miri_test.html">
   JWST Pipeline Validation Notebook: skymatch and photometry with MIRI
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../skymatch/jwst_skymatch_miri_test/jwst_skymatch_miri_test.html">
   JWST Pipeline Validation Notebook: skymatch with MIRI
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../jump/jwst_jump_miri_test/jwst_jump_miri_testing.html">
   JWST Pipeline Validation Testing Notebook: Calwebb_Detector1, Jump step
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../jump/jwst_jump_miri_test/exec_jwst_jump_miri_testing.html">
   JWST Pipeline Validation Testing Notebook: Calwebb_Detector1, Jump step
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../jump/jwst_jump_unit_tests.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, jump unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../jump/exec_jwst_jump_unit_tests.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, jump unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../calwebb_image3/jwst_image3_nircam_test/jwst_image3_nircam_test.html">
   JWST Pipeline Validation Notebook: calwebb_image3, NIRCam imaging
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../calwebb_image3/jwst_image3_nircam_test/exec_jwst_image3_nircam_test.html">
   JWST Pipeline Validation Notebook: calwebb_image3, NIRCam imaging
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../calwebb_image3/jwst_image3_miri_test/exec_jwst_image3_miri_test.html">
   JWST Pipeline Validation Notebook: calwebb_image3 with MIRI
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../calwebb_image3/jwst_image3_miri_test/jwst_image3_miri_test.html">
   JWST Pipeline Validation Notebook: calwebb_image3 with MIRI
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../calwebb_detector1/jwst_detector1_nircam_test/jwst_detector1_nircam_test.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, NIRCam imaging
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../calwebb_detector1/jwst_detector1_nircam_test/exec_jwst_detector1_nircam_test.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, NIRCam imaging
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../calwebb_detector1/jwst_detector1_miri_test/exec_jwst_detector1_miri_imtso_testing.html">
   JWST Pipeline Validation Testing Notebook: Calwebb_Detector1 for MIRI TSO imaging
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../calwebb_detector1/jwst_detector1_miri_test/jwst_detector1_miri_imtso_testing.html">
   JWST Pipeline Validation Testing Notebook: Calwebb_Detector1 for MIRI TSO imaging
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../calwebb_detector1/jwst_detector1_miri_test/exec_caldetector1-miri-lrs-tso.html">
   JWST Pipeline Validation Testing Notebook: MIRI LRS Time Series Observation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../calwebb_detector1/jwst_detector1_miri_test/caldetector1-miri-lrs-tso.html">
   JWST Pipeline Validation Testing Notebook: MIRI LRS Time Series Observation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../rscd/jwst_rscd_unit_tests.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, rscd unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../rscd/exec_jwst_rscd_unit_tests.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, rscd unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../rscd/jwst_rscd_miri_test/exec_jwst_miri_rscd_testing.html">
   JWST Pipeline Validation Testing Notebook: Calwebb_Detector1, RSCD step
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../rscd/jwst_rscd_miri_test/jwst_miri_rscd_testing.html">
   JWST Pipeline Validation Testing Notebook: Calwebb_Detector1, RSCD step
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../calwebb_image2/jwst_image2_nircam_test/jwst_image2_nircam_test.html">
   JWST Pipeline Validation Notebook: calwebb_image2, NIRCam imaging
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../calwebb_image2/jwst_image2_nircam_test/exec_jwst_image2_nircam_test.html">
   JWST Pipeline Validation Notebook: calwebb_image2, NIRCam imaging
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ramp_fitting/exec_jwst_ramp_fitting_unit_tests.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, ramp_fitting unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ramp_fitting/jwst_ramp_fitting_unit_tests.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, ramp_fitting unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../firstframe/exec_jwst_firstframe_unit_tests.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, firstframe unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../firstframe/jwst_firstframe_unit_tests.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, firstframe unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../dq_init/exec_jwst_dq_init_unit_tests.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, dq_init unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../dq_init/jwst_dq_init_unit_tests.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, dq_init unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../cube_build/jwst_cube_build_miri_test/test_cube_build_spec3.html">
   JWST Pipeline Validation Testing Notebook: Cube Build with MIRISIM Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../cube_build/jwst_cube_build_miri_test/exec_testing_point_source_flux_conservation_modeshep_all.html">
   JWST Pipeline Validation Testing Notebook: Point Source Flux Conservation Modeshep
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../cube_build/jwst_cube_build_miri_test/testing_point_source_flux_conservation_modeshep_all.html">
   JWST Pipeline Validation Testing Notebook: Point Source Flux Conservation Modeshep
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../cube_build/jwst_cube_build_miri_test/exec_test_cube_build_spec3.html">
   JWST Pipeline Validation Testing Notebook: Cube Build with MIRISIM Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../saturation/exec_jwst_saturation_unit_tests.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, saturation unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../saturation/jwst_saturation_unit_tests.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, saturation unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../extract_2d/jwst_extract_2d_nirspec_test/jwst_extract_2d_nirspec_test.html">
   JWST Pipeline Validation Testing Notebook: spec2, extract_2d step
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../extract_2d/jwst_extract_2d_nirspec_test/exec_jwst_extract_2d_nirspec_test.html">
   JWST Pipeline Validation Testing Notebook: spec2, extract_2d step
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../persistence/exec_jwst_persistence_unit_tests.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, persistence unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../persistence/jwst_persistence_unit_tests.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, persistence unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../extract_1d/jwst_extract_1d_miri_test/exec_extract_1d-spec2-miri-lrs-slit.html">
   JWST Pipeline Validation Testing Notebook: MIRI LRS Slit
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../extract_1d/jwst_extract_1d_miri_test/extract_1d-spec2-miri-lrs-slitless.html">
   JWST Pipeline Validation Testing Notebook: MIRI LRS Slitless
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../extract_1d/jwst_extract_1d_miri_test/extract_1d-spec2-miri-lrs-slit.html">
   JWST Pipeline Validation Testing Notebook: MIRI LRS Slit
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../extract_1d/jwst_extract_1d_miri_test/exec_extract_1d-spec2-miri-lrs-slitless.html">
   JWST Pipeline Validation Testing Notebook: MIRI LRS Slitless
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../dark_current/exec_jwst_dark_current_unit_tests.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, dark_current unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../dark_current/jwst_dark_current_unit_tests.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, dark_current unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../templates/jwst_validation_notebook_template.html">
   JWST Pipeline Validation Notebook:
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../templates/exec_jwst_validation_notebook_template.html">
   JWST Pipeline Validation Notebook:
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../templates/validation_test_template.html">
   JWST Pipeline Validation Testing Notebook: Descriptive Name of Test You Are Performing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../templates/exec_validation_test_template.html">
   JWST Pipeline Validation Testing Notebook: Descriptive Name of Test You Are Performing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ipc/exec_jwst_ipc_unit_tests.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, ipc unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ipc/jwst_ipc_unit_tests.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, ipc unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/background/exec_jwst_background_unit_tests.html">
   JWST calwebb_image2, background unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/background/jwst_background_unit_tests.html">
   JWST calwebb_image2, background unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/jwst_nirspec_regression_tests.html">
   JWST NIRSpec regression tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/flatfield/exec_jwst_flatfield_unit_tests.html">
   JWST calwebb_image2 and calwebb_spec2, flatfield unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/flatfield/jwst_flatfield_unit_tests.html">
   JWST calwebb_image2 and calwebb_spec2, flatfield unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/jwst_nircam_regression_tests.html">
   JWST NIRCam regression tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/resample/exec_jwst_resample_unit_tests.html">
   JWST calwebb_image2 and calwebb_spec2, resample unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/resample/jwst_resample_unit_tests.html">
   JWST calwebb_image2 and calwebb_spec2, resample unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/jwst_niriss_regression_tests.html">
   JWST NIRISS regression tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/source_catalog/jwst_source_catalog_unit_tests.html">
   JWST calwebb_image3, source_catalog unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/source_catalog/exec_jwst_source_catalog_unit_tests.html">
   JWST calwebb_image3, source_catalog unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/exec_jwst_fgs_regression_tests.html">
   JWST FGS regression tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/photom/jwst_photom_unit_tests.html">
   JWST calwebb_image2 and calwebb_spec2, photom unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/photom/exec_jwst_photom_unit_tests.html">
   JWST calwebb_image2 and calwebb_spec2, photom unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/assign_wcs/jwst_assign_wcs_unit_tests.html">
   JWST calwebb_image2 and calwebb_spec2, assign_wcs unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/assign_wcs/exec_jwst_assign_wcs_unit_tests.html">
   JWST calwebb_image2 and calwebb_spec2, assign_wcs unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/skymatch/jwst_skymatch_unit_tests.html">
   JWST calwebb_image3, skymatch unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/skymatch/exec_jwst_skymatch_unit_tests.html">
   JWST calwebb_image3, skymatch unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/exec_jwst_niriss_regression_tests.html">
   JWST NIRISS regression tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/exec_jwst_nirspec_regression_tests.html">
   JWST NIRSpec regression tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/exec_jwst_nircam_regression_tests.html">
   JWST NIRCam regression tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/jwst_fgs_regression_tests.html">
   JWST FGS regression tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/exec_jwst_miri_regression_tests.html">
   JWST MIRI regression tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/jwst_miri_regression_tests.html">
   JWST MIRI regression tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/tweakreg/exec_jwst_tweakreg_unit_tests.html">
   JWST calwebb_image3, tweakreg unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/tweakreg/jwst_tweakreg_unit_tests.html">
   JWST calwebb_image3, tweakreg unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/outlier_detection/jwst_outlier_detection_unit_tests.html">
   JWST calwebb_image3, calwebb_spec3, calwebb_coron3, calwebb_tso3, outlier_detection unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../regression_test/outlier_detection/exec_jwst_outlier_detection_unit_tests.html">
   JWST calwebb_image3, calwebb_spec3, calwebb_coron3, calwebb_tso3, outlier_detection unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../tweakreg/jwst_tweakreg_miri_test/exec_jwst_tweakreg_miri_test.html">
   JWST Pipeline Validation Testing Notebook: Calwebb_Image3, Tweakreg step with MIRI imaging
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../tweakreg/jwst_tweakreg_miri_test/jwst_tweakreg_miri_test.html">
   JWST Pipeline Validation Testing Notebook: Calwebb_Image3, Tweakreg step with MIRI imaging
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../outlier_detection/jwst_outlier_detection_miri_test/exec_jwst_outlier_detection_miri_test.html">
   JWST Pipeline Validation Notebook: outlier_detection with MIRI
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../outlier_detection/jwst_outlier_detection_miri_test/exec_jwst_outlier_detection_view_miri_test.html">
   JWST Pipeline Validation Notebook: MIRI view outlier_detection
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../outlier_detection/jwst_outlier_detection_miri_test/exec_out_det_test2.html">
   JWST Pipeline Validation Notebook: Outlier Detection for MIRI MRS
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../outlier_detection/jwst_outlier_detection_miri_test/out_det_test2.html">
   JWST Pipeline Validation Notebook: Outlier Detection for MIRI MRS
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../outlier_detection/jwst_outlier_detection_miri_test/jwst_outlier_detection_miri_test.html">
   JWST Pipeline Validation Notebook: outlier_detection with MIRI
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../outlier_detection/jwst_outlier_detection_miri_test/jwst_outlier_detection_view_miri_test.html">
   JWST Pipeline Validation Notebook: MIRI view outlier_detection
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../superbias/exec_jwst_superbias_unit_tests.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, superbias unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../superbias/jwst_superbias_unit_tests.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, superbias unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../calwebb_coron3/exec_MIRI_shared_calcoron3_testing.html">
   JWST Pipeline Validation Testing Notebook: Calwebb_Coron3 for MIRI Coronagraphic Imaging
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../calwebb_coron3/jwst_calcoron3_nircam_test.html">
   JWST Pipeline Validation Notebook: calwebb_coron3 with NIRCam
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../calwebb_coron3/exec_jwst_calcoron3_nircam_test.html">
   JWST Pipeline Validation Notebook: calwebb_coron3 with NIRCam
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../calwebb_coron3/MIRI_shared_calcoron3_testing.html">
   JWST Pipeline Validation Testing Notebook: Calwebb_Coron3 for MIRI Coronagraphic Imaging
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../fringe/JWST_fringe_miri_test/exec_fringe_miri_mrs_test.html">
   JWST Pipeline Validation Testing Notebook: Spec2, fringe, MIRI
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../fringe/JWST_fringe_miri_test/fringe_miri_mrs_test.html">
   JWST Pipeline Validation Testing Notebook: Spec2, fringe, MIRI
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../image3/jwst_image3_miri_test/exec_jwst_image3_miri_test.html">
   JWST Pipeline Validation Notebook: calwebb_image3 with MIRI
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../image3/jwst_image3_miri_test/jwst_image3_miri_test.html">
   JWST Pipeline Validation Notebook: calwebb_image3 with MIRI
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../linearity/jwst_linearity_unit_tests.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, linearity unit tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../linearity/exec_jwst_linearity_unit_tests.html">
   JWST Pipeline Validation Notebook: calwebb_detector1, linearity unit tests
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/TheRealZoidberg/jwst_validation_test/main?urlpath=tree/notebooks/source_catalog/jwst_source_catalog_miri_test/jwst_source_catalog_miri_test.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../../../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
      <li>
        <a href="https://colab.research.google.com/github/TheRealZoidberg/jwst_validation_test/blob/main/notebooks/source_catalog/jwst_source_catalog_miri_test/jwst_source_catalog_miri_test.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Colab"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../../../_static/images/logo_colab.png">
  </span>
<span class="headerbtn__text-container">Colab</span>
</a>

      </li>
      
      <li>
        
<button onclick="initThebeSBT()"
  class="headerbtn headerbtn-launch-thebe"
  data-toggle="tooltip"
data-placement="left"
title="Launch Thebe"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="headerbtn__text-container">Live Code</span>
</button>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/TheRealZoidberg/jwst_validation_test"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/TheRealZoidberg/jwst_validation_test/issues/new?title=Issue%20on%20page%20%2Fnotebooks/source_catalog/jwst_source_catalog_miri_test/jwst_source_catalog_miri_test.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../../../_sources/notebooks/source_catalog/jwst_source_catalog_miri_test/jwst_source_catalog_miri_test.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#table-of-contents">
   Table of Contents
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#introduction">
   Introduction
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#jwst-calibration-working-group-algorithm">
     JWST Calibration working group algorithm
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#test-description">
     Test description
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#data-description">
     Data description
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#create-a-temporary-directory-for-all-of-the-test-data">
     Create a temporary directory for all of the test data
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#set-up-import-statements">
     Set up import statements
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#put-in-some-helper-scripts">
     Put in some helper scripts
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#print-pipeline-version-number">
     Print pipeline version number
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#read-in-data">
     Read in data
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#run-pipelines">
   Run Pipelines
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#run-output-of-calwebb-detector1-through-calwebb-image2">
     Run output of calwebb_detector1 through calwebb_image2
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#run-output-of-calwebb-image2-through-calwebb-image3">
     Run output of calwebb_image2 through calwebb_image3
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#create-an-association-file-to-combine-the-input-calibrated-files">
     Create an association file to combine the input calibrated files
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#run-calwebb-image3-pipeline">
     Run Calwebb_Image3 pipeline
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#results">
   Results
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#read-in-output-table-of-source-catalog-step-and-print-ecsv-table">
     Read in output table of source_catalog step and print ecsv table
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#display-image-and-overplot-detector-sources-from-ecsv-table">
     Display image and overplot detector sources from ecsv table
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#in-the-image-above-check-that-the-stars-found-by-source-catalog-red-overlap-with-stars-in-the-image">
     In the image above, check that the stars found by source catalog (red) overlap with stars in the image
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#look-at-the-fluxes-of-the-sources-found">
     Look at the fluxes of the sources found
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#look-at-ab-mag-of-sources-found">
     Look at AB mag of sources found
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#look-at-the-errors-on-the-ab-magnitudes">
     Look at the errors on the AB magnitudes
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#manually-find-matches">
     Manually find matches
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#use-miri-software-to-put-x-y-coordinates-from-input-catalog-into-ra-dec-coordinates">
     Use MIRI software to put x, y coordinates from input catalog into RA, Dec coordinates
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#compare-ra-dec-coordinates-between-simulator-catalog-and-output-catalog-to-find-matches">
     Compare RA, Dec coordinates between simulator catalog and output catalog to find matches
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#use-photutils-to-find-catalog-matches-and-compare-which-sources-were-found-and-matched">
     Use photutils to find catalog matches and compare which sources were found and matched.
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#plot-ra-and-dec-positions-of-both-catalogs">
     Plot RA and Dec positions of both catalogs
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#convert-matched-ra-dec-coordinates-back-to-x-y-positions-and-plot-matched-stars-on-image">
     Convert matched RA/Dec coordinates back to x,y positions and plot matched stars on image
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#compare-to-full-catalog-and-see-where-differences-are">
     Compare to full catalog and see where differences are
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#look-at-positions-of-sources-in-the-simulated-images-from-the-catalogs-used-to-create-the-images">
     Look at positions of sources in the simulated images from the catalogs used to create the images
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#compare-fluxes-between-input-sources-and-output-catalog">
   Compare fluxes between input sources and output catalog
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#compare-the-star-magnitudes-and-magnitude-differences-to-the-x-position-of-the-stars">
     Compare the star magnitudes and magnitude differences to the x position of the stars.
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#plot-ab-mag-vs-x-position">
     Plot AB mag vs x position
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#plot-difference-in-magnitude-against-x-and-y-position">
     Plot difference in magnitude against x and y position.
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#plot-ab-magnitude-difference-against-ab-mag-to-see-if-there-is-a-pattern-in-the-differences-by-mag">
     Plot AB magnitude difference against AB mag to see if there is a pattern in the differences by mag.
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#passing-criteria">
       Passing criteria
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#about-this-notebook">
       About this Notebook
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>JWST Pipeline Validation Notebook: calwebb_image3: source_catalog with MIRI</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#table-of-contents">
   Table of Contents
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#introduction">
   Introduction
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#jwst-calibration-working-group-algorithm">
     JWST Calibration working group algorithm
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#test-description">
     Test description
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#data-description">
     Data description
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#create-a-temporary-directory-for-all-of-the-test-data">
     Create a temporary directory for all of the test data
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#set-up-import-statements">
     Set up import statements
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#put-in-some-helper-scripts">
     Put in some helper scripts
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#print-pipeline-version-number">
     Print pipeline version number
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#read-in-data">
     Read in data
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#run-pipelines">
   Run Pipelines
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#run-output-of-calwebb-detector1-through-calwebb-image2">
     Run output of calwebb_detector1 through calwebb_image2
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#run-output-of-calwebb-image2-through-calwebb-image3">
     Run output of calwebb_image2 through calwebb_image3
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#create-an-association-file-to-combine-the-input-calibrated-files">
     Create an association file to combine the input calibrated files
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#run-calwebb-image3-pipeline">
     Run Calwebb_Image3 pipeline
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#results">
   Results
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#read-in-output-table-of-source-catalog-step-and-print-ecsv-table">
     Read in output table of source_catalog step and print ecsv table
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#display-image-and-overplot-detector-sources-from-ecsv-table">
     Display image and overplot detector sources from ecsv table
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#in-the-image-above-check-that-the-stars-found-by-source-catalog-red-overlap-with-stars-in-the-image">
     In the image above, check that the stars found by source catalog (red) overlap with stars in the image
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#look-at-the-fluxes-of-the-sources-found">
     Look at the fluxes of the sources found
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#look-at-ab-mag-of-sources-found">
     Look at AB mag of sources found
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#look-at-the-errors-on-the-ab-magnitudes">
     Look at the errors on the AB magnitudes
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#manually-find-matches">
     Manually find matches
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#use-miri-software-to-put-x-y-coordinates-from-input-catalog-into-ra-dec-coordinates">
     Use MIRI software to put x, y coordinates from input catalog into RA, Dec coordinates
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#compare-ra-dec-coordinates-between-simulator-catalog-and-output-catalog-to-find-matches">
     Compare RA, Dec coordinates between simulator catalog and output catalog to find matches
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#use-photutils-to-find-catalog-matches-and-compare-which-sources-were-found-and-matched">
     Use photutils to find catalog matches and compare which sources were found and matched.
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#plot-ra-and-dec-positions-of-both-catalogs">
     Plot RA and Dec positions of both catalogs
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#convert-matched-ra-dec-coordinates-back-to-x-y-positions-and-plot-matched-stars-on-image">
     Convert matched RA/Dec coordinates back to x,y positions and plot matched stars on image
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#compare-to-full-catalog-and-see-where-differences-are">
     Compare to full catalog and see where differences are
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#look-at-positions-of-sources-in-the-simulated-images-from-the-catalogs-used-to-create-the-images">
     Look at positions of sources in the simulated images from the catalogs used to create the images
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#compare-fluxes-between-input-sources-and-output-catalog">
   Compare fluxes between input sources and output catalog
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#compare-the-star-magnitudes-and-magnitude-differences-to-the-x-position-of-the-stars">
     Compare the star magnitudes and magnitude differences to the x position of the stars.
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#plot-ab-mag-vs-x-position">
     Plot AB mag vs x position
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#plot-difference-in-magnitude-against-x-and-y-position">
     Plot difference in magnitude against x and y position.
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#plot-ab-magnitude-difference-against-ab-mag-to-see-if-there-is-a-pattern-in-the-differences-by-mag">
     Plot AB magnitude difference against AB mag to see if there is a pattern in the differences by mag.
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#passing-criteria">
       Passing criteria
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#about-this-notebook">
       About this Notebook
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <p><a id="title_ID"></a></p>
<section class="tex2jax_ignore mathjax_ignore" id="jwst-pipeline-validation-notebook-calwebb-image3-source-catalog-with-miri">
<h1>JWST Pipeline Validation Notebook: calwebb_image3: source_catalog with MIRI<a class="headerlink" href="#jwst-pipeline-validation-notebook-calwebb-image3-source-catalog-with-miri" title="Permalink to this headline">#</a></h1>
<p><span style="color:red"> <strong>Instruments Affected</strong></span>: MIRI, NIRCam</p>
<p>Tested on MIRI Simulated data</p>
<section id="table-of-contents">
<h2>Table of Contents<a class="headerlink" href="#table-of-contents" title="Permalink to this headline">#</a></h2>
<div style="text-align: left"> 
<p><br>  <a class="reference external" href="#intro_ID">Introduction</a> <br> <a class="reference external" href="#imports_ID">Imports</a> <br> <a class="reference external" href="#pipeline_ID">Run Pipeline</a> <br> <a class="reference external" href="#output_ID">Check Results</a> <br> <a class="reference external" href="#about_ID">About This Notebook</a> <br></p>
</div><p><a id="intro_ID"></a></p>
</section>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">#</a></h2>
<p>This notebook processes a set of images through calwebb_image2 and calwebb_image3 and examines the output table of the source_catalog step.</p>
<p>This test uses simulated MIRI F770W (options for F560W or F770W) data of a crowded star + galaxy field.</p>
<p>The pipeline documentation can be found here: <a class="reference external" href="https://jwst-pipeline.readthedocs.io/en/latest/jwst/source_catalog/main.html">https://jwst-pipeline.readthedocs.io/en/latest/jwst/source_catalog/main.html</a></p>
<p>The pipeline code is available on GitHub: <a class="reference external" href="https://github.com/spacetelescope/jwst">https://github.com/spacetelescope/jwst</a></p>
<section id="jwst-calibration-working-group-algorithm">
<h3>JWST Calibration working group algorithm<a class="headerlink" href="#jwst-calibration-working-group-algorithm" title="Permalink to this headline">#</a></h3>
<p>The algorithm and discussion for this step can be found at the following page:</p>
<p><a class="reference external" href="https://outerspace.stsci.edu/display/JWSTCC/Vanilla+Point+Source+Catalog">https://outerspace.stsci.edu/display/JWSTCC/Vanilla+Point+Source+Catalog</a></p>
</section>
<section id="test-description">
<h3>Test description<a class="headerlink" href="#test-description" title="Permalink to this headline">#</a></h3>
<p>The steps of this test are as follow:</p>
<ol class="simple">
<li><p>Set up data path and directory and image files name.</p></li>
<li><p>Run output of calwebb_detector1 through calwebb_image2.</p></li>
<li><p>Run output of calwebb_image2 through calwebb_image3.</p></li>
<li><p>Read in output table of source_catalog step and print ecsv table</p></li>
<li><p>Display image and overplot detector sources from ecsv table.</p></li>
<li><p>Look at plots of total flux in Jy and AB mag.</p></li>
<li><p>Look for matches between expected source positions (RA and Dec) from simulated catalog to output from source_catalog.</p></li>
<li><p>Compare magnitudes and magnitude differences between input simulated catalog and output found sources.</p></li>
</ol>
</section>
<section id="data-description">
<h3>Data description<a class="headerlink" href="#data-description" title="Permalink to this headline">#</a></h3>
<p>The data used in this test consist of a set of four simulated images in the F770W filter of MIRI, at four different dither positions. The data have 4827 stars of varying flux levels and just over 200 galaxies in the image. The MIRI Image simulator (MIRISim) was used to create the simulations.</p>
</section>
<section id="create-a-temporary-directory-for-all-of-the-test-data">
<h3>Create a temporary directory for all of the test data<a class="headerlink" href="#create-a-temporary-directory-for-all-of-the-test-data" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a temporary directory to hold notebook output, and change the working directory to that directory.</span>
<span class="kn">from</span> <span class="nn">tempfile</span> <span class="kn">import</span> <span class="n">TemporaryDirectory</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="n">data_dir</span> <span class="o">=</span> <span class="n">TemporaryDirectory</span><span class="p">()</span>
<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">data_dir</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

<span class="c1"># For info, print out where the script is running</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Running in </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running in /tmp/tmpjariqfyf
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="k">if</span> <span class="s1">&#39;CRDS_CACHE_TYPE&#39;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;CRDS_CACHE_TYPE&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;local&#39;</span><span class="p">:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;CRDS_PATH&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;HOME&#39;</span><span class="p">],</span> <span class="s1">&#39;crds&#39;</span><span class="p">,</span> <span class="s1">&#39;cache&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;CRDS_CACHE_TYPE&#39;</span><span class="p">]):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;CRDS_PATH&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;CRDS_CACHE_TYPE&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;CRDS cache location: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;CRDS_PATH&#39;</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">KeyError</span><span class="g g-Whitespace">                                  </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">line</span> <span class="mi">7</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span>     <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;CRDS_CACHE_TYPE&#39;</span><span class="p">]):</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span>         <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;CRDS_PATH&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;CRDS_CACHE_TYPE&#39;</span><span class="p">]</span>
<span class="ne">----&gt; </span><span class="mi">7</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;CRDS cache location: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;CRDS_PATH&#39;</span><span class="p">]))</span>

<span class="nn">File /usr/share/miniconda/lib/python3.9/os.py:679,</span> in <span class="ni">_Environ.__getitem__</span><span class="nt">(self, key)</span>
<span class="g g-Whitespace">    </span><span class="mi">676</span>     <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">encodekey</span><span class="p">(</span><span class="n">key</span><span class="p">)]</span>
<span class="g g-Whitespace">    </span><span class="mi">677</span> <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">678</span>     <span class="c1"># raise KeyError with the original key value</span>
<span class="ne">--&gt; </span><span class="mi">679</span>     <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="kn">from</span> <span class="bp">None</span>
<span class="g g-Whitespace">    </span><span class="mi">680</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">decodevalue</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

<span class="ne">KeyError</span>: &#39;CRDS_PATH&#39;
</pre></div>
</div>
</div>
</div>
<p><a id="imports_ID"></a></p>
</section>
<section id="set-up-import-statements">
<h3>Set up import statements<a class="headerlink" href="#set-up-import-statements" title="Permalink to this headline">#</a></h3>
<p>The following packages are needed to enable this notebook to run:</p>
<ul class="simple">
<li><p>astropy for coordinate handling and calculations</p></li>
<li><p>jwst to run the pipeline steps and create associations</p></li>
<li><p>matplotlib for plotting</p></li>
<li><p>ci_watson for retrieving data from artifactory</p></li>
<li><p>set of tools to retrieve data from Box</p></li>
</ul>
<p><a class="reference external" href="#title_ID">Top of Page</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#import pytest</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">glob</span> <span class="kn">import</span> <span class="n">glob</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">photutils</span>

<span class="kn">from</span> <span class="nn">astropy.io</span> <span class="kn">import</span> <span class="n">fits</span><span class="p">,</span> <span class="n">ascii</span>
<span class="kn">from</span> <span class="nn">astropy.coordinates</span> <span class="kn">import</span> <span class="n">Angle</span>
<span class="kn">from</span> <span class="nn">astropy.table</span> <span class="kn">import</span> <span class="n">Table</span><span class="p">,</span> <span class="n">vstack</span><span class="p">,</span> <span class="n">unique</span><span class="p">,</span> <span class="n">join</span>
<span class="kn">from</span> <span class="nn">astropy</span> <span class="kn">import</span> <span class="n">table</span>
<span class="kn">from</span> <span class="nn">astropy.coordinates</span> <span class="kn">import</span> <span class="n">SkyCoord</span><span class="p">,</span> <span class="n">match_coordinates_sky</span>
<span class="kn">from</span> <span class="nn">astropy.visualization</span> <span class="kn">import</span> <span class="n">simple_norm</span>
<span class="kn">from</span> <span class="nn">astropy</span> <span class="kn">import</span> <span class="n">units</span> <span class="k">as</span> <span class="n">u</span>
<span class="kn">from</span> <span class="nn">astropy.modeling</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">astropy.wcs</span> <span class="kn">import</span> <span class="n">WCS</span>

<span class="c1"># Box download imports </span>
<span class="kn">from</span> <span class="nn">astropy.utils.data</span> <span class="kn">import</span> <span class="n">download_file</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">shutil</span> <span class="kn">import</span> <span class="n">move</span>
<span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">splitext</span>

<span class="kn">import</span> <span class="nn">jwst</span>
<span class="kn">from</span> <span class="nn">jwst</span> <span class="kn">import</span> <span class="n">datamodels</span>
<span class="kn">from</span> <span class="nn">jwst.datamodels</span> <span class="kn">import</span> <span class="n">RampModel</span><span class="p">,</span> <span class="n">ImageModel</span>

<span class="kn">from</span> <span class="nn">jwst</span> <span class="kn">import</span> <span class="n">associations</span>
<span class="kn">from</span> <span class="nn">jwst.associations</span> <span class="kn">import</span> <span class="n">asn_from_list</span>
<span class="kn">from</span> <span class="nn">jwst.associations.lib.rules_level3_base</span> <span class="kn">import</span> <span class="n">DMS_Level3_Base</span>

<span class="kn">from</span> <span class="nn">jwst.pipeline</span> <span class="kn">import</span> <span class="n">calwebb_image3</span>
<span class="kn">from</span> <span class="nn">jwst.pipeline</span> <span class="kn">import</span> <span class="n">calwebb_image2</span>
<span class="kn">from</span> <span class="nn">jwst.pipeline</span> <span class="kn">import</span> <span class="n">calwebb_detector1</span>
<span class="kn">from</span> <span class="nn">jwst.pipeline</span> <span class="kn">import</span> <span class="n">Detector1Pipeline</span><span class="p">,</span> <span class="n">Image2Pipeline</span><span class="p">,</span> <span class="n">Image3Pipeline</span>

<span class="kn">from</span> <span class="nn">ci_watson.artifactory_helpers</span> <span class="kn">import</span> <span class="n">get_bigdata</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="put-in-some-helper-scripts">
<h3>Put in some helper scripts<a class="headerlink" href="#put-in-some-helper-scripts" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">create_scatterplot</span><span class="p">(</span><span class="n">catalog_colx</span><span class="p">,</span> <span class="n">catalog_coly</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Function to generate a generic scatterplot.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">catalog_colx</span><span class="p">,</span><span class="n">catalog_coly</span><span class="p">)</span> 
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">catalog_colx</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">catalog_coly</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    
    <span class="k">if</span> <span class="n">title</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Band info from constants in miricap</span>

<span class="c1"># wref in microns and zeropoint in Jy</span>
<span class="n">band_info</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;2MASS J&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;wref&#39;</span><span class="p">:</span> <span class="mf">1.235</span><span class="p">,</span> <span class="s1">&#39;zeropoint&#39;</span><span class="p">:</span> <span class="mi">1594</span><span class="p">},</span>
    <span class="s2">&quot;2MASS H&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;wref&#39;</span><span class="p">:</span> <span class="mf">1.662</span><span class="p">,</span> <span class="s1">&#39;zeropoint&#39;</span><span class="p">:</span> <span class="mi">1024</span><span class="p">},</span>
    <span class="s2">&quot;2MASS Ks&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;wref&#39;</span><span class="p">:</span> <span class="mf">2.159</span><span class="p">,</span> <span class="s1">&#39;zeropoint&#39;</span><span class="p">:</span> <span class="mf">666.7</span><span class="p">},</span>
    <span class="s2">&quot;Johnson U&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;wref&#39;</span><span class="p">:</span> <span class="mf">0.36</span><span class="p">,</span> <span class="s1">&#39;zeropoint&#39;</span><span class="p">:</span> <span class="mi">1823</span><span class="p">},</span>
    <span class="s2">&quot;Johnson B&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;wref&#39;</span><span class="p">:</span> <span class="mf">0.44</span><span class="p">,</span> <span class="s1">&#39;zeropoint&#39;</span><span class="p">:</span> <span class="mi">4130</span><span class="p">},</span>
    <span class="s2">&quot;Johnson V&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;wref&#39;</span><span class="p">:</span> <span class="mf">0.55</span><span class="p">,</span> <span class="s1">&#39;zeropoint&#39;</span><span class="p">:</span> <span class="mi">3781</span><span class="p">},</span>
    <span class="s2">&quot;Johnson R&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;wref&#39;</span><span class="p">:</span> <span class="mf">0.71</span><span class="p">,</span> <span class="s1">&#39;zeropoint&#39;</span><span class="p">:</span> <span class="mi">2941</span><span class="p">},</span>
    <span class="s2">&quot;Johnson I&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;wref&#39;</span><span class="p">:</span> <span class="mf">0.97</span><span class="p">,</span> <span class="s1">&#39;zeropoint&#39;</span><span class="p">:</span> <span class="mi">2635</span><span class="p">},</span>
    <span class="s2">&quot;Johnson J&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;wref&#39;</span><span class="p">:</span> <span class="mf">1.25</span><span class="p">,</span> <span class="s1">&#39;zeropoint&#39;</span><span class="p">:</span> <span class="mi">1603</span><span class="p">},</span>
    <span class="s2">&quot;Johnson H&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;wref&#39;</span><span class="p">:</span> <span class="mf">1.60</span><span class="p">,</span> <span class="s1">&#39;zeropoint&#39;</span><span class="p">:</span> <span class="mi">1075</span><span class="p">},</span>
    <span class="s2">&quot;Johnson K&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;wref&#39;</span><span class="p">:</span> <span class="mf">2.22</span><span class="p">,</span> <span class="s1">&#39;zeropoint&#39;</span><span class="p">:</span> <span class="mi">667</span><span class="p">},</span>
    <span class="s2">&quot;Johnson L&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;wref&#39;</span><span class="p">:</span> <span class="mf">3.54</span><span class="p">,</span> <span class="s1">&#39;zeropoint&#39;</span><span class="p">:</span> <span class="mi">288</span><span class="p">},</span>
    <span class="s2">&quot;Johnson M&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;wref&#39;</span><span class="p">:</span> <span class="mf">4.80</span><span class="p">,</span> <span class="s1">&#39;zeropoint&#39;</span><span class="p">:</span> <span class="mi">170</span><span class="p">},</span>
    <span class="s2">&quot;Johnson N&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;wref&#39;</span><span class="p">:</span> <span class="mf">10.6</span><span class="p">,</span> <span class="s1">&#39;zeropoint&#39;</span><span class="p">:</span> <span class="mi">36</span><span class="p">},</span>
    <span class="s2">&quot;Johnson O&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;wref&#39;</span><span class="p">:</span> <span class="mf">21.0</span><span class="p">,</span> <span class="s1">&#39;zeropoint&#39;</span><span class="p">:</span> <span class="mf">9.4</span><span class="p">},</span>
    <span class="s2">&quot;UKIRT V&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;wref&#39;</span><span class="p">:</span> <span class="mf">0.5556</span><span class="p">,</span> <span class="s1">&#39;zeropoint&#39;</span><span class="p">:</span> <span class="mi">3540</span><span class="p">},</span>
    <span class="s2">&quot;UKIRT I&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;wref&#39;</span><span class="p">:</span> <span class="mf">0.9</span><span class="p">,</span> <span class="s1">&#39;zeropoint&#39;</span><span class="p">:</span> <span class="mi">2250</span><span class="p">},</span>
    <span class="s2">&quot;UKIRT J&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;wref&#39;</span><span class="p">:</span> <span class="mf">1.25</span><span class="p">,</span> <span class="s1">&#39;zeropoint&#39;</span><span class="p">:</span> <span class="mi">1600</span><span class="p">},</span>
    <span class="s2">&quot;UKIRT H&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;wref&#39;</span><span class="p">:</span> <span class="mf">1.65</span><span class="p">,</span> <span class="s1">&#39;zeropoint&#39;</span><span class="p">:</span> <span class="mi">1020</span><span class="p">},</span>
    <span class="s2">&quot;UKIRT K&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;wref&#39;</span><span class="p">:</span> <span class="mf">2.20</span><span class="p">,</span> <span class="s1">&#39;zeropoint&#39;</span><span class="p">:</span> <span class="mi">657</span><span class="p">},</span>
    <span class="s2">&quot;UKIRT L&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;wref&#39;</span><span class="p">:</span> <span class="mf">3.45</span><span class="p">,</span> <span class="s1">&#39;zeropoint&#39;</span><span class="p">:</span> <span class="mi">290</span><span class="p">},</span>
    <span class="s2">&quot;UKIRT L&#39;&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;wref&#39;</span><span class="p">:</span> <span class="mf">3.80</span><span class="p">,</span> <span class="s1">&#39;zeropoint&#39;</span><span class="p">:</span> <span class="mi">252</span><span class="p">},</span>
    <span class="s2">&quot;UKIRT M&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;wref&#39;</span><span class="p">:</span> <span class="mf">4.8</span><span class="p">,</span> <span class="s1">&#39;zeropoint&#39;</span><span class="p">:</span> <span class="mi">163</span><span class="p">},</span>
    <span class="s2">&quot;UKIRT N&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;wref&#39;</span><span class="p">:</span> <span class="mf">10.1</span><span class="p">,</span> <span class="s1">&#39;zeropoint&#39;</span><span class="p">:</span> <span class="mf">39.8</span><span class="p">},</span>
    <span class="s2">&quot;UKIRT Q&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;wref&#39;</span><span class="p">:</span> <span class="mf">20.0</span><span class="p">,</span> <span class="s1">&#39;zeropoint&#39;</span><span class="p">:</span> <span class="mf">10.4</span><span class="p">},</span>
    <span class="s2">&quot;MIRLIN N&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;wref&#39;</span><span class="p">:</span> <span class="mf">10.79</span><span class="p">,</span> <span class="s1">&#39;zeropoint&#39;</span><span class="p">:</span> <span class="mf">33.4</span><span class="p">},</span>
    <span class="s2">&quot;MIRLIN Q-s&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;wref&#39;</span><span class="p">:</span> <span class="mf">17.90</span><span class="p">,</span> <span class="s1">&#39;zeropoint&#39;</span><span class="p">:</span> <span class="mf">12.4</span><span class="p">},</span>
    <span class="s2">&quot;MIRLIN N0&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;wref&#39;</span><span class="p">:</span> <span class="mf">7.91</span><span class="p">,</span> <span class="s1">&#39;zeropoint&#39;</span><span class="p">:</span> <span class="mf">60.9</span><span class="p">},</span>
    <span class="s2">&quot;MIRLIN N1&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;wref&#39;</span><span class="p">:</span> <span class="mf">8.81</span><span class="p">,</span> <span class="s1">&#39;zeropoint&#39;</span><span class="p">:</span> <span class="mf">49.4</span><span class="p">},</span>
    <span class="s2">&quot;MIRLIN N2&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;wref&#39;</span><span class="p">:</span> <span class="mf">9.69</span><span class="p">,</span> <span class="s1">&#39;zeropoint&#39;</span><span class="p">:</span> <span class="mf">41.1</span><span class="p">},</span>
    <span class="s2">&quot;MIRLIN N3&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;wref&#39;</span><span class="p">:</span> <span class="mf">10.27</span><span class="p">,</span> <span class="s1">&#39;zeropoint&#39;</span><span class="p">:</span> <span class="mf">36.7</span><span class="p">},</span>
    <span class="s2">&quot;MIRLIN N4&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;wref&#39;</span><span class="p">:</span> <span class="mf">11.70</span><span class="p">,</span> <span class="s1">&#39;zeropoint&#39;</span><span class="p">:</span> <span class="mf">28.5</span><span class="p">},</span>
    <span class="s2">&quot;MIRLIN N5&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;wref&#39;</span><span class="p">:</span> <span class="mf">12.49</span><span class="p">,</span> <span class="s1">&#39;zeropoint&#39;</span><span class="p">:</span> <span class="mf">25.1</span><span class="p">},</span>
    <span class="s2">&quot;MIRLIN Q0&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;wref&#39;</span><span class="p">:</span> <span class="mf">17.20</span><span class="p">,</span> <span class="s1">&#39;zeropoint&#39;</span><span class="p">:</span> <span class="mf">13.4</span><span class="p">},</span>
    <span class="s2">&quot;MIRLIN Q1&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;wref&#39;</span><span class="p">:</span> <span class="mf">17.93</span><span class="p">,</span> <span class="s1">&#39;zeropoint&#39;</span><span class="p">:</span> <span class="mf">12.3</span><span class="p">},</span>
    <span class="s2">&quot;MIRLIN Q2&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;wref&#39;</span><span class="p">:</span> <span class="mf">18.64</span><span class="p">,</span> <span class="s1">&#39;zeropoint&#39;</span><span class="p">:</span> <span class="mf">11.4</span><span class="p">},</span>
    <span class="s2">&quot;MIRLIN Q3&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;wref&#39;</span><span class="p">:</span> <span class="mf">20.81</span><span class="p">,</span> <span class="s1">&#39;zeropoint&#39;</span><span class="p">:</span> <span class="mf">9.2</span><span class="p">},</span>
    <span class="s2">&quot;MIRLIN Q4&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;wref&#39;</span><span class="p">:</span> <span class="mf">22.81</span><span class="p">,</span> <span class="s1">&#39;zeropoint&#39;</span><span class="p">:</span> <span class="mf">7.7</span><span class="p">},</span>
    <span class="s2">&quot;MIRLIN Q5&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;wref&#39;</span><span class="p">:</span> <span class="mf">24.48</span><span class="p">,</span> <span class="s1">&#39;zeropoint&#39;</span><span class="p">:</span> <span class="mf">6.7</span><span class="p">},</span>
    <span class="s2">&quot;MIRLIN K&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;wref&#39;</span><span class="p">:</span> <span class="mf">2.2</span><span class="p">,</span> <span class="s1">&#39;zeropoint&#39;</span><span class="p">:</span> <span class="mf">650.0</span><span class="p">},</span>
    <span class="s2">&quot;MIRLIN M&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;wref&#39;</span><span class="p">:</span> <span class="mf">4.68</span><span class="p">,</span> <span class="s1">&#39;zeropoint&#39;</span><span class="p">:</span> <span class="mf">165.0</span><span class="p">},</span>
    <span class="s2">&quot;WISE W1&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;wref&#39;</span><span class="p">:</span> <span class="mf">3.4</span><span class="p">,</span> <span class="s1">&#39;zeropoint&#39;</span><span class="p">:</span><span class="mf">309.54</span><span class="p">},</span>
    <span class="s2">&quot;WISE W2&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;wref&#39;</span><span class="p">:</span> <span class="mf">4.6</span><span class="p">,</span> <span class="s1">&#39;zeropoint&#39;</span><span class="p">:</span><span class="mf">171.787</span><span class="p">},</span>
    <span class="s2">&quot;WISE W3&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;wref&#39;</span><span class="p">:</span> <span class="mf">12.</span><span class="p">,</span> <span class="s1">&#39;zeropoint&#39;</span><span class="p">:</span><span class="mf">31.674</span><span class="p">},</span>
    <span class="s2">&quot;WISE W4&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;wref&#39;</span><span class="p">:</span> <span class="mf">22.</span><span class="p">,</span> <span class="s1">&#39;zeropoint&#39;</span><span class="p">:</span><span class="mf">8.363</span><span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># code from miricap.imager section written by Christophe Cossou of the MIRI EC team.</span>

<span class="k">def</span> <span class="nf">get_band_info</span><span class="p">(</span><span class="n">band</span><span class="p">,</span> <span class="n">system</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieve information on a given band in a dictionnary &#39;band_info&#39; that need to be</span>
<span class="sd">    available in global variable of the script at this level.</span>
<span class="sd">    :param str band: Band name (e.g. V for Johnson)</span>
<span class="sd">    :param str system: possible values: Johnson, 2MASS, UKIRT, MARLIN)</span>
<span class="sd">    :return: wref in microns and zeropoint in Jy</span>
<span class="sd">    :rtype: tuple(Quantity, Quantity)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">system_list</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Johnson&quot;</span><span class="p">,</span> <span class="s2">&quot;2MASS&quot;</span><span class="p">,</span> <span class="s2">&quot;UKIRT&quot;</span><span class="p">,</span> <span class="s2">&quot;MARLIN&quot;</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">system</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">system_list</span><span class="p">:</span>
        <span class="n">LOG</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown system &#39;</span><span class="si">{</span><span class="n">system</span><span class="si">}</span><span class="s2">&#39;. Possible values: </span><span class="si">{</span><span class="n">system_list</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

    <span class="n">key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">system</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">band</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">band_dict</span> <span class="o">=</span> <span class="n">band_info</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="n">zeropoint</span> <span class="o">=</span> <span class="n">band_dict</span><span class="p">[</span><span class="s2">&quot;zeropoint&quot;</span><span class="p">]</span>
        <span class="n">wref</span> <span class="o">=</span> <span class="n">band_dict</span><span class="p">[</span><span class="s2">&quot;wref&quot;</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="n">bands</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">band_info</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="n">system</span> <span class="ow">in</span> <span class="n">k</span><span class="p">]</span>
        <span class="n">LOG</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown band &#39;</span><span class="si">{</span><span class="n">band</span><span class="si">}</span><span class="s2">&#39; for &#39;</span><span class="si">{</span><span class="n">system</span><span class="si">}</span><span class="s2">&#39;. Available bands are: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">bands</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

    <span class="k">return</span> <span class="n">wref</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">micron</span><span class="p">,</span> <span class="n">zeropoint</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">Jy</span>



<span class="k">def</span> <span class="nf">mag2flux</span><span class="p">(</span><span class="n">magnitude</span><span class="p">,</span> <span class="n">band</span><span class="p">,</span> <span class="n">system</span><span class="o">=</span><span class="s2">&quot;Johnson&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert magnitude in a given band/system into flux in mJy (and return the corresponding wavelength reference</span>
<span class="sd">    :param float magnitude: magnitude in a given bandpass</span>
<span class="sd">    :param str band: band name (e.g &#39;V&#39; or Johnson system)</span>
<span class="sd">    :param str system: (By default Johnson, possible values: Johnson, 2MASS, UKIRT, MARLIN)</span>
<span class="sd">    :return: flux in mJy and wref in microns</span>
<span class="sd">    :rtype: tuple(float, float)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">wref</span><span class="p">,</span> <span class="n">zero_point</span> <span class="o">=</span> <span class="n">get_band_info</span><span class="p">(</span><span class="n">band</span><span class="p">,</span> <span class="n">system</span><span class="p">)</span>

    <span class="n">flux</span> <span class="o">=</span> <span class="n">zero_point</span> <span class="o">*</span> <span class="mf">10.0</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.4</span> <span class="o">*</span> <span class="n">magnitude</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Magnitude </span><span class="si">{</span><span class="n">magnitude</span><span class="si">}</span><span class="s2"> in </span><span class="si">{</span><span class="n">system</span><span class="si">}</span><span class="s2"> band </span><span class="si">{</span><span class="n">band</span><span class="si">}</span><span class="s2"> -&gt; Flux: </span><span class="si">{</span><span class="n">flux</span><span class="si">}</span><span class="s2"> at </span><span class="si">{</span><span class="n">wref</span><span class="si">}</span><span class="s2"> microns&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">flux</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">mJy</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">wref</span><span class="o">.</span><span class="n">value</span>


<span class="k">def</span> <span class="nf">extrapolate_flux</span><span class="p">(</span><span class="n">flux</span><span class="p">,</span> <span class="n">wref</span><span class="p">,</span> <span class="n">waves</span><span class="p">,</span> <span class="n">temperature_star</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    From a flux and reference wavelength, will return the flux for other wavelength</span>
<span class="sd">    (using the star effective temperature for the spectrum shape)</span>
<span class="sd">    To convert magnitude flux in a band, use one of the following website for instance:</span>
<span class="sd">    - http://ssc.spitzer.caltech.edu/warmmission/propkit/pet/magtojy/</span>
<span class="sd">    - https://www.gemini.edu/sciops/instruments/midir-resources/imaging-calibrations/fluxmagnitude-conversion</span>
<span class="sd">    :param float flux: Star flux in mJy</span>
<span class="sd">    :param float wref: reference wavelength (microns) corresponding to the flux given in parameter</span>
<span class="sd">    :param waves: list of wavelengths you want to extrapolate the star flux on.</span>
<span class="sd">    :type waves: float or list(float) or np.array(float)</span>
<span class="sd">    :param float temperature_star: star effective temperature in K</span>
<span class="sd">    :return: flux values for all required wavelengths. Unit will be the unit of the input flux</span>
<span class="sd">    :rtype: quantity or np.array(quantity)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">flux</span> <span class="o">=</span> <span class="n">flux</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">mJy</span>
    <span class="n">wref</span> <span class="o">=</span> <span class="n">wref</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">micron</span>
    <span class="n">waves</span> <span class="o">=</span> <span class="n">waves</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">micron</span>

    <span class="n">bb_star</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BlackBody</span><span class="p">(</span><span class="n">temperature_star</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">K</span><span class="p">)</span>

    <span class="n">extrapolated_flux</span> <span class="o">=</span> <span class="n">flux</span> <span class="o">*</span> <span class="n">bb_star</span><span class="p">(</span><span class="n">waves</span><span class="p">)</span> <span class="o">/</span> <span class="n">bb_star</span><span class="p">(</span><span class="n">wref</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Assuming T=</span><span class="si">{</span><span class="n">temperature_star</span><span class="si">}</span><span class="s2"> K, Flux: </span><span class="si">{</span><span class="n">flux</span><span class="si">}</span><span class="s2"> at </span><span class="si">{</span><span class="n">wref</span><span class="si">}</span><span class="s2"> -&gt; Flux: </span><span class="si">{</span><span class="n">extrapolated_flux</span><span class="si">}</span><span class="s2"> at </span><span class="si">{</span><span class="n">waves</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">extrapolated_flux</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="print-pipeline-version-number">
<h3>Print pipeline version number<a class="headerlink" href="#print-pipeline-version-number" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">jwst</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span> 
<span class="nb">print</span><span class="p">(</span><span class="n">data_dir</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="read-in-data">
<h3>Read in data<a class="headerlink" href="#read-in-data" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Read in new dataset from Box</span>

<span class="k">def</span> <span class="nf">get_box_files</span><span class="p">(</span><span class="n">file_list</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">box_url</span><span class="p">,</span><span class="n">file_name</span> <span class="ow">in</span> <span class="n">file_list</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;https&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">box_url</span><span class="p">:</span>
            <span class="n">box_url</span> <span class="o">=</span> <span class="s1">&#39;https://stsci.box.com/shared/static/&#39;</span> <span class="o">+</span> <span class="n">box_url</span>
        <span class="n">downloaded_file</span> <span class="o">=</span> <span class="n">download_file</span><span class="p">(</span><span class="n">box_url</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">Path</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span><span class="o">.</span><span class="n">suffix</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="n">ext</span> <span class="o">=</span> <span class="n">splitext</span><span class="p">(</span><span class="n">box_url</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">file_name</span> <span class="o">+=</span> <span class="n">ext</span>
        <span class="n">move</span><span class="p">(</span><span class="n">downloaded_file</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span>

<span class="c1"># Use F560W data set</span>
        
<span class="c1">#file_urls = [&#39;https://stsci.box.com/shared/static/g8ozd2wkdo9klrtkafpe9qegpzhpd66a.fits&#39;, </span>
<span class="c1">#             &#39;https://stsci.box.com/shared/static/ym75nbqdi32t9wnbanm6s57itqixniyc.fits&#39;, </span>
<span class="c1">#             &#39;https://stsci.box.com/shared/static/0bqh6ijsc6kd7cyv6gtnj9kvly9t885f.fits&#39;,</span>
<span class="c1">#             &#39;https://stsci.box.com/shared/static/tywadpqcjhp9yxyv0sy91hc79red92xm.fits&#39;,</span>
<span class="c1">#             &#39;https://stsci.box.com/shared/static/lpcgp7jkq6lmjj2lxpk63jz9u05qgk3a.cat&#39;,</span>
<span class="c1">#             &#39;https://stsci.box.com/shared/static/15j6hkjc28zow4rjepob2t75dl887zs3.cat&#39;]</span>

<span class="c1">#file_names = [&#39;det_image_seq1_MIRIMAGE_F560Wexp1_rate.fits&#39;, </span>
<span class="c1">#             &#39;det_image_seq2_MIRIMAGE_F560Wexp1_rate.fits&#39;, </span>
<span class="c1">#             &#39;det_image_seq3_MIRIMAGE_F560Wexp1_rate.fits&#39;,</span>
<span class="c1">#             &#39;det_image_seq4_MIRIMAGE_F560Wexp1_rate.fits&#39;,</span>
<span class="c1">#             &#39;input_sim_stars.cat&#39;,</span>
<span class="c1">#             &#39;input_sim_galaxies.cat&#39;]</span>

<span class="c1"># Test with F770W data set</span>

<span class="n">file_urls</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;https://stsci.box.com/shared/static/8573htf1p8mhk4e49z9b483dp975y3lz.fits&#39;</span><span class="p">,</span>
             <span class="s1">&#39;https://stsci.box.com/shared/static/p69h7uzlmqwlzf6kqqbf4lu9ibz28tc6.fits&#39;</span><span class="p">,</span>
             <span class="s1">&#39;https://stsci.box.com/shared/static/js8k6j20rek1oago057wxn08dhuticij.fits&#39;</span><span class="p">,</span>
             <span class="s1">&#39;https://stsci.box.com/shared/static/es253mc3m1sptusj9c9ctl1blidr1qdl.fits&#39;</span><span class="p">,</span>
             <span class="s1">&#39;https://stsci.box.com/shared/static/lpcgp7jkq6lmjj2lxpk63jz9u05qgk3a.cat&#39;</span><span class="p">,</span>
             <span class="s1">&#39;https://stsci.box.com/shared/static/15j6hkjc28zow4rjepob2t75dl887zs3.cat&#39;</span><span class="p">]</span>


<span class="n">file_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;det_image_seq1_MIRIMAGE_F770Wexp1_rate.fits&#39;</span><span class="p">,</span> 
             <span class="s1">&#39;det_image_seq2_MIRIMAGE_F770Wexp1_rate.fits&#39;</span><span class="p">,</span> 
             <span class="s1">&#39;det_image_seq3_MIRIMAGE_F770Wexp1_rate.fits&#39;</span><span class="p">,</span>
             <span class="s1">&#39;det_image_seq4_MIRIMAGE_F770Wexp1_rate.fits&#39;</span><span class="p">,</span>
             <span class="s1">&#39;input_sim_stars.cat&#39;</span><span class="p">,</span>
             <span class="s1">&#39;input_sim_galaxies.cat&#39;</span><span class="p">]</span>


<span class="n">box_download_list</span> <span class="o">=</span> <span class="p">[(</span><span class="n">url</span><span class="p">,</span><span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="n">url</span><span class="p">,</span><span class="n">name</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">file_urls</span><span class="p">,</span><span class="n">file_names</span><span class="p">)]</span>


<span class="n">get_box_files</span><span class="p">(</span><span class="n">box_download_list</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><a id="pipeline_ID"></a></p>
</section>
</section>
<section id="run-pipelines">
<h2>Run Pipelines<a class="headerlink" href="#run-pipelines" title="Permalink to this headline">#</a></h2>
<p>Read in the data and run the JWST calibration pipelines.</p>
<section id="run-output-of-calwebb-detector1-through-calwebb-image2">
<h3>Run output of calwebb_detector1 through calwebb_image2<a class="headerlink" href="#run-output-of-calwebb-detector1-through-calwebb-image2" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Run Calwebb_image2 on output files from detector1</span>
<span class="n">ratefiles</span> <span class="o">=</span> <span class="n">glob</span><span class="p">(</span><span class="s1">&#39;*rate.fits&#39;</span><span class="p">)</span>    
    
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;There are &#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">ratefiles</span><span class="p">),</span> <span class="s1">&#39; images.&#39;</span><span class="p">)</span>
    
<span class="n">callist</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># cycle through files</span>
<span class="k">for</span> <span class="n">im</span> <span class="ow">in</span> <span class="n">ratefiles</span><span class="p">:</span>
    <span class="n">pipe2</span> <span class="o">=</span> <span class="n">Image2Pipeline</span><span class="p">()</span>
    
    <span class="n">rampfile</span> <span class="o">=</span> <span class="n">ImageModel</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="n">rampfile</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">filename</span>
    <span class="c1"># Set pipeline parameters</span>

    <span class="n">pipe2</span><span class="o">.</span><span class="n">save_results</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">pipe2</span><span class="o">.</span><span class="n">output_file</span> <span class="o">=</span> <span class="n">filename</span> <span class="o">+</span><span class="s1">&#39;_cal.fits&#39;</span>
    <span class="n">pipe2</span><span class="o">.</span><span class="n">resample</span><span class="o">.</span><span class="n">save_results</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">pipe2</span><span class="o">.</span><span class="n">suffix</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">calfile</span> <span class="o">=</span> <span class="n">pipe2</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">rampfile</span><span class="p">)</span>

    <span class="n">callist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">calfile</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">callist</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="run-output-of-calwebb-image2-through-calwebb-image3">
<h3>Run output of calwebb_image2 through calwebb_image3<a class="headerlink" href="#run-output-of-calwebb-image2-through-calwebb-image3" title="Permalink to this headline">#</a></h3>
</section>
<section id="create-an-association-file-to-combine-the-input-calibrated-files">
<h3>Create an association file to combine the input calibrated files<a class="headerlink" href="#create-an-association-file-to-combine-the-input-calibrated-files" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># use asn_from_list to create association table</span>

<span class="n">calfiles</span> <span class="o">=</span> <span class="n">glob</span><span class="p">(</span><span class="s1">&#39;*_cal.fits&#39;</span><span class="p">)</span>
<span class="n">asn</span> <span class="o">=</span> <span class="n">asn_from_list</span><span class="o">.</span><span class="n">asn_from_list</span><span class="p">(</span><span class="n">calfiles</span><span class="p">,</span> <span class="n">rule</span><span class="o">=</span><span class="n">DMS_Level3_Base</span><span class="p">,</span> <span class="n">product_name</span><span class="o">=</span><span class="s1">&#39;starfield_combined.fits&#39;</span><span class="p">)</span>

<span class="c1"># use this if you need to add non&#39;science&#39; exposure types</span>
<span class="c1">#asn[&#39;products&#39;][0][&#39;members&#39;][1][&#39;exptype&#39;] = &#39;background&#39;</span>
<span class="c1">#asn[&#39;products&#39;][0][&#39;members&#39;][2][&#39;exptype&#39;] = &#39;sourcecat&#39;</span>

<span class="c1"># dump association table to a .json file for use in image3</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;starfield_asnfile.json&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
    <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">asn</span><span class="o">.</span><span class="n">dump</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="n">asn</span><span class="p">)</span>    
</pre></div>
</div>
</div>
</div>
</section>
<section id="run-calwebb-image3-pipeline">
<h3>Run Calwebb_Image3 pipeline<a class="headerlink" href="#run-calwebb-image3-pipeline" title="Permalink to this headline">#</a></h3>
<p>For MIRI, the FWHM values are dependent on filter and should be set using the table below:</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>Filter</p></th>
<th class="head"><p>FWHM</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>F560W</p></td>
<td><p>1.636</p></td>
</tr>
<tr class="row-odd"><td><p>F770W</p></td>
<td><p>2.187</p></td>
</tr>
<tr class="row-even"><td><p>F1000W</p></td>
<td><p>2.888</p></td>
</tr>
<tr class="row-odd"><td><p>F1130W</p></td>
<td><p>3.318</p></td>
</tr>
<tr class="row-even"><td><p>F1280W</p></td>
<td><p>3.713</p></td>
</tr>
<tr class="row-odd"><td><p>F1500W</p></td>
<td><p>4.354</p></td>
</tr>
<tr class="row-even"><td><p>F1800W</p></td>
<td><p>5.224</p></td>
</tr>
<tr class="row-odd"><td><p>F2100W</p></td>
<td><p>5.989</p></td>
</tr>
<tr class="row-even"><td><p>F2550W</p></td>
<td><p>7.312</p></td>
</tr>
<tr class="row-odd"><td><p>F2550WR</p></td>
<td><p>7.312</p></td>
</tr>
</tbody>
</table>
<p>For the fit geometry keyword, the following options are available:
fitgeometry: A str value indicating the type of affine transformation to be considered when fitting catalogs. Allowed values:</p>
<ul class="simple">
<li><p>shift: x/y shifts only</p></li>
<li><p>rscale: rotation and scale</p></li>
<li><p>rshift: rotation and shifts</p></li>
<li><p>general: shift, rotation, and scale (Default=general)</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Run Calwebb_image3 on the association table</span>
    
<span class="c1"># set any specific parameters</span>
<span class="c1"># tweakreg parameters to allow data to run</span>
<span class="n">fwhm</span> <span class="o">=</span> <span class="mf">2.187</span>  <span class="c1"># Gaussian kernel FWHM of objects expected, default=2.5</span>
<span class="n">minobj</span> <span class="o">=</span> <span class="mi">5</span>   <span class="c1"># minimum number of objects needed to match positions for a good fit, default=15</span>
<span class="n">snr</span> <span class="o">=</span> <span class="mi">8</span>      <span class="c1"># signal to noise threshold, default=5</span>
<span class="n">sigma</span> <span class="o">=</span> <span class="mi">5</span>    <span class="c1"># clipping limit, in sigma units, used when performing fit, default=3</span>
<span class="n">fit_geom</span> <span class="o">=</span> <span class="s1">&#39;shift&#39;</span> <span class="c1"># ftype of affine transformation to be considered when fitting catalogs, default=&#39;general&#39;</span>
<span class="n">use2dhist</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># boolean indicating whether to use 2D histogram to find initial offset, default=True</span>
   
<span class="n">pipe3</span><span class="o">=</span><span class="n">Image3Pipeline</span><span class="p">()</span>    
<span class="n">pipe3</span><span class="o">.</span><span class="n">tweakreg</span><span class="o">.</span><span class="n">kernel_fwhm</span> <span class="o">=</span> <span class="n">fwhm</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">tweakreg</span><span class="o">.</span><span class="n">snr_threshold</span> <span class="o">=</span> <span class="n">snr</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">tweakreg</span><span class="o">.</span><span class="n">minobj</span> <span class="o">=</span> <span class="n">minobj</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">tweakreg</span><span class="o">.</span><span class="n">sigma</span> <span class="o">=</span> <span class="n">sigma</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">tweakreg</span><span class="o">.</span><span class="n">fitgeometry</span> <span class="o">=</span> <span class="n">fit_geom</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">tweakreg</span><span class="o">.</span><span class="n">use2dhist</span> <span class="o">=</span> <span class="n">use2dhist</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">source_catalog</span><span class="o">.</span><span class="n">save_results</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">source_catalog</span><span class="o">.</span><span class="n">snr_threshold</span> <span class="o">=</span> <span class="n">snr</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">source_catalog</span><span class="o">.</span><span class="n">kernel_fwhm</span> <span class="o">=</span> <span class="n">fwhm</span>
<span class="n">pipe3</span><span class="o">.</span><span class="n">save_results</span> <span class="o">=</span> <span class="kc">True</span>

<span class="c1"># run Image3</span>

<span class="n">image</span> <span class="o">=</span> <span class="n">pipe3</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s1">&#39;starfield_asnfile.json&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Image 3 pipeline finished.&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><a id="output_ID"></a></p>
</section>
</section>
<section id="results">
<h2>Results<a class="headerlink" href="#results" title="Permalink to this headline">#</a></h2>
<p>Read in the output of the pipeline and check your results.</p>
<section id="read-in-output-table-of-source-catalog-step-and-print-ecsv-table">
<h3>Read in output table of source_catalog step and print ecsv table<a class="headerlink" href="#read-in-output-table-of-source-catalog-step-and-print-ecsv-table" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">photfile</span> <span class="o">=</span> <span class="s1">&#39;starfield_combined_cat.ecsv&#39;</span>
<span class="n">input_file</span> <span class="o">=</span> <span class="s1">&#39;starfield_combined_i2d.fits&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Look at subset of table with full columns</span>
<span class="c1"># If you have negative fluxes or repeated values of xcentroid or ycentroid, you may be finding spurious sources at image edges</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">Table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">photfile</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;ascii&#39;</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="s1">&#39;#&#39;</span><span class="p">)</span>

<span class="n">smalltable</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">,</span> <span class="s1">&#39;xcentroid&#39;</span><span class="p">,</span> <span class="s1">&#39;ycentroid&#39;</span><span class="p">,</span><span class="s1">&#39;aper30_flux&#39;</span><span class="p">,</span> <span class="s1">&#39;aper50_flux&#39;</span><span class="p">,</span> <span class="s1">&#39;aper70_flux&#39;</span><span class="p">,</span> <span class="s1">&#39;CI_50_30&#39;</span><span class="p">,</span> <span class="s1">&#39;CI_70_50&#39;</span><span class="p">,</span><span class="s1">&#39;aper_total_flux&#39;</span><span class="p">]</span>
<span class="n">smalltable</span><span class="o">.</span><span class="n">pprint_all</span><span class="p">()</span>
<span class="c1">#print(smalltable)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Look at catalog table that shows all columns, but subset of rows</span>
<span class="c1"># Pay attention to rows with a large number of nans, as this may indicate a spurious source</span>

<span class="n">catalog</span> <span class="o">=</span> <span class="n">Table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s2">&quot;starfield_combined_cat.ecsv&quot;</span><span class="p">)</span>
<span class="n">catalog</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="display-image-and-overplot-detector-sources-from-ecsv-table">
<h3>Display image and overplot detector sources from ecsv table<a class="headerlink" href="#display-image-and-overplot-detector-sources-from-ecsv-table" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Read in i2d combined Image</span>
<span class="n">im_i2d</span> <span class="o">=</span> <span class="n">ImageModel</span><span class="p">(</span><span class="n">input_file</span><span class="p">)</span>    
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># read in ecsv photom file</span>
<span class="kn">from</span> <span class="nn">astropy.visualization</span> <span class="kn">import</span> <span class="n">LogStretch</span><span class="p">,</span> <span class="n">PercentileInterval</span><span class="p">,</span> <span class="n">ManualInterval</span>
<span class="kn">from</span> <span class="nn">astropy</span> <span class="kn">import</span> <span class="n">table</span>

<span class="n">viz2</span> <span class="o">=</span> <span class="n">LogStretch</span><span class="p">()</span> <span class="o">+</span> <span class="n">ManualInterval</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>
<span class="c1">#plt.imshow(viz2(im_i2d.data), origin=&#39;lower&#39;)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">im_i2d</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;rainbow&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;xcentroid&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;ycentroid&#39;</span><span class="p">],</span><span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="in-the-image-above-check-that-the-stars-found-by-source-catalog-red-overlap-with-stars-in-the-image">
<h3>In the image above, check that the stars found by source catalog (red) overlap with stars in the image<a class="headerlink" href="#in-the-image-above-check-that-the-stars-found-by-source-catalog-red-overlap-with-stars-in-the-image" title="Permalink to this headline">#</a></h3>
</section>
<section id="look-at-the-fluxes-of-the-sources-found">
<h3>Look at the fluxes of the sources found<a class="headerlink" href="#look-at-the-fluxes-of-the-sources-found" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#create_scatterplot(catalog[&#39;label&#39;], catalog[&#39;aper_total_flux&#39;],title=&#39;Total Flux in &#39;+str(catalog[&#39;aper_total_flux&#39;].unit))</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">()</span>

<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">catalog</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">],</span> <span class="n">catalog</span><span class="p">[</span><span class="s1">&#39;aper_total_flux&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Total Flux in &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">catalog</span><span class="p">[</span><span class="s1">&#39;aper_total_flux&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unit</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;label&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;aper_total_flux&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="look-at-ab-mag-of-sources-found">
<h3>Look at AB mag of sources found<a class="headerlink" href="#look-at-ab-mag-of-sources-found" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">create_scatterplot</span><span class="p">(</span><span class="n">catalog</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">],</span> <span class="n">catalog</span><span class="p">[</span><span class="s1">&#39;aper_total_abmag&#39;</span><span class="p">],</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Total AB mag&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="look-at-the-errors-on-the-ab-magnitudes">
<h3>Look at the errors on the AB magnitudes<a class="headerlink" href="#look-at-the-errors-on-the-ab-magnitudes" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">create_scatterplot</span><span class="p">(</span><span class="n">catalog</span><span class="p">[</span><span class="s1">&#39;aper_total_abmag&#39;</span><span class="p">],</span> <span class="n">catalog</span><span class="p">[</span><span class="s1">&#39;aper_total_abmag_err&#39;</span><span class="p">],</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Total AB mag vs error&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="manually-find-matches">
<h3>Manually find matches<a class="headerlink" href="#manually-find-matches" title="Permalink to this headline">#</a></h3>
<p>Since this is a simulated data set, we can compare the output catalog information from the pipeline with the input catalog information used to create the simulation. Grab the input catalog x,y values and the output catalog x and y values.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Read in catalogs used for simulated data</span>
<span class="n">sim_star_cat</span> <span class="o">=</span> <span class="n">Table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;input_sim_stars.cat&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;ascii&#39;</span><span class="p">)</span>
<span class="n">sim_gal_cat</span> <span class="o">=</span> <span class="n">Table</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;input_sim_galaxies.cat&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;ascii&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sim_star_cat</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># join the star and galaxy catalogs used to make the simulations</span>
<span class="n">combined</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">sim_star_cat</span><span class="p">,</span> <span class="n">sim_gal_cat</span><span class="p">])</span>
<span class="n">combined</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sim_ra</span> <span class="o">=</span> <span class="n">combined</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span><span class="o">/</span><span class="mf">3600.</span>
<span class="n">sim_dec</span> <span class="o">=</span> <span class="n">combined</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span><span class="o">/</span><span class="mf">3600.</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="use-miri-software-to-put-x-y-coordinates-from-input-catalog-into-ra-dec-coordinates">
<h3>Use MIRI software to put x, y coordinates from input catalog into RA, Dec coordinates<a class="headerlink" href="#use-miri-software-to-put-x-y-coordinates-from-input-catalog-into-ra-dec-coordinates" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Put star positions into RA and Dec</span>

<span class="c1"># import coordinate conversion tools</span>
<span class="c1">#import miricoord.tel.tel_tools as teltools</span>
<span class="c1">#import miricoord.imager.mirim_pipetools as mpt</span>
<span class="c1">#import miricoord.imager.mirim_tools as mt</span>
<span class="c1">#import pysiaf</span>

<span class="c1">#filt = &#39;F560W&#39;</span>
<span class="c1"># use pipeline to get v2ref and v3ref coordinates</span>
<span class="c1">#siaf = pysiaf.Siaf(&#39;MIRI&#39;)</span>
<span class="c1">#xref,yref=siaf[&#39;MIRIM_FULL&#39;].XDetRef,siaf[&#39;MIRIM_FULL&#39;].YDetRef</span>
<span class="c1">#xref,yref=xref-1,yref-1</span>
<span class="c1">#v2ref,v3ref=mt.xytov2v3(xref,yref,filt)</span>

<span class="c1"># set reference for RA and Dec</span>
<span class="c1">#raref = 0.0</span>
<span class="c1">#decref = 0.0</span>
<span class="c1">#rollref = 0.0</span>

<span class="c1">#sim_ra = np.zeros(len(combined))</span>
<span class="c1">#sim_dec = np.zeros(len(combined))</span>

<span class="c1"># cycle through list of coordinates input into scene and get RA/Dec values out, printing to file</span>
<span class="c1">#for i in range(len(combined)):</span>
    <span class="c1">#print(combined[&#39;x&#39;][i])</span>
<span class="c1">#    v2 = v2ref + combined[&#39;x&#39;][i]</span>
<span class="c1">#    v3 = v3ref + combined[&#39;y&#39;][i]</span>
<span class="c1">#    ra,dec,newroll=teltools.jwst_v2v3toradec(v2,v3,v2ref=v2ref,v3ref=v3ref,raref=raref,decref=decref,rollref=rollref)</span>
    
<span class="c1">#    sim_ra[i] = ra</span>
<span class="c1">#    sim_dec[i] = dec</span>
    
<span class="c1">#print(np.shape(sim_ra))</span>
<span class="c1">#print(sim_ra, sim_dec)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="compare-ra-dec-coordinates-between-simulator-catalog-and-output-catalog-to-find-matches">
<h3>Compare RA, Dec coordinates between simulator catalog and output catalog to find matches<a class="headerlink" href="#compare-ra-dec-coordinates-between-simulator-catalog-and-output-catalog-to-find-matches" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cat_ra</span> <span class="o">=</span> <span class="n">catalog</span><span class="p">[</span><span class="s1">&#39;sky_centroid&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">ra</span><span class="o">.</span><span class="n">deg</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cat_ra</span><span class="p">)):</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">cat_ra</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">&gt;</span><span class="mf">180.</span><span class="p">):</span>
        <span class="n">cat_ra</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-=</span> <span class="mf">360.</span>
<span class="n">cat_dec</span> <span class="o">=</span> <span class="n">catalog</span><span class="p">[</span><span class="s1">&#39;sky_centroid&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dec</span><span class="o">.</span><span class="n">deg</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># set the tolerance for differences and initialize counters</span>

<span class="n">tol</span> <span class="o">=</span> <span class="mf">1.e-5</span>    <span class="c1"># Set tolerance around 30 mas (units here are in degrees; 36 mas ~ 1e-5 deg)</span>
<span class="n">found_count</span><span class="o">=</span><span class="mi">0</span>
<span class="n">multiples_count</span><span class="o">=</span><span class="mi">0</span>
<span class="n">missed_count</span><span class="o">=</span><span class="mi">0</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set up array for matches</span>
<span class="n">detected</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">chararray</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sim_ra</span><span class="p">))</span>
<span class="c1">#print(np.shape(detected))</span>

<span class="k">for</span> <span class="n">ra</span><span class="p">,</span><span class="n">dec</span><span class="p">,</span><span class="n">idx</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">sim_ra</span><span class="p">,</span> <span class="n">sim_dec</span><span class="p">,</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sim_ra</span><span class="p">))):</span>

    <span class="n">match</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">ra</span><span class="o">-</span><span class="n">cat_ra</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">tol</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">dec</span><span class="o">-</span><span class="n">cat_dec</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">tol</span><span class="p">))</span>
    <span class="c1">#print(&#39;match&#39;, match)</span>
    
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">match</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> 
        <span class="n">found_count</span> <span class="o">+=</span><span class="mi">1</span> 
        <span class="n">detected</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Y&#39;</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">match</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>  
        <span class="n">multiples_count</span> <span class="o">+=</span><span class="mi">1</span>       
        
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">match</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">missed_count</span> <span class="o">+=</span><span class="mi">1</span>

<span class="c1">#print(np.shape(detected))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">total_percent_found</span> <span class="o">=</span> <span class="p">(</span><span class="n">found_count</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">sim_ra</span><span class="p">))</span><span class="o">*</span><span class="mi">100</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;SNR threshold used for pipeline: &#39;</span><span class="p">,</span><span class="n">pipe3</span><span class="o">.</span><span class="n">source_catalog</span><span class="o">.</span><span class="n">snr_threshold</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Total matches found:&#39;</span><span class="p">,</span><span class="n">found_count</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Total missed:&#39;</span><span class="p">,</span><span class="n">missed_count</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Number of multiples: &#39;</span><span class="p">,</span><span class="n">multiples_count</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Total number of input (simulated) sources:&#39;</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">combined</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Total number in output catalog:&#39;</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">catalog</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Total percent found:&#39;</span><span class="p">,</span><span class="n">total_percent_found</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="use-photutils-to-find-catalog-matches-and-compare-which-sources-were-found-and-matched">
<h3>Use photutils to find catalog matches and compare which sources were found and matched.<a class="headerlink" href="#use-photutils-to-find-catalog-matches-and-compare-which-sources-were-found-and-matched" title="Permalink to this headline">#</a></h3>
<p>Photutils includes a package to match sources between catalogs by providing a max separation value. Set that value and compare the two catalogs.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">catalog_in</span> <span class="o">=</span> <span class="n">SkyCoord</span><span class="p">(</span><span class="n">ra</span><span class="o">=</span><span class="n">sim_ra</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">degree</span><span class="p">,</span> <span class="n">dec</span><span class="o">=</span><span class="n">sim_dec</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">degree</span><span class="p">)</span> <span class="c1"># full simulated catalog, stars+galaxies</span>
<span class="n">catalog_out</span> <span class="o">=</span> <span class="n">SkyCoord</span><span class="p">(</span><span class="n">ra</span><span class="o">=</span><span class="n">cat_ra</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">degree</span><span class="p">,</span> <span class="n">dec</span><span class="o">=</span><span class="n">cat_dec</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">degree</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">max_sep</span> <span class="o">=</span> <span class="mf">0.04</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">arcsec</span> <span class="c1"># Set match at around 30 mas</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># match full tables</span>
<span class="n">idx</span><span class="p">,</span> <span class="n">d2d</span><span class="p">,</span> <span class="n">d3d</span> <span class="o">=</span> <span class="n">match_coordinates_sky</span><span class="p">(</span><span class="n">catalog_in</span><span class="p">,</span> <span class="n">catalog_out</span><span class="p">)</span>
<span class="n">sep_constraint</span> <span class="o">=</span> <span class="n">d2d</span> <span class="o">&lt;</span> <span class="n">max_sep</span>
<span class="n">combined_matched</span> <span class="o">=</span> <span class="n">combined</span><span class="p">[</span><span class="n">sep_constraint</span><span class="p">]</span> <span class="c1"># simulated sources matched</span>
<span class="n">catalog_matched</span> <span class="o">=</span> <span class="n">catalog</span><span class="p">[</span><span class="n">idx</span><span class="p">[</span><span class="n">sep_constraint</span><span class="p">]]</span> <span class="c1"># sources found matched</span>

<span class="nb">print</span><span class="p">(</span><span class="n">catalog_matched</span><span class="o">.</span><span class="n">colnames</span><span class="p">)</span>
<span class="nb">print</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">catalog_matched</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#match RA and Dec</span>
<span class="n">idx</span><span class="p">,</span> <span class="n">d2d</span><span class="p">,</span> <span class="n">d3d</span> <span class="o">=</span> <span class="n">match_coordinates_sky</span><span class="p">(</span><span class="n">catalog_in</span><span class="p">,</span> <span class="n">catalog_out</span><span class="p">)</span>
<span class="n">sep_constraint</span> <span class="o">=</span> <span class="n">d2d</span> <span class="o">&lt;</span> <span class="n">max_sep</span>
<span class="n">catalog_in_matches</span> <span class="o">=</span> <span class="n">catalog_in</span><span class="p">[</span><span class="n">sep_constraint</span><span class="p">]</span>
<span class="n">catalog_out_matches</span> <span class="o">=</span> <span class="n">catalog_out</span><span class="p">[</span><span class="n">idx</span><span class="p">[</span><span class="n">sep_constraint</span><span class="p">]]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">catalog_out_matches</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now, catalog_in_matches and catalog_out_matches are the matched sources in catalog_in and catalog_out, respectively, which are separated less than our max_sep value.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Number of matched sources using max separation of &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">max_sep</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;: &#39;</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">catalog_matched</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="plot-ra-and-dec-positions-of-both-catalogs">
<h3>Plot RA and Dec positions of both catalogs<a class="headerlink" href="#plot-ra-and-dec-positions-of-both-catalogs" title="Permalink to this headline">#</a></h3>
<p>The simulated positions are in red and the sources found with source catalog are marked in blue. Matched sources from both are marked in green.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#rrr = catalog_in_matches.ra.deg</span>
<span class="c1">#ddd = catalog_in_matches.dec.deg</span>

<span class="n">rrr</span> <span class="o">=</span> <span class="n">catalog_matched</span><span class="p">[</span><span class="s1">&#39;sky_centroid&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">ra</span><span class="o">.</span><span class="n">deg</span>
<span class="n">ddd</span> <span class="o">=</span> <span class="n">catalog_matched</span><span class="p">[</span><span class="s1">&#39;sky_centroid&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dec</span><span class="o">.</span><span class="n">deg</span>

<span class="c1"># make sure ra is in proper range for display</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rrr</span><span class="p">)):</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">rrr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">&gt;</span><span class="mf">180.</span><span class="p">):</span>
        <span class="n">rrr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-=</span> <span class="mf">360.</span>
        
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">rrr</span><span class="p">,</span> <span class="n">ddd</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">108</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">sim_ra</span><span class="p">,</span> <span class="n">sim_dec</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">cat_ra</span><span class="p">,</span> <span class="n">cat_dec</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="convert-matched-ra-dec-coordinates-back-to-x-y-positions-and-plot-matched-stars-on-image">
<h3>Convert matched RA/Dec coordinates back to x,y positions and plot matched stars on image<a class="headerlink" href="#convert-matched-ra-dec-coordinates-back-to-x-y-positions-and-plot-matched-stars-on-image" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Convert matched RA/Dec values back to x, y to plot on image</span>

<span class="c1">#print(catalog_out_matches)</span>

<span class="c1"># Read in wcs values from file header (in extension 1)</span>
<span class="c1">#hdu = fits.open(input_file)[1]  </span>
<span class="c1">#wcs = WCS(hdu.header)  </span>

<span class="c1"># convert positions from RA/Dec back to x,y</span>

<span class="c1">#x_matched, y_matched = wcs.world_to_pixel(catalog_out_matches)</span>

<span class="c1">#print(x_matched)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot all matched sources in red</span>

<span class="n">viz2</span> <span class="o">=</span> <span class="n">LogStretch</span><span class="p">()</span> <span class="o">+</span> <span class="n">ManualInterval</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>
<span class="c1">#plt.imshow(viz2(im_i2d.data), origin=&#39;lower&#39;)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">im_i2d</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;rainbow&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="c1">#plt.scatter(x_matched, y_matched,lw=1, s=10,color=&#39;red&#39;)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">catalog_matched</span><span class="p">[</span><span class="s1">&#39;xcentroid&#39;</span><span class="p">],</span> <span class="n">catalog_matched</span><span class="p">[</span><span class="s1">&#39;ycentroid&#39;</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>      
</pre></div>
</div>
</div>
</div>
</section>
<section id="compare-to-full-catalog-and-see-where-differences-are">
<h3>Compare to full catalog and see where differences are<a class="headerlink" href="#compare-to-full-catalog-and-see-where-differences-are" title="Permalink to this headline">#</a></h3>
<p>The full source_catalog output is shown with black dots and the matched sources are shown with smaller white dots over the black dots. This shows the sources that were found in the catalog (source_catalog step) but not listed as a match between the input and calculated catalogs.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">viz2</span> <span class="o">=</span> <span class="n">LogStretch</span><span class="p">()</span> <span class="o">+</span> <span class="n">ManualInterval</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>
<span class="c1">#plt.imshow(viz2(im_i2d.data), origin=&#39;lower&#39;)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">im_i2d</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;rainbow&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;xcentroid&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;ycentroid&#39;</span><span class="p">],</span><span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
<span class="c1">#plt.scatter(x_matched, y_matched,lw=1, s=5,color=&#39;white&#39;)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">catalog_matched</span><span class="p">[</span><span class="s1">&#39;xcentroid&#39;</span><span class="p">],</span> <span class="n">catalog_matched</span><span class="p">[</span><span class="s1">&#39;ycentroid&#39;</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="look-at-positions-of-sources-in-the-simulated-images-from-the-catalogs-used-to-create-the-images">
<h3>Look at positions of sources in the simulated images from the catalogs used to create the images<a class="headerlink" href="#look-at-positions-of-sources-in-the-simulated-images-from-the-catalogs-used-to-create-the-images" title="Permalink to this headline">#</a></h3>
<p>Are there more stars/galaxies in the simulation input catalogs than actually fit on the combined image? That would explain the sources beyond image edges.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">catalog_in</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Read in wcs values from file header (in extension 1)</span>
<span class="n">hdu</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">input_file</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>  
<span class="n">wcs</span> <span class="o">=</span> <span class="n">WCS</span><span class="p">(</span><span class="n">hdu</span><span class="o">.</span><span class="n">header</span><span class="p">)</span>  

<span class="c1"># convert positions from RA/Dec back to x,y</span>

<span class="n">x_sim</span><span class="p">,</span> <span class="n">y_sim</span> <span class="o">=</span> <span class="n">wcs</span><span class="o">.</span><span class="n">world_to_pixel</span><span class="p">(</span><span class="n">catalog_in</span><span class="p">)</span>

<span class="c1"># Many sources go beyond image edges. Only display sources that were actually in FOV of combined image.</span>
<span class="n">minval</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">maxval</span> <span class="o">=</span> <span class="mi">1140</span>

<span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">x_sim</span> <span class="o">&gt;</span> <span class="n">minval</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x_sim</span> <span class="o">&lt;</span> <span class="mi">1110</span><span class="p">)</span><span class="o">&amp;</span> <span class="p">(</span><span class="n">y_sim</span> <span class="o">&gt;</span> <span class="n">minval</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">y_sim</span> <span class="o">&lt;</span> <span class="n">maxval</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">viz2</span> <span class="o">=</span> <span class="n">LogStretch</span><span class="p">()</span> <span class="o">+</span> <span class="n">ManualInterval</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>
<span class="c1">#plt.imshow(viz2(im_i2d.data), origin=&#39;lower&#39;)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">im_i2d</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;rainbow&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x_sim</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span> <span class="n">y_sim</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span><span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="compare-fluxes-between-input-sources-and-output-catalog">
<h2>Compare fluxes between input sources and output catalog<a class="headerlink" href="#compare-fluxes-between-input-sources-and-output-catalog" title="Permalink to this headline">#</a></h2>
<p>Input catalog combined has Ks and J columns for stars and flux for galaxies.
Output source catalog catalog has aper_total_flux, isophotal_flux, aper_total_abmag, aper_total_vegamag, isophotal_abmag and isophotal_vegamag.</p>
<p>The first plot compares the magnitudes for the input simulated catalog (in blue) and the sources found with source catalog in green.</p>
<section id="compare-the-star-magnitudes-and-magnitude-differences-to-the-x-position-of-the-stars">
<h3>Compare the star magnitudes and magnitude differences to the x position of the stars.<a class="headerlink" href="#compare-the-star-magnitudes-and-magnitude-differences-to-the-x-position-of-the-stars" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">flux</span><span class="p">,</span> <span class="n">wref</span> <span class="o">=</span> <span class="n">mag2flux</span><span class="p">(</span><span class="n">combined_matched</span><span class="p">[</span><span class="s1">&#39;Ks&#39;</span><span class="p">],</span> <span class="n">band</span><span class="o">=</span><span class="s2">&quot;Ks&quot;</span><span class="p">,</span> <span class="n">system</span><span class="o">=</span><span class="s2">&quot;2MASS&quot;</span><span class="p">)</span>
<span class="n">fnew</span> <span class="o">=</span> <span class="n">extrapolate_flux</span><span class="p">(</span><span class="n">flux</span><span class="p">,</span> <span class="n">wref</span><span class="p">,</span> <span class="mf">7.7</span><span class="p">,</span> <span class="n">combined_matched</span><span class="p">[</span><span class="s1">&#39;Teff&#39;</span><span class="p">])</span>
<span class="n">F770W_ABmag</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">((</span><span class="n">fnew</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">Jy</span><span class="p">))</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="o">+</span> <span class="mf">8.9</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="plot-ab-mag-vs-x-position">
<h3>Plot AB mag vs x position<a class="headerlink" href="#plot-ab-mag-vs-x-position" title="Permalink to this headline">#</a></h3>
<p>Simulated stars in blue, sources found in green.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">()</span>

<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">catalog_matched</span><span class="p">[</span><span class="s1">&#39;xcentroid&#39;</span><span class="p">],</span> <span class="n">F770W_ABmag</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Simulated stars&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">catalog_matched</span><span class="p">[</span><span class="s1">&#39;xcentroid&#39;</span><span class="p">],</span> <span class="n">catalog_matched</span><span class="p">[</span><span class="s1">&#39;aper_total_abmag&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Sources found&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;X position in pixels&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;AB mag&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="plot-difference-in-magnitude-against-x-and-y-position">
<h3>Plot difference in magnitude against x and y position.<a class="headerlink" href="#plot-difference-in-magnitude-against-x-and-y-position" title="Permalink to this headline">#</a></h3>
<p>Found catalog minus matched simulated AB mag vs. x position and vs. y position, with the median magnitude difference plotted as a horizontal line in red.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">()</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">catalog_matched</span><span class="p">[</span><span class="s1">&#39;xcentroid&#39;</span><span class="p">],</span> <span class="n">F770W_ABmag</span><span class="o">-</span><span class="n">catalog_matched</span><span class="p">[</span><span class="s1">&#39;aper_total_abmag&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>

<span class="c1">#ax.legend()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;ABmag difference (simulated - found) vs. x position&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;X position in pixels&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Delta AB mag&#39;</span><span class="p">)</span>

<span class="n">ok</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">F770W_ABmag</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">,</span> <span class="n">F770W_ABmag</span><span class="o">&lt;</span><span class="mi">100</span><span class="p">)</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">F770W_ABmag</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span><span class="o">-</span><span class="n">catalog_matched</span><span class="p">[</span><span class="s1">&#39;aper_total_abmag&#39;</span><span class="p">][</span><span class="n">ok</span><span class="p">]</span>
<span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">m</span><span class="p">),</span> <span class="nb">min</span><span class="p">(</span><span class="n">catalog_matched</span><span class="p">[</span><span class="s1">&#39;xcentroid&#39;</span><span class="p">]),</span> <span class="nb">max</span><span class="p">(</span><span class="n">catalog_matched</span><span class="p">[</span><span class="s1">&#39;xcentroid&#39;</span><span class="p">]),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">()</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">catalog_matched</span><span class="p">[</span><span class="s1">&#39;ycentroid&#39;</span><span class="p">],</span> <span class="n">F770W_ABmag</span><span class="o">-</span><span class="n">catalog_matched</span><span class="p">[</span><span class="s1">&#39;aper_total_abmag&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
<span class="c1">#ax.legend()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;ABmag difference (simulated - found) vs. y position&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Y position in pixels&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Delta AB mag&#39;</span><span class="p">)</span>

<span class="n">ok</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">F770W_ABmag</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">,</span> <span class="n">F770W_ABmag</span><span class="o">&lt;</span><span class="mi">100</span><span class="p">)</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">F770W_ABmag</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span><span class="o">-</span><span class="n">catalog_matched</span><span class="p">[</span><span class="s1">&#39;aper_total_abmag&#39;</span><span class="p">][</span><span class="n">ok</span><span class="p">]</span>
<span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">m</span><span class="p">),</span> <span class="nb">min</span><span class="p">(</span><span class="n">catalog_matched</span><span class="p">[</span><span class="s1">&#39;ycentroid&#39;</span><span class="p">]),</span> <span class="nb">max</span><span class="p">(</span><span class="n">catalog_matched</span><span class="p">[</span><span class="s1">&#39;ycentroid&#39;</span><span class="p">]),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="plot-ab-magnitude-difference-against-ab-mag-to-see-if-there-is-a-pattern-in-the-differences-by-mag">
<h3>Plot AB magnitude difference against AB mag to see if there is a pattern in the differences by mag.<a class="headerlink" href="#plot-ab-magnitude-difference-against-ab-mag-to-see-if-there-is-a-pattern-in-the-differences-by-mag" title="Permalink to this headline">#</a></h3>
<p>Median difference marked by line in red.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">()</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">F770W_ABmag</span><span class="p">,</span> <span class="n">F770W_ABmag</span><span class="o">-</span><span class="n">catalog_matched</span><span class="p">[</span><span class="s1">&#39;aper_total_abmag&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
<span class="c1">#ax.legend()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Difference in AB mag (simulated-found) vs. ABmag (simulated)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;AB mag&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Delta AB mag&#39;</span><span class="p">)</span>

<span class="n">ok</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">F770W_ABmag</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">,</span> <span class="n">F770W_ABmag</span><span class="o">&lt;</span><span class="mi">100</span><span class="p">)</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">F770W_ABmag</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span><span class="o">-</span><span class="n">catalog_matched</span><span class="p">[</span><span class="s1">&#39;aper_total_abmag&#39;</span><span class="p">][</span><span class="n">ok</span><span class="p">]</span>
<span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">m</span><span class="p">),</span> <span class="mi">16</span><span class="p">,</span> <span class="mf">24.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="passing-criteria">
<h4>Passing criteria<a class="headerlink" href="#passing-criteria" title="Permalink to this headline">#</a></h4>
<p>Look at the matched image to see what sources were matched between the simulated and found catalogs and see if there is a pattern to which found sources were not matched to the simulated catalog. Are they mostly galaxies or were the found sources in areas of confusion between two stars or sources where the source finding algorithm might not have pinpointed the actual centroid of the source. If the majority of the sources matched seem to be the stars that are clearly marked and properly found, that part of the test passes.</p>
<p>If the plots showing magnitudes of the matched sources show that theyre close (exact criteria for close TBD), then that test passes.</p>
<p>This test is mostly visual inspection of the images and plots. As long as nothing is obviously wrong (no columns in the table marked as all NaNs, sources found seem to be real sources, and a good number of them match the simulated sources input into the image), then this test passes.</p>
</section>
<section id="about-this-notebook">
<h4>About this Notebook<a class="headerlink" href="#about-this-notebook" title="Permalink to this headline">#</a></h4>
<p>Authors: M. Cracraft, M. Libralato and T. Temim, MIRI Branch</p>
<p>Updated On: 08/18/2021</p>
</section>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "TheRealZoidberg/jwst_validation_test",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./notebooks/source_catalog/jwst_source_catalog_miri_test"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="exec_jwst_source_catalog_miri_test.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">JWST Pipeline Validation Notebook: calwebb_image3: source_catalog with MIRI</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="../jwst_source_catalog_nircam_test/jwst_nircam_imaging_source_catalog.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">JWST Pipeline Validation Notebook: NIRCam, calwebb_image3, source_catalog</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By STScI<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>